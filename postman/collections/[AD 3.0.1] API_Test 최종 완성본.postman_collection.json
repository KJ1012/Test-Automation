{
	"info": {
		"_postman_id": "6f1afdb7-c141-4f98-80d5-6a29380ebc44",
		"name": "[AD 3.0.1] API_Test ìµœì¢… ì™„ì„±ë³¸",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "47877169",
		"_collection_link": "https://neurophet-7450.postman.co/workspace/demo~cec5f3f7-bdde-45ce-b34a-dbeae7fb6678/collection/40885812-6f1afdb7-c141-4f98-80d5-6a29380ebc44?action=share&source=collection_link&creator=47877169"
	},
	"item": [
		{
			"name": "user_Patient",
			"item": [
				{
					"name": "patient",
					"item": [
						{
							"name": "user ê³„ì • ë¡œê·¸ì¸ ì„±ê³µ",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// ===== 0) SJCL ì†ŒìŠ¤ ë¡œë“œ (ë„¤íŠ¸ì›Œí¬ X) =====\r",
											"const SJCL_SRC = pm.environment.get(\"sjcl_src\") || pm.globals.get(\"sjcl_src\");\r",
											"if (!SJCL_SRC) throw new Error(\"sjcl_src ë³€ìˆ˜ì— sjcl.js ì „ì²´ ì†ŒìŠ¤ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.\");\r",
											"\r",
											"// ë…ë¦½ ìŠ¤ì½”í”„ì—ì„œ SJCL ê°ì²´ íšŒìˆ˜ (eval ìŠ¤ì½”í”„ ë¬¸ì œ ë°©ì§€)\r",
											"function buildSJCL(src) {\r",
											"  const factory = new Function(`\r",
											"    var window = {}; var self = window; var global = window;\r",
											"    var module = { exports: {} }; var exports = module.exports;\r",
											"    ${src}\r",
											"    return (typeof sjcl !== \"undefined\") ? sjcl\r",
											"         : (module && module.exports ? module.exports\r",
											"         : (window.sjcl || exports.sjcl));\r",
											"  `);\r",
											"  const lib = factory();\r",
											"  if (!lib || !lib.cipher || !lib.mode || !lib.codec) throw new Error(\"SJCL ë¡œë“œ ì‹¤íŒ¨\");\r",
											"  return lib;\r",
											"}\r",
											"const SJCL = buildSJCL(SJCL_SRC);\r",
											"\r",
											"// ===== 1) CryptoJS (Postman ë‚´ì¥) =====\r",
											"const CryptoJS = require(\"crypto-js\");\r",
											"\r",
											"// ===== 2) ìœ í‹¸ =====\r",
											"function randomBytes(n){\r",
											"  const wa = CryptoJS.lib.WordArray.random(n);\r",
											"  const hex = wa.toString(CryptoJS.enc.Hex);\r",
											"  const out = [];\r",
											"  for (let i=0;i<hex.length;i+=2) out.push(parseInt(hex.substr(i,2),16));\r",
											"  return out;\r",
											"}\r",
											"function bytesToBits(bytes){\r",
											"  let hex = \"\";\r",
											"  for (let i=0;i<bytes.length;i++){\r",
											"    const h = bytes[i].toString(16);\r",
											"    hex += (h.length===1 ? \"0\"+h : h);\r",
											"  }\r",
											"  return SJCL.codec.hex.toBits(hex);\r",
											"}\r",
											"\r",
											"// AES-128-GCM (iv 12B, tag 16B), í‚¤: sha256(key).hex -> ì•16(ASCII, UPPER)\r",
											"function encryptOnce(keyStr, plain){\r",
											"  const ivBytes = randomBytes(12);                        // IV_LENGTH = 12\r",
											"  const ivBits  = bytesToBits(ivBytes);\r",
											"\r",
											"  const tempKeyHex   = CryptoJS.SHA256(keyStr).toString(CryptoJS.enc.Hex).toUpperCase();\r",
											"  const secretKeyStr = tempKeyHex.substring(0,16).toUpperCase();    // ASCII 16 bytes\r",
											"  const keyBits = SJCL.codec.utf8String.toBits(secretKeyStr);\r",
											"\r",
											"  const ptBits = SJCL.codec.utf8String.toBits(plain);\r",
											"  const aes    = new SJCL.cipher.aes(keyBits);\r",
											"\r",
											"  const ctWithTag = SJCL.mode.gcm.encrypt(aes, ptBits, ivBits, [], 128); // tag 128-bit\r",
											"  const combined  = SJCL.bitArray.concat(bytesToBits(ivBytes), ctWithTag);// iv + ct + tag\r",
											"  return SJCL.codec.base64.fromBits(combined);                            // standard Base64\r",
											"}\r",
											"\r",
											"// ===== 3) ë©”ì¸: ë°”ë””ì—ì„œ ID/íŒ¨ìŠ¤ì›Œë“œ ì½ì–´ ë™ì¼ IDë¡œ ì•”í˜¸í™” =====\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"\r",
											"let body;\r",
											"try {\r",
											"  body = JSON.parse(pm.request.body.raw || \"{}\");\r",
											"} catch (e) {\r",
											"  throw new Error(\"Bodyê°€ JSONì´ ì•„ë‹™ë‹ˆë‹¤.\");\r",
											"}\r",
											"\r",
											"// ì„œë²„ê°€ ì½ëŠ” ID í•„ë“œëª…ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš© (loginId / id / userId ì¤‘ í•˜ë‚˜)\r",
											"const keyId = String(body.loginId ?? body.id ?? body.userId ?? \"\").trim();\r",
											"if (!keyId) throw new Error(\"Bodyì— loginId/id/userId ì¤‘ í•˜ë‚˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.\");\r",
											"\r",
											"let plainPw;\r",
											"if (typeof body.password === \"string\" && body.password.trim() && !body.password.includes(\"{{\")) {\r",
											"  // ë°”ë””ì— í‰ë¬¸ì´ ìˆìœ¼ë©´ ê·¸ê±¸ ì‚¬ìš©\r",
											"  plainPw = body.password;\r",
											"} else {\r",
											"  // ì—†ìœ¼ë©´ í™˜ê²½ë³€ìˆ˜ì—ì„œ í‰ë¬¸ì„ ê°€ì ¸ì™€ ì‚¬ìš© (ì„ íƒ)\r",
											"  plainPw = pm.environment.get(\"PLAIN_PW\");\r",
											"  if (!plainPw) throw new Error(\"password í‰ë¬¸ì´ í•„ìš”í•©ë‹ˆë‹¤ (Body.password ë˜ëŠ” í™˜ê²½ë³€ìˆ˜ PLAIN_PW).\");\r",
											"}\r",
											"\r",
											"const encPw = encryptOnce(keyId, plainPw);\r",
											"\r",
											"// ë°”ë””ì— ì•”í˜¸ë¬¸ ë°˜ì˜\r",
											"body.password = encPw;\r",
											"pm.request.body.update(JSON.stringify(body));\r",
											"\r",
											"// í•„ìš” ì‹œ ë³€ìˆ˜ë¡œë„ ë…¸ì¶œ (ë‹¤ë¥¸ ìš”ì²­ì—ì„œ ì¬ì‚¬ìš©)\r",
											"pm.variables.set(\"ENC_PW\", encPw);\r",
											"\r",
											"// ë””ë²„ê·¸ ë¡œê·¸\r",
											"console.log(\"Enc with ID =\", keyId, \", Base64 length =\", encPw.length);\r",
											"\r",
											"\r",
											"\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// ë¡œê·¸ì¸ ì‘ë‹µ ì½”ë“œ ê²€ì‚¬\r",
											"if (pm.response.code === 200) {\r",
											"  pm.test(\"ë¡œê·¸ì¸ ì„±ê³µ\", function () {\r",
											"    pm.expect(pm.response.code).to.eql(200);\r",
											"  });\r",
											"\r",
											"  // ì‘ë‹µ JSON íŒŒì‹±\r",
											"  let jsonData; try { jsonData = pm.response.json(); } catch (e) { jsonData = null; }\r",
											"\r",
											"  if (jsonData && jsonData.result && jsonData.result.accessToken && jsonData.result.accessToken.token) {\r",
											"    const token = jsonData.result.accessToken.token;\r",
											"\r",
											"    // ğŸ‘‰ í™˜ê²½ë³€ìˆ˜ ì €ì¥\r",
											"    pm.environment.set(\"access_token\", token);\r",
											"    console.log(\"ğŸ”‘ í† í° ì €ì¥ë¨:\", token);\r",
											"  } else {\r",
											"    console.log(\"âš ï¸ ì‘ë‹µì—ì„œ í† í°ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\");\r",
											"  }\r",
											"\r",
											"} else {\r",
											"  // ì‹¤íŒ¨ ë©”ì‹œì§€ ì¶œë ¥\r",
											"  pm.test(\"ë¡œê·¸ì¸ ì‹¤íŒ¨ - ì‘ë‹µì½”ë“œ: \" + pm.response.code, function () {\r",
											"    pm.expect(pm.response.code).to.eql(200);\r",
											"  });\r",
											"}\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n  \"loginId\": \"kjhan\",\r\n  \"password\": \"marine6c!\",\r\n  \"isRestrictNewToken\": true\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/identity/api/access/login",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"identity",
										"api",
										"access",
										"login"
									]
								}
							},
							"response": []
						},
						{
							"name": "í™˜ì ëª©ë¡ ì¡°íšŒ_PATIENT ID ì €ì¥",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"const id = pm.environment.get(\"TARGET_IDENTIFIER\") || \"\"; // ì—†ìœ¼ë©´ ì „ì²´ê²€ìƒ‰\r",
											"const body = {\r",
											"  identifier: id,\r",
											"  name: \"\",\r",
											"  sex: null,\r",
											"  startDate: null,\r",
											"  endDate: null,\r",
											"  paginationReq: {\r",
											"    requestPageNumber: 1,\r",
											"    itemCountPerPage: 100,\r",
											"    order: \"desc\",\r",
											"    sortBy: \"\"\r",
											"  },\r",
											"  isSortById: false\r",
											"};\r",
											"\r",
											"// Content-Type ë³´ì •\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"// Body ì—…ë°ì´íŠ¸\r",
											"pm.request.body.update(JSON.stringify(body, null, 2));\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === 1) JSON íŒŒì‹± ===\r",
											"let json;\r",
											"try {\r",
											"  json = pm.response.json();\r",
											"} catch (e) {\r",
											"  pm.environment.unset(\"PATIENT_ID\");\r",
											"  console.error(\"ì‘ë‹µì´ JSONì´ ì•„ë‹˜:\", e);\r",
											"  return;\r",
											"}\r",
											"\r",
											"// === 2) contents ë°°ì—´ ì¶”ì¶œ ===\r",
											"let contents = [];\r",
											"try {\r",
											"  if (json && json.result && json.result.patientInfos && Array.isArray(json.result.patientInfos.contents)) {\r",
											"    contents = json.result.patientInfos.contents;\r",
											"  }\r",
											"} catch (_) {}\r",
											"\r",
											"// === 3) íƒ€ê¹ƒ identifier ê²°ì •\r",
											"// ìš°ì„ ìˆœìœ„: í™˜ê²½ë³€ìˆ˜ TARGET_IDENTIFIER > ìš”ì²­ bodyì˜ identifier(ë¹„ì–´ìˆì§€ ì•Šìœ¼ë©´) > \"sample_1\"\r",
											"let targetIdentifier = pm.environment.get(\"TARGET_IDENTIFIER\");\r",
											"if (!targetIdentifier) {\r",
											"  try {\r",
											"    const raw = pm.request.body && pm.request.body.raw ? pm.request.body.raw : \"{}\";\r",
											"    const body = JSON.parse(raw);\r",
											"    if (body && body.identifier) targetIdentifier = body.identifier;\r",
											"  } catch (_) {}\r",
											"}\r",
											"if (!targetIdentifier) targetIdentifier = \"sample_1\";\r",
											"\r",
											"// === 4) ë§¤ì¹­ ì°¾ê¸°\r",
											"const match = contents.find(o => o && o.identifier === targetIdentifier);\r",
											"\r",
											"// === 5) í™˜ê²½ë³€ìˆ˜ ì„¤ì • (ì½”ë“œ 200 + ë§¤ì¹­ ìˆì„ ë•Œë§Œ)\r",
											"if (json && json.code === 200 && match && match.id != null) {\r",
											"  pm.environment.set(\"PATIENT_ID\", String(match.id));\r",
											"  console.log(\"PATIENT_ID set to\", match.id);\r",
											"} else {\r",
											"  pm.environment.unset(\"PATIENT_ID\");\r",
											"  console.warn(\r",
											"    \"PATIENT_ID not set. ì´ìœ :\",\r",
											"    { code: json && json.code, targetIdentifier, identifiers: contents.map(x => x && x.identifier) }\r",
											"  );\r",
											"}\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/patient/search",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"patient",
										"search"
									]
								}
							},
							"response": []
						},
						{
							"name": "í™˜ì ëª©ë¡ ì¡°íšŒ_search",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === helpers ===\r",
											"function randStr(len=8) {\r",
											"  const chars = \"abcdefghijklmnopqrstuvwxyz0123456789\";\r",
											"  let s = \"\";\r",
											"  for (let i = 0; i < len; i++) s += chars[Math.floor(Math.random() * chars.length)];\r",
											"  return s;\r",
											"}\r",
											"function pick(arr) { return arr[Math.floor(Math.random() * arr.length)]; }\r",
											"function asBool(v) { return Math.random() < (v ?? 0.5); } // 50% ê¸°ë³¸\r",
											"\r",
											"function randomDateYYYYMMDD() {\r",
											"  // 2010-01-01 ~ ì˜¤ëŠ˜ ì‚¬ì´ ì„ì˜ ë‚ ì§œ\r",
											"  const start = new Date(Date.UTC(2010, 0, 1));\r",
											"  const end = new Date(); // ë¡œì»¬\r",
											"  const t = start.getTime() + Math.floor(Math.random() * (end.getTime() - start.getTime()));\r",
											"  const d = new Date(t);\r",
											"  const yyyy = d.getFullYear();\r",
											"  const mm = String(d.getMonth() + 1).padStart(2, \"0\");\r",
											"  const dd = String(d.getDate()).padStart(2, \"0\");\r",
											"  return `${yyyy}-${mm}-${dd}`;\r",
											"}\r",
											"\r",
											"// === token & headers ===\r",
											"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
											"\r",
											"// === fields ===\r",
											"// identifierì™€ nameì€ í•­ìƒ ë™ì¼í•œ ëœë¤ ë¬¸ìì—´\r",
											"const sameId = randStr(6);\r",
											"\r",
											"// sex: null, 'F', 'M', 'U' ì¤‘ ëœë¤ (nullë„ ì‹¤ì œ nullë¡œ ë³´ëƒ„)\r",
											"const sexOptions = [\"F\", \"M\", \"U\"];\r",
											"const sex = pick(sexOptions);\r",
											"\r",
											"// startDate/endDate: 50% í™•ë¥ ë¡œ ë‘˜ ë‹¤ null, ì•„ë‹ˆë©´ ë‘˜ ë‹¤ ê°™ì€ yyyy-mm-dd\r",
											"let startDate = null, endDate = null;\r",
											"if (!asBool(0.5)) {\r",
											"  const day = randomDateYYYYMMDD();\r",
											"  startDate = day;\r",
											"  endDate = day;\r",
											"}\r",
											"\r",
											"// isSortById: true/false ëœë¤\r",
											"const isSortById = asBool(0.5);\r",
											"\r",
											"// === payload êµ¬ì„± ===\r",
											"const body = {\r",
											"  identifier: sameId,\r",
											"  name: sameId,\r",
											"  sex: [sex],                // nullì´ë©´ JSONì˜ nullë¡œ ë“¤ì–´ê°‘ë‹ˆë‹¤.\r",
											"  startDate: startDate,    // ê·œì¹™: ë‘˜ ë‹¤ null ë˜ëŠ” ë™ì¼\r",
											"  endDate: endDate,\r",
											"  paginationReq: {\r",
											"    requestPageNumber: 1,\r",
											"    itemCountPerPage: 20,\r",
											"    order: \"desc\",\r",
											"    sortBy: \"\"             // ìš”ì²­ëŒ€ë¡œ ë¹ˆ ë¬¸ìì—´ ìœ ì§€\r",
											"  },\r",
											"  isSortById: isSortById\r",
											"};\r",
											"\r",
											"// === ìš”ì²­ ë°”ë”” ì£¼ì… ===\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(body));\r",
											"\r",
											"// === ë””ë²„ê¹…/ì²´ì´ë‹ìš© ì €ì¥ ===\r",
											"pm.variables.set(\"REQ_IDENTIFIER_NAME\", sameId);\r",
											"pm.variables.set(\"REQ_SEX\", sex === null ? \"null\" : sex);\r",
											"pm.variables.set(\"REQ_DATE\", startDate === null ? \"null\" : startDate);\r",
											"pm.variables.set(\"REQ_isSortById\", String(isSortById));\r",
											"console.log(\"[patient/search] payload:\", body);\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"HTTP 200\", () => pm.response.to.have.status(200));\r",
											"\r",
											"const sent = {\r",
											"  identifier_name: pm.variables.get(\"REQ_IDENTIFIER_NAME\"),\r",
											"  sex: pm.variables.get(\"REQ_SEX\"),\r",
											"  date: pm.variables.get(\"REQ_DATE\"),\r",
											"  isSortById: pm.variables.get(\"REQ_isSortById\")\r",
											"};\r",
											"console.log(\"[SENT TRACE]\", sent);\r",
											"\r",
											"// ì„œë¹„ìŠ¤ ê³µí†µ code í•„ë“œê°€ ìˆìœ¼ë©´ 200 í™•ì¸(ì˜µì…˜)\r",
											"let j={}; try{ j=pm.response.json(); }catch(e){}\r",
											"if (j && typeof j.code !== \"undefined\") {\r",
											"  pm.test(\"service code === 200\", () => pm.expect(j.code).to.eql(200));\r",
											"}\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/patient/search",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"patient",
										"search"
									]
								}
							},
							"response": []
						},
						{
							"name": "í™˜ì ëª©ë¡ ì¡°íšŒ_reset",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"HTTP 200\", () => pm.response.to.have.status(200));\r",
											"\r",
											"const sent = {\r",
											"  identifier_name: pm.variables.get(\"REQ_IDENTIFIER_NAME\"),\r",
											"  sex: pm.variables.get(\"REQ_SEX\"),\r",
											"  date: pm.variables.get(\"REQ_DATE\"),\r",
											"  isSortById: pm.variables.get(\"REQ_isSortById\")\r",
											"};\r",
											"console.log(\"[SENT TRACE]\", sent);\r",
											"\r",
											"// ì„œë¹„ìŠ¤ ê³µí†µ code í•„ë“œê°€ ìˆìœ¼ë©´ 200 í™•ì¸(ì˜µì…˜)\r",
											"let j={}; try{ j=pm.response.json(); }catch(e){}\r",
											"if (j && typeof j.code !== \"undefined\") {\r",
											"  pm.test(\"service code === 200\", () => pm.expect(j.code).to.eql(200));\r",
											"}\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n  \"identifier\": \"\",\r\n  \"name\": \"\",\r\n  \"sex\": null,\r\n  \"startDate\": null,\r\n  \"endDate\": null,\r\n  \"paginationReq\": {\r\n    \"requestPageNumber\": 1,\r\n    \"itemCountPerPage\": 20,\r\n    \"order\": \"desc\",\r\n    \"sortBy\": \"\"\r\n  },\r\n  \"isSortById\": false\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/patient/search",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"patient",
										"search"
									]
								}
							},
							"response": []
						},
						{
							"name": "í™˜ì ëª©ë¡ ì¡°íšŒ_sorting",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === ê¸°ë³¸ ë°”ë”” (ìš”ì²­í•˜ì‹  êµ¬ì¡°ì— ì •í™•íˆ ë§ì¶¤) ===\r",
											"let baseBody = {\r",
											"  identifier: \"\",\r",
											"  name: \"\",\r",
											"  sex: null,\r",
											"  startDate: null,\r",
											"  endDate: null,\r",
											"  paginationReq: {\r",
											"    requestPageNumber: 1,\r",
											"    itemCountPerPage: 20,\r",
											"    order: \"desc\",          // ë°˜ë“œì‹œ ì†Œë¬¸ì\r",
											"    sortBy: \"dateOfBirth\"   // ê¸°ë³¸ê°’\r",
											"  },\r",
											"  isSortById: true\r",
											"};\r",
											"\r",
											"// í™˜ê²½ë³€ìˆ˜ BASE_BODY_JSON ìˆìœ¼ë©´ ë³‘í•© (ì˜µì…˜)\r",
											"try {\r",
											"  const extra = pm.environment.get(\"BASE_BODY_JSON\");\r",
											"  if (extra) baseBody = Object.assign(baseBody, JSON.parse(extra));\r",
											"} catch (e) {}\r",
											"\r",
											"// === ì´ë²ˆ ë©”ì¸ ìš”ì²­: patientId DESC(ì†Œë¬¸ì 'desc') ===\r",
											"baseBody.paginationReq.order = \"desc\";\r",
											"baseBody.paginationReq.sortBy = \"patientId\";\r",
											"\r",
											"// í—¤ë”/í† í°\r",
											"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
											"\r",
											"// ë°”ë”” ì£¼ì…\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(baseBody));\r",
											"console.log(\"[MAIN REQ] body =\", baseBody);\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === patient/search ì •ë ¬ ê²€ì¦: ë©”ì¸(patientId desc) + 7ì¼€ì´ìŠ¤ ===\r",
											"(function () {\r",
											"  // 0) ë©”ì¸ ì‘ë‹µ ìƒíƒœ\r",
											"  pm.test(\"[MAIN] HTTP 200\", function(){ pm.response.to.have.status(200); });\r",
											"  try {\r",
											"    const j = pm.response.json();\r",
											"    if (j && typeof j.code !== \"undefined\") {\r",
											"      pm.test(\"[MAIN] Business code 200\", function(){ pm.expect(j.code).to.eql(200); });\r",
											"    }\r",
											"  } catch (e) {}\r",
											"\r",
											"  // 1) ë‚˜ë¨¸ì§€ ì¼€ì´ìŠ¤ (ëª¨ë‘ ìœ íš¨, ëª¨ë‘ 200 ê¸°ëŒ€)\r",
											"  const CASES_REST = [\r",
											"    { order: \"asc\",  sortBy: \"patientId\" },\r",
											"    { order: \"desc\", sortBy: \"patientName\" },\r",
											"    { order: \"asc\",  sortBy: \"patientName\" },\r",
											"    { order: \"desc\", sortBy: \"sex\" },\r",
											"    { order: \"asc\",  sortBy: \"sex\" },\r",
											"    { order: \"desc\", sortBy: \"dateOfBirth\" },\r",
											"    { order: \"asc\",  sortBy: \"dateOfBirth\" }\r",
											"  ];\r",
											"\r",
											"  // í—ˆìš© ê°’(ì†Œë¬¸ì!)\r",
											"  const ALLOWED_FIELDS = [\"patientId\",\"patientName\",\"sex\",\"dateOfBirth\"];\r",
											"  const ALLOWED_ORDERS = [\"asc\",\"desc\"];\r",
											"\r",
											"  // ê³µí†µ ì„¤ì •\r",
											"  const baseUrl = String(pm.environment.get(\"baseUrl\") || pm.variables.get(\"baseUrl\") || \"\").replace(/\\/+$/,\"\");\r",
											"  pm.test(\"baseUrl configured\", function(){ pm.expect(baseUrl, \"í™˜ê²½ë³€ìˆ˜ baseUrl í•„ìš”\").to.not.be.empty; });\r",
											"  const url = baseUrl + \"/app/api/patient/search\";\r",
											"\r",
											"  const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\") || \"\";\r",
											"  const headers = [{ key: \"Content-Type\", value: \"application/json\" }];\r",
											"  if (token) headers.push({ key: \"Authorization\", value: \"Bearer \" + token });\r",
											"\r",
											"  const DELAY_MS   = Number(pm.environment.get(\"INTER_CALL_DELAY_MS\") || 150);\r",
											"  const STOP_ON_FAIL = String(pm.environment.get(\"STOP_ON_FAIL\") || \"false\").toLowerCase() === \"true\";\r",
											"\r",
											"  // ê¸°ë³¸ ë°”ë””(ìš”ì²­í•˜ì‹  ê¸°ë³¸ êµ¬ì¡°ì™€ ë™ì¼)\r",
											"  let baseBody = {\r",
											"    identifier: \"\",\r",
											"    name: \"\",\r",
											"    sex: null,\r",
											"    startDate: null,\r",
											"    endDate: null,\r",
											"    paginationReq: { requestPageNumber: 1, itemCountPerPage: 20, order: \"desc\", sortBy: \"dateOfBirth\" },\r",
											"    isSortById: true\r",
											"  };\r",
											"  try {\r",
											"    const extra = pm.environment.get(\"BASE_BODY_JSON\");\r",
											"    if (extra) baseBody = Object.assign(baseBody, JSON.parse(extra));\r",
											"  } catch (e) {}\r",
											"\r",
											"  function buildBody(body, ord, sortBy) {\r",
											"    const cloned = JSON.parse(JSON.stringify(body));\r",
											"    // ë°˜ë“œì‹œ paginationReq ë‚´ë¶€ì—ë§Œ ì„¤ì •\r",
											"    if (!cloned.paginationReq || typeof cloned.paginationReq !== \"object\") {\r",
											"      cloned.paginationReq = { requestPageNumber: 1, itemCountPerPage: 20 };\r",
											"    }\r",
											"    cloned.paginationReq.requestPageNumber = cloned.paginationReq.requestPageNumber ?? 1;\r",
											"    cloned.paginationReq.itemCountPerPage  = cloned.paginationReq.itemCountPerPage  ?? 20;\r",
											"    cloned.paginationReq.order = ord.toLowerCase();  // ì†Œë¬¸ì ê°•ì œ\r",
											"    cloned.paginationReq.sortBy = sortBy;\r",
											"    // ìµœìƒìœ„ order/sortByëŠ” ì ˆëŒ€ ë„£ì§€ ì•ŠìŒ\r",
											"    delete cloned.order;\r",
											"    delete cloned.sortBy;\r",
											"    return cloned;\r",
											"  }\r",
											"\r",
											"  // 4) ìˆœì°¨ í˜¸ì¶œ\r",
											"  const results = [];\r",
											"  let halted = false;\r",
											"\r",
											"  function runCase(i){\r",
											"    if (halted || i >= CASES_REST.length) return finish();\r",
											"\r",
											"    const c = CASES_REST[i];\r",
											"    const ord = String(c.order || \"\").toLowerCase();\r",
											"    const sortBy = String(c.sortBy || \"\");\r",
											"    const isValid = (ALLOWED_ORDERS.includes(ord) && ALLOWED_FIELDS.includes(sortBy));\r",
											"\r",
											"    const body = buildBody(baseBody, ord, sortBy);\r",
											"\r",
											"    pm.sendRequest({\r",
											"      url, method: \"POST\", header: headers,\r",
											"      body: { mode: \"raw\", raw: JSON.stringify(body) }\r",
											"    }, function (err, res) {\r",
											"      if (err) {\r",
											"        results.push({ i:i+2, sortBy, order:ord, http:0, pass:false, expected:\"200\", reason:\"request-error\" });\r",
											"        pm.test(`[${i+2}] request error (${sortBy} ${ord})`, function(){ throw new Error(String(err)); });\r",
											"        if (STOP_ON_FAIL) { halted = true; return finish(); }\r",
											"        return setTimeout(function(){ runCase(i+1); }, DELAY_MS);\r",
											"      }\r",
											"\r",
											"      const httpOk = (res.code === 200);\r",
											"      pm.test(`[${i+2}/8] HTTP 200 (${sortBy} ${ord})`, function(){\r",
											"        pm.expect(httpOk, \"ìœ íš¨ ì¼€ì´ìŠ¤ì¸ë° 200ì´ ì•„ë‹˜\").to.eql(true);\r",
											"      });\r",
											"      results.push({ i:i+2, sortBy, order:ord, http:res.code, pass:httpOk, expected:\"200\" });\r",
											"\r",
											"      if (STOP_ON_FAIL && !httpOk) { halted = true; return finish(); }\r",
											"      setTimeout(function(){ runCase(i+1); }, DELAY_MS);\r",
											"    });\r",
											"  }\r",
											"\r",
											"  function finish(){\r",
											"    const total = results.length + 1; // ë©”ì¸ 1 + ë‚˜ë¨¸ì§€\r",
											"    const failed = results.filter(r => !r.pass).length;\r",
											"\r",
											"    console.log(\"[SUMMARY] total=\"+total+\" (main + \"+results.length+\" rest), failed=\"+failed);\r",
											"    results.forEach(r => {\r",
											"      console.log(`[SUMMARY] [${r.i}/8] ${r.sortBy} ${r.order} -> http=${r.http||\"-\"}, expected=${r.expected}, pass=${r.pass}${r.reason?(\" reason=\"+r.reason):\"\"}`);\r",
											"    });\r",
											"\r",
											"    pm.environment.set(\"SORT_SINGLE_SUMMARY\", JSON.stringify({ total, failed, results }));\r",
											"    pm.test(\"Executed all 8 (main+rest)\", function(){ pm.expect(total).to.eql(8); });\r",
											"    pm.test(\"All cases met expected behavior\", function(){ pm.expect(failed).to.eql(0); });\r",
											"  }\r",
											"\r",
											"  // ì‹œì‘(ë©”ì¸ì€ ì´ë¯¸ ì „ì†¡ë¨)\r",
											"  runCase(0);\r",
											"})();\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/patient/search",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"patient",
										"search"
									]
								}
							},
							"response": []
						},
						{
							"name": "í™˜ì ëª©ë¡ ì¡°íšŒ_Related images sorting",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === ê¸°ë³¸ ë°”ë”” (ìš”ì²­í•˜ì‹  êµ¬ì¡°ì— ì •í™•íˆ ë§ì¶¤) ===\r",
											"let baseBody = {\r",
											"  identifier: \"\",\r",
											"  name: \"\",\r",
											"  sex: null,\r",
											"  startDate: null,\r",
											"  endDate: null,\r",
											"  paginationReq: {\r",
											"    requestPageNumber: 1,\r",
											"    itemCountPerPage: 20,\r",
											"    order: \"desc\",          // ë°˜ë“œì‹œ ì†Œë¬¸ì\r",
											"    sortBy: \"status\"   // ê¸°ë³¸ê°’\r",
											"  },\r",
											"  isSortById: true\r",
											"};\r",
											"\r",
											"// í™˜ê²½ë³€ìˆ˜ BASE_BODY_JSON ìˆìœ¼ë©´ ë³‘í•© (ì˜µì…˜)\r",
											"try {\r",
											"  const extra = pm.environment.get(\"BASE_BODY_JSON\");\r",
											"  if (extra) baseBody = Object.assign(baseBody, JSON.parse(extra));\r",
											"} catch (e) {}\r",
											"\r",
											"// === ì´ë²ˆ ë©”ì¸ ìš”ì²­: patientId DESC(ì†Œë¬¸ì 'desc') ===\r",
											"baseBody.paginationReq.order = \"desc\";\r",
											"baseBody.paginationReq.sortBy = \"patientId\";\r",
											"\r",
											"// í—¤ë”/í† í°\r",
											"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
											"\r",
											"// ë°”ë”” ì£¼ì…\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(baseBody));\r",
											"console.log(\"[MAIN REQ] body =\", baseBody);\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === patient/search ì •ë ¬ ê²€ì¦: ë©”ì¸(patientId desc) + 18ì¼€ì´ìŠ¤ ===\r",
											"(function () {\r",
											"  // 0) ë©”ì¸ ì‘ë‹µ ìƒíƒœ\r",
											"  pm.test(\"[MAIN] HTTP 200\", function(){ pm.response.to.have.status(200); });\r",
											"  try {\r",
											"    const j = pm.response.json();\r",
											"    if (j && typeof j.code !== \"undefined\") {\r",
											"      pm.test(\"[MAIN] Business code 200\", function(){ pm.expect(j.code).to.eql(200); });\r",
											"    }\r",
											"  } catch (e) {}\r",
											"\r",
											"  // 1) ë‚˜ë¨¸ì§€ ì¼€ì´ìŠ¤ (ëª¨ë‘ ìœ íš¨, ëª¨ë‘ 200 ê¸°ëŒ€)\r",
											"  const CASES_REST = [\r",
											"    { order: \"asc\",  sortBy: \"patientId\" },\r",
											"    { order: \"desc\", sortBy: \"imageType\" },\r",
											"    { order: \"asc\",  sortBy: \"imageType\" },\r",
											"    { order: \"desc\", sortBy: \"status\" },\r",
											"    { order: \"asc\",  sortBy: \"status\" },\r",
											"    { order: \"desc\", sortBy: \"isBaseline\" },\r",
											"    { order: \"asc\",  sortBy: \"isBaseline\" },\r",
											"    { order: \"desc\", sortBy: \"studyId\" },\r",
											"    { order: \"asc\",  sortBy: \"studyId\" },\r",
											"    { order: \"desc\", sortBy: \"scanDate\" },\r",
											"    { order: \"asc\",  sortBy: \"scanDate\" },\r",
											"    { order: \"desc\", sortBy: \"studyDesc\" },\r",
											"    { order: \"asc\",  sortBy: \"studyDesc\" },\r",
											"    { order: \"desc\", sortBy: \"seriesDesc\" },\r",
											"    { order: \"asc\",  sortBy: \"seriesDesc\" },\r",
											"    { order: \"desc\", sortBy: \"updateDate\" },\r",
											"    { order: \"asc\",  sortBy: \"updateDate\" },\r",
											"    { order: \"desc\", sortBy: \"imageSource\" },\r",
											"    { order: \"asc\",  sortBy: \"imageSource\" }\r",
											"  ];\r",
											"\r",
											"  // í—ˆìš© ê°’(ì†Œë¬¸ì!)\r",
											"  const ALLOWED_FIELDS = [\"patientId\",\"imageType\",\"status\",\"isBaseline\", \"studyId\", \"scanDate\", \"studyDesc\", \"seriesDesc\", \"updateDate\", \"imageSource\"];\r",
											"  const ALLOWED_ORDERS = [\"asc\",\"desc\"];\r",
											"\r",
											"  // ê³µí†µ ì„¤ì •\r",
											"  const baseUrl = String(pm.environment.get(\"baseUrl\") || pm.variables.get(\"baseUrl\") || \"\").replace(/\\/+$/,\"\");\r",
											"  pm.test(\"baseUrl configured\", function(){ pm.expect(baseUrl, \"í™˜ê²½ë³€ìˆ˜ baseUrl í•„ìš”\").to.not.be.empty; });\r",
											"  const url = baseUrl + \"/app/api/patient/search\";\r",
											"\r",
											"  const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\") || \"\";\r",
											"  const headers = [{ key: \"Content-Type\", value: \"application/json\" }];\r",
											"  if (token) headers.push({ key: \"Authorization\", value: \"Bearer \" + token });\r",
											"\r",
											"  const DELAY_MS   = Number(pm.environment.get(\"INTER_CALL_DELAY_MS\") || 150);\r",
											"  const STOP_ON_FAIL = String(pm.environment.get(\"STOP_ON_FAIL\") || \"false\").toLowerCase() === \"true\";\r",
											"\r",
											"  // ê¸°ë³¸ ë°”ë””(ìš”ì²­í•˜ì‹  ê¸°ë³¸ êµ¬ì¡°ì™€ ë™ì¼)\r",
											"  let baseBody = {\r",
											"    identifier: \"\",\r",
											"    name: \"\",\r",
											"    sex: null,\r",
											"    startDate: null,\r",
											"    endDate: null,\r",
											"    paginationReq: { requestPageNumber: 1, itemCountPerPage: 20, order: \"desc\", sortBy: \"status\" },\r",
											"    isSortById: true\r",
											"  };\r",
											"  try {\r",
											"    const extra = pm.environment.get(\"BASE_BODY_JSON\");\r",
											"    if (extra) baseBody = Object.assign(baseBody, JSON.parse(extra));\r",
											"  } catch (e) {}\r",
											"\r",
											"  function buildBody(body, ord, sortBy) {\r",
											"    const cloned = JSON.parse(JSON.stringify(body));\r",
											"    // ë°˜ë“œì‹œ paginationReq ë‚´ë¶€ì—ë§Œ ì„¤ì •\r",
											"    if (!cloned.paginationReq || typeof cloned.paginationReq !== \"object\") {\r",
											"      cloned.paginationReq = { requestPageNumber: 1, itemCountPerPage: 20 };\r",
											"    }\r",
											"    cloned.paginationReq.requestPageNumber = cloned.paginationReq.requestPageNumber ?? 1;\r",
											"    cloned.paginationReq.itemCountPerPage  = cloned.paginationReq.itemCountPerPage  ?? 20;\r",
											"    cloned.paginationReq.order = ord.toLowerCase();  // ì†Œë¬¸ì ê°•ì œ\r",
											"    cloned.paginationReq.sortBy = sortBy;\r",
											"    // ìµœìƒìœ„ order/sortByëŠ” ì ˆëŒ€ ë„£ì§€ ì•ŠìŒ\r",
											"    delete cloned.order;\r",
											"    delete cloned.sortBy;\r",
											"    return cloned;\r",
											"  }\r",
											"\r",
											"  // 4) ìˆœì°¨ í˜¸ì¶œ\r",
											"  const results = [];\r",
											"  let halted = false;\r",
											"\r",
											"  function runCase(i){\r",
											"    if (halted || i >= CASES_REST.length) return finish();\r",
											"\r",
											"    const c = CASES_REST[i];\r",
											"    const ord = String(c.order || \"\").toLowerCase();\r",
											"    const sortBy = String(c.sortBy || \"\");\r",
											"    const isValid = (ALLOWED_ORDERS.includes(ord) && ALLOWED_FIELDS.includes(sortBy));\r",
											"\r",
											"    const body = buildBody(baseBody, ord, sortBy);\r",
											"\r",
											"    pm.sendRequest({\r",
											"      url, method: \"POST\", header: headers,\r",
											"      body: { mode: \"raw\", raw: JSON.stringify(body) }\r",
											"    }, function (err, res) {\r",
											"      if (err) {\r",
											"        results.push({ i:i+2, sortBy, order:ord, http:0, pass:false, expected:\"200\", reason:\"request-error\" });\r",
											"        pm.test(`[${i+2}] request error (${sortBy} ${ord})`, function(){ throw new Error(String(err)); });\r",
											"        if (STOP_ON_FAIL) { halted = true; return finish(); }\r",
											"        return setTimeout(function(){ runCase(i+1); }, DELAY_MS);\r",
											"      }\r",
											"\r",
											"      const httpOk = (res.code === 200);\r",
											"      pm.test(`[${i+2}/20] HTTP 200 (${sortBy} ${ord})`, function(){\r",
											"        pm.expect(httpOk, \"ìœ íš¨ ì¼€ì´ìŠ¤ì¸ë° 200ì´ ì•„ë‹˜\").to.eql(true);\r",
											"      });\r",
											"      results.push({ i:i+2, sortBy, order:ord, http:res.code, pass:httpOk, expected:\"200\" });\r",
											"\r",
											"      if (STOP_ON_FAIL && !httpOk) { halted = true; return finish(); }\r",
											"      setTimeout(function(){ runCase(i+1); }, DELAY_MS);\r",
											"    });\r",
											"  }\r",
											"\r",
											"  function finish(){\r",
											"    const total = results.length + 1; // ë©”ì¸ 1 + ë‚˜ë¨¸ì§€\r",
											"    const failed = results.filter(r => !r.pass).length;\r",
											"\r",
											"    console.log(\"[SUMMARY] total=\"+total+\" (main + \"+results.length+\" rest), failed=\"+failed);\r",
											"    results.forEach(r => {\r",
											"      console.log(`[SUMMARY] [${r.i}/20] ${r.sortBy} ${r.order} -> http=${r.http||\"-\"}, expected=${r.expected}, pass=${r.pass}${r.reason?(\" reason=\"+r.reason):\"\"}`);\r",
											"    });\r",
											"\r",
											"    pm.environment.set(\"SORT_SINGLE_SUMMARY\", JSON.stringify({ total, failed, results }));\r",
											"    pm.test(\"Executed all 20 (main+rest)\", function(){ pm.expect(total).to.eql(20); });\r",
											"    pm.test(\"All cases met expected behavior\", function(){ pm.expect(failed).to.eql(0); });\r",
											"  }\r",
											"\r",
											"  // ì‹œì‘(ë©”ì¸ì€ ì´ë¯¸ ì „ì†¡ë¨)\r",
											"  runCase(0);\r",
											"})();\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/patient/search",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"patient",
										"search"
									]
								}
							},
							"response": []
						},
						{
							"name": "í•´ë‹¹ ë¶„ì„ ë¦¬ìŠ¤íŠ¸ë¥¼ íƒ€ì…ë³„ë¡œ ë¶„ë¥˜í•˜ì—¬ ì „ë‹¬",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// ===== ê³µí†µ í—¤ë” =====\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
											"\r",
											"// ===== patientIdë§Œ ì‚¬ìš© =====\r",
											"const patientId = Number(pm.environment.get(\"PATIENT_ID\"));\r",
											"if (!patientId) throw new Error(\"PATIENT_IDê°€ ì—†ìŠµë‹ˆë‹¤. (í™˜ì ëª©ë¡ ì¡°íšŒ ë¨¼ì € ì‹¤í–‰)\");\r",
											"\r",
											"// ì„œë²„ê°€ patient ë²”ìœ„ Exportë¥¼ ì§€ì›í•œë‹¤ëŠ” ê°€ì •\r",
											"const body = {\r",
											"  patientId,\r",
											"  // í•„ìš” ì‹œ ì£¼ì„ í•´ì œ (ì„œë²„ ìŠ¤í‚¤ë§ˆì— ë”°ë¼)\r",
											"//  scope: \"PATIENT\",        // ë˜ëŠ” context: \"PATIENT\"\r",
											"//  purpose: null,            // í”„ë¡ íŠ¸ ëª¨ë‹¬ì˜ \"Purpose of data export\" ê°’\r",
											"//  includeStudies: true      // í™˜ì í•˜ìœ„ ëª¨ë“  ìŠ¤í„°ë”” í¬í•¨ ì˜µì…˜ ë“±\r",
											"};\r",
											"pm.request.body.update(JSON.stringify(body, null, 2));\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"HTTP 2xx\", () => pm.expect(pm.response.code).to.be.within(200,299));\r",
											"\r",
											"let j = {};\r",
											"try { j = pm.response.json(); } catch (e) {\r",
											"  pm.test(\"JSON íŒŒì‹±\").fail(\"ì‘ë‹µ JSON ì•„ë‹˜\");\r",
											"  return;\r",
											"}\r",
											"if (typeof j.code !== \"undefined\") {\r",
											"  pm.test(\"Service code == 200\", () => pm.expect(j.code).to.eql(200));\r",
											"}\r",
											"\r",
											"// ===== 1) ê¸°ë³¸ êµ¬ì¡°: analysisIdByType ì§€ì› =====\r",
											"const byType = j?.result?.analysisIdByType;\r",
											"let catalog = [];\r",
											"let exportIdsMap = {};\r",
											"\r",
											"if (byType && typeof byType === \"object\" && !Array.isArray(byType)) {\r",
											"  // ì˜ˆ: { \"PDF\":[...], \"CSV_ARIA_E\":[...], ... }\r",
											"  const keys = Object.keys(byType);\r",
											"  catalog = keys.map(k => ({\r",
											"    code: k,                         // \"PDF\", \"CSV_ARIA_E\", ...\r",
											"    label: k.replace(/_/g, \" \"),     // ê°„ë‹¨ ë¼ë²¨: \"CSV ARIA E\"\r",
											"    enabled: true,\r",
											"    count: Array.isArray(byType[k]) ? byType[k].length : 0\r",
											"  }));\r",
											"  exportIdsMap = keys.reduce((acc, k) => {\r",
											"    acc[k] = Array.isArray(byType[k]) ? byType[k] : [];\r",
											"    return acc;\r",
											"  }, {});\r",
											"}\r",
											"\r",
											"// ===== 2) ëŒ€ì•ˆ êµ¬ì¡°(ì•„ì´í…œ ë°°ì—´)ë„ ë³‘í–‰ ì§€ì› =====\r",
											"if (catalog.length === 0) {\r",
											"  // í•­ëª©ì²˜ëŸ¼ ë³´ì´ëŠ” ë°°ì—´ì„ ìë™ íƒìƒ‰ (í›„ë°© í˜¸í™˜)\r",
											"  function looksLikeItem(o) {\r",
											"    if (!o || typeof o !== \"object\" || Array.isArray(o)) return false;\r",
											"    const keys = Object.keys(o).map(k => k.toLowerCase());\r",
											"    const hasCode  = keys.some(k => [\"code\",\"id\",\"key\",\"type\"].includes(k));\r",
											"    const hasLabel = keys.some(k => [\"label\",\"name\",\"title\"].includes(k));\r",
											"    return hasCode && hasLabel;\r",
											"  }\r",
											"  function collectItemArrays(node, acc = []) {\r",
											"    if (!node) return acc;\r",
											"    if (Array.isArray(node)) {\r",
											"      if (node.length && node.every(looksLikeItem)) acc.push(node);\r",
											"      node.forEach(x => collectItemArrays(x, acc));\r",
											"    } else if (typeof node === \"object\") {\r",
											"      Object.values(node).forEach(v => collectItemArrays(v, acc));\r",
											"    }\r",
											"    return acc;\r",
											"  }\r",
											"  const candidates = collectItemArrays(j);\r",
											"  const items = candidates[0] || [];\r",
											"  catalog = items.map(x => ({\r",
											"    code:  x?.code ?? x?.id ?? x?.key ?? x?.type,\r",
											"    label: x?.label ?? x?.name ?? x?.title ?? String(x?.code ?? x?.id ?? \"\"),\r",
											"    enabled: x?.enabled ?? true,\r",
											"    count:  undefined\r",
											"  }));\r",
											"}\r",
											"\r",
											"// ===== 3) ê²°ê³¼ ì €ì¥ =====\r",
											"pm.environment.set(\"EXPORT_TYPE_LIST_JSON\", JSON.stringify(catalog));\r",
											"if (Object.keys(exportIdsMap).length) {\r",
											"  pm.environment.set(\"EXPORT_TYPE_IDS_JSON\", JSON.stringify(exportIdsMap));\r",
											"} else {\r",
											"  pm.environment.unset(\"EXPORT_TYPE_IDS_JSON\");\r",
											"}\r",
											"\r",
											"// ëŒ€í‘œ PDF ì½”ë“œ ì €ì¥\r",
											"const pdfItem =\r",
											"  catalog.find(x => String(x.code).toUpperCase() === \"PDF\") ||\r",
											"  catalog.find(x => String(x.code).toLowerCase().includes(\"pdf\"));\r",
											"if (pdfItem?.code) pm.environment.set(\"EXPORT_TYPE_PRIMARY\", String(pdfItem.code));\r",
											"\r",
											"// ===== 4) ì–´ì„œì…˜ =====\r",
											"// falseë¥¼ trueë¡œ ë³€ê²½í•¨\r",
											"pm.test(\"Export íƒ€ì… ëª©ë¡ ì¡´ì¬\", () => pm.expect(catalog.length > 0).to.eql(true));\r",
											"\r",
											"// ===== 5) ì°¸ê³  ë¡œê·¸ =====\r",
											"console.log(\"[EXPORT TYPES catalog]\", catalog);\r",
											"if (Object.keys(exportIdsMap).length) {\r",
											"  console.log(\"[EXPORT IDS map]\", exportIdsMap);\r",
											"}\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											"\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/app/api/download/types",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"download",
										"types"
									]
								}
							},
							"response": []
						},
						{
							"name": "Download Typeì— ë”°ë¥¸ csv, pdf íŒŒì¼ì˜ ì••ì¶• ë‹¤ìš´ë¡œë“œ",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// ==== ê³µí†µ í—¤ë”/í† í° ====\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
											"\r",
											"// ==== í•„ìˆ˜ ì…ë ¥ ====\r",
											"const patientId = Number(pm.environment.get(\"PATIENT_ID\"));\r",
											"if (!patientId) { throw new Error(\"PATIENT_IDê°€ ì—†ìŠµë‹ˆë‹¤. (í™˜ì ëª©ë¡ ì¡°íšŒ ë¨¼ì € ì‹¤í–‰)\"); }\r",
											"\r",
											"// ==== ëª©ì /ë©”ëª¨(ì„ íƒ) ====\r",
											"const purpose = pm.environment.get(\"EXPORT_PURPOSE_CODE\") || \"RESEARCH\"; // í•„ìš” ì—†ìœ¼ë©´ nullë¡œ\r",
											"const memo    = pm.environment.get(\"EXPORT_MEMO\") || null;\r",
											"\r",
											"// ==== íƒ€ì… ì„ íƒ ====\r",
											"/**\r",
											" * ì„ íƒ ë°©ì‹ A: (ê¶Œì¥) ì´ì „ ë‹¨ê³„ì—ì„œ ì €ì¥í•œ EXPORT_TYPE_IDS_JSONì„ ê¸°ë°˜ìœ¼ë¡œ\r",
											" *   - SELECTED_EXPORT_TYPES í™˜ê²½ë³€ìˆ˜(JSON ë°°ì—´ ë¬¸ìì—´), ì˜ˆ: [\"PDF\",\"CSV_ARIA_E\"]\r",
											" *\r",
											" * ì„ íƒ ë°©ì‹ B: (ì§ì ‘ ì§€ì •) ANALYSIS_ID_BY_TYPE_JSON í™˜ê²½ë³€ìˆ˜ë¡œ ë°”ë¡œ ì „ë‹¬\r",
											" *   - ì˜ˆ: {\"PDF\":[1,2], \"CSV_ARIA_E\":[3,4]}\r",
											" */\r",
											"const parseJSON = (s, dflt) => { try { return JSON.parse(s); } catch { return dflt; } };\r",
											"const dedupeSort = (arr) => Array.from(new Set((arr || []).map(Number))).filter(Number.isFinite).sort((a,b)=>a-b);\r",
											"\r",
											"// ìš°ì„ ìˆœìœ„ 1) ì‚¬ìš©ìê°€ ì§ì ‘ ì œê³µ\r",
											"let analysisIdByType = parseJSON(pm.environment.get(\"ANALYSIS_ID_BY_TYPE_JSON\") || \"\", null);\r",
											"\r",
											"// ìš°ì„ ìˆœìœ„ 2) types ë‹¨ê³„ì—ì„œ ì €ì¥í•œ ë§µ + ì„ íƒ íƒ€ì…ìœ¼ë¡œ êµ¬ì„±\r",
											"if (!analysisIdByType) {\r",
											"  const map = parseJSON(pm.environment.get(\"EXPORT_TYPE_IDS_JSON\") || \"{}\", {});\r",
											"  let selectedTypes = parseJSON(pm.environment.get(\"SELECTED_EXPORT_TYPES\") || '[\"PDF\"]', [\"PDF\"]);\r",
											"\r",
											"  const picked = {};\r",
											"  selectedTypes.forEach(t => {\r",
											"    let ids = Array.isArray(map?.[t]) ? map[t] : [];\r",
											"    // PDFê°€ ë¹„ì–´ìˆìœ¼ë©´ ë‹¤ë¥¸ íƒ€ì…ë“¤ì˜ í•©ì§‘í•©ì„ ë„£ëŠ” ë°©ì–´ ë¡œì§\r",
											"    if (t.toUpperCase() === \"PDF\" && ids.length === 0) {\r",
											"      ids = Object.values(map || {}).flat();\r",
											"    }\r",
											"    ids = dedupeSort(ids);\r",
											"    if (ids.length) picked[t] = ids;\r",
											"  });\r",
											"\r",
											"  if (Object.keys(picked).length === 0) {\r",
											"    throw new Error(\"ë³´ë‚¼ ë¶„ì„ IDê°€ ì—†ìŠµë‹ˆë‹¤. (SELECTED_EXPORT_TYPES / EXPORT_TYPE_IDS_JSON / ANALYSIS_ID_BY_TYPE_JSON í™•ì¸)\");\r",
											"  }\r",
											"  analysisIdByType = picked;\r",
											"}\r",
											"\r",
											"// ==== ìš”ì²­ ë°”ë”” ====\r",
											"const body = {\r",
											"  analysisIdByType,      // { \"PDF\":[...], \"CSV_ARIA_E\":[...], ... }\r",
											"  purposeOfExport: purpose,\r",
											"  memo,\r",
											"  patientId\r",
											"};\r",
											"\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(body, null, 2));\r",
											"\r",
											"// ==== ë¡œê·¸ ====\r",
											"console.log(\"[/download/files PRE]\", {\r",
											"  patientId,\r",
											"  purpose,\r",
											"  memo,\r",
											"  types: Object.fromEntries(Object.entries(analysisIdByType).map(([k,v]) => [k, (v||[]).length]))\r",
											"});\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// 200(ë™ê¸° íŒŒì¼) ë˜ëŠ” 202(ë¹„ë™ê¸° ì¡) í—ˆìš©\r",
											"pm.test(\"HTTP 200/202\", () => pm.expect([200,202]).to.include(pm.response.code));\r",
											"\r",
											"const disp  = pm.response.headers.get(\"Content-Disposition\") || \"\";\r",
											"const ctype = pm.response.headers.get(\"Content-Type\") || \"\";\r",
											"\r",
											"// JSONì¸ì§€ ì‹œë„\r",
											"let json = null; try { json = pm.response.json(); } catch (_) { json = null; }\r",
											"\r",
											"if (json && typeof json === \"object\") {\r",
											"  if (typeof json.code !== \"undefined\") {\r",
											"    pm.test(\"Service code == 200/202\", () => pm.expect(json.code).to.be.oneOf([200,202]));\r",
											"  }\r",
											"\r",
											"  const jobId   = json?.result?.jobId    ?? json?.result?.downloadId ?? json?.result?.requestId ?? null;\r",
											"  const fileUrl = json?.result?.fileUrl  ?? json?.result?.url        ?? null;\r",
											"  const name    = json?.result?.fileName ?? json?.result?.name       ?? null;\r",
											"\r",
											"  if (jobId)   pm.environment.set(\"DOWNLOAD_JOB_ID\", String(jobId));\r",
											"  if (fileUrl) pm.environment.set(\"DOWNLOAD_FILE_URL\", String(fileUrl));\r",
											"  if (name)    pm.environment.set(\"DOWNLOADED_FILE_NAME\", String(name));\r",
											"\r",
											"  pm.test(\"íŠ¸ë¦¬ê±° ê²°ê³¼ ìˆ˜ì‹ (jobId ë˜ëŠ” fileUrl)\", () => pm.expect(Boolean(jobId || fileUrl)).to.eql(true));\r",
											"  console.log(\"[/download/files JSON result]\", { jobId, fileUrl, name });\r",
											"} else {\r",
											"  // ë°”ì´ë„ˆë¦¬ ì‘ë‹µ(ZIP/PDF ë“±)\r",
											"  // ZIPì˜ ê²½ìš° ì‘ë‹µ ë°”ë””ê°€ 'PK'ë¡œ ì‹œì‘í•  ìˆ˜ ìˆìŒ\r",
											"  console.log(\"[/download/files BINARY]\", { \"Content-Type\": ctype, \"Content-Disposition\": disp });\r",
											"\r",
											"  // íŒŒì¼ëª… ì €ì¥\r",
											"  let filename = null;\r",
											"  const m = /filename\\*?=(?:UTF-8'')?(\"?)([^\";]+)\\1/i.exec(disp);\r",
											"  if (m && m[2]) filename = decodeURIComponent(m[2]);\r",
											"  if (filename) pm.environment.set(\"DOWNLOADED_FILE_NAME\", filename);\r",
											"\r",
											"  // ì²¨ë¶€ í—¤ë” í™•ì¸\r",
											"  pm.test(\"ì²¨ë¶€ í—¤ë” í¬í•¨\", () => pm.expect(disp.toLowerCase()).to.include(\"attachment\"));\r",
											"\r",
											"  // Postmanì—ì„œ ì‹¤ì œ íŒŒì¼ ì €ì¥ì€ \"Send and Download\" ë²„íŠ¼ ì‚¬ìš©\r",
											"}\r",
											"\r",
											"// ì°¸ê³ : ìš°ë¦¬ê°€ ë³´ë‚¸ í˜ì´ë¡œë“œ ìš”ì•½ ë¡œê·¸\r",
											"try {\r",
											"  const sent = JSON.parse(pm.request.body.raw || \"{}\");\r",
											"  const counts = Object.fromEntries(\r",
											"    Object.entries(sent.analysisIdByType || {}).map(([k,v]) => [k, Array.isArray(v) ? v.length : 0])\r",
											"  );\r",
											"  console.log(\"[SENT analysisIdByType counts]\", counts);\r",
											"} catch {}\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/app/api/download/files",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"download",
										"files"
									]
								}
							},
							"response": []
						},
						{
							"name": "í™˜ì ë³„ summary ì¡°íšŒ",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"const id = pm.environment.get(\"TARGET_IDENTIFIER\") || \"\"; // ì—†ìœ¼ë©´ ì „ì²´ê²€ìƒ‰\r",
											"const body = {\r",
											"  identifier: id,\r",
											"  name: \"\",\r",
											"  sex: null,\r",
											"  startDate: null,\r",
											"  endDate: null,\r",
											"  paginationReq: {\r",
											"    requestPageNumber: 1,\r",
											"    itemCountPerPage: 20,\r",
											"    order: \"desc\",\r",
											"    sortBy: \"\"\r",
											"  },\r",
											"  isSortById: false\r",
											"};\r",
											"\r",
											"// Content-Type ë³´ì •\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"// Body ì—…ë°ì´íŠ¸\r",
											"pm.request.body.update(JSON.stringify(body, null, 2));\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/patient/{{PATIENT_ID}}/summary",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"patient",
										"{{PATIENT_ID}}",
										"summary"
									]
								}
							},
							"response": []
						},
						{
							"name": "í™˜ì ë³„ ì´ë¯¸ì§€ ëª©ë¡ ì¡°íšŒ",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"const id = pm.environment.get(\"TARGET_IDENTIFIER\") || \"\"; // ì—†ìœ¼ë©´ ì „ì²´ê²€ìƒ‰\r",
											"const body = {\r",
											"  identifier: id,\r",
											"  name: \"\",\r",
											"  sex: null,\r",
											"  startDate: null,\r",
											"  endDate: null,\r",
											"  paginationReq: {\r",
											"    requestPageNumber: 1,\r",
											"    itemCountPerPage: 20,\r",
											"    order: \"desc\",\r",
											"    sortBy: \"\"\r",
											"  },\r",
											"  isSortById: false\r",
											"};\r",
											"\r",
											"// Content-Type ë³´ì •\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"// Body ì—…ë°ì´íŠ¸\r",
											"pm.request.body.update(JSON.stringify(body, null, 2));\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/patient/{{PATIENT_ID}}/series",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"patient",
										"{{PATIENT_ID}}",
										"series"
									]
								}
							},
							"response": []
						},
						{
							"name": "í™˜ì ë³„ ì´ë¯¸ì§€ ëª©ë¡ ì¡°íšŒ_Image Type ë³€ê²½",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === ê³µí†µ: í™˜ì ID ê²½ë¡œ ë³´ì • ===\r",
											"const pid = Number(pm.environment.get(\"PATIENT_ID\") || 0);\r",
											"if (pid) {\r",
											"  const s = pm.request.url.toString();\r",
											"  const replaced = s.replace(/\\/app\\/api\\/patient\\/\\d+\\/series/i, `/app/api/patient/${pid}/series`);\r",
											"  if (replaced !== s) pm.request.url = replaced;\r",
											"}\r",
											"\r",
											"// === ëœë¤ ì„ íƒ ì„¤ì • ===\r",
											"// RANDOM_IMAGE_TYPE = \"true\"  => T1~PHASE ì¤‘ì—ì„œ ë§¤ ìš”ì²­ ëœë¤ ì„ íƒ\r",
											"// RANDOM_IMAGE_TYPE = \"false\" => í•­ìƒ All (ê¸°ë³¸)\r",
											"const RANDOM = String(pm.environment.get(\"RANDOM_IMAGE_TYPE\") || \"false\").toLowerCase() === \"true\";\r",
											"\r",
											"// UI ë¼ë²¨ -> API ì½”ë“œ ë§¤í•‘\r",
											"const IMAGE_TYPES = [\r",
											"  { label: \"T1\",          code: \"T1\" },\r",
											"  { label: \"T2-FLAIR\",    code: \"T2_FLAIR\" },\r",
											"  { label: \"SWI\",         code: \"SWI\" },\r",
											"  { label: \"GRE\",         code: \"GRE\" },\r",
											"  { label: \"Amyloid PET\", code: \"PET_AMYLOID\" },\r",
											"  { label: \"Tau PET\",     code: \"PET_TAU\" },\r",
											"  { label: \"DWI\",         code: \"DWI\" },\r",
											"  { label: \"ADC\",         code: \"ADC\" },\r",
											"  //{ label: \"Phase\",       code: \"PHASE\" }\r",
											"];\r",
											"\r",
											"// ì„ íƒ ë¡œì§\r",
											"let selected = { label: \"All\", code: \"ALL\" };\r",
											"if (RANDOM) {\r",
											"  const idx = Math.floor(Math.random() * IMAGE_TYPES.length);\r",
											"  selected = IMAGE_TYPES[idx];\r",
											"}\r",
											"\r",
											"// ì¿¼ë¦¬ ê°±ì‹ : statusëŠ” analyzed,unanalyzed ê³ ì • / image-typeì€ ALLì´ë©´ ë¯¸í¬í•¨\r",
											"pm.request.url.removeQueryParams([\"status\", \"image-type\"]);\r",
											"pm.request.url.addQueryParams([{ key: \"status\", value: \"analyzed,unanalyzed\" }]);\r",
											"if (selected.code !== \"ALL\") {\r",
											"  pm.request.url.addQueryParams([{ key: \"image-type\", value: selected.code }]);\r",
											"}\r",
											"\r",
											"// ì„ íƒ ë‚´ìš© ì €ì¥(ì²´ì´ë‹ ìš©)\r",
											"pm.environment.set(\"SELECTED_IMAGE_TYPE_LABEL\", selected.label);\r",
											"pm.environment.set(\"SELECTED_IMAGE_TYPE_CODE\", selected.code);\r",
											"\r",
											"console.log(\"[series PRE] selected image-type =\", selected, \"url =\", pm.request.url.toString());\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"HTTP 2xx\", () => pm.expect(pm.response.code).to.be.within(200,299));\r",
											"pm.test(\"JSON\", () => { try { pm.response.json(); pm.expect(true).to.eql(true); } catch(e){ pm.expect.fail(\"ì‘ë‹µì´ JSONì´ ì•„ë‹˜\"); } });\r",
											"\r",
											"// ì„ íƒëœ íƒ€ì… ë¡œê·¸ (ë””ë²„ê·¸ìš©)\r",
											"console.log(\"[series TEST] image-type =\", {\r",
											"  label: pm.environment.get(\"SELECTED_IMAGE_TYPE_LABEL\"),\r",
											"  code: pm.environment.get(\"SELECTED_IMAGE_TYPE_CODE\")\r",
											"});\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											"\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/patient/{{PATIENT_ID}}/series",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"patient",
										"{{PATIENT_ID}}",
										"series"
									]
								}
							},
							"response": []
						},
						{
							"name": "í™˜ì ë³„ ì´ë¯¸ì§€ ëª©ë¡ ì¡°íšŒ_Analysis status ë³€ê²½",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// ===== í™˜ì ID ê²½ë¡œ ë³´ì • =====\r",
											"(function fixPatientPath() {\r",
											"  const pid = Number(pm.environment.get(\"PATIENT_ID\") || 0);\r",
											"  if (!pid) return;\r",
											"  const s = pm.request.url.toString();\r",
											"  const replaced = s.replace(/\\/app\\/api\\/patient\\/\\d+\\/series/i, `/app/api/patient/${pid}/series`);\r",
											"  if (replaced !== s) pm.request.url = replaced;\r",
											"})();\r",
											"\r",
											"// ===== ìƒíƒœ ìˆœí™˜/ëœë¤ ì„¤ì • =====\r",
											"const STATUS_CYCLE = [\r",
											"  \"analyzed,unanalyzed\", // 1) ë‘˜ ë‹¤\r",
											"  \"analyzed\",            // 2) analyzedë§Œ\r",
											"  \"unanalyzed\"           // 3) unanalyzedë§Œ\r",
											"];\r",
											"const RANDOM = String(pm.environment.get(\"SERIES_STATUS_RANDOM\") || \"false\").toLowerCase() === \"true\";\r",
											"\r",
											"let idx = Number(pm.environment.get(\"SERIES_STATUS_INDEX\"));\r",
											"if (!Number.isInteger(idx) || idx < 0 || idx >= STATUS_CYCLE.length) idx = 0;\r",
											"\r",
											"let statusVal = \"\";\r",
											"if (RANDOM) {\r",
											"  statusVal = STATUS_CYCLE[Math.floor(Math.random() * STATUS_CYCLE.length)];\r",
											"  // ëœë¤ì´ì–´ë„ ë‹¤ìŒ ìˆœí™˜ ì¸ë±ìŠ¤ëŠ” í•œ ì¹¸ ì§„í–‰ (ì›í•˜ë©´ ê³ ì •í•´ë„ ë¨)\r",
											"  pm.environment.set(\"SERIES_STATUS_INDEX\", String((idx + 1) % STATUS_CYCLE.length));\r",
											"} else {\r",
											"  statusVal = STATUS_CYCLE[idx];\r",
											"  pm.environment.set(\"SERIES_STATUS_INDEX\", String((idx + 1) % STATUS_CYCLE.length));\r",
											"}\r",
											"\r",
											"// ===== URLì—ì„œ statusë§Œ êµì²´(ì§ì ‘ ì¬êµ¬ì„±) =====\r",
											"(function setQueryParam() {\r",
											"  const orig = pm.request.url.toString();\r",
											"  const qIndex = orig.indexOf(\"?\");\r",
											"  const base = qIndex >= 0 ? orig.slice(0, qIndex) : orig;\r",
											"  const qs   = qIndex >= 0 ? orig.slice(qIndex + 1) : \"\";\r",
											"\r",
											"  // ì¿¼ë¦¬ íŒŒì‹± â†’ status ì œì™¸ â†’ status ì¶”ê°€\r",
											"  const parts = qs\r",
											"    ? qs.split(\"&\").filter(kv => !/^status=/i.test(decodeURIComponent(kv).split(\"=\")[0] || \"\"))\r",
											"    : [];\r",
											"\r",
											"  // status ì¶”ê°€\r",
											"  parts.push(`status=${encodeURIComponent(statusVal)}`);\r",
											"\r",
											"  const newUrl = base + \"?\" + parts.join(\"&\");\r",
											"  pm.request.url = newUrl;\r",
											"\r",
											"  console.log(\"[series PRE] status ->\", statusVal);\r",
											"  console.log(\"[series PRE] URL    ->\", pm.request.url.toString());\r",
											"})();\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"HTTP 2xx\", () => pm.expect(pm.response.code).to.be.within(200,299));\r",
											"pm.test(\"JSON ì‘ë‹µ\", () => { try { pm.response.json(); pm.expect(true).to.eql(true); } catch(e){ pm.expect.fail(\"ì‘ë‹µì´ JSONì´ ì•„ë‹˜\"); } });\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/patient/{{PATIENT_ID}}/series",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"patient",
										"{{PATIENT_ID}}",
										"series"
									]
								}
							},
							"response": []
						},
						{
							"name": "í™˜ì ë³„ ë¶„ì„ ëª©ë¡ ì¡°íšŒ",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"const id = pm.environment.get(\"TARGET_IDENTIFIER\") || \"\"; // ì—†ìœ¼ë©´ ì „ì²´ê²€ìƒ‰\r",
											"const body = {\r",
											"  identifier: id,\r",
											"  name: \"\",\r",
											"  sex: null,\r",
											"  startDate: null,\r",
											"  endDate: null,\r",
											"  paginationReq: {\r",
											"    requestPageNumber: 1,\r",
											"    itemCountPerPage: 20,\r",
											"    order: \"desc\",\r",
											"    sortBy: \"\"\r",
											"  },\r",
											"  isSortById: false\r",
											"};\r",
											"\r",
											"// Content-Type ë³´ì •\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"// Body ì—…ë°ì´íŠ¸\r",
											"pm.request.body.update(JSON.stringify(body, null, 2));\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/patient/{{PATIENT_ID}}/analysis",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"patient",
										"{{PATIENT_ID}}",
										"analysis"
									]
								}
							},
							"response": []
						},
						{
							"name": "í™˜ì ì •ë³´ ë³€ê²½_name",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// 1) íƒ€ì„ìŠ¤íƒ¬í”„ ìˆ«ì ìƒì„± (epoch milliseconds)\r",
											"const ts = Date.now();          // ì˜ˆ: 1695112345678\r",
											"const newName = `sample_${ts}`; // ì˜ˆ: sample_1695112345678\r",
											"pm.environment.set(\"NEW_NAME\", newName);\r",
											"\r",
											"// 2) PATCH ìš”ì²­ ë°”ë”” êµ¬ì„± (sex, birthëŠ” ê³ ì • ê°’ ì‚¬ìš©)\r",
											"const body = {\r",
											"  name: newName,\r",
											"  sex: \"M\",\r",
											"  birth: \"1970-01-01\"\r",
											"};\r",
											"\r",
											"// 3) í—¤ë” ë³´ì • + Body ì—…ë°ì´íŠ¸\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"pm.request.headers.upsert({ key: \"Accept\", value: \"application/json\" });\r",
											"pm.request.body.update(JSON.stringify(body, null, 2));\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"let json = null;\r",
											"try { json = pm.response.json(); } catch (_) { /* 204 No Contentì¼ ìˆ˜ ìˆìŒ */ }\r",
											"\r",
											"// HTTP 2xxë§Œ ê¸°ë³¸ í™•ì¸\r",
											"pm.test(\"HTTP 2xx\", function () {\r",
											"  pm.expect(pm.response.code).to.be.within(200, 299);\r",
											"});\r",
											"\r",
											"// ì•± ë ˆë²¨ codeê°€ ìˆìœ¼ë©´ 200ì¸ì§€ ì°¸ê³ (ìˆì„ ë•Œë§Œ ê²€ì‚¬)\r",
											"if (json && typeof json.code !== \"undefined\") {\r",
											"  pm.test(\"app code == 200 (ìˆì„ ë•Œë§Œ)\", function () {\r",
											"    pm.expect(json.code).to.eql(200);\r",
											"  });\r",
											"}\r",
											"\r",
											"// ì„œë²„ê°€ ì‘ë‹µì— ê°±ì‹ ëœ nameì„ ì—ì½”í•´ ì¤„ ê²½ìš°ë§Œ í™•ì¸(ì—†ìœ¼ë©´ ìŠ¤í‚µ)\r",
											"const echoedName = json?.result?.patient?.name ?? json?.name ?? null;\r",
											"if (echoedName) {\r",
											"  pm.test(\"nameì´ NEW_NAMEìœ¼ë¡œ ì—…ë°ì´íŠ¸ ë˜ì—ˆëŠ”ì§€\", function () {\r",
											"    pm.expect(echoedName).to.eql(pm.environment.get(\"NEW_NAME\"));\r",
											"  });\r",
											"}\r",
											"\r",
											"// í¸ì˜: ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ëœ ì´ë¦„ ë³´ê´€\r",
											"if (echoedName) {\r",
											"  pm.environment.set(\"LAST_UPDATED_NAME\", echoedName);\r",
											"} else if (pm.environment.get(\"NEW_NAME\")) {\r",
											"  // 204ê°™ì´ ë°”ë””ê°€ ì—†ëŠ” ê²½ìš°ì—ëŠ” NEW_NAMEì„ ê·¸ëŒ€ë¡œ ë³´ê´€\r",
											"  pm.environment.set(\"LAST_UPDATED_NAME\", pm.environment.get(\"NEW_NAME\"));\r",
											"}\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "PATCH",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/patient/{{PATIENT_ID}}",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"patient",
										"{{PATIENT_ID}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "í™˜ì ì •ë³´ ë³€ê²½_sex",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// 1) ëœë¤ ì„±ë³„ ì„ íƒ (M/F)\r",
											"let sex = [\"M\", \"F\"][Math.floor(Math.random() * 2)];\r",
											"\r",
											"// 2) í˜„ì¬ ì„±ë³„ì´ ì´ë¯¸ í™˜ê²½ë³€ìˆ˜ì— ìˆìœ¼ë©´, ê°™ì„ ê²½ìš° ë°˜ì „\r",
											"const cur = (pm.environment.get(\"CURRENT_SEX\") || \"\").toUpperCase();\r",
											"if (cur && (sex === cur)) {\r",
											"  sex = (cur === \"M\") ? \"F\" : \"M\";\r",
											"}\r",
											"\r",
											"// 3) ì´ë¦„/ìƒë…„ì€ ê³ ì •ê°’ ë˜ëŠ” í™˜ê²½ë³€ìˆ˜ë¡œ ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆ ê°€ëŠ¥\r",
											"const name  = pm.environment.get(\"PATCH_NAME\")  || \"irb60_0013\";\r",
											"const birth = pm.environment.get(\"PATCH_BIRTH\") || \"1970-01-01\";\r",
											"\r",
											"// 4) PATCH ìš”ì²­ ë°”ë”” êµ¬ì„± & ì ìš©\r",
											"const body = { name, sex, birth };\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"pm.request.headers.upsert({ key: \"Accept\", value: \"application/json\" });\r",
											"pm.request.body.update(JSON.stringify(body, null, 2));\r",
											"\r",
											"// 5) ê²€ì¦/ë¡œê·¸ìš© í™˜ê²½ë³€ìˆ˜ ì €ì¥\r",
											"pm.environment.set(\"NEXT_SEX\", sex);\r",
											"console.log(\"PATCH body:\", body);\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"let json = null;\r",
											"try { json = pm.response.json(); } catch (_) { /* 204ì¼ ìˆ˜ ìˆìŒ */ }\r",
											"\r",
											"// HTTP 2xxë©´ í†µê³¼\r",
											"pm.test(\"HTTP 2xx\", function () {\r",
											"  pm.expect(pm.response.code).to.be.within(200, 299);\r",
											"});\r",
											"\r",
											"// ì•± ì½”ë“œê°€ ì¡´ì¬í•  ë•Œë§Œ 200 í™•ì¸\r",
											"if (json && typeof json.code !== \"undefined\") {\r",
											"  pm.test(\"app code == 200 (ìˆì„ ë•Œë§Œ)\", function () {\r",
											"    pm.expect(json.code).to.eql(200);\r",
											"  });\r",
											"}\r",
											"\r",
											"// ì‘ë‹µì´ sexë¥¼ ì—ì½”í•˜ë©´ ìš”ì²­ ê°’ê³¼ ë™ì¼í•œì§€ í™•ì¸ (ìˆì„ ë•Œë§Œ)\r",
											"const echoedSex = json?.result?.patient?.sex ?? json?.sex ?? null;\r",
											"if (echoedSex) {\r",
											"  pm.test(\"sexê°€ ìš”ì²­ê°’ê³¼ ë™ì¼\", function () {\r",
											"    pm.expect(echoedSex).to.eql(pm.environment.get(\"NEXT_SEX\"));\r",
											"  });\r",
											"}\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "PATCH",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/patient/{{PATIENT_ID}}",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"patient",
										"{{PATIENT_ID}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "í™˜ì ì •ë³´ ë³€ê²½_birth",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// ===== KST(Asia/Seoul) ê¸°ì¤€ \"ì˜¤ëŠ˜\" ê³„ì‚° =====\r",
											"function getTodayKST() {\r",
											"  try {\r",
											"    const s = new Date().toLocaleDateString('en-CA', { timeZone: 'Asia/Seoul' });\r",
											"    const [y, m, d] = s.split('-').map(Number);\r",
											"    return new Date(Date.UTC(y, m - 1, d));\r",
											"  } catch (e) {\r",
											"    const now = new Date();\r",
											"    return new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate()));\r",
											"  }\r",
											"}\r",
											"\r",
											"function parseYMD(s) {\r",
											"  const m = /^(\\d{4})-(\\d{2})-(\\d{2})$/.exec(s);\r",
											"  if (!m) return null;\r",
											"  return new Date(Date.UTC(+m[1], +m[2] - 1, +m[3]));\r",
											"}\r",
											"\r",
											"function formatYMD(dt) {\r",
											"  const y = dt.getUTCFullYear();\r",
											"  const m = String(dt.getUTCMonth() + 1).padStart(2, '0');\r",
											"  const d = String(dt.getUTCDate()).padStart(2, '0');\r",
											"  return `${y}-${m}-${d}`;\r",
											"}\r",
											"\r",
											"function randomDateUTC(minDt, maxDt) {\r",
											"  const minMs = minDt.getTime();\r",
											"  const maxMs = maxDt.getTime();\r",
											"  const rand = minMs + Math.floor(Math.random() * (maxMs - minMs + 1)); // inclusive\r",
											"  return new Date(rand);\r",
											"}\r",
											"\r",
											"// ===== ë²”ìœ„ ì„¤ì •: 1930-01-01 ~ 1960-01-01 =====\r",
											"// (í™˜ê²½ë³€ìˆ˜ë¡œ ë®ì–´ì“°ê¸° ê°€ëŠ¥: MIN_BIRTH / MAX_BIRTH)\r",
											"const minBirthStr = pm.environment.get(\"MIN_BIRTH\") || \"1930-01-01\";\r",
											"const maxBirthStr = pm.environment.get(\"MAX_BIRTH\") || \"1960-01-01\";\r",
											"\r",
											"let minBirth = parseYMD(minBirthStr) || parseYMD(\"1930-01-01\");\r",
											"let maxBirth = parseYMD(maxBirthStr) || parseYMD(\"1960-01-01\");\r",
											"\r",
											"// ë°©ì–´: min > maxì´ë©´ ì„œë¡œ ìŠ¤ì™‘\r",
											"if (minBirth.getTime() > maxBirth.getTime()) {\r",
											"  const tmp = minBirth; minBirth = maxBirth; maxBirth = tmp;\r",
											"}\r",
											"\r",
											"// ===== ëœë¤ ìƒë…„ì›”ì¼ ìƒì„± (yyyy-mm-dd) =====\r",
											"const birthDt = randomDateUTC(minBirth, maxBirth);\r",
											"const newBirth = formatYMD(birthDt);\r",
											"pm.environment.set(\"NEW_BIRTH\", newBirth);\r",
											"\r",
											"// ===== ê¸°íƒ€ í•„ë“œ =====\r",
											"const name  = pm.environment.get(\"PATCH_NAME\") || \"irb60_0013\";\r",
											"const sex   = pm.environment.get(\"PATCH_SEX\")  || \"M\";\r",
											"\r",
											"// ===== ìš”ì²­ ë°”ë”” êµ¬ì„± & ì ìš© =====\r",
											"const body = { name, sex, birth: newBirth };\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"pm.request.headers.upsert({ key: \"Accept\", value: \"application/json\" });\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(body, null, 2));\r",
											"\r",
											"console.log(\"PATCH body =\", body);\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"let json = null;\r",
											"try { json = pm.response.json(); } catch (_) { /* 204ì¼ ìˆ˜ ìˆìŒ */ }\r",
											"\r",
											"// 1) HTTP 2xx í™•ì¸\r",
											"pm.test(\"HTTP 2xx\", function () {\r",
											"  pm.expect(pm.response.code).to.be.within(200, 299);\r",
											"});\r",
											"\r",
											"// 2) ì•± ì½”ë“œê°€ ìˆìœ¼ë©´ 200 í™•ì¸\r",
											"if (json && typeof json.code !== \"undefined\") {\r",
											"  pm.test(\"app code == 200 (ìˆì„ ë•Œë§Œ)\", function () {\r",
											"    pm.expect(json.code).to.eql(200);\r",
											"  });\r",
											"}\r",
											"\r",
											"// 3) ì„œë²„ê°€ birthë¥¼ ì—ì½”í•˜ë©´ ìš°ë¦¬ê°€ ì „ì†¡í•œ ê°’ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸\r",
											"const echoedBirth = json?.result?.patient?.birth ?? json?.birth ?? null;\r",
											"if (echoedBirth) {\r",
											"  pm.test(\"birthê°€ ìš”ì²­ê°’ê³¼ ë™ì¼\", function () {\r",
											"    pm.expect(echoedBirth).to.eql(pm.environment.get(\"NEW_BIRTH\"));\r",
											"  });\r",
											"}\r",
											"\r",
											"// ì°¸ê³ ìš© ë¡œê·¸\r",
											"console.log(\"Sent NEW_BIRTH =\", pm.environment.get(\"NEW_BIRTH\"));\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "PATCH",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/patient/{{PATIENT_ID}}",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"patient",
										"{{PATIENT_ID}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "í™˜ì clinical ì •ë³´ ë³€ê²½_MMSE(add score)",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// ===== ìœ í‹¸ =====\r",
											"function parseYMD(s){ const m=/^(\\d{4})-(\\d{2})-(\\d{2})$/.exec(s); if(!m) return null; return new Date(Date.UTC(+m[1],+m[2]-1,+m[3])); }\r",
											"function formatYMD(dt){ const y=dt.getUTCFullYear(), m=String(dt.getUTCMonth()+1).padStart(2,'0'), d=String(dt.getUTCDate()).padStart(2,'0'); return `${y}-${m}-${d}`; }\r",
											"function randInt(min,max){ min=Math.ceil(min); max=Math.floor(max); return Math.floor(Math.random()*(max-min+1))+min; }\r",
											"function randomDateUTC(minDt,maxDt){\r",
											"  const dayMs=86400000, totalDays=Math.floor((maxDt - minDt)/dayMs)+1;\r",
											"  const off = randInt(0, totalDays-1);\r",
											"  return new Date(minDt.getTime() + off*dayMs);\r",
											"}\r",
											"\r",
											"// ===== ì„¤ì •(ë¯¸ë˜ í—ˆìš© ë²”ìœ„) =====\r",
											"let minDate = parseYMD(pm.environment.get(\"MIN_ASSESS_DATE\") || \"2000-01-01\") || parseYMD(\"2000-01-01\");\r",
											"let maxDate = parseYMD(pm.environment.get(\"MAX_ASSESS_DATE\") || \"2100-12-31\") || parseYMD(\"2100-12-31\");\r",
											"if (minDate > maxDate) { const t=minDate; minDate=maxDate; maxDate=t; } // ë³´ì •\r",
											"\r",
											"// ì ìˆ˜/ë©”ëª¨ ëœë¤\r",
											"const mmseValue = randInt(Number(pm.environment.get(\"MIN_MMSE\") || 0), Number(pm.environment.get(\"MAX_MMSE\") || 30));\r",
											"const MEMO_MAX_LEN = Math.min(parseInt(pm.environment.get(\"MEMO_MAX_LEN\") || \"256\",10), 256);\r",
											"const MEMO_MIN_LEN = Math.max(parseInt(pm.environment.get(\"MEMO_MIN_LEN\") || \"0\",10), 0);\r",
											"const charset = (pm.environment.get(\"MEMO_CHARSET\") || \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789 .,_-()[]{}:;!?/@#\").split(\"\");\r",
											"function randomMemo(){ const len=randInt(MEMO_MIN_LEN,MEMO_MAX_LEN); let out=\"\"; for(let i=0;i<len;i++) out+=charset[randInt(0,charset.length-1)]; return out; }\r",
											"\r",
											"// ë‚ ì§œ/ë©”ëª¨ ìƒì„±\r",
											"const mmseDate = formatYMD(randomDateUTC(minDate, maxDate));\r",
											"const memoStr  = randomMemo();\r",
											"\r",
											"// ===== ê¸°ì¡´ Body ì½ê³  MMSEë§Œ ë®ì–´ì“°ê¸° (ì—†ìœ¼ë©´ ê¸°ë³¸ ìƒì„±) =====\r",
											"let bodyObj={};\r",
											"try { const raw=pm.request.body?.raw||\"\"; bodyObj = raw ? JSON.parse(raw) : {}; } catch (_) { bodyObj={}; }\r",
											"if (typeof bodyObj!==\"object\" || bodyObj===null) bodyObj={};\r",
											"\r",
											"if (!(\"apoeStatusType\" in bodyObj)) bodyObj.apoeStatusType = null;\r",
											"if (typeof bodyObj.memo !== \"string\") bodyObj.memo = \"\";\r",
											"if (!Array.isArray(bodyObj.assessmentScore)) bodyObj.assessmentScore = [];\r",
											"\r",
											"// MMSE í•­ëª© ì°¾ê±°ë‚˜ ìƒì„±\r",
											"let mmseIdx = bodyObj.assessmentScore.findIndex(a => a && a.assessmentType===\"MMSE\");\r",
											"if (mmseIdx === -1) {\r",
											"  bodyObj.assessmentScore.push({ assessmentType:\"MMSE\", addList:[], deleteList:[] });\r",
											"  mmseIdx = bodyObj.assessmentScore.length - 1;\r",
											"}\r",
											"const mmse = bodyObj.assessmentScore[mmseIdx];\r",
											"mmse.addList = Array.isArray(mmse.addList) ? mmse.addList : [];\r",
											"mmse.deleteList = Array.isArray(mmse.deleteList) ? mmse.deleteList : [];\r",
											"if (mmse.addList.length === 0) mmse.addList.push({});\r",
											"\r",
											"// ëœë¤ ê°’ ì£¼ì…\r",
											"mmse.addList[0].value = mmseValue;\r",
											"mmse.addList[0].date  = mmseDate;\r",
											"\r",
											"// memo ì£¼ì…(â‰¤256ì)\r",
											"bodyObj.memo = memoStr;\r",
											"\r",
											"// ===== ìš”ì²­ ë°”ë””/í—¤ë” ì ìš© =====\r",
											"pm.request.headers.upsert({ key:\"Content-Type\", value:\"application/json\" });\r",
											"pm.request.headers.upsert({ key:\"Accept\", value:\"application/json\" });\r",
											"pm.request.body.update(JSON.stringify(bodyObj, null, 2));\r",
											"\r",
											"// ===== í™˜ê²½ë³€ìˆ˜ ì €ì¥(ë‹¤ë¥¸ ìš”ì²­ì—ì„œ ì¬ì‚¬ìš©) =====\r",
											"pm.environment.set(\"RAND_MMSE_VALUE\", String(mmseValue));\r",
											"pm.environment.set(\"RAND_MMSE_DATE\", mmseDate);\r",
											"pm.environment.set(\"RAND_MEMO\", memoStr);\r",
											"\r",
											"// ğŸ‘‰ ë‚˜ì¤‘ì— ì¡°íšŒì—ì„œ ì“°ê¸° ìœ„í•´ dateë¥¼ PATIENT_SCOREì— ì €ì¥\r",
											"pm.environment.set(\"PATIENT_SCORE\", mmseDate);\r",
											"\r",
											"console.log(\"Prepared:\", { value:mmseValue, date:mmseDate, memoLen:memoStr.length });\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"let json=null; try{ json=pm.response.json(); }catch(_){}\r",
											"pm.test(\"HTTP 2xx\", function(){ pm.expect(pm.response.code).to.be.within(200,299); });\r",
											"if (json && typeof json.code!==\"undefined\") {\r",
											"  pm.test(\"app code == 200 (ìˆì„ ë•Œë§Œ)\", function(){ pm.expect(json.code).to.eql(200); });\r",
											"}\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "PATCH",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/patient/{{PATIENT_ID}}/clinical-info",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"patient",
										"{{PATIENT_ID}}",
										"clinical-info"
									]
								}
							},
							"response": []
						},
						{
							"name": "í™˜ì ë³„ clinical info ì¡°íšŒ",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === 1) ì‘ë‹µ JSON íŒŒì‹± ===\r",
											"let json;\r",
											"try { json = pm.response.json(); }\r",
											"catch (e) {\r",
											"  pm.environment.unset(\"PATIENT_SCORE_ID\");\r",
											"  console.error(\"JSON parse failed:\", e);\r",
											"  // HTTP ì½”ë“œë§Œ ì†Œí”„íŠ¸í•˜ê²Œ í™•ì¸\r",
											"  pm.test(\"HTTP 2xx\", function () {\r",
											"    pm.expect(pm.response.code).to.be.within(200, 299);\r",
											"  });\r",
											"  return;\r",
											"}\r",
											"\r",
											"// === 2) mmseList ì•ˆì „ ì¶”ì¶œ ===\r",
											"const mmseList = Array.isArray(json?.result?.mmseList) ? json.result.mmseList : [];\r",
											"\r",
											"// === 3) íƒ€ê²Ÿ ë‚ ì§œ ê°€ì ¸ì˜¤ê¸° (í™˜ê²½ë³€ìˆ˜ PATIENT_SCORE) ===\r",
											"const targetDateRaw = (pm.environment.get(\"PATIENT_SCORE\") || \"\").trim();\r",
											"const normalizeDate = (s) => String(s || \"\").split(\"T\")[0].split(\" \")[0];\r",
											"\r",
											"if (!targetDateRaw) {\r",
											"  pm.environment.unset(\"PATIENT_SCORE_ID\");\r",
											"  console.warn(\"PATIENT_SCORE is empty or not set.\");\r",
											"} else {\r",
											"  const targetDate = normalizeDate(targetDateRaw);\r",
											"\r",
											"  // === 4) ë‚ ì§œ ë§¤ì¹­ (ë™ì¼ yyyy-mm-dd) ===\r",
											"  const matches = mmseList.filter(it => normalizeDate(it?.date) === targetDate);\r",
											"\r",
											"  if (matches.length === 0) {\r",
											"    pm.environment.unset(\"PATIENT_SCORE_ID\");\r",
											"    console.warn(`No mmseList item matches date=${targetDate}. Available dates:`, mmseList.map(x => x?.date));\r",
											"  } else {\r",
											"    // ì—¬ëŸ¬ê°œë©´ idê°€ ê°€ì¥ í° ê²ƒ ì„ íƒ\r",
											"    const chosen = matches.reduce((best, cur) => {\r",
											"      const bid = Number(best?.id ?? -Infinity);\r",
											"      const cid = Number(cur?.id ?? -Infinity);\r",
											"      return cid > bid ? cur : best;\r",
											"    }, matches[0]);\r",
											"\r",
											"    const chosenId = chosen?.id;\r",
											"    if (chosenId !== undefined && chosenId !== null) {\r",
											"      pm.environment.set(\"PATIENT_SCORE_ID\", String(chosenId));\r",
											"      console.log(`PATIENT_SCORE_ID set to ${chosenId} for date ${targetDate}`);\r",
											"    } else {\r",
											"      pm.environment.unset(\"PATIENT_SCORE_ID\");\r",
											"      console.warn(\"Match found but 'id' is missing:\", chosen);\r",
											"    }\r",
											"  }\r",
											"}\r",
											"\r",
											"// === 5) (ì„ íƒ) ê°€ë²¼ìš´ í™•ì¸ë§Œ ===\r",
											"pm.test(\"HTTP 2xx\", function () {\r",
											"  pm.expect(pm.response.code).to.be.within(200, 299);\r",
											"});\r",
											"if (typeof json?.code !== \"undefined\") {\r",
											"  pm.test(\"app code == 200 (ìˆì„ ë•Œë§Œ)\", function () {\r",
											"    pm.expect(json.code).to.eql(200);\r",
											"  });\r",
											"}\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/patient/{{PATIENT_ID}}/clinical-info",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"patient",
										"{{PATIENT_ID}}",
										"clinical-info"
									]
								}
							},
							"response": []
						},
						{
							"name": "í™˜ì clinical ì •ë³´ ë³€ê²½_MMSE(delete score)",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// 1) í™˜ê²½ë³€ìˆ˜ì—ì„œ ID ì½ê¸° (ìˆ«ì ë³´ì •)\r",
											"const rawId = pm.environment.get(\"PATIENT_SCORE_ID\");\r",
											"const delId = Number(rawId);\r",
											"if (!Number.isFinite(delId)) {\r",
											"  // ID ì—†ê±°ë‚˜ ìˆ«ì ì•„ë‹˜ â†’ ë³´ë‚´ë´ì•¼ ì‹¤íŒ¨ ê°€ëŠ¥ì„±ì´ ë†’ìœ¼ë‹ˆ ê²½ê³ \r",
											"  console.warn(\"PATIENT_SCORE_ID is not set or not a number:\", rawId);\r",
											"}\r",
											"\r",
											"// 2) í˜„ ìš”ì²­ Body ì½ê¸° (ì—†ìœ¼ë©´ ê¸°ë³¸ ìŠ¤ì¼ˆë ˆí†¤ ìƒì„±)\r",
											"let bodyObj = {};\r",
											"try {\r",
											"  const raw = pm.request.body?.raw || \"\";\r",
											"  bodyObj = raw ? JSON.parse(raw) : {};\r",
											"} catch (_) { bodyObj = {}; }\r",
											"\r",
											"// 3) ê¸°ë³¸ êµ¬ì¡° ë³´ì •\r",
											"if (typeof bodyObj !== \"object\" || bodyObj === null) bodyObj = {};\r",
											"if (!(\"apoeStatusType\" in bodyObj)) bodyObj.apoeStatusType = null;\r",
											"if (typeof bodyObj.memo !== \"string\") bodyObj.memo = \"DELETE\";\r",
											"if (!Array.isArray(bodyObj.assessmentScore)) bodyObj.assessmentScore = [];\r",
											"\r",
											"// 4) MMSE í•­ëª© ì°¾ê±°ë‚˜ ìƒì„±\r",
											"let mmseIdx = bodyObj.assessmentScore.findIndex(a => a && a.assessmentType === \"MMSE\");\r",
											"if (mmseIdx === -1) {\r",
											"  bodyObj.assessmentScore.push({ assessmentType: \"MMSE\", addList: [], deleteList: [] });\r",
											"  mmseIdx = bodyObj.assessmentScore.length - 1;\r",
											"}\r",
											"const mmse = bodyObj.assessmentScore[mmseIdx];\r",
											"\r",
											"// 5) deleteListë¥¼ PATIENT_SCORE_ID í•˜ë‚˜ë¡œ ì„¤ì •\r",
											"mmse.addList = Array.isArray(mmse.addList) ? mmse.addList : [];\r",
											"mmse.deleteList = Number.isFinite(delId) ? [ delId ] : [];  // delIdê°€ ìœ íš¨í•˜ì§€ ì•Šìœ¼ë©´ ë¹ˆ ë°°ì—´ë¡œ\r",
											"\r",
											"// 6) í—¤ë” ë³´ì • + Body ì—…ë°ì´íŠ¸\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"pm.request.headers.upsert({ key: \"Accept\", value: \"application/json\" });\r",
											"pm.request.body.update(JSON.stringify(bodyObj, null, 2));\r",
											"\r",
											"console.log(\"PATCH clinical-info body:\", bodyObj);\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"let json = null;\r",
											"try { json = pm.response.json(); } catch (_) {}\r",
											"\r",
											"pm.test(\"HTTP 2xx\", function () {\r",
											"  pm.expect(pm.response.code).to.be.within(200, 299);\r",
											"});\r",
											"\r",
											"if (json && typeof json.code !== \"undefined\") {\r",
											"  pm.test(\"app code == 200 (ìˆì„ ë•Œë§Œ)\", function () {\r",
											"    pm.expect(json.code).to.eql(200);\r",
											"  });\r",
											"}\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "PATCH",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n  \"apoeStatusType\": null,\r\n  \"assessmentScore\": [\r\n    {\r\n      \"assessmentType\": \"MMSE\",\r\n      \"addList\": [],\r\n      \"deleteList\": [ {{PATIENT_SCORE_ID}} ]\r\n    },\r\n    {\r\n      \"assessmentType\": \"CDR_SB\",\r\n      \"addList\": [],\r\n      \"deleteList\": []\r\n    }\r\n  ],\r\n  \"memo\": \"DELETE\"\r\n}\r\n",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/patient/{{PATIENT_ID}}/clinical-info",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"patient",
										"{{PATIENT_ID}}",
										"clinical-info"
									]
								}
							},
							"response": []
						},
						{
							"name": "í™˜ì clinical ì •ë³´ ë³€ê²½_CDR-SB(add score)",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// ===== utils =====\r",
											"function parseYMD(s){ const m=/^(\\d{4})-(\\d{2})-(\\d{2})$/.exec(s||\"\"); if(!m) return null; return new Date(Date.UTC(+m[1],+m[2]-1,+m[3])); }\r",
											"function fmtYMD(dt){ const y=dt.getUTCFullYear(), m=String(dt.getUTCMonth()+1).padStart(2,'0'), d=String(dt.getUTCDate()).padStart(2,'0'); return `${y}-${m}-${d}`; }\r",
											"function randInt(min,max){ min=Math.ceil(min); max=Math.floor(max); return Math.floor(Math.random()*(max-min+1))+min; }\r",
											"function randDateUTC(minDt,maxDt){\r",
											"  const day=86400000, total=Math.max(1, Math.floor((maxDt-minDt)/day)+1);\r",
											"  const off = randInt(0,total-1);\r",
											"  return new Date(minDt.getTime()+off*day);\r",
											"}\r",
											"\r",
											"// ===== config via env =====\r",
											"const MIN_DATE = parseYMD(pm.environment.get(\"MIN_ASSESS_DATE\") || \"2000-01-01\") || parseYMD(\"2000-01-01\");\r",
											"const MAX_DATE = parseYMD(pm.environment.get(\"MAX_ASSESS_DATE\") || fmtYMD(new Date())); // ì˜¤ëŠ˜\r",
											"let minDate = MIN_DATE, maxDate = MAX_DATE;\r",
											"if (minDate > maxDate) { const t=minDate; minDate=maxDate; maxDate=t; }\r",
											"\r",
											"const MIN_CDRSB = Number(pm.environment.get(\"MIN_CDRSB\") || 0);\r",
											"const MAX_CDRSB = Number(pm.environment.get(\"MAX_CDRSB\") || 18);\r",
											"const STEP_CDRSB = Number(pm.environment.get(\"STEP_CDRSB\") || 0.5);\r",
											"const MEMO_TEXT = (pm.environment.get(\"MEMO_TEXT\") ?? \"DELETE\");\r",
											"\r",
											"// ===== pick random value/date =====\r",
											"const steps = Math.max(1, Math.floor((Math.max(MIN_CDRSB,MAX_CDRSB)-Math.min(MIN_CDRSB,MAX_CDRSB))/STEP_CDRSB)+1);\r",
											"const base  = Math.min(MIN_CDRSB,MAX_CDRSB);\r",
											"const cidx  = randInt(0, steps-1);\r",
											"const cdrsbValue = Math.round((base + cidx*STEP_CDRSB)*2)/2; // 0.5 ìŠ¤í… ìŠ¤ëƒ…\r",
											"const assessDate = fmtYMD(randDateUTC(minDate, maxDate));\r",
											"\r",
											"// ===== build body (overwrite entirely to match server spec) =====\r",
											"const body = {\r",
											"  apoeStatusType: null,\r",
											"  assessmentScore: [\r",
											"    { assessmentType: \"MMSE\",   addList: [], deleteList: [] },\r",
											"    { assessmentType: \"CDR_SB\", addList: [{ value: cdrsbValue, date: assessDate }], deleteList: [] }\r",
											"  ],\r",
											"  memo: MEMO_TEXT\r",
											"};\r",
											"\r",
											"// ===== headers & inject =====\r",
											"pm.request.headers.upsert({ key:\"Content-Type\", value:\"application/json\" });\r",
											"pm.request.headers.upsert({ key:\"Accept\", value:\"application/json\" });\r",
											"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key:\"Authorization\", value:`Bearer ${token}` });\r",
											"\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(body, null, 2));\r",
											"\r",
											"// ===== debug / chaining =====\r",
											"// ì¡°íšŒ ë‹¨ê³„ì—ì„œ ë‚ ì§œ ë§¤ì¹­ì„ ìœ„í•´ ì €ì¥\r",
											"pm.environment.set(\"PATIENT_SCORE\", assessDate);        // ğŸ”‘ ì¡°íšŒìš© íƒ€ê²Ÿ ë‚ ì§œ\r",
											"pm.environment.set(\"RAND_CDRSB_VALUE\", String(cdrsbValue));\r",
											"pm.environment.set(\"RAND_CDRSB_DATE\", assessDate);\r",
											"\r",
											"console.log(\"[PATCH clinical-info] body =\", body);\r",
											"console.log(\"[TRACE] PATIENT_SCORE =\", assessDate);\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"let json=null; try{ json=pm.response.json(); }catch(_){}\r",
											"pm.test(\"HTTP 2xx\", function(){ pm.expect(pm.response.code).to.be.within(200,299); });\r",
											"if (json && typeof json.code!==\"undefined\") {\r",
											"  pm.test(\"app code == 200 (ìˆì„ ë•Œë§Œ)\", function(){ pm.expect(json.code).to.eql(200); });\r",
											"}\r",
											"\r",
											"\r",
											"/// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "PATCH",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/patient/{{PATIENT_ID}}/clinical-info",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"patient",
										"{{PATIENT_ID}}",
										"clinical-info"
									]
								}
							},
							"response": []
						},
						{
							"name": "í™˜ì ë³„ clinical info ì¡°íšŒ",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === 1) ì‘ë‹µ JSON íŒŒì‹± ===\r",
											"let json;\r",
											"try { json = pm.response.json(); }\r",
											"catch (e) {\r",
											"  pm.environment.unset(\"PATIENT__SCORE_ID\");\r",
											"  pm.environment.unset(\"PATIENT_SCORE_ID\");\r",
											"  console.error(\"JSON parse failed:\", e);\r",
											"  // HTTP ì½”ë“œë§Œ ì†Œí”„íŠ¸í•˜ê²Œ í™•ì¸\r",
											"  pm.test(\"HTTP 2xx\", function () {\r",
											"    pm.expect(pm.response.code).to.be.within(200, 299);\r",
											"  });\r",
											"  return;\r",
											"}\r",
											"\r",
											"// === 2) cdrSbList ì•ˆì „ ì¶”ì¶œ ===\r",
											"const cdrList = Array.isArray(json?.result?.cdrSbList) ? json.result.cdrSbList : [];\r",
											"\r",
											"// === 3) íƒ€ê²Ÿ ë‚ ì§œ ê°€ì ¸ì˜¤ê¸° (í™˜ê²½ë³€ìˆ˜ PATIENT_SCORE) ===\r",
											"const normalizeDate = (s) => String(s || \"\").split(\"T\")[0].split(\" \")[0];\r",
											"const targetDateRaw = (pm.environment.get(\"PATIENT_SCORE\") || \"\").trim();\r",
											"\r",
											"if (!targetDateRaw) {\r",
											"  pm.environment.unset(\"PATIENT__SCORE_ID\");\r",
											"  pm.environment.unset(\"PATIENT_SCORE_ID\");\r",
											"  console.warn(\"[CDR-SB] PATIENT_SCORE is empty or not set.\");\r",
											"} else {\r",
											"  const targetDate = normalizeDate(targetDateRaw);\r",
											"\r",
											"  // === 4) ë‚ ì§œ ë§¤ì¹­ (ë™ì¼ yyyy-mm-dd) ===\r",
											"  const matches = cdrList.filter(it => normalizeDate(it?.date) === targetDate);\r",
											"\r",
											"  if (matches.length === 0) {\r",
											"    pm.environment.unset(\"PATIENT__SCORE_ID\");\r",
											"    pm.environment.unset(\"PATIENT_SCORE_ID\");\r",
											"    console.warn(`[CDR-SB] No cdrSbList item matches date=${targetDate}. Available dates:`, cdrList.map(x => x?.date));\r",
											"  } else {\r",
											"    // ì—¬ëŸ¬ê°œë©´ idê°€ ê°€ì¥ í° ê²ƒ ì„ íƒ\r",
											"    const chosen = matches.reduce((best, cur) => {\r",
											"      const bid = Number(best?.id ?? -Infinity);\r",
											"      const cid = Number(cur?.id ?? -Infinity);\r",
											"      return cid > bid ? cur : best;\r",
											"    }, matches[0]);\r",
											"\r",
											"    const chosenId = chosen?.id;\r",
											"    if (chosenId !== undefined && chosenId !== null) {\r",
											"      // ìš”ì²­í•˜ì‹  ë³€ìˆ˜ëª…(ë°‘ì¤„ 2ê°œ)ê³¼ ê¸°ì¡´ ë³€ìˆ˜ëª…(1ê°œ) ë‘˜ ë‹¤ ì„¸íŒ…\r",
											"      pm.environment.set(\"PATIENT__SCORE_ID\", String(chosenId));\r",
											"      pm.environment.set(\"PATIENT_SCORE_ID\",  String(chosenId));\r",
											"      console.log(`[CDR-SB] PATIENT__SCORE_ID set to ${chosenId} for date ${targetDate}`);\r",
											"    } else {\r",
											"      pm.environment.unset(\"PATIENT__SCORE_ID\");\r",
											"      pm.environment.unset(\"PATIENT_SCORE_ID\");\r",
											"      console.warn(\"[CDR-SB] Match found but 'id' is missing:\", chosen);\r",
											"    }\r",
											"  }\r",
											"}\r",
											"\r",
											"// === 5) (ì„ íƒ) ê°€ë²¼ìš´ í™•ì¸ë§Œ ===\r",
											"pm.test(\"HTTP 2xx\", function () {\r",
											"  pm.expect(pm.response.code).to.be.within(200, 299);\r",
											"});\r",
											"if (typeof json?.code !== \"undefined\") {\r",
											"  pm.test(\"app code == 200 (ìˆì„ ë•Œë§Œ)\", function () {\r",
											"    pm.expect(json.code).to.eql(200);\r",
											"  });\r",
											"}\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/patient/{{PATIENT_ID}}/clinical-info",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"patient",
										"{{PATIENT_ID}}",
										"clinical-info"
									]
								}
							},
							"response": []
						},
						{
							"name": "í™˜ì clinical ì •ë³´ ë³€ê²½_CDR-SB(delete score)",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// ===== 0) ì„¤ì • =====\r",
											"const TARGET_ASSESS = (pm.environment.get(\"TARGET_ASSESS\") || \"CDR_SB\").trim(); // ê¸°ë³¸ CDR_SB\r",
											"const MEMO_TEXT = (pm.environment.get(\"MEMO_TEXT\") ?? \"DELETE\");\r",
											"\r",
											"// ===== 1) í™˜ê²½ë³€ìˆ˜ì—ì„œ ì‚­ì œí•  ID ì½ê¸° (ìˆ«ì ë³´ì •)\r",
											"const rawId = pm.environment.get(\"PATIENT_SCORE_ID\");\r",
											"const delId = Number(rawId);\r",
											"if (!Number.isFinite(delId)) {\r",
											"  console.warn(\"[clinical-info] PATIENT_SCORE_ID is not set or not a number:\", rawId);\r",
											"}\r",
											"\r",
											"// ===== 2) í˜„ ìš”ì²­ Body ì½ê¸° (ì—†ìœ¼ë©´ ê¸°ë³¸ ìŠ¤ì¼ˆë ˆí†¤)\r",
											"let bodyObj = {};\r",
											"try {\r",
											"  const raw = pm.request.body?.raw || \"\";\r",
											"  bodyObj = raw ? JSON.parse(raw) : {};\r",
											"} catch (_) { bodyObj = {}; }\r",
											"\r",
											"// ===== 3) ê¸°ë³¸ êµ¬ì¡° ë³´ì •\r",
											"if (typeof bodyObj !== \"object\" || bodyObj === null) bodyObj = {};\r",
											"if (!(\"apoeStatusType\" in bodyObj)) bodyObj.apoeStatusType = null;\r",
											"if (typeof bodyObj.memo !== \"string\") bodyObj.memo = MEMO_TEXT;\r",
											"if (!Array.isArray(bodyObj.assessmentScore)) bodyObj.assessmentScore = [];\r",
											"\r",
											"// ===== 4) ë³´ì¡°: íŠ¹ì • assessmentType í•­ëª©ì„ ë³´ì¥í•˜ëŠ” í—¬í¼\r",
											"function ensureAssess(type) {\r",
											"  let idx = bodyObj.assessmentScore.findIndex(a => a && a.assessmentType === type);\r",
											"  if (idx === -1) {\r",
											"    bodyObj.assessmentScore.push({ assessmentType: type, addList: [], deleteList: [] });\r",
											"    idx = bodyObj.assessmentScore.length - 1;\r",
											"  }\r",
											"  const it = bodyObj.assessmentScore[idx];\r",
											"  it.addList = Array.isArray(it.addList) ? it.addList : [];\r",
											"  it.deleteList = Array.isArray(it.deleteList) ? it.deleteList : [];\r",
											"  return { idx, it };\r",
											"}\r",
											"\r",
											"// ===== 5) MMSE & CDR_SB í•­ëª© ë³´ì¥\r",
											"const { it: mmse }    = ensureAssess(\"MMSE\");\r",
											"const { it: cdrsb }   = ensureAssess(\"CDR_SB\");\r",
											"\r",
											"// ëª¨ë“  addListëŠ” ë¹„ì›Œì„œ \"ì‚­ì œ ì „ìš©\" ìš”ì²­ìœ¼ë¡œ ë³´ëƒ„\r",
											"mmse.addList = [];\r",
											"cdrsb.addList = [];\r",
											"\r",
											"// ===== 6) íƒ€ê²Ÿ í‰ê°€íƒ€ì…ì—ë§Œ deleteList ì„¤ì •\r",
											"mmse.deleteList  = (TARGET_ASSESS === \"MMSE\")   ? (Number.isFinite(delId) ? [delId] : []) : [];\r",
											"cdrsb.deleteList = (TARGET_ASSESS === \"CDR_SB\") ? (Number.isFinite(delId) ? [delId] : []) : [];\r",
											"\r",
											"// ===== 7) í—¤ë” ë³´ì • + Body ì—…ë°ì´íŠ¸\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"pm.request.headers.upsert({ key: \"Accept\", value: \"application/json\" });\r",
											"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
											"\r",
											"pm.request.body.update(JSON.stringify(bodyObj, null, 2));\r",
											"\r",
											"// ë¡œê·¸\r",
											"console.log(\"[PATCH clinical-info] TARGET_ASSESS=\", TARGET_ASSESS, \"delId=\", delId);\r",
											"console.log(\"[PATCH clinical-info] body =\", bodyObj);\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"let json = null;\r",
											"try { json = pm.response.json(); } catch (_) {}\r",
											"\r",
											"pm.test(\"HTTP 2xx\", function () {\r",
											"  pm.expect(pm.response.code).to.be.within(200, 299);\r",
											"});\r",
											"\r",
											"if (json && typeof json.code !== \"undefined\") {\r",
											"  pm.test(\"app code == 200 (ìˆì„ ë•Œë§Œ)\", function () {\r",
											"    pm.expect(json.code).to.eql(200);\r",
											"  });\r",
											"}\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											"\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "PATCH",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n  \"apoeStatusType\": null,\r\n  \"assessmentScore\": [\r\n    {\r\n      \"assessmentType\": \"MMSE\",\r\n      \"addList\": [],\r\n      \"deleteList\": [ {{PATIENT_SCORE_ID}} ]\r\n    },\r\n    {\r\n      \"assessmentType\": \"CDR_SB\",\r\n      \"addList\": [],\r\n      \"deleteList\": []\r\n    }\r\n  ],\r\n  \"memo\": \"DELETE\"\r\n}\r\n",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/patient/{{PATIENT_ID}}/clinical-info",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"patient",
										"{{PATIENT_ID}}",
										"clinical-info"
									]
								}
							},
							"response": []
						},
						{
							"name": "í™˜ì ì‚­ì œ ë¶ˆê°€_ image, analysis result ì¡´ì¬",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === 1) ì‘ë‹µ JSON íŒŒì‹±(ì•ˆì „í•˜ê²Œ) ===\r",
											"let j = null;\r",
											"try { j = pm.response.json(); } catch (e) { /* JSON ì•„ë‹ˆì–´ë„ í†µê³¼ ë¡œì§ ì²˜ë¦¬ ê°€ëŠ¥ */ }\r",
											"\r",
											"const httpStatus = pm.response.code;\r",
											"const svcCode = (j && typeof j.code !== \"undefined\") ? Number(j.code) : null;\r",
											"const svcMsg  = (j && typeof j.message !== \"undefined\") ? String(j.message) : \"\";\r",
											"\r",
											"// === 2) PASS ì¡°ê±´ ì •ì˜ ===\r",
											"//  A. ì •ìƒ ì‚­ì œ: HTTP 2xx\r",
											"//  B. ì˜ˆì™¸ í—ˆìš©: HTTP 500 ì´ë©´ì„œ ì„œë¹„ìŠ¤ code == 905 (\"Cannot be performed\")\r",
											"const is2xx = httpStatus >= 200 && httpStatus < 300;\r",
											"const isExpected905 = (httpStatus === 500 && svcCode === 905);\r",
											"\r",
											"const PASS = is2xx || isExpected905;\r",
											"\r",
											"// === 3) Runnerì—ì„œ ìµœì¢… PASSë¡œ í‘œì‹œë˜ëŠ” ë‹¨ì¼ í•µì‹¬ í…ŒìŠ¤íŠ¸ ===\r",
											"pm.test(\"DELETE /patient ì²˜ë¦¬ ê²°ê³¼: PASS ì¡°ê±´ ì¶©ì¡±\", function () {\r",
											"  pm.expect(PASS, `status=${httpStatus}, svcCode=${svcCode}, message=\"${svcMsg}\"`).to.be.true;\r",
											"});\r",
											"\r",
											"// === 4) ë³´ì¡° ê°€ë…ì„± í…ŒìŠ¤íŠ¸(ë¡œê·¸ ìš©) ===\r",
											"if (isExpected905) {\r",
											"  pm.test(\"ì˜ˆìƒëœ ì˜ˆì™¸ ìˆ˜ìš©: 500 + code=905\", function () {\r",
											"    pm.expect(true).to.be.true; // ì •ë³´ì„± PASS\r",
											"  });\r",
											"} else if (is2xx) {\r",
											"  pm.test(\"ì •ìƒ ì‚­ì œ(HTTP 2xx)\", function () {\r",
											"    pm.expect(true).to.be.true; // ì •ë³´ì„± PASS\r",
											"  });\r",
											"} else {\r",
											"  pm.test(\"ë¹„í—ˆìš© ìƒíƒœ(ì°¸ê³ ìš©)\", function () {\r",
											"    // ì‹¤íŒ¨ ì›ì¸ í‘œì‹œ (ì´ í…ŒìŠ¤íŠ¸ëŠ” ì‹¤íŒ¨í•´ë„ ìœ„ì˜ í•µì‹¬ PASS í…ŒìŠ¤íŠ¸ê°€ trueë©´ ì „ì²´ëŠ” PASSë¡œ ë³´ì¼ ìˆ˜ ìˆìŒ)\r",
											"    pm.expect.fail(`Unexpected response. status=${httpStatus}, code=${svcCode}, message=\"${svcMsg}\"`);\r",
											"  });\r",
											"}\r",
											"\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code == 500;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "DELETE",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/patient/{{PATIENT_ID}}",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"patient",
										"{{PATIENT_ID}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "í™˜ì ë“±ë¡",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === helpers ===\r",
											"function randInt(min,max){ min=Math.ceil(min); max=Math.floor(max); return Math.floor(Math.random()*(max-min+1))+min; }\r",
											"function randDigits(n){ let s=\"\"; for(let i=0;i<n;i++) s += Math.floor(Math.random()*10); return s; }\r",
											"function fmtYMD(d){ const y=d.getFullYear(), m=String(d.getMonth()+1).padStart(2,'0'), da=String(d.getDate()).padStart(2,'0'); return `${y}-${m}-${da}`; }\r",
											"function randDate(start,end){ const t=start.getTime()+Math.random()*(end.getTime()-start.getTime()); return new Date(t); }\r",
											"function pick(a){ return a[Math.floor(Math.random()*a.length)]; }\r",
											"\r",
											"// === options via ENV ===\r",
											"const SEND_PATIENT_ID = String(pm.environment.get(\"SEND_PATIENT_ID\") ?? \"false\").toLowerCase()===\"true\";\r",
											"const STRICT_NUMERIC_IDENTIFIER = String(pm.environment.get(\"STRICT_NUMERIC_IDENTIFIER\") ?? \"true\").toLowerCase()===\"true\";\r",
											"\r",
											"// analysisId ë³´ì •(í•„ìš”ì‹œ ìœ íš¨ê°’ìœ¼ë¡œ)\r",
											"const analysisIdEnv = pm.environment.get(\"ANALYSIS_ID\");\r",
											"const analysisId = Number.isFinite(Number(analysisIdEnv)) ? Number(analysisIdEnv) : 1;\r",
											"\r",
											"// patientId: ì„œë²„ ë°œê¸‰ì´ë©´ ë³´ë‚´ì§€ ë§ ê²ƒ (ENVë¡œ ì¼œë©´ ì „ì†¡)\r",
											"const patientIdSeed = pm.environment.get(\"PATIENT_ID_SEED\");\r",
											"const candidatePatientId = Number.isFinite(Number(patientIdSeed)) ? Number(patientIdSeed) : randInt(1, 9_999_999);\r",
											"\r",
											"// identifier: â˜… ê³ ì • \"taejekim\" (ENV IDENTIFIERê°€ ìˆìœ¼ë©´ ê·¸ ê°’ ì‚¬ìš©)\r",
											"let identifier = String(pm.environment.get(\"IDENTIFIER\") ?? \"taejekim\");\r",
											"// ê³ ì •ê°’ì„ ìœ ì§€í•˜ê¸° ìœ„í•´ ìˆ«ìë§Œ ê°•ì œ(STRICT_NUMERIC_IDENTIFIER)ëŠ” ì ìš©í•˜ì§€ ì•ŠìŒ\r",
											"// (í•„ìš”í•˜ë©´ ì•„ë˜ í•œ ì¤„ ì£¼ì„ í•´ì œ)\r",
											"// if (STRICT_NUMERIC_IDENTIFIER) identifier = identifier.replace(/\\D+/g, \"\") || \"0\";\r",
											"\r",
											"// name: ë¬´ì‘ìœ„\r",
											"const firstNames = [\"Alex\",\"Chris\",\"Jordan\",\"Taylor\",\"Morgan\",\"Jamie\",\"Casey\",\"Drew\",\"Riley\",\"Sam\",\"Avery\",\"Jesse\",\"Reeves\"];\r",
											"const lastNames  = [\"Lee\",\"Kim\",\"Park\",\"Choi\",\"Morgan\",\"Scott\",\"Young\",\"Baker\",\"Cooper\",\"Bell\",\"Reeves\"];\r",
											"const name = `${pick(firstNames)} ${pick(lastNames)}`;\r",
											"\r",
											"// sex: ë°˜ë“œì‹œ ëŒ€ë¬¸ì M/F/U ì¤‘ í•˜ë‚˜\r",
											"let sex = (pm.environment.get(\"SEX\") || pick([\"M\",\"F\",\"U\"])).toString().toUpperCase();\r",
											"if (![\"M\",\"F\",\"U\"].includes(sex)) sex = \"M\";\r",
											"\r",
											"// birth: ìœ íš¨ ë‚ ì§œ(1930-01-01 ~ 2025-12-31)\r",
											"let birth = pm.environment.get(\"BIRTH\");\r",
											"if (!/^\\d{4}-\\d{2}-\\d{2}$/.test(birth || \"\")) {\r",
											"  const start = new Date(1930,0,1), end = new Date(2025,11,31);\r",
											"  birth = fmtYMD(randDate(start, end));\r",
											"}\r",
											"\r",
											"// === build body ===\r",
											"const body = {\r",
											"  analysisId: analysisId,\r",
											"  identifier: identifier,   // â† ê³ ì • \"taejekim\"\r",
											"  name:       name,          // â† ëœë¤\r",
											"  sex:        sex,\r",
											"  birth:      birth\r",
											"};\r",
											"if (SEND_PATIENT_ID) body.patientId = candidatePatientId;\r",
											"\r",
											"// === headers & inject ===\r",
											"pm.request.headers.upsert({ key:\"Content-Type\", value:\"application/json\" });\r",
											"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key:\"Authorization\", value:`Bearer ${token}` });\r",
											"\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(body, null, 2));\r",
											"\r",
											"console.log(\"[POST /app/api/patient] body =\", body);\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"HTTP 2xx\", () => pm.expect(pm.response.code).to.be.within(200,299));\r",
											"\r",
											"let j={}; try{ j=pm.response.json(); }catch(e){}\r",
											"if (typeof j.code !== \"undefined\") {\r",
											"  pm.test(\"service code === 200\", () => pm.expect(j.code).to.eql(200));\r",
											"}\r",
											"if (j?.code === 701) {\r",
											"  console.error(\"[701] Invalid parameter: Check patientId sending, analysisId validity, identifier format/length, sex enum, birth date format.\");\r",
											"}\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/patient",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"patient"
									]
								}
							},
							"response": []
						},
						{
							"name": "í™˜ì ëª©ë¡ ì¡°íšŒ_PATIENT ID(taejekim) ì €ì¥",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"const id = pm.environment.get(\"TARGET_IDENTIFIER\") || \"\"; // ì—†ìœ¼ë©´ ì „ì²´ê²€ìƒ‰\r",
											"const body = {\r",
											"  identifier: id,\r",
											"  name: \"\",\r",
											"  sex: null,\r",
											"  startDate: null,\r",
											"  endDate: null,\r",
											"  paginationReq: {\r",
											"    requestPageNumber: 1,\r",
											"    itemCountPerPage: 100,\r",
											"    order: \"desc\",\r",
											"    sortBy: \"\"\r",
											"  },\r",
											"  isSortById: false\r",
											"};\r",
											"\r",
											"// Content-Type ë³´ì •\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"// Body ì—…ë°ì´íŠ¸\r",
											"pm.request.body.update(JSON.stringify(body, null, 2));\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === 1) JSON íŒŒì‹± ===\r",
											"let json;\r",
											"try {\r",
											"  json = pm.response.json();\r",
											"} catch (e) {\r",
											"  pm.environment.unset(\"PATIENT_DELETE\");\r",
											"  console.error(\"ì‘ë‹µì´ JSONì´ ì•„ë‹˜:\", e);\r",
											"  return;\r",
											"}\r",
											"\r",
											"// === 2) contents ë°°ì—´ ì¶”ì¶œ ===\r",
											"let contents = [];\r",
											"try {\r",
											"  if (json && json.result && json.result.patientInfos && Array.isArray(json.result.patientInfos.contents)) {\r",
											"    contents = json.result.patientInfos.contents;\r",
											"  }\r",
											"} catch (_) {}\r",
											"\r",
											"// === 3) íƒ€ê¹ƒ identifier ê²°ì •\r",
											"// ìš°ì„ ìˆœìœ„: í™˜ê²½ë³€ìˆ˜ TARGET_IDENTIFIER > ìš”ì²­ bodyì˜ identifier(ë¹„ì–´ìˆì§€ ì•Šìœ¼ë©´) > \"taejekim\"\r",
											"let targetIdentifier = pm.environment.get(\"TARGET_IDENTIFIER\");\r",
											"if (!targetIdentifier) {\r",
											"  try {\r",
											"    const raw = pm.request.body && pm.request.body.raw ? pm.request.body.raw : \"{}\";\r",
											"    const body = JSON.parse(raw);\r",
											"    if (body && body.identifier) targetIdentifier = body.identifier;\r",
											"  } catch (_) {}\r",
											"}\r",
											"if (!targetIdentifier) targetIdentifier = \"taejekim\";\r",
											"\r",
											"// === 4) ë§¤ì¹­ ì°¾ê¸°\r",
											"const match = contents.find(o => o && o.identifier === targetIdentifier);\r",
											"\r",
											"// === 5) í™˜ê²½ë³€ìˆ˜ ì„¤ì • (ì½”ë“œ 200 + ë§¤ì¹­ ìˆì„ ë•Œë§Œ)\r",
											"if (json && json.code === 200 && match && match.id != null) {\r",
											"  pm.environment.set(\"PATIENT_DELETE\", String(match.id));\r",
											"  console.log(\"PATIENT_DELETE set to\", match.id);\r",
											"} else {\r",
											"  pm.environment.unset(\"PATIENT_DELETE\");\r",
											"  console.warn(\r",
											"    \"PATIENT_DELETE not set. ì´ìœ :\",\r",
											"    { code: json && json.code, targetIdentifier, identifiers: contents.map(x => x && x.identifier) }\r",
											"  );\r",
											"}\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											"\r",
											"\r",
											"\r",
											"\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/patient/search",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"patient",
										"search"
									]
								}
							},
							"response": []
						},
						{
							"name": "í™˜ì ì‚­ì œ",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "DELETE",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/patient/{{PATIENT_DELETE}}",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"patient",
										"{{PATIENT_DELETE}}"
									]
								}
							},
							"response": []
						}
					]
				}
			]
		},
		{
			"name": "user_Medication",
			"item": [
				{
					"name": "í™˜ì ì„ íƒ_Clinical Information ì¡°íšŒ",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// ===== helpers =====\r",
									"function asStr(v, d){ return (v===undefined||v===null||String(v).trim()===\"\") ? (d||\"\") : String(v); }\r",
									"function asDate(v){ var d=new Date(v); return isNaN(d.getTime())?null:d; }\r",
									"function fmtYMD(d){ var y=d.getFullYear(), m=(\"0\"+(d.getMonth()+1)).slice(-2), da=(\"0\"+d.getDate()).slice(-2); return y+\"-\"+m+\"-\"+da; }\r",
									"function randDate(start,end){ var t=start.getTime()+Math.random()*(end.getTime()-start.getTime()); return new Date(t); }\r",
									"function pickRandom(arr){ return arr[Math.floor(Math.random()*arr.length)]; }\r",
									"\r",
									"\r",
									"// ===== ì½”ë“œ ê²°ì • (4ì¢… ëª¨ë‘ í—ˆìš©) =====\r",
									"// FORCE_CODE ìˆìœ¼ë©´ ê°•ì œ ì‚¬ìš©: LECANEMAB | DONANEMAB | NO_MEDICATION | OTHERS\r",
									"var FORCE = asStr(pm.environment.get(\"FORCE_CODE\"));\r",
									"var CODES = [\"LECANEMAB\",\"DONANEMAB\",\"NO_MEDICATION\",\"OTHERS\"];\r",
									"var code  = FORCE || pickRandom(CODES);\r",
									"\r",
									"// ===== ë‚ ì§œ ê²°ì • =====\r",
									"// FORCE_DATE ìˆìœ¼ë©´ ê°•ì œ, ì—†ìœ¼ë©´ ìµœê·¼ 5ë…„ ëœë¤(ë¯¸ë˜ ê¸ˆì§€)\r",
									"var today = new Date();\r",
									"var start0 = new Date(today.getFullYear()-5, today.getMonth(), today.getDate());\r",
									"var start  = asDate(asStr(pm.environment.get(\"rand_date_start\"), fmtYMD(start0))) || start0;\r",
									"var end    = asDate(asStr(pm.environment.get(\"rand_date_end\"), fmtYMD(today)))   || today;\r",
									"\r",
									"var FORCE_DATE = asStr(pm.environment.get(\"FORCE_DATE\"));\r",
									"var chosen = FORCE_DATE ? (asDate(FORCE_DATE) || today) : randDate(start, end);\r",
									"if (chosen > today) chosen = today;\r",
									"var dateStr = fmtYMD(chosen);\r",
									"\r",
									"// ===== Testsì—ì„œ ì°¸ê³ í•  ê°’ ì €ì¥ =====\r",
									"pm.variables.set(\"CHOSEN_MED_CODE\", code);\r",
									"pm.variables.set(\"CHOSEN_MED_DATE\", dateStr);\r",
									"\r",
									"// ===== body =====\r",
									"var payload = { date: dateStr, code: code };\r",
									"pm.request.body.mode = \"raw\";\r",
									"pm.request.body.update(JSON.stringify(payload));\r",
									"\r",
									"console.log(\"[CREATE MEDICATION][REQ]\", { pid: pm.environment.get(\"PATIENT_)ID\"), payload: payload });\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// ===== parse response safely =====\r",
									"var raw = pm.response.text();\r",
									"var j = {}; try { j = JSON.parse(raw); } catch(e) { j = {}; }\r",
									"var r = (j && j.result) ? j.result : j;\r",
									"\r",
									"// sent values (from Pre-request)\r",
									"var sentCode = pm.variables.get(\"CHOSEN_MED_CODE\") || \"-\";\r",
									"var sentDate = pm.variables.get(\"CHOSEN_MED_DATE\") || \"-\";\r",
									"\r",
									"// server echo (ìˆìœ¼ë©´ ìš°ì„  ì‚¬ìš©)\r",
									"var savedCode = (r && typeof r.medicationCode === \"string\") ? r.medicationCode\r",
									"             : (r && typeof r.code === \"string\") ? r.code\r",
									"             : \"\";\r",
									"var savedDate = (r && r.date) ? String(r.date).slice(0,10) : \"\";\r",
									"\r",
									"// svc OK íŒë‹¨\r",
									"var svcOk = (typeof j.code === \"number\" ? j.code === 200 : true);\r",
									"// echo ì—†ìœ¼ë©´ ìš°ë¦¬ê°€ ë³´ë‚¸ ê°’ìœ¼ë¡œ ê°„ì£¼\r",
									"if (svcOk && (!savedCode || !savedDate)) {\r",
									"  savedCode = savedCode || sentCode;\r",
									"  savedDate = savedDate || sentDate;\r",
									"}\r",
									"\r",
									"// display map\r",
									"var NAME = {\r",
									"  \"NO_MEDICATION\":\"No medication\",\r",
									"  \"LECANEMAB\":\"LEQEMBI (lecanemab)\",\r",
									"  \"DONANEMAB\":\"Kisunla (donanemab)\",\r",
									"  \"OTHERS\":\"Others\"\r",
									"};\r",
									"var displayName = NAME[savedCode] || savedCode || \"-\";\r",
									"\r",
									"// ===== ê¸°ë³¸ í…ŒìŠ¤íŠ¸ =====\r",
									"pm.test(\"HTTP 200/201\", function () {\r",
									"  pm.expect([200,201]).to.include(pm.response.code);\r",
									"});\r",
									"if (typeof j.code !== \"undefined\") {\r",
									"  pm.test(\"Service code == 200\", function () { pm.expect(j.code).to.eql(200); });\r",
									"}\r",
									"\r",
									"// ===== ìš”ì•½ ë©”ì‹œì§€ (Test Resultsì—ì„œ ë°”ë¡œ ë³´ì„) =====\r",
									"pm.test(`Saved âœ ${displayName || \"-\"} on ${savedDate || \"-\"}`, function () { pm.expect(true).to.be.true; });\r",
									"\r",
									"// ë³´ë‚¸ ê°’ vs ì €ì¥ ê°’ ë¹„êµ\r",
									"var codeMatch = (savedCode && sentCode && savedCode === sentCode);\r",
									"var dateMatch = (savedDate && sentDate && savedDate === sentDate);\r",
									"pm.test(`Sent vs Saved: code ${sentCode} â†’ ${savedCode || \"-\"} (${codeMatch ? \"âœ“\" : \"âœ—\"}), date ${sentDate} â†’ ${savedDate || \"-\"} (${dateMatch ? \"âœ“\" : \"âœ—\"})`, function () {\r",
									"  pm.expect(true).to.be.true;\r",
									"});\r",
									"\r",
									"// ===== 701 ë“± ì‹¤íŒ¨ ì‹œ ìë™ ë³µêµ¬(ìµœëŒ€ 3íšŒ) =====\r",
									"if (!(pm.response.code === 200 || pm.response.code === 201)) {\r",
									"  var svc = j && j.code !== undefined ? j.code : null;\r",
									"  var retry = Number(pm.environment.get(\"RETRY_COUNT\") || 0);\r",
									"\r",
									"  // ê·œì¹™:\r",
									"  //  - ì²« ì‹¤íŒ¨: ë‚ ì§œ -1ì¼ ì´ë™\r",
									"  //  - ë‘ ë²ˆì§¸ ì‹¤íŒ¨: ë‚ ì§œ -7ì¼ ì´ë™\r",
									"  //  - ì„¸ ë²ˆì§¸ ì‹¤íŒ¨: ì½”ë“œ LEQEMBI(LECANEMAB) ê°•ì œ\r",
									"  if (svc === 701 && retry < 3) {\r",
									"    retry += 1;\r",
									"    pm.environment.set(\"RETRY_COUNT\", String(retry));\r",
									"\r",
									"    if (retry === 1) {\r",
									"      pm.environment.set(\"FORCE_DATE\", shiftDate(sentDate, -1));\r",
									"    } else if (retry === 2) {\r",
									"      pm.environment.set(\"FORCE_DATE\", shiftDate(sentDate, -7));\r",
									"    } else if (retry === 3) {\r",
									"      pm.environment.set(\"FORCE_CODE\", \"LECANEMAB\");\r",
									"      pm.environment.unset(\"FORCE_DATE\");\r",
									"    }\r",
									"\r",
									"    console.warn(\"[RETRY] attempt:\", retry, \"svc=701; next payload:\", {\r",
									"      FORCE_CODE: pm.environment.get(\"FORCE_CODE\") || \"(keep)\",\r",
									"      FORCE_DATE: pm.environment.get(\"FORCE_DATE\") || \"(keep)\"\r",
									"    });\r",
									"\r",
									"    pm.execution.setNextRequest(pm.info.requestName);\r",
									"  } else {\r",
									"    pm.test(\"ìš”ì²­ ì‹¤íŒ¨\", function () {\r",
									"      pm.expect.fail(\"HTTP \" + pm.response.code + \" / svc=\" + (svc === null ? \"?\" : svc) + \" \" + (j && j.message ? j.message : \"\"));\r",
									"    });\r",
									"  }\r",
									"}\r",
									"\r",
									"// ìœ í‹¸: ë‚ ì§œ ì´ë™\r",
									"function shiftDate(ymd, deltaDays){\r",
									"  try{\r",
									"    var p = (ymd || \"\").split(\"-\");\r",
									"    var d = new Date(Number(p[0]), Number(p[1])-1, Number(p[2]));\r",
									"    if (isNaN(d.getTime())) d = new Date();\r",
									"    d = new Date(d.getTime() + (deltaDays||0)*24*60*60*1000);\r",
									"    var y=d.getFullYear(), m=(\"0\"+(d.getMonth()+1)).slice(-2), da=(\"0\"+d.getDate()).slice(-2);\r",
									"    return y+\"-\"+m+\"-\"+da;\r",
									"  }catch(e){ return ymd; }\r",
									"}\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
									"\r",
									"\r",
									"\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/app/api/patient/{{PATIENT_ID}}/clinical-info",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"patient",
								"{{PATIENT_ID}}",
								"clinical-info"
							]
						}
					},
					"response": []
				},
				{
					"name": "íˆ¬ì•½ ë‚´ì—­ ì¶”ê°€",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// ===== helpers =====\r",
									"function asStr(v, d){ return (v===undefined||v===null||String(v).trim()===\"\") ? (d||\"\") : String(v); }\r",
									"function asDate(v){ var d=new Date(v); return isNaN(d.getTime())?null:d; }\r",
									"function fmtYMD(d){ var y=d.getFullYear(), m=(\"0\"+(d.getMonth()+1)).slice(-2), da=(\"0\"+d.getDate()).slice(-2); return y+\"-\"+m+\"-\"+da; }\r",
									"function randDate(start,end){ var t=start.getTime()+Math.random()*(end.getTime()-start.getTime()); return new Date(t); }\r",
									"function pickRandom(arr){ return arr[Math.floor(Math.random()*arr.length)]; }\r",
									"\r",
									"\r",
									"// ===== ì½”ë“œ ê²°ì • (4ì¢… ëª¨ë‘ í—ˆìš©) =====\r",
									"// FORCE_CODE ìˆìœ¼ë©´ ê°•ì œ ì‚¬ìš©: LECANEMAB | DONANEMAB | NO_MEDICATION | OTHERS\r",
									"var FORCE = asStr(pm.environment.get(\"FORCE_CODE\"));\r",
									"var CODES = [\"LECANEMAB\",\"DONANEMAB\",\"NO_MEDICATION\",\"OTHERS\"];\r",
									"var code  = FORCE || pickRandom(CODES);\r",
									"\r",
									"// ===== ë‚ ì§œ ê²°ì • =====\r",
									"// FORCE_DATE ìˆìœ¼ë©´ ê°•ì œ, ì—†ìœ¼ë©´ ìµœê·¼ 5ë…„ ëœë¤(ë¯¸ë˜ ê¸ˆì§€)\r",
									"var today = new Date();\r",
									"var start0 = new Date(today.getFullYear()-5, today.getMonth(), today.getDate());\r",
									"var start  = asDate(asStr(pm.environment.get(\"rand_date_start\"), fmtYMD(start0))) || start0;\r",
									"var end    = asDate(asStr(pm.environment.get(\"rand_date_end\"), fmtYMD(today)))   || today;\r",
									"\r",
									"var FORCE_DATE = asStr(pm.environment.get(\"FORCE_DATE\"));\r",
									"var chosen = FORCE_DATE ? (asDate(FORCE_DATE) || today) : randDate(start, end);\r",
									"if (chosen > today) chosen = today;\r",
									"var dateStr = fmtYMD(chosen);\r",
									"\r",
									"// ===== Testsì—ì„œ ì°¸ê³ í•  ê°’ ì €ì¥ =====\r",
									"pm.variables.set(\"CHOSEN_MED_CODE\", code);\r",
									"pm.variables.set(\"CHOSEN_MED_DATE\", dateStr);\r",
									"\r",
									"// ===== body =====\r",
									"var payload = { date: dateStr, code: code };\r",
									"pm.request.body.mode = \"raw\";\r",
									"pm.request.body.update(JSON.stringify(payload));\r",
									"\r",
									"console.log(\"[CREATE MEDICATION][REQ]\", { pid: pm.environment.get(\"PATIENT_)ID\"), payload: payload });\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// ===== parse response safely =====\r",
									"var raw = pm.response.text();\r",
									"var j = {}; try { j = JSON.parse(raw); } catch(e) { j = {}; }\r",
									"var r = (j && j.result) ? j.result : j;\r",
									"\r",
									"// sent values (from Pre-request)\r",
									"var sentCode = pm.variables.get(\"CHOSEN_MED_CODE\") || \"-\";\r",
									"var sentDate = pm.variables.get(\"CHOSEN_MED_DATE\") || \"-\";\r",
									"\r",
									"// server echo (ìˆìœ¼ë©´ ìš°ì„  ì‚¬ìš©)\r",
									"var savedCode = (r && typeof r.medicationCode === \"string\") ? r.medicationCode\r",
									"             : (r && typeof r.code === \"string\") ? r.code\r",
									"             : \"\";\r",
									"var savedDate = (r && r.date) ? String(r.date).slice(0,10) : \"\";\r",
									"\r",
									"// svc OK íŒë‹¨\r",
									"var svcOk = (typeof j.code === \"number\" ? j.code === 200 : true);\r",
									"// echo ì—†ìœ¼ë©´ ìš°ë¦¬ê°€ ë³´ë‚¸ ê°’ìœ¼ë¡œ ê°„ì£¼\r",
									"if (svcOk && (!savedCode || !savedDate)) {\r",
									"  savedCode = savedCode || sentCode;\r",
									"  savedDate = savedDate || sentDate;\r",
									"}\r",
									"\r",
									"// display map\r",
									"var NAME = {\r",
									"  \"NO_MEDICATION\":\"No medication\",\r",
									"  \"LECANEMAB\":\"LEQEMBI (lecanemab)\",\r",
									"  \"DONANEMAB\":\"Kisunla (donanemab)\",\r",
									"  \"OTHERS\":\"Others\"\r",
									"};\r",
									"var displayName = NAME[savedCode] || savedCode || \"-\";\r",
									"\r",
									"// ===== ê¸°ë³¸ í…ŒìŠ¤íŠ¸ =====\r",
									"pm.test(\"HTTP 200/201\", function () {\r",
									"  pm.expect([200,201]).to.include(pm.response.code);\r",
									"});\r",
									"if (typeof j.code !== \"undefined\") {\r",
									"  pm.test(\"Service code == 200\", function () { pm.expect(j.code).to.eql(200); });\r",
									"}\r",
									"\r",
									"// ===== ìš”ì•½ ë©”ì‹œì§€ (Test Resultsì—ì„œ ë°”ë¡œ ë³´ì„) =====\r",
									"pm.test(`Saved âœ ${displayName || \"-\"} on ${savedDate || \"-\"}`, function () { pm.expect(true).to.be.true; });\r",
									"\r",
									"// ë³´ë‚¸ ê°’ vs ì €ì¥ ê°’ ë¹„êµ\r",
									"var codeMatch = (savedCode && sentCode && savedCode === sentCode);\r",
									"var dateMatch = (savedDate && sentDate && savedDate === sentDate);\r",
									"pm.test(`Sent vs Saved: code ${sentCode} â†’ ${savedCode || \"-\"} (${codeMatch ? \"âœ“\" : \"âœ—\"}), date ${sentDate} â†’ ${savedDate || \"-\"} (${dateMatch ? \"âœ“\" : \"âœ—\"})`, function () {\r",
									"  pm.expect(true).to.be.true;\r",
									"});\r",
									"\r",
									"// ===== 701 ë“± ì‹¤íŒ¨ ì‹œ ìë™ ë³µêµ¬(ìµœëŒ€ 3íšŒ) =====\r",
									"if (!(pm.response.code === 200 || pm.response.code === 201)) {\r",
									"  var svc = j && j.code !== undefined ? j.code : null;\r",
									"  var retry = Number(pm.environment.get(\"RETRY_COUNT\") || 0);\r",
									"\r",
									"  // ê·œì¹™:\r",
									"  //  - ì²« ì‹¤íŒ¨: ë‚ ì§œ -1ì¼ ì´ë™\r",
									"  //  - ë‘ ë²ˆì§¸ ì‹¤íŒ¨: ë‚ ì§œ -7ì¼ ì´ë™\r",
									"  //  - ì„¸ ë²ˆì§¸ ì‹¤íŒ¨: ì½”ë“œ LEQEMBI(LECANEMAB) ê°•ì œ\r",
									"  if (svc === 701 && retry < 3) {\r",
									"    retry += 1;\r",
									"    pm.environment.set(\"RETRY_COUNT\", String(retry));\r",
									"\r",
									"    if (retry === 1) {\r",
									"      pm.environment.set(\"FORCE_DATE\", shiftDate(sentDate, -1));\r",
									"    } else if (retry === 2) {\r",
									"      pm.environment.set(\"FORCE_DATE\", shiftDate(sentDate, -7));\r",
									"    } else if (retry === 3) {\r",
									"      pm.environment.set(\"FORCE_CODE\", \"LECANEMAB\");\r",
									"      pm.environment.unset(\"FORCE_DATE\");\r",
									"    }\r",
									"\r",
									"    console.warn(\"[RETRY] attempt:\", retry, \"svc=701; next payload:\", {\r",
									"      FORCE_CODE: pm.environment.get(\"FORCE_CODE\") || \"(keep)\",\r",
									"      FORCE_DATE: pm.environment.get(\"FORCE_DATE\") || \"(keep)\"\r",
									"    });\r",
									"\r",
									"    pm.execution.setNextRequest(pm.info.requestName);\r",
									"  } else {\r",
									"    pm.test(\"ìš”ì²­ ì‹¤íŒ¨\", function () {\r",
									"      pm.expect.fail(\"HTTP \" + pm.response.code + \" / svc=\" + (svc === null ? \"?\" : svc) + \" \" + (j && j.message ? j.message : \"\"));\r",
									"    });\r",
									"  }\r",
									"}\r",
									"\r",
									"// ìœ í‹¸: ë‚ ì§œ ì´ë™\r",
									"function shiftDate(ymd, deltaDays){\r",
									"  try{\r",
									"    var p = (ymd || \"\").split(\"-\");\r",
									"    var d = new Date(Number(p[0]), Number(p[1])-1, Number(p[2]));\r",
									"    if (isNaN(d.getTime())) d = new Date();\r",
									"    d = new Date(d.getTime() + (deltaDays||0)*24*60*60*1000);\r",
									"    var y=d.getFullYear(), m=(\"0\"+(d.getMonth()+1)).slice(-2), da=(\"0\"+d.getDate()).slice(-2);\r",
									"    return y+\"-\"+m+\"-\"+da;\r",
									"  }catch(e){ return ymd; }\r",
									"}\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
									"\r",
									"\r",
									"\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/app/api/medication/{{PATIENT_ID}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"medication",
								"{{PATIENT_ID}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "íˆ¬ì•½ ë‚´ì—­ ì¡°íšŒ",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"function finalizePatch(top){\r",
									"  const oldDate = top.date ? String(top.date) : null;\r",
									"  const medId   = String(top.id);\r",
									"  const code    = top.medicationCode ? String(top.medicationCode) : \"\";   // â˜… ì¶”ê°€\r",
									"\r",
									"  const RANGE_START = pm.environment.get(\"RANDOM_START_DATE\");\r",
									"  const RANGE_END   = pm.environment.get(\"RANDOM_END_DATE\") || \"TODAY\";\r",
									"\r",
									"  let newDate = null;\r",
									"  for (let i=0;i<10;i++){ \r",
									"    const cand = randomDateStr(RANGE_START, RANGE_END); \r",
									"    if (!oldDate || cand!==oldDate){ newDate=cand; break; } \r",
									"  }\r",
									"  if (!newDate) newDate = randomDateStr(RANGE_START, RANGE_END);\r",
									"\r",
									"  // URL ë³€ìˆ˜ ì£¼ì…\r",
									"  pm.variables.set(\"medicationId\", medId);\r",
									"  \r",
									"  // ë°”ë”” ìµœì†Œí™”: dateë§Œ ì „ì†¡\r",
									"  const payload = { date: newDate };\r",
									"  pm.request.body.mode = \"raw\";\r",
									"  pm.request.body.update(JSON.stringify(payload));\r",
									"\r",
									"  // Test ê²°ê³¼ ìš”ì•½ê°’ ì €ì¥\r",
									"  pm.variables.set(\"PATCH_TARGET_ID\", medId);\r",
									"  pm.variables.set(\"PATCH_OLD_DATE\", oldDate || \"\");\r",
									"  pm.variables.set(\"PATCH_NEW_DATE\", newDate);\r",
									"  pm.variables.set(\"PATCH_MED_CODE\", code);   // â˜… ì´ì œ ì •ì˜ëœ code ì‚¬ìš©\r",
									"\r",
									"  console.log(\"[MED/PATCH] id=\", medId, \"oldDate=\", oldDate, \"â†’ newDate(ëœë¤)=\", newDate, \"code=\", code);\r",
									"}\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// === ê³µí†µ ìƒíƒœ í™•ì¸ ===\r",
									"pm.test(\"HTTP 200/204\", () => pm.expect([200,204]).to.include(pm.response.code));\r",
									"\r",
									"let r = {};\r",
									"try { r = pm.response.json(); } catch (e) { r = {}; }\r",
									"if (typeof r?.code !== \"undefined\") {\r",
									"  pm.test(\"service code === 200\", () => pm.expect(r.code).to.eql(200));\r",
									"}\r",
									"\r",
									"// === ìš”ì•½: ì–´ë–¤ medicationì´ ìˆ˜ì •ë˜ì—ˆëŠ”ì§€ í‘œì‹œ ===\r",
									"const id     = pm.variables.get(\"PATCH_TARGET_ID\");\r",
									"const oldD   = pm.variables.get(\"PATCH_OLD_DATE\") || \"(null)\";\r",
									"const newD   = pm.variables.get(\"PATCH_NEW_DATE\");\r",
									"const mcode  = pm.variables.get(\"PATCH_MED_CODE\") || \"(N/A)\";\r",
									"\r",
									"// í…ŒìŠ¤íŠ¸ ì´ë¦„ ìì²´ì— ìš”ì•½ì„ ì¶œë ¥(í†µê³¼ìš© ë”ë¯¸ ì–´ì„œì…˜)\r",
									"pm.test(`[UPDATED] medication #${id} (${mcode}) date: ${oldD} â†’ ${newD}`, () => {\r",
									"  pm.expect(true).to.be.true; // í•­ìƒ í†µê³¼\r",
									"  \r",
									"});\r",
									"\r",
									"// ì„œë²„ê°€ ë‚ ì§œë¥¼ ì‘ë‹µìœ¼ë¡œ ëŒë ¤ì£¼ëŠ” ê²½ìš°ì—” ê°’ ì¼ì¹˜ ê²€ì¦\r",
									"const respDate = r?.result?.date ?? r?.date;\r",
									"if (respDate) {\r",
									"  pm.test(\"ì‘ë‹µ ë‚ ì§œê°€ ìš”ì²­í•œ ìƒˆ ë‚ ì§œì™€ ì¼ì¹˜\", () => pm.expect(String(respDate)).to.eql(String(newD)));\r",
									"}\r",
									"\r",
									"// ë””ë²„ê·¸ ë¡œê·¸(ì½˜ì†”)\r",
									"console.log(\"[MED/PATCH][SUMMARY]\", { id, medicationCode: mcode, oldDate: oldD, newDate: newD, status: pm.response.code, body: r });\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
									"\r",
									"\r",
									"\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "",
								"value": "",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"itemCountPerPage\": 6,\r\n  \"requestPageNumber\": 1\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/app/api/medication/search/{{PATIENT_ID}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"medication",
								"search",
								"{{PATIENT_ID}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "íˆ¬ì•½ ë‚´ì—­ ìˆ˜ì •",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"/**\r",
									" * PATCH {{baseUrl}}/app/api/medication/{{medicationId}}\r",
									" * 1) POST /app/api/medication/search/{{patient_id}}\r",
									" * 2) result.medicationHistory.contents ìµœìƒë‹¨ í•­ëª© ì„ íƒ\r",
									" * 3) PATCH ë°”ë””ëŠ” { date: \"<ëœë¤>\" }ë§Œ ì „ì†¡ (ëœë¤ ì¢…ë£Œì¼ ê¸°ë³¸ TODAY)\r",
									" *\r",
									" * ì˜µì…˜ í™˜ê²½ë³€ìˆ˜\r",
									" *  - SEARCH_BODY_JSON: search ë°”ë””(JSON ë¬¸ìì—´)\r",
									" *  - RANDOM_START_DATE: ëœë¤ ì‹œì‘ì¼(YYYY-MM-DD) (ê¸°ë³¸ 2019-01-01)\r",
									" *  - RANDOM_END_DATE:   ëœë¤ ì¢…ë£Œì¼(YYYY-MM-DD ë˜ëŠ” 'TODAY') (ê¸°ë³¸ TODAY)\r",
									" */\r",
									"\r",
									"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
									"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
									"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
									"\r",
									"const baseUrl    = pm.environment.get(\"baseUrl\") || pm.variables.get(\"baseUrl\");\r",
									"const PATIENT_ID= pm.environment.get(\"PATIENT_ID\");\r",
									"if (!baseUrl)   throw new Error(\"baseUrl í™˜ê²½ë³€ìˆ˜ í•„ìš”\");\r",
									"if (!PATIENT_ID) throw new Error(\"PATIENT_ID í™˜ê²½ë³€ìˆ˜ í•„ìš”\");\r",
									"\r",
									"// ===== helpers =====\r",
									"function ymd(d){const y=d.getFullYear(),m=String(d.getMonth()+1).padStart(2,\"0\"),day=String(d.getDate()).padStart(2,\"0\");return `${y}-${m}-${day}`;}\r",
									"function parseYMD(s,f){if(!s) return f; const d=new Date(`${s}T00:00:00`); return isNaN(d.getTime())?f:d;}\r",
									"function ri(min,max){return Math.floor(Math.random()*(max-min+1))+min;}\r",
									"function resolveEndDate(str){ if (!str || String(str).trim().toUpperCase()===\"TODAY\") return new Date(); return parseYMD(str, new Date()); }\r",
									"function randomDateStr(startStr,endStr){\r",
									"  const start = parseYMD(startStr, new Date(\"2019-01-01T00:00:00\"));\r",
									"  let end = resolveEndDate(endStr); if (start.getTime()>end.getTime()) end = start;\r",
									"  return ymd(new Date(ri(start.getTime(), end.getTime())));\r",
									"}\r",
									"function pickTop(contents){\r",
									"  if (!Array.isArray(contents) || contents.length===0) throw new Error(\"ê²€ìƒ‰ ê²°ê³¼ contents ë¹„ì–´ìˆìŒ\");\r",
									"  return contents[0] ?? contents.find(Boolean);\r",
									"}\r",
									"\r",
									"function finalizePatch(top){\r",
									"  const oldDate = top?.date ? String(top.date) : null;\r",
									"  const medId   = String(top.id);\r",
									"  const code    = top?.medicationCode ? String(top.medicationCode) : \"\"; // for display\r",
									"\r",
									"  const RANGE_START = pm.environment.get(\"RANDOM_START_DATE\");\r",
									"  const RANGE_END   = pm.environment.get(\"RANDOM_END_DATE\") || \"TODAY\";\r",
									"\r",
									"  let newDate = null;\r",
									"  for (let i=0;i<10;i++){ const cand = randomDateStr(RANGE_START, RANGE_END); if (!oldDate || cand!==oldDate){ newDate=cand; break; } }\r",
									"  if (!newDate) newDate = randomDateStr(RANGE_START, RANGE_END);\r",
									"\r",
									"  // URL ë³€ìˆ˜ ì£¼ì…\r",
									"  pm.variables.set(\"medicationId\", medId);\r",
									"\r",
									"  // ë°”ë”” ìµœì†Œí™”: dateë§Œ ì „ì†¡\r",
									"  const payload = { date: newDate };\r",
									"  pm.request.body.mode = \"raw\";\r",
									"  pm.request.body.update(JSON.stringify(payload));\r",
									"\r",
									"  // Testsì—ì„œ ìš”ì•½ ì¶œë ¥ìš©\r",
									"  pm.variables.set(\"PATCH_TARGET_ID\", medId);\r",
									"  pm.variables.set(\"PATCH_OLD_DATE\", oldDate || \"\");\r",
									"  pm.variables.set(\"PATCH_NEW_DATE\", newDate);\r",
									"  pm.variables.set(\"PATCH_MED_CODE\", code);\r",
									"\r",
									"  console.log(\"[MED/PATCH] id=\", medId, \"oldDate=\", oldDate, \"â†’ newDate(ëœë¤)=\", newDate, \"code=\", code);\r",
									"}\r",
									"\r",
									"// --- search ë°”ë”” ê²°ì • ---\r",
									"let searchBody = { requestPageNumber:1, itemCountPerPage:5, order:\"DESC\", sortBy:\"date\" };\r",
									"const searchBodyRaw = pm.environment.get(\"SEARCH_BODY_JSON\") || pm.variables.get(\"SEARCH_BODY_JSON\");\r",
									"if (searchBodyRaw){ try { searchBody = JSON.parse(searchBodyRaw); } catch(e){ throw new Error(\"SEARCH_BODY_JSON íŒŒì‹± ì‹¤íŒ¨: \"+e.message); } }\r",
									"\r",
									"// --- search í˜¸ì¶œ â†’ ìµœìƒë‹¨ ì„ íƒ â†’ PATCH ì„¸íŒ… ---\r",
									"const searchUrl = `${baseUrl}/app/api/medication/search/${encodeURIComponent(PATIENT_ID)}`;\r",
									"return new Promise((resolve,reject)=>{\r",
									"  const headers = {\"Content-Type\":\"application/json\"}; if (token) headers.Authorization = `Bearer ${token}`;\r",
									"\r",
									"  pm.sendRequest(\r",
									"    { url:searchUrl, method:\"POST\", header:headers, body:{ mode:\"raw\", raw:JSON.stringify(searchBody) } },\r",
									"    (err,res)=>{\r",
									"      if (err) return reject(err);\r",
									"      if (!res) return reject(new Error(\"search ì‘ë‹µ ì—†ìŒ\"));\r",
									"      if (res.code<200 || res.code>=300) return reject(new Error(`search HTTP ${res.code}`));\r",
									"\r",
									"      let j={}; try{ j=res.json(); }catch(_){ return reject(new Error(\"search JSON íŒŒì‹± ì‹¤íŒ¨\")); }\r",
									"      if (typeof j?.code!==\"undefined\" && j.code!==200) return reject(new Error(`search service code ${j.code} (${j.message||\"no message\"})`));\r",
									"\r",
									"      // ê²½ë¡œ: result.medicationHistory.contents\r",
									"      const contents =\r",
									"        Array.isArray(j?.result?.medicationHistory?.contents) ? j.result.medicationHistory.contents :\r",
									"        Array.isArray(j?.result?.contents) ? j.result.contents :\r",
									"        Array.isArray(j?.contents) ? j.contents : null;\r",
									"\r",
									"      if (!Array.isArray(contents) || contents.length===0) {\r",
									"        console.log(\"ë””ë²„ê·¸ ì‘ë‹µ:\", JSON.stringify(j));\r",
									"        return reject(new Error(\"ê²€ìƒ‰ ê²°ê³¼ contentsê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.\"));\r",
									"      }\r",
									"\r",
									"      const filtered = contents.filter(x => x && (x.id!==undefined && x.id!==null));\r",
									"      try { const top = pickTop(filtered); finalizePatch(top); resolve(); }\r",
									"      catch(e){ reject(e); }\r",
									"    }\r",
									"  );\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// ê¸°ë³¸ ìƒíƒœ í™•ì¸\r",
									"pm.test(\"HTTP 200/204\", () => pm.expect([200,204]).to.include(pm.response.code));\r",
									"\r",
									"let r = {};\r",
									"try { r = pm.response.json(); } catch (e) { r = {}; }\r",
									"\r",
									"// ì„œë¹„ìŠ¤ ì½”ë“œê°€ ì¡´ì¬í•˜ë©´ 200 í™•ì¸\r",
									"if (typeof r?.code !== \"undefined\") {\r",
									"  pm.test(\"service code === 200\", () => pm.expect(r.code).to.eql(200));\r",
									"}\r",
									"\r",
									"// ì–´ë–¤ í•­ëª©ì´ ìˆ˜ì •ë˜ì—ˆëŠ”ì§€ ìš”ì•½ ì¶œë ¥\r",
									"const id    = pm.variables.get(\"PATCH_TARGET_ID\");\r",
									"const oldD  = pm.variables.get(\"PATCH_OLD_DATE\") || \"(null)\";\r",
									"const newD  = pm.variables.get(\"PATCH_NEW_DATE\");\r",
									"const mcode = pm.variables.get(\"PATCH_MED_CODE\") || \"(N/A)\";\r",
									"\r",
									"pm.test(`[UPDATED] medication #${id} (${mcode}) date: ${oldD} â†’ ${newD}`, () => {\r",
									"  pm.expect(true).to.be.true; // í•­ìƒ í†µê³¼, ìš”ì•½ ì¶œë ¥ìš©\r",
									"});\r",
									"\r",
									"// ì„œë²„ê°€ ë‚ ì§œë¥¼ ì‘ë‹µìœ¼ë¡œ ëŒë ¤ì¤€ ê²½ìš° ê°’ ì¼ì¹˜ ê²€ì¦\r",
									"const respDate = r?.result?.date ?? r?.date;\r",
									"if (respDate) {\r",
									"  pm.test(\"ì‘ë‹µ ë‚ ì§œ == ìš”ì²­í•œ ìƒˆ ë‚ ì§œ\", () => pm.expect(String(respDate)).to.eql(String(newD)));\r",
									"}\r",
									"\r",
									"// ì‹¤íŒ¨ ì‹œ ì§„ë‹¨ ë¡œê·¸\r",
									"if (![200,204].includes(pm.response.code)) {\r",
									"  console.log(\"[MED/PATCH][DEBUG] status=\", pm.response.code, \"body=\", r || pm.response.text());\r",
									"}\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
									"\r",
									"\r",
									"\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "{{access_token}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/app/api/medication/{{medicationId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"medication",
								"{{medicationId}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "íˆ¬ì•½ ë‚´ì—­ ì‚­ì œ",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"/**\r",
									" * DELETE {{baseUrl}}/app/api/medication/{{medicationId}}\r",
									" *\r",
									" * íë¦„:\r",
									" *  1) POST /app/api/medication/search/{{patient_id}} í˜¸ì¶œ\r",
									" *     >> íˆ¬ì•½ ë‚´ì—­ ì¡°íšŒì— ìˆëŠ” id ì¡°íšŒë¥¼ ìœ„í•´ ì‚¬ìš©í•¨\r",
									" *  2) result.medicationHistory.contents ìµœìƒë‹¨ í•­ëª© ì„ íƒ\r",
									" *  3) ì„ íƒ í•­ëª©ì˜ idë¥¼ {{medicationId}}ì— ì£¼ì…í•˜ì—¬ DELETE ì‹¤í–‰\r",
									" *\r",
									" * ì˜µì…˜ í™˜ê²½ë³€ìˆ˜\r",
									" *  - SEARCH_BODY_JSON: search ë°”ë””(JSON ë¬¸ìì—´)\r",
									" */\r",
									"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
									"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
									"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
									"\r",
									"const baseUrl    = pm.environment.get(\"baseUrl\") || pm.variables.get(\"baseUrl\");\r",
									"const PATIENT_ID = pm.environment.get(\"PATIENT_ID\");\r",
									"if (!baseUrl)   throw new Error(\"baseUrl í™˜ê²½ë³€ìˆ˜ í•„ìš”\");\r",
									"if (!PATIENT_ID) throw new Error(\"PATIENT_ID í™˜ê²½ë³€ìˆ˜ í•„ìš”\");\r",
									"\r",
									"// --- helpers ---\r",
									"function pickTop(contents){\r",
									"  if (!Array.isArray(contents) || contents.length === 0) {\r",
									"    throw new Error(\"ê²€ìƒ‰ ê²°ê³¼ contentsê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.\");\r",
									"  }\r",
									"  return contents[0] ?? contents.find(Boolean);\r",
									"}\r",
									"\r",
									"// --- search ë°”ë”” ê²°ì • ---\r",
									"let searchBody = { requestPageNumber: 1, itemCountPerPage: 5, order: \"DESC\", sortBy: \"date\" };\r",
									"const searchBodyRaw = pm.environment.get(\"SEARCH_BODY_JSON\") || pm.variables.get(\"SEARCH_BODY_JSON\");\r",
									"if (searchBodyRaw){\r",
									"  try { searchBody = JSON.parse(searchBodyRaw); }\r",
									"  catch(e){ throw new Error(\"SEARCH_BODY_JSON íŒŒì‹± ì‹¤íŒ¨: \" + e.message); }\r",
									"}\r",
									"\r",
									"// --- search í˜¸ì¶œ â†’ ìµœìƒë‹¨ ì„ íƒ â†’ URL ë³€ìˆ˜ ì„¸íŒ… ---\r",
									"const searchUrl = `${baseUrl}/app/api/medication/search/${encodeURIComponent(PATIENT_ID)}`;\r",
									"return new Promise((resolve, reject) => {\r",
									"  const headers = { \"Content-Type\": \"application/json\" };\r",
									"  if (token) headers.Authorization = `Bearer ${token}`;\r",
									"\r",
									"  pm.sendRequest(\r",
									"    { url: searchUrl, method: \"POST\", header: headers, body: { mode: \"raw\", raw: JSON.stringify(searchBody) } },\r",
									"    (err, res) => {\r",
									"      if (err) return reject(err);\r",
									"      if (!res) return reject(new Error(\"search ì‘ë‹µ ì—†ìŒ\"));\r",
									"      if (res.code < 200 || res.code >= 300) return reject(new Error(`search HTTP ${res.code}`));\r",
									"\r",
									"      let j = {};\r",
									"      try { j = res.json(); } catch(_){ return reject(new Error(\"search JSON íŒŒì‹± ì‹¤íŒ¨\")); }\r",
									"      if (typeof j?.code !== \"undefined\" && j.code !== 200) {\r",
									"        return reject(new Error(`search service code ${j.code} (${j.message || \"no message\"})`));\r",
									"      }\r",
									"\r",
									"      const contents =\r",
									"        Array.isArray(j?.result?.medicationHistory?.contents) ? j.result.medicationHistory.contents :\r",
									"        Array.isArray(j?.result?.contents) ? j.result.contents :\r",
									"        Array.isArray(j?.contents) ? j.contents : null;\r",
									"\r",
									"      if (!Array.isArray(contents) || contents.length === 0) {\r",
									"        console.log(\"ë””ë²„ê·¸ ì‘ë‹µ:\", JSON.stringify(j));\r",
									"        return reject(new Error(\"ê²€ìƒ‰ ê²°ê³¼ contentsê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.\"));\r",
									"      }\r",
									"\r",
									"      // ìµœìƒë‹¨ í•­ëª©\r",
									"      const top = pickTop(contents.filter(x => x && (x.id !== undefined && x.id !== null)));\r",
									"\r",
									"      // URL path ë³€ìˆ˜ ì„¤ì •\r",
									"      pm.variables.set(\"medicationId\", String(top.id));\r",
									"\r",
									"      // Testsì—ì„œ ë³´ì—¬ì¤„ ìš”ì•½ ì €ì¥\r",
									"      pm.variables.set(\"DEL_TARGET_ID\", String(top.id));\r",
									"      pm.variables.set(\"DEL_DATE\", top.date ? String(top.date) : \"(null)\");\r",
									"      pm.variables.set(\"DEL_CODE\", top.medicationCode ? String(top.medicationCode) : \"(N/A)\");\r",
									"\r",
									"      // DELETEëŠ” ë³´í†µ ë°”ë””ê°€ í•„ìš” ì—†ìŒ â†’ ì•ˆì „í•˜ê²Œ ë¹„ì›€\r",
									"      pm.request.body && pm.request.body.update(\"\");\r",
									"\r",
									"      console.log(\"[MED/DELETE] target id=\", top.id, \"date=\", top.date, \"code=\", top.medicationCode);\r",
									"      resolve();\r",
									"    }\r",
									"  );\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// ê¸°ë³¸ ìƒíƒœ í™•ì¸\r",
									"pm.test(\"HTTP 200/204\", () => pm.expect([200, 204]).to.include(pm.response.code));\r",
									"\r",
									"let r = {};\r",
									"try { r = pm.response.json(); } catch(e) { r = {}; }\r",
									"\r",
									"// ì„œë¹„ìŠ¤ ì½”ë“œê°€ ì¡´ì¬í•˜ë©´ 200 í™•ì¸\r",
									"if (typeof r?.code !== \"undefined\") {\r",
									"  pm.test(\"service code === 200\", () => pm.expect(r.code).to.eql(200));\r",
									"}\r",
									"\r",
									"// ì–´ë–¤ í•­ëª©ì´ ì‚­ì œë˜ì—ˆëŠ”ì§€ ìš”ì•½ ì¶œë ¥\r",
									"const id    = pm.variables.get(\"DEL_TARGET_ID\");\r",
									"const date  = pm.variables.get(\"DEL_DATE\");\r",
									"const mcode = pm.variables.get(\"DEL_CODE\");\r",
									"\r",
									"pm.test(`[DELETED] medication #${id} (${mcode}) date: ${date}`, () => {\r",
									"  pm.expect(true).to.be.true;  // ìš”ì•½ í‘œì‹œìš©\r",
									"});\r",
									"\r",
									"// ì‹¤íŒ¨ ì‹œ ì§„ë‹¨ ë¡œê·¸\r",
									"if (![200,204].includes(pm.response.code)) {\r",
									"  console.log(\"[MED/DELETE][DEBUG] status=\", pm.response.code, \"body=\", r || pm.response.text());\r",
									"}\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
									"\r",
									"\r",
									"\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "DELETE",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/app/api/medication/{{medicationId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"medication",
								"{{medicationId}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "user_Analysis",
			"item": [
				{
					"name": "Analysis view",
					"item": [
						{
							"name": "í™˜ì ë³„ ë¶„ì„ ëª©ë¡ ì¡°íšŒ(1)",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"const id = pm.environment.get(\"TARGET_IDENTIFIER\") || \"\"; // ì—†ìœ¼ë©´ ì „ì²´ê²€ìƒ‰\r",
											"const body = {\r",
											"  identifier: id,\r",
											"  name: \"\",\r",
											"  sex: null,\r",
											"  startDate: null,\r",
											"  endDate: null,\r",
											"  paginationReq: {\r",
											"    requestPageNumber: 1,\r",
											"    itemCountPerPage: 20,\r",
											"    order: \"desc\",\r",
											"    sortBy: \"\"\r",
											"  },\r",
											"  isSortById: false\r",
											"};\r",
											"\r",
											"// Content-Type ë³´ì •\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"// Body ì—…ë°ì´íŠ¸\r",
											"pm.request.body.update(JSON.stringify(body, null, 2));\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// 1) ì‘ë‹µ íŒŒì‹±\r",
											"let j = {};\r",
											"try { j = pm.response.json(); } catch (e) {\r",
											"  pm.environment.unset(\"analysisId\");\r",
											"  console.error(\"[analysis] JSON parse failed:\", e);\r",
											"  pm.test(\"HTTP 2xx\", () => pm.expect(pm.response.code).to.be.within(200,299));\r",
											"  return;\r",
											"}\r",
											"\r",
											"// 2) ê¸°ë³¸ ìƒíƒœ ì²´í¬\r",
											"pm.test(\"HTTP 2xx\", () => pm.expect(pm.response.code).to.be.within(200,299));\r",
											"if (typeof j.code !== \"undefined\") {\r",
											"  pm.test(\"service code === 200\", () => pm.expect(j.code).to.eql(200));\r",
											"}\r",
											"\r",
											"// 3) ë¦¬ìŠ¤íŠ¸ì—ì„œ 'ê°€ì¥ ìœ„' í•­ëª© ì„ íƒ â†’ id ì €ì¥\r",
											"const list = Array.isArray(j?.result?.analysisInfoList) ? j.result.analysisInfoList : [];\r",
											"if (!list.length) {\r",
											"  pm.environment.unset(\"analysisId\");\r",
											"  console.warn(\"[analysis] analysisInfoList is empty.\");\r",
											"} else {\r",
											"  // ê·œì¹™: ì‘ë‹µ ë°°ì—´ì˜ ì²« ë²ˆì§¸ í•­ëª©ì´ 'ê°€ì¥ ìœ„'\r",
											"  const top = list[0];\r",
											"\r",
											"  // ë°©ì–´ì : idê°€ ì—†ìœ¼ë©´ ë³´ì¡° ì „ëµ(analysisComplete ìµœì‹  or id ìµœëŒ€)ìœ¼ë¡œ ë³´ì •\r",
											"  let chosen = top;\r",
											"  if (chosen?.id == null) {\r",
											"    const byCompleteDesc = [...list].filter(x => x?.analysisComplete)\r",
											"      .sort((a,b) => new Date(b.analysisComplete) - new Date(a.analysisComplete));\r",
											"    chosen = byCompleteDesc[0] ?? list.reduce((best,cur) =>\r",
											"      (Number(cur?.id ?? -Infinity) > Number(best?.id ?? -Infinity) ? cur : best), list[0]);\r",
											"  }\r",
											"\r",
											"  const chosenId = chosen?.id;\r",
											"  if (chosenId != null) {\r",
											"    pm.environment.set(\"analysisId\", String(chosenId));\r",
											"    // (ì˜µì…˜) ë¶€ê°€ ì •ë³´ë„ ì €ì¥í•´ë‘ë©´ ìœ ìš©\r",
											"    if (chosen?.analysisType)      pm.environment.set(\"analysisType\", String(chosen.analysisType));\r",
											"    if (chosen?.analysisStatusType)pm.environment.set(\"analysisStatusType\", String(chosen.analysisStatusType));\r",
											"    console.log(`[analysis] analysisId set to ${chosenId} (type=${chosen?.analysisType}, status=${chosen?.analysisStatusType})`);\r",
											"  } else {\r",
											"    pm.environment.unset(\"analysisId\");\r",
											"    console.warn(\"[analysis] could not determine id from the first row or fallbacks.\");\r",
											"  }\r",
											"}\r",
											"\r",
											"\r",
											"\r",
											"\r",
											"\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/patient/{{PATIENT_ID}}/analysis",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"patient",
										"{{PATIENT_ID}}",
										"analysis"
									]
								}
							},
							"response": []
						},
						{
							"name": "ë¶„ì„ ê²°ê³¼ ìƒì„¸ ì¡°íšŒ",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === env â†’ body ===\r",
											"let analysisId  = pm.environment.get(\"analysisId\")  || pm.variables.get(\"analysisId\")  || \"\";\r",
											"let analysisType= pm.environment.get(\"analysisType\")|| pm.variables.get(\"analysisType\")|| \"\";\r",
											"\r",
											"// ë°©ì–´ì  ë³´ì • (ë¬¸ìì—´ë¡œ ì „ì†¡)\r",
											"analysisId   = String(analysisId).trim();\r",
											"analysisType = String(analysisType).trim();\r",
											"\r",
											"// ê²½ê³  ë¡œê·¸\r",
											"if (!analysisId)   console.warn(\"[analysis/search] analysisId is empty.\");\r",
											"if (!analysisType) console.warn(\"[analysis/search] analysisType is empty.\");\r",
											"\r",
											"// headers\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key:\"Authorization\", value:`Bearer ${token}` });\r",
											"\r",
											"// body\r",
											"const body = {\r",
											"  analysisId: analysisId,       // â† ë¬¸ìì—´ë¡œ ì „ì†¡ (\"22\")\r",
											"  analysisType: analysisType    // e.g. \"TAU_PET\"\r",
											"};\r",
											"\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(body, null, 2));\r",
											"\r",
											"console.log(\"[POST /app/api/analysis/search] body =\", body);\r",
											"\r",
											"\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"HTTP 2xx\", () => pm.expect(pm.response.code).to.be.within(200,299));\r",
											"\r",
											"let j={}; try { j = pm.response.json(); } catch(e){}\r",
											"if (typeof j?.code !== \"undefined\") {\r",
											"  pm.test(\"service code === 200\", () => pm.expect(j.code).to.eql(200));\r",
											"}\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": ""
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/analysis/view/detail",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"analysis",
										"view",
										"detail"
									]
								}
							},
							"response": []
						},
						{
							"name": "ë¶„ì„ ê²°ê³¼ ì „ì²´ ëª©ë¡ ì¡°íšŒ",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === env -> body ===\r",
											"let patientIdEnv = pm.environment.get(\"PATIENT_ID\") || pm.variables.get(\"PATIENT_ID\");\r",
											"let patientIdNum = Number(patientIdEnv);\r",
											"\r",
											"if (!Number.isFinite(patientIdNum)) {\r",
											"  console.warn(\"[analysis/view/total] PATIENT_ID is missing or not a number:\", patientIdEnv);\r",
											"  // ì„œë²„ê°€ ìˆ«ìë§Œ í—ˆìš©í•œë‹¤ë©´ nullë¡œ ë³´ëƒ„(ë˜ëŠ” throw)\r",
											"  patientIdNum = null;\r",
											"}\r",
											"\r",
											"// body (ìš”ì²­ ì¡°ê±´ ê³ ì •)\r",
											"const body = {\r",
											"  analysisId: null,   // ê·¸ëŒ€ë¡œ ìœ ì§€\r",
											"  patientId: patientIdNum, // envì—ì„œ ì½ìŒ (ìˆ«ì)\r",
											"  latestOnly: false   // ê·¸ëŒ€ë¡œ ìœ ì§€\r",
											"};\r",
											"\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(body, null, 2));\r",
											"\r",
											"console.log(\"[POST /app/api/analysis/view/total] body =\", body);\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// 1) ì‘ë‹µ íŒŒì‹± & ê¸°ë³¸ í™•ì¸\r",
											"let j = {};\r",
											"try { j = pm.response.json(); } catch (e) {\r",
											"  pm.environment.unset(\"REPORT_UID\");\r",
											"  console.error(\"[view/total] JSON parse failed:\", e);\r",
											"  pm.test(\"HTTP 2xx\", () => pm.expect(pm.response.code).to.be.within(200,299));\r",
											"  return;\r",
											"}\r",
											"\r",
											"pm.test(\"HTTP 2xx\", () => pm.expect(pm.response.code).to.be.within(200,299));\r",
											"if (typeof j?.code !== \"undefined\") {\r",
											"  pm.test(\"service code === 200\", () => pm.expect(j.code).to.eql(200));\r",
											"}\r",
											"\r",
											"// 2) íƒ€ê²Ÿ analysisId ë¶ˆëŸ¬ì˜¤ê¸° (env)\r",
											"const envIdRaw = pm.environment.get(\"analysisId\") || pm.variables.get(\"analysisId\") || \"\";\r",
											"const envIdNum = Number(envIdRaw);\r",
											"const useNumeric = Number.isFinite(envIdNum);\r",
											"\r",
											"// 3) analysisListì—ì„œ summaries í‰íƒ„í™”í•˜ì—¬ ë§¤ì¹­\r",
											"const list = Array.isArray(j?.result?.analysisList) ? j.result.analysisList : [];\r",
											"let found = null;\r",
											"\r",
											"// summariesë¥¼ í›‘ìœ¼ë©´ì„œ id ì¼ì¹˜ í•­ëª© ì°¾ê¸°\r",
											"for (const group of list) {\r",
											"  const summaries = Array.isArray(group?.summaries) ? group.summaries : [];\r",
											"  for (const s of summaries) {\r",
											"    const sidNum = Number(s?.id);\r",
											"    const match = useNumeric ? (sidNum === envIdNum) : (String(s?.id) === String(envIdRaw));\r",
											"    if (match) {\r",
											"      found = { reportUid: s?.reportUid, analysisType: group?.analysisType, imageType: s?.imageType, summary: s };\r",
											"      break;\r",
											"    }\r",
											"  }\r",
											"  if (found) break;\r",
											"}\r",
											"\r",
											"// 4) ëª» ì°¾ì•˜ìœ¼ë©´ selectedAnalysisë¡œë„ í•œ ë²ˆ ë” í™•ì¸\r",
											"if (!found) {\r",
											"  const sel = j?.result?.selectedAnalysis;\r",
											"  const selMatch = sel && ((useNumeric && Number(sel.analysisId) === envIdNum) || (String(sel?.analysisId) === String(envIdRaw)));\r",
											"  if (selMatch && sel?.reportUid) {\r",
											"    found = { reportUid: sel.reportUid, analysisType: sel.analysisType, imageType: null, summary: null };\r",
											"  }\r",
											"}\r",
											"\r",
											"// 5) ê²°ê³¼ ì €ì¥/ë¦¬í¬íŠ¸\r",
											"if (found && found.reportUid) {\r",
											"  pm.environment.set(\"report_Uid\", String(found.reportUid));\r",
											"  if (found.analysisType) pm.environment.set(\"analysisType\", String(found.analysisType)); // ë®ì–´ì“°ê¸° í—ˆìš©\r",
											"  if (found.imageType)    pm.environment.set(\"imageType\", String(found.imageType));\r",
											"  console.log(`[view/total] report_Uid set -> ${found.reportUid} (analysisId=${envIdRaw}, type=${found.analysisType || \"-\"})`);\r",
											"  pm.test(\"reportUid found for given analysisId\", () => pm.expect(true).to.eql(true));\r",
											"} else {\r",
											"  pm.environment.unset(\"report_Uid\");\r",
											"  console.warn(`[view/total] No reportUid matched analysisId=${envIdRaw}.`);\r",
											"  pm.test(\"reportUid not found for given analysisId\", () => pm.expect(true, \"No matching reportUid\").to.eql(false));\r",
											"}\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": ""
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/analysis/view/total",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"analysis",
										"view",
										"total"
									]
								}
							},
							"response": []
						},
						{
							"name": "ë¶„ì„ ê²°ê³¼ ë³„ ëª©ë¡ ì¡°íšŒ",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === env -> body ===\r",
											"let patientIdEnv = pm.environment.get(\"PATIENT_ID\") || pm.variables.get(\"PATIENT_ID\");\r",
											"let patientIdNum = Number(patientIdEnv);\r",
											"if (!Number.isFinite(patientIdNum)) {\r",
											"  console.warn(\"[analysis/view/summary] PATIENT_ID is missing or not a number:\", patientIdEnv);\r",
											"  patientIdNum = null; // ì„œë²„ê°€ ìˆ«ìë§Œ ë°›ìœ¼ë©´ null ëŒ€ì‹  ì—ëŸ¬ ìœ ë„ë¨\r",
											"}\r",
											"\r",
											"let analysisType = pm.environment.get(\"analysisType\") || pm.variables.get(\"analysisType\") || \"\";\r",
											"analysisType = String(analysisType).trim();\r",
											"\r",
											"// headers\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
											"\r",
											"// body (dataSize ê³ ì • 10)\r",
											"const body = {\r",
											"  patientId: patientIdNum,\r",
											"  analysisType: analysisType,\r",
											"  dataSize: 10\r",
											"};\r",
											"\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(body, null, 2));\r",
											"\r",
											"console.log(\"[POST /app/api/analysis/view/summary] body =\", body);\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": ""
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/analysis/view/summary",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"analysis",
										"view",
										"summary"
									]
								}
							},
							"response": []
						},
						{
							"name": "ë¶„ì„ ê²°ê³¼ ëª©ë¡ ì¡°íšŒ_Show latest scan only",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// ==== ê³µí†µ í—¤ë”/í† í° ====\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
											"\r",
											"// ==== í™˜ì ID ====\r",
											"const patientId = Number(pm.environment.get(\"PATIENT_ID\"));\r",
											"if (!patientId) { throw new Error(\"PATIENT_IDê°€ ì—†ìŠµë‹ˆë‹¤. (sample_1 í™˜ì ì¡°íšŒ ë¨¼ì € ì‹¤í–‰)\"); }\r",
											"\r",
											"// ==== ë¶„ì„ ID ì„ íƒ ====\r",
											"// 1) ìš°ì„  í™˜ê²½ë³€ìˆ˜ ANALYSIS_IDê°€ ìˆìœ¼ë©´ ê·¸ê±¸ ì‚¬ìš©\r",
											"let analysisId = Number(pm.environment.get(\"ANALYSIS_ID\") || NaN);\r",
											"\r",
											"// 2) ì—†ìœ¼ë©´ EXPORT_TYPE_IDS_JSONì˜ ëª¨ë“  ID í•©ì§‘í•©ì—ì„œ ëœë¤ ì„ íƒ\r",
											"if (!Number.isFinite(analysisId)) {\r",
											"  let map = {};\r",
											"  try { map = JSON.parse(pm.environment.get(\"EXPORT_TYPE_IDS_JSON\") || \"{}\"); } catch (_) { map = {}; }\r",
											"  const union = Array.from(\r",
											"    new Set(Object.values(map).flat().map(Number).filter(Number.isFinite))\r",
											"  );\r",
											"  if (!union.length) throw new Error(\"ë¶„ì„ IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ANALYSIS_ID ë˜ëŠ” EXPORT_TYPE_IDS_JSON ì„¤ì • í•„ìš”)\");\r",
											"  analysisId = union[Math.floor(Math.random() * union.length)];\r",
											"  // ì„ íƒëœ ê°’ ë³´ê´€(ë‹¤ìŒì—ë„ ë™ì¼í•˜ê²Œ ì“°ê³  ì‹¶ë‹¤ë©´ ì£¼ì„ í•´ì œ)\r",
											"  // pm.environment.set(\"ANALYSIS_ID\", String(analysisId));\r",
											"}\r",
											"\r",
											"// ==== latestOnly í† ê¸€ (ë§¤ ìš”ì²­ë§ˆë‹¤ true/false ë²ˆê°ˆì•„ê°€ë©°) ====\r",
											"function asBool(v, dflt) {\r",
											"  if (typeof v === \"boolean\") return v;\r",
											"  if (typeof v === \"string\") {\r",
											"    const s = v.trim().toLowerCase();\r",
											"    if (s === \"true\") return true;\r",
											"    if (s === \"false\") return false;\r",
											"  }\r",
											"  return dflt;\r",
											"}\r",
											"let init = asBool(pm.environment.get(\"LATEST_ONLY_INIT\"), false);\r",
											"let latestOnly = asBool(pm.environment.get(\"LATEST_ONLY_VALUE\"), false);\r",
											"\r",
											"if (!init) {\r",
											"  // ì²« ì‹¤í–‰: falseë¡œ ì‹œì‘\r",
											"  latestOnly = false;\r",
											"  pm.environment.set(\"LATEST_ONLY_INIT\", \"true\");\r",
											"} else {\r",
											"  // ë‹¤ìŒ ì‹¤í–‰ë¶€í„°ëŠ” ë°˜ì „\r",
											"  latestOnly = !latestOnly;\r",
											"}\r",
											"pm.environment.set(\"LATEST_ONLY_VALUE\", String(latestOnly));\r",
											"\r",
											"// ==== URLì˜ t=íƒ€ì„ìŠ¤íƒ¬í”„ ê°±ì‹  ====\r",
											"(function updateTimestampQuery() {\r",
											"  const now = Date.now();\r",
											"  const orig = pm.request.url.toString();\r",
											"  const qIndex = orig.indexOf(\"?\");\r",
											"  const base = qIndex >= 0 ? orig.slice(0, qIndex) : orig;\r",
											"  const qs   = qIndex >= 0 ? orig.slice(qIndex + 1) : \"\";\r",
											"  const parts = qs ? qs.split(\"&\").filter(kv => !/^t=/i.test((kv.split(\"=\")[0] || \"\"))) : [];\r",
											"  parts.push(`t=${now}`);\r",
											"  pm.request.url = base + \"?\" + parts.join(\"&\");\r",
											"})();\r",
											"\r",
											"// ==== ìš”ì²­ ë°”ë”” êµ¬ì„± ====\r",
											"const body = { analysisId, patientId, latestOnly };\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(body, null, 2));\r",
											"\r",
											"// ==== ë¡œê·¸ ====\r",
											"console.log(\"[analysis/view/total PRE]\", { analysisId, patientId, latestOnly, url: pm.request.url.toString() });\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"HTTP 2xx\", () => pm.expect(pm.response.code).to.be.within(200,299));\r",
											"\r",
											"let j = {};\r",
											"try { j = pm.response.json(); } catch (_) { j = null; }\r",
											"\r",
											"if (j && typeof j === \"object\" && typeof j.code !== \"undefined\") {\r",
											"  pm.test(\"Service code == 200\", () => pm.expect(j.code).to.eql(200));\r",
											"}\r",
											"\r",
											"// ë‚´ê°€ ë°©ê¸ˆ ë³´ë‚¸ ê°’ í™•ì¸ ë¡œê·¸\r",
											"try {\r",
											"  const sent = JSON.parse(pm.request.body.raw || \"{}\");\r",
											"  console.log(\"[SENT latestOnly toggle]\", sent);\r",
											"} catch {}\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{access_token}}",
										"type": "text"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/app/api/analysis/view/total",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"analysis",
										"view",
										"total"
									]
								}
							},
							"response": []
						},
						{
							"name": "ë³´ê³ ì„œ ì¡°íšŒ",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"HTTP 2xx\", () => pm.expect(pm.response.code).to.be.within(200,299));\r",
											"\r",
											"let j={}; try { j = pm.response.json(); } catch(e){}\r",
											"if (typeof j?.code !== \"undefined\") {\r",
											"  pm.test(\"service code === 200\", () => pm.expect(j.code).to.eql(200));\r",
											"}\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": ""
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/analysis/view/report/{{report_Uid}}",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"analysis",
										"view",
										"report",
										"{{report_Uid}}"
									]
								}
							},
							"response": []
						}
					]
				},
				{
					"name": "Analysis",
					"item": [
						{
							"name": "ë¶„ì„ ëª©ë¡ ì¡°íšŒ",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === 1) ì‘ë‹µ íŒŒì‹± & ê¸°ë³¸ í™•ì¸ ===\r",
											"let j = {};\r",
											"try { j = pm.response.json(); } catch (e) {\r",
											"  pm.environment.unset(\"analysisId_failed\");\r",
											"  pm.environment.unset(\"analysisType_failed\");\r",
											"  pm.environment.unset(\"FAIL_REPORT_UID\");\r",
											"  console.error(\"[analysis/search] JSON parse failed:\", e);\r",
											"  pm.test(\"HTTP 2xx\", () => pm.expect(pm.response.code).to.be.within(200,299));\r",
											"  return;\r",
											"}\r",
											"\r",
											"pm.test(\"HTTP 2xx\", () => pm.expect(pm.response.code).to.be.within(200,299));\r",
											"if (typeof j?.code !== \"undefined\") {\r",
											"  pm.test(\"service code === 200\", () => pm.expect(j.code).to.eql(200));\r",
											"}\r",
											"\r",
											"// === ê³µí†µ ìœ í‹¸ ===\r",
											"const asU = v => String(v ?? \"\").trim().toUpperCase();\r",
											"const filterType = (pm.environment.get(\"FILTER_FAILED_TYPE\") || \"\").trim(); // e.g. \"TAU_PET\"\r",
											"const DELAY_MS = Number(pm.environment.get(\"INTER_PAGE_DELAY_MS\") || 200);\r",
											"\r",
											"// í˜„ì¬ ìš”ì²­ ë°”ë””(ë‹¤ìŒ í˜ì´ì§€ í˜¸ì¶œì— ì¬ì‚¬ìš©)\r",
											"let reqBody = {};\r",
											"try { reqBody = pm.request.body ? JSON.parse(pm.request.body.raw) : {}; } catch {} \r",
											"if (!reqBody.paginationReq) reqBody.paginationReq = { requestPageNumber: 1, itemCountPerPage: 20, order: \"DESC\", sortBy: \"id\" };\r",
											"\r",
											"// === ì„ íƒ í•¨ìˆ˜: FAILED/CANCELED ì¤‘ ì²« í•­ëª© ì°¾ê¸° & ì €ì¥ ===\r",
											"function pickAndStore(contents) {\r",
											"  let failedItems = (contents || []).filter(it =>\r",
											"    [\"FAILED\",\"CANCELED\"].includes(asU(it?.analysisStatusType))\r",
											"  );\r",
											"  if (filterType) {\r",
											"    failedItems = failedItems.filter(it => asU(it?.analysisType) === asU(filterType));\r",
											"  }\r",
											"  const chosen = failedItems[0];\r",
											"  if (chosen && chosen.id != null) {\r",
											"    pm.environment.set(\"analysisId_failed\", String(chosen.id));\r",
											"    pm.environment.set(\"analysisType_failed\", String(chosen.analysisType || \"\"));\r",
											"    if (chosen.failReportUid) pm.environment.set(\"FAIL_REPORT_UID\", String(chosen.failReportUid));\r",
											"    console.log(`[analysis/search] FOUND on page ${reqBody?.paginationReq?.requestPageNumber} -> id=${chosen.id}, type=${chosen.analysisType}, status=${chosen.analysisStatusType}`);\r",
											"    return true;\r",
											"  }\r",
											"  return false;\r",
											"}\r",
											"\r",
											"// === 2) í˜„ì¬ í˜ì´ì§€ ê²€ì‚¬ ===\r",
											"const pageInfo = j?.result?.paginationResult || {};\r",
											"const contents = Array.isArray(pageInfo?.contents) ? pageInfo.contents : [];\r",
											"const pageNo = Number(pageInfo?.pageNumberToResponse || reqBody?.paginationReq?.requestPageNumber || 1);\r",
											"const totalPages = Number(pageInfo?.totalPageCount || 1);\r",
											"\r",
											"// í˜„ì¬ í˜ì´ì§€ì—ì„œ ë¨¼ì € ì‹œë„\r",
											"if (pickAndStore(contents)) {\r",
											"  // ì°¾ì•˜ìœ¼ë©´ ë\r",
											"} else {\r",
											"  // === 3) ë‹¤ìŒ í˜ì´ì§€ë“¤ ìˆœíšŒ ===\r",
											"  function fetchPage(nextPage) {\r",
											"    if (nextPage > totalPages) {\r",
											"      console.warn(`[analysis/search] FAILED/CANCELED not found across ${totalPages} page(s).`);\r",
											"      pm.environment.unset(\"analysisId_failed\");\r",
											"      pm.environment.unset(\"analysisType_failed\");\r",
											"      pm.environment.unset(\"FAIL_REPORT_UID\");\r",
											"      pm.test(\"FAILED/CANCELED item exists across all pages\", function () {\r",
											"  pm.expect.fail(\"No FAILED/CANCELED items found in all pages\");\r",
											"});\r",
											"\r",
											"      return;\r",
											"    }\r",
											"\r",
											"    const baseUrl = pm.environment.get(\"baseUrl\") || pm.variables.get(\"baseUrl\") || \"\";\r",
											"    const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\") || \"\";\r",
											"\r",
											"    const headers = [{ key: \"Content-Type\", value: \"application/json\" }, { key: \"Accept\", value: \"application/json\" }];\r",
											"    if (token) headers.push({ key: \"Authorization\", value: `Bearer ${token}` });\r",
											"\r",
											"    const body = JSON.parse(JSON.stringify(reqBody));\r",
											"    body.paginationReq = Object.assign({}, body.paginationReq, { requestPageNumber: nextPage });\r",
											"\r",
											"    setTimeout(() => {\r",
											"      pm.sendRequest({\r",
											"        url: baseUrl.replace(/\\/+$/,\"\") + \"/app/api/analysis/search\",\r",
											"        method: \"POST\",\r",
											"        header: headers,\r",
											"        body: { mode: \"raw\", raw: JSON.stringify(body) }\r",
											"      }, (err, res) => {\r",
											"        if (err || !res) {\r",
											"          console.error(\"[analysis/search] page fetch error:\", err);\r",
											"          return;\r",
											"        }\r",
											"        let j2 = {};\r",
											"        try { j2 = res.json(); } catch { j2 = {}; }\r",
											"        const pageInfo2 = j2?.result?.paginationResult || {};\r",
											"        const contents2 = Array.isArray(pageInfo2?.contents) ? pageInfo2.contents : [];\r",
											"        // ì°¾ìœ¼ë©´ ì €ì¥í•˜ê³  ì¢…ë£Œ, ì•„ë‹ˆë©´ ë‹¤ìŒ í˜ì´ì§€\r",
											"        if (pickAndStore(contents2)) return;\r",
											"        fetchPage(nextPage + 1);\r",
											"      });\r",
											"    }, DELAY_MS);\r",
											"  }\r",
											"\r",
											"  // ë‹¤ìŒ í˜ì´ì§€ë¶€í„° ì‹œì‘\r",
											"  fetchPage(pageNo + 1);\r",
											"}\r",
											"\r",
											"// === (ë„¤ê°€ ì“°ë˜) ì§‘ê³„ IIFEëŠ” ê·¸ëŒ€ë¡œ ì•„ë˜ì— ë‘ë©´ ë¨ ===\r",
											"// ... (ê¸°ì¡´ Aggregation IIFE ìœ ì§€)\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n  \"paginationReq\": {\r\n    \"requestPageNumber\": 1,\r\n    \"itemCountPerPage\": 100,\r\n    \"order\": \"DESC\",\r\n    \"sortBy\": \"id\"\r\n},\r\n  \"identifier\": \"\",\r\n  \"name\": \"\",\r\n  \"sex\": null,\r\n  \"startDate\": null,\r\n  \"endDate\": null,\r\n  \"analysisTypes\": null,\r\n  \"analysisStatusTypes\": null,\r\n  \"imageTypes\": null\r\n}\r\n"
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/analysis/search",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"analysis",
										"search"
									]
								}
							},
							"response": []
						},
						{
							"name": "ë¶„ì„ ëª©ë¡ ì¡°íšŒ_Patient ID",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// ===== ê³µí†µ í—¤ë”/í† í° =====\r",
											"pm.request.method = \"POST\";\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: \"Bearer \" + token });\r",
											"\r",
											"// ====== ê²€ìƒ‰ íŒŒë¼ë¯¸í„° ê¸°ë³¸ê°’ ======\r",
											"const IDENT = pm.environment.get(\"ANALYSIS_SEARCH_IDENTIFIER\") || \"sample_1\";\r",
											"const NAME  = pm.environment.get(\"ANALYSIS_SEARCH_NAME\") || \"sample_1\";\r",
											"\r",
											"// ë‚ ì§œ ê¸°ë³¸ê°’: ìµœê·¼ 6ê°œì›” (KST ê¸°ì¤€)\r",
											"function kstTodayYMD() {\r",
											"  const s = new Date().toLocaleDateString('en-CA', { timeZone: 'Asia/Seoul' }); // YYYY-MM-DD\r",
											"  return s;\r",
											"}\r",
											"function addMonths(ymd, months) {\r",
											"  const [y,m,d] = ymd.split('-').map(Number);\r",
											"  const dt = new Date(Date.UTC(y, m-1, d));\r",
											"  dt.setUTCMonth(dt.getUTCMonth() + months);\r",
											"  const y2 = dt.getUTCFullYear();\r",
											"  const m2 = String(dt.getUTCMonth()+1).padStart(2,'0');\r",
											"  const d2 = String(dt.getUTCDate()).padStart(2,'0');\r",
											"  return `${y2}-${m2}-${d2}`;\r",
											"}\r",
											"const endDateDefault = kstTodayYMD();\r",
											"const startDateDefault = addMonths(endDateDefault, -6);\r",
											"\r",
											"const START = pm.environment.get(\"ANALYSIS_SEARCH_START_DATE\") || startDateDefault;\r",
											"const END   = pm.environment.get(\"ANALYSIS_SEARCH_END_DATE\")   || endDateDefault;\r",
											"\r",
											"// í˜ì´ì§€/ì •ë ¬ ì˜µì…˜\r",
											"const PAGE  = Number(pm.environment.get(\"ANALYSIS_SEARCH_PAGE\") || 1);\r",
											"const SIZE  = Number(pm.environment.get(\"ANALYSIS_SEARCH_SIZE\") || 20);\r",
											"const ORDER = pm.environment.get(\"ANALYSIS_SEARCH_ORDER\") || \"desc\"; // asc|desc\r",
											"const SORT  = pm.environment.get(\"ANALYSIS_SEARCH_SORT\")  || \"id\";   // id|requestedAt ë“±\r",
											"\r",
											"// ====== Body êµ¬ì„± ======\r",
											"const body = {\r",
											"  paginationReq: {\r",
											"    requestPageNumber: PAGE,\r",
											"    itemCountPerPage: SIZE,\r",
											"    order: ORDER,\r",
											"    sortBy: SORT\r",
											"  },\r",
											"  identifier: IDENT,\r",
											"  name: NAME,\r",
											"  sex: null,\r",
											"  startDate: START,\r",
											"  endDate: END,\r",
											"  analysisTypes: null,\r",
											"  analysisStatusTypes: null,\r",
											"  imageTypes: null\r",
											"};\r",
											"\r",
											"// ìºì‹œ ë°©ì§€ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° t ì¶”ê°€\r",
											"const ts = Date.now();\r",
											"const url0 = pm.request.url.toString();\r",
											"pm.request.url = url0.includes(\"?\") ? `${url0}&t=${ts}` : `${url0}?t=${ts}`;\r",
											"\r",
											"// ìµœì¢… ë°”ë”” ì£¼ì…\r",
											"pm.request.body = {\r",
											"  mode: 'raw',\r",
											"  raw: JSON.stringify(body)\r",
											"};\r",
											"\r",
											"// ë””ë²„ê·¸ ë¡œê·¸\r",
											"console.log(\"[analysis/search] request body:\", body);\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === ì‘ë‹µ íŒŒì‹± ===\r",
											"let j = {};\r",
											"try { j = pm.response.json(); } catch (e) {\r",
											"  pm.test(\"HTTP 2xx\", () => pm.expect(pm.response.code).to.be.within(200,299));\r",
											"  pm.expect.fail(\"JSON íŒŒì‹± ì‹¤íŒ¨: \" + e);\r",
											"}\r",
											"\r",
											"// === ê¸°ë³¸ HTTP/ì„œë¹„ìŠ¤ ì½”ë“œ í™•ì¸ ===\r",
											"pm.test(\"HTTP 2xx\", () => pm.expect(pm.response.code).to.be.within(200,299));\r",
											"if (typeof j.code !== \"undefined\") {\r",
											"  pm.test(\"Service code == 200\", () => pm.expect(j.code, \"service code\").to.eql(200));\r",
											"}\r",
											"\r",
											"// === ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ ì•ˆì „ ì¶”ì¶œ (ì‘ë‹µ êµ¬ì¡° ìœ ì—° ì²˜ë¦¬) ===\r",
											"const result = j.result || j.data || {};\r",
											"const page = result.paginationResult || result.page || {};\r",
											"const contents = page.contents || page.items || result.contents || [];\r",
											"const totalCount = page.totalItemCount || page.totalElements || contents.length;\r",
											"\r",
											"// === ì‹ë³„ì/ì´ë¦„ í•„í„°(ì´ë¯¸ ì„œë²„ì—ì„œ í•„í„°ë§ëì§€ë§Œ ì´ì¤‘ í™•ì¸) ===\r",
											"const ident = pm.environment.get(\"ANALYSIS_SEARCH_IDENTIFIER\") || \"sample_1\";\r",
											"const name  = pm.environment.get(\"ANALYSIS_SEARCH_NAME\") || \"sample_1\";\r",
											"const filtered = contents.filter(row => {\r",
											"  const idf = (row.identifier || row.patientIdentifier || row.name || \"\").toString();\r",
											"  const nm  = (row.name || row.patientName || row.patient || \"\").toString();\r",
											"  return idf === ident || nm === name;\r",
											"});\r",
											"\r",
											"// === ê²°ê³¼ ì—†ì„ ë•Œ ì²˜ë¦¬ ===\r",
											"pm.test(\"ê²€ìƒ‰ ê²°ê³¼ ì¡´ì¬\", () => pm.expect(filtered.length, \"ê²€ìƒ‰ ê²°ê³¼\").to.be.greaterThan(0));\r",
											"\r",
											"// === ì²« í–‰ ì €ì¥ ===\r",
											"if (filtered.length > 0) {\r",
											"  const first = filtered[0];\r",
											"  const idVal = first.id || first.analysisId || first.analysisID;\r",
											"  const status = first.analysisStatus || first.status || first.analysisStatusType;\r",
											"  const aType  = first.analysisType || first.type || first.analysisTypeName;\r",
											"\r",
											"  pm.environment.set(\"analysis_search_totalCount\", String(totalCount));\r",
											"  pm.environment.set(\"analysis_first_id\", String(idVal));\r",
											"  pm.environment.set(\"analysis_first_status\", String(status));\r",
											"  pm.environment.set(\"analysis_first_type\", String(aType));\r",
											"\r",
											"  // ê°€ë…ì„± ë¡œê·¸\r",
											"  console.log(\"[analysis/search] total:\", totalCount);\r",
											"  console.log(\"[analysis/search] first:\", { id: idVal, status, analysisType: aType });\r",
											"\r",
											"  pm.test(\"ì²« í–‰ id ì¡´ì¬\", () => pm.expect(idVal, \"first id\").to.exist);\r",
											"  pm.test(\"ì²« í–‰ ìƒíƒœ ì¡´ì¬\", () => pm.expect(status, \"first status\").to.exist);\r",
											"}\r",
											"\r",
											"// === ìš”ì•½ ë©”ì„¸ì§€ ===\r",
											"if (filtered.length > 0) {\r",
											"  const f = filtered[0];\r",
											"  const idVal = f.id || f.analysisId || f.analysisID;\r",
											"  const status = f.analysisStatus || f.status || f.analysisStatusType;\r",
											"  const aType  = f.analysisType || f.type || f.analysisTypeName;\r",
											"  pm.test(`ìš”ì•½ | ì²« í–‰: #${idVal} | ${aType} | ${status}`, () => true);\r",
											"} else {\r",
											"  pm.test(\"ìš”ì•½ | ê²°ê³¼ ì—†ìŒ\", () => true);\r",
											"}\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{access_token}}",
										"type": "text"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/app/api/analysis/search",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"analysis",
										"search"
									]
								}
							},
							"response": []
						},
						{
							"name": "ë¶„ì„ ëª©ë¡ ì¡°íšŒ_Sex",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// (ì—¬ê¸°ë¶€í„° ê¸°ì¡´ Pre-request ìœ ì§€: START/END/PAGE/SIZE/SEX_CYCLE/SEX_IDX ê³„ì‚°,\r",
											"// sexCode ì„ íƒ, body êµ¬ì„±, env ì €ì¥, ìºì‹œ ë°©ì§€ ë“±)\r",
											"//\r",
											"\r",
											"// === ê³µí†µ í—¤ë”/í† í° ===\r",
											"pm.request.method = \"POST\";\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: \"Bearer \" + token });\r",
											"\r",
											"// === ë‚ ì§œ/í˜ì´ì§€ ê¸°ë³¸ê°’ ===\r",
											"const START = pm.environment.get(\"ANALYSIS_START_DATE\") || \"2025-04-21\";\r",
											"const END   = pm.environment.get(\"ANALYSIS_END_DATE\")   || \"2025-10-21\";\r",
											"const PAGE  = Number(pm.environment.get(\"PAGE\") || 1);\r",
											"const SIZE  = Number(pm.environment.get(\"SIZE\") || 20);\r",
											"const ORDER = pm.environment.get(\"ORDER\") || \"desc\";\r",
											"const SORT  = pm.environment.get(\"SORT\")  || \"id\";\r",
											"\r",
											"// === ì„±ë³„ ìˆœí™˜ (M,F,U ê¸°ë³¸) ===\r",
											"const CYCLE = (pm.environment.get(\"SEX_CYCLE\") || \"M,F,U\")\r",
											"  .split(\",\").map(s => s.trim().toUpperCase()).filter(Boolean);\r",
											"\r",
											"let idx = Number(pm.environment.get(\"SEX_IDX\") || 0);\r",
											"if (!Number.isFinite(idx) || idx < 0) idx = 0;\r",
											"\r",
											"// ì´ë²ˆ í˜¸ì¶œ ì„±ë³„\r",
											"const sexCode = CYCLE[idx % CYCLE.length];\r",
											"\r",
											"// ìš”ì²­ ë°”ë””\r",
											"const body = {\r",
											"  paginationReq: { requestPageNumber: PAGE, itemCountPerPage: SIZE, order: ORDER, sortBy: SORT },\r",
											"  identifier: \"\",\r",
											"  name: \"\",\r",
											"  sex: [sexCode],\r",
											"  startDate: START,\r",
											"  endDate: END,\r",
											"  analysisTypes: null,\r",
											"  analysisStatusTypes: null,\r",
											"  imageTypes: null\r",
											"};\r",
											"\r",
											"// ë°”ë”” ì£¼ì…\r",
											"pm.request.body = { mode: \"raw\", raw: JSON.stringify(body) };\r",
											"\r",
											"// í˜„ì¬ ìƒíƒœ ì €ì¥(Testsì—ì„œ idx ì¦ê°€)\r",
											"pm.environment.set(\"SEX_IDX\", String(idx));\r",
											"pm.environment.set(\"SEX_CODE_CURRENT\", sexCode);\r",
											"\r",
											"// ìºì‹œ ë°©ì§€ ì¿¼ë¦¬ ì¶”ê°€\r",
											"const ts = Date.now();\r",
											"const u0 = pm.request.url.toString();\r",
											"pm.request.url = u0.includes(\"?\") ? `${u0}&t=${ts}` : `${u0}?t=${ts}`;\r",
											"\r",
											"console.log(\"[analysis/search] sex:\", sexCode, \"| idx:\", idx, \"| cycle:\", CYCLE.join(\"->\"));\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === ì‘ë‹µ íŒŒì‹±/ê¸°ë³¸ ì²´í¬ ===\r",
											"let j = {};\r",
											"try { j = pm.response.json(); } catch (e) {\r",
											"  pm.test(\"HTTP 2xx\", () => pm.expect(pm.response.code).to.be.within(200,299));\r",
											"  pm.expect.fail(\"JSON íŒŒì‹± ì‹¤íŒ¨: \" + e);\r",
											"}\r",
											"pm.test(\"HTTP 2xx\", () => pm.expect(pm.response.code).to.be.within(200,299));\r",
											"if (typeof j.code !== \"undefined\") {\r",
											"  pm.test(\"Service code == 200\", () => pm.expect(j.code).to.eql(200));\r",
											"}\r",
											"\r",
											"// === ë¦¬ìŠ¤íŠ¸ ì¶”ì¶œ ===\r",
											"const result = j.result || j.data || {};\r",
											"const page   = result.paginationResult || result.page || {};\r",
											"const rows   = page.contents || result.contents || [];\r",
											"\r",
											"// === í˜„ì¬ ì„±ë³„ ===\r",
											"const sexCode = (pm.environment.get(\"SEX_CODE_CURRENT\") || \"M\").toUpperCase();\r",
											"\r",
											"// í¬ë§· ëŒ€ì‘(M/F/U or Male/Female/Unknown)\r",
											"const okMap = {\r",
											"  \"M\": v => [\"M\",\"MALE\",\"Male\"].includes(String(v).toUpperCase()),\r",
											"  \"F\": v => [\"F\",\"FEMALE\",\"Female\"].includes(String(v).toUpperCase()),\r",
											"  \"U\": v => [\"U\",\"UNKNOWN\",\"Unknown\",\"\"].includes(String(v).toUpperCase()),\r",
											"};\r",
											"const getSex = r => r.sex || r.gender || r.patientSex || r.patientGender;\r",
											"\r",
											"// ê²°ê³¼ ê²€ì¦(ë¹ˆ ê²°ê³¼ í—ˆìš©)\r",
											"pm.test(`ì„±ë³„(${sexCode}) í•„í„° ì¼ì¹˜`, () => {\r",
											"  const bad = rows.filter(r => !okMap[sexCode](getSex(r)));\r",
											"  if (bad.length) console.warn(\"ì„±ë³„ ë¶ˆì¼ì¹˜ ì˜ˆì‹œ:\", bad[0]);\r",
											"  pm.expect(bad.length).to.eql(0);\r",
											"});\r",
											"\r",
											"// ìš”ì•½\r",
											"pm.test(`ìš”ì•½ | sex=${sexCode} | count=${rows.length}`, () => true);\r",
											"\r",
											"// === ìˆœí™˜ ì¸ë±ìŠ¤ë§Œ ì¦ê°€í•˜ê³  ì¢…ë£Œ (ì²´ì´ë‹ ì—†ìŒ) ===\r",
											"const cycleLen = (pm.environment.get(\"SEX_CYCLE\") || \"M,F,U\").split(\",\").filter(Boolean).length || 3;\r",
											"let idx = Number(pm.environment.get(\"SEX_IDX\") || 0);\r",
											"idx = (idx + 1) % cycleLen;\r",
											"pm.environment.set(\"SEX_IDX\", String(idx));\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{access_token}}",
										"type": "text"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/app/api/analysis/search",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"analysis",
										"search"
									]
								}
							},
							"response": []
						},
						{
							"name": "ë¶„ì„ ëª©ë¡ ì¡°íšŒ_Analysis Type",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === ê³µí†µ í—¤ë”/í† í° ===\r",
											"pm.request.method = \"POST\";\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: \"Bearer \" + token });\r",
											"\r",
											"// === ê¸°ê°„/í˜ì´ì§€ (í•„ìš”ì‹œ í™˜ê²½ë³€ìˆ˜ë¡œ ë®ì–´ì“°ê¸°) ===\r",
											"const START = pm.environment.get(\"ANALYSIS_START_DATE\") || \"2025-04-21\";\r",
											"const END   = pm.environment.get(\"ANALYSIS_END_DATE\")   || \"2025-10-21\";\r",
											"const PAGE  = Number(pm.environment.get(\"PAGE\") || 1);\r",
											"const SIZE  = Number(pm.environment.get(\"SIZE\") || 20);\r",
											"const ORDER = pm.environment.get(\"ORDER\") || \"desc\";\r",
											"const SORT  = pm.environment.get(\"SORT\")  || \"id\";\r",
											"\r",
											"// === ë¶„ì„íƒ€ì… ì¹´íƒˆë¡œê·¸(ìˆœì„œ ê³ ì •) ===\r",
											"const CATALOG = [\r",
											"  { code:\"AD_STAGING\",   name:\"AD Biomarker\" },\r",
											"  { code:\"SCREENING\",    name:\"Screening Support\" },\r",
											"  { code:\"MONITORING\",   name:\"Monitoring Support\" },\r",
											"  { code:\"BRAIN_VOL\",    name:\"Brain Volumetry\" },\r",
											"  { code:\"FLAIR_HI\",     name:\"Microvascular Ischemic Change\" },\r",
											"  { code:\"ARIA_E\",       name:\"ARIA-E\" },\r",
											"  { code:\"ARIA_H_SWI\",   name:\"ARIA-H (SWI)\" },\r",
											"  { code:\"ARIA_H_GRE\",   name:\"ARIA-H (GRE)\" },\r",
											"  { code:\"ARIA_H_SG\",    name:\"ARIA-H (SWI+GRE)\" },\r",
											"  { code:\"AMYLOID_PET\",  name:\"Amyloid PET\" },\r",
											"  { code:\"TAU_PET\",      name:\"Tau PET\" },\r",
											"];\r",
											"\r",
											"// === ì§„í–‰ ì¸ë±ìŠ¤(ìˆœì„œ ìœ ì§€ìš©) ===\r",
											"let idx = Number(pm.environment.get(\"AT_IDX\") || 0);\r",
											"if (!Number.isFinite(idx) || idx < 0) idx = 0;\r",
											"\r",
											"// í˜„ì¬ ëŒ€ìƒ\r",
											"const curr = CATALOG[idx % CATALOG.length];\r",
											"\r",
											"// ìš”ì²­ ë°”ë”” êµ¬ì„±\r",
											"const body = {\r",
											"  paginationReq: { requestPageNumber: PAGE, itemCountPerPage: SIZE, order: ORDER, sortBy: SORT },\r",
											"  identifier: \"\",\r",
											"  name: \"\",\r",
											"  sex: null,\r",
											"  startDate: START,\r",
											"  endDate: END,\r",
											"  analysisTypes: [curr.code],   // â˜… ìˆœì„œëŒ€ë¡œ í•˜ë‚˜ì”©\r",
											"  analysisStatusTypes: null,\r",
											"  imageTypes: null\r",
											"};\r",
											"\r",
											"// ë°”ë”” ì ìš©\r",
											"pm.request.body = { mode: \"raw\", raw: JSON.stringify(body) };\r",
											"\r",
											"// ìƒíƒœ ì €ì¥ (Post-responseì—ì„œ idxë§Œ +1)\r",
											"pm.environment.set(\"AT_IDX\", String(idx));\r",
											"pm.environment.set(\"AT_CODE\", curr.code);\r",
											"pm.environment.set(\"AT_NAME\", curr.name);\r",
											"pm.environment.set(\"AT_CATLEN\", String(CATALOG.length));  // Postì—ì„œ ì‚¬ìš©\r",
											"\r",
											"// ìºì‹œ ë°©ì§€\r",
											"const ts = Date.now();\r",
											"const u0 = pm.request.url.toString();\r",
											"pm.request.url = u0.includes(\"?\") ? `${u0}&t=${ts}` : `${u0}?t=${ts}`;\r",
											"\r",
											"console.log(`[analysis/search] analysisType: ${curr.code} (${curr.name}) | idx=${idx}/${CATALOG.length-1}`);\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === ì‘ë‹µ íŒŒì‹±/ê¸°ë³¸ ì²´í¬(ê°„ë‹¨) ===\r",
											"let j = {};\r",
											"try { j = pm.response.json(); } catch (e) {\r",
											"  pm.test(\"HTTP 2xx\", () => pm.expect(pm.response.code).to.be.within(200,299));\r",
											"  console.warn(\"JSON íŒŒì‹± ì‹¤íŒ¨:\", e);\r",
											"}\r",
											"\r",
											"// ì„œë¹„ìŠ¤ ì½”ë“œê°€ ìˆìœ¼ë©´ ì°¸ê³  ë¡œê·¸ë§Œ\r",
											"if (typeof j.code !== \"undefined\") {\r",
											"  console.log(\"service code:\", j.code);\r",
											"}\r",
											"\r",
											"// === ë¦¬ìŠ¤íŠ¸/ìš”ì•½ë§Œ ì¶œë ¥ (ê²€ì¦ ìµœì†Œí™”) ===\r",
											"const result = (j && (j.result || j.data)) || {};\r",
											"const page   = result.paginationResult || result.page || {};\r",
											"const rows   = page.contents || result.contents || [];\r",
											"\r",
											"const CODE = (pm.environment.get(\"AT_CODE\") || \"\").toUpperCase();\r",
											"const NAME = pm.environment.get(\"AT_NAME\") || \"\";\r",
											"pm.test(`ìš”ì•½ | ${CODE} (${NAME}) | count=${rows.length}`, () => true);\r",
											"\r",
											"// === ìˆœì„œë§Œ ë‹¤ìŒìœ¼ë¡œ ì´ë™ (ì²´ì´ë‹ ì—†ìŒ) ===\r",
											"const catLen = Math.max(1, Number(pm.environment.get(\"AT_CATLEN\") || 1));\r",
											"let idx  = Number(pm.environment.get(\"AT_IDX\") || 0);\r",
											"idx = (idx + 1) % catLen;          // ë‹¤ìŒ ë¶„ì„íƒ€ì…ìœ¼ë¡œ ìˆœí™˜\r",
											"pm.environment.set(\"AT_IDX\", String(idx));\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{access_token}}",
										"type": "text"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/app/api/analysis/search",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"analysis",
										"search"
									]
								}
							},
							"response": []
						},
						{
							"name": "ë¶„ì„ ëª©ë¡ ì¡°íšŒ_Analysis status",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === POST /app/api/analysis/search : analysisStatusTypesë¥¼ ìˆœì°¨ ìˆœí™˜ ===\r",
											"pm.request.method = \"POST\";\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"\r",
											"// (ì˜µì…˜) í† í°ì´ ìˆìœ¼ë©´ í—¤ë” ì£¼ì…\r",
											"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
											"\r",
											"// ---- KST ë‚ ì§œ ìœ í‹¸ ----\r",
											"function toYMD_KST(date) {\r",
											"  const s = date.toLocaleDateString(\"en-CA\", { timeZone: \"Asia/Seoul\" }); // YYYY-MM-DD\r",
											"  return s;\r",
											"}\r",
											"function todayKST00() {\r",
											"  const s = toYMD_KST(new Date()); // \"YYYY-MM-DD\"\r",
											"  const [y, m, d] = s.split(\"-\").map(Number);\r",
											"  return new Date(Date.UTC(y, m - 1, d));\r",
											"}\r",
											"function addMonths(date, months) {\r",
											"  const dt = new Date(date.getTime());\r",
											"  dt.setUTCMonth(dt.getUTCMonth() + months);\r",
											"  return dt;\r",
											"}\r",
											"const endDate = toYMD_KST(todayKST00());\r",
											"const startDate = toYMD_KST(addMonths(todayKST00(), -6));\r",
											"\r",
											"// ---- ìˆœí™˜í•  ìƒíƒœ ëª©ë¡(ì¹´íƒˆë¡œê·¸ ìˆœì„œ) ----\r",
											"// ìš”ì²­: \"In Queueë¶€í„° Pendingê¹Œì§€\" â†’ UPDATEëŠ” ì œì™¸(í•„ìš”í•˜ë©´ ë°°ì—´ì— \"UPDATE\" ì¶”ê°€)\r",
											"const STATUSES = [\r",
											"  \"IN_QUEUE\",\r",
											"  \"IN_PROGRESS\",\r",
											"  \"NEURO_ENGINE_COMPLETED\",\r",
											"  \"ANALYSIS_COMPLETED\",\r",
											"  \"COMPLETED\",\r",
											"  \"FAILED\",\r",
											"  \"CANCELED\",\r",
											"  \"PENDING\",\r",
											"];\r",
											"\r",
											"// ---- ì¸ë±ìŠ¤ ê°±ì‹ (í™˜ê²½ë³€ìˆ˜ STATUS_IDX ì‚¬ìš©) ----\r",
											"let idx = Number(pm.environment.get(\"STATUS_IDX\"));\r",
											"if (!Number.isInteger(idx) || idx < 0) idx = 0;\r",
											"const cur = STATUSES[idx];\r",
											"\r",
											"// ë‹¤ìŒ ì‹¤í–‰ì„ ìœ„í•´ ì¸ë±ìŠ¤ ì¦ê°€(ìˆœí™˜)\r",
											"const nextIdx = (idx + 1) % STATUSES.length;\r",
											"pm.environment.set(\"STATUS_IDX\", String(nextIdx));\r",
											"pm.environment.set(\"CURRENT_STATUS\", cur);\r",
											"\r",
											"// ---- ìš”ì²­ ë°”ë”” êµ¬ì„± ----\r",
											"const body = {\r",
											"  paginationReq: {\r",
											"    requestPageNumber: 1,\r",
											"    itemCountPerPage: 20,\r",
											"    order: \"desc\",\r",
											"    sortBy: \"id\",\r",
											"  },\r",
											"  identifier: \"\",\r",
											"  name: \"\",\r",
											"  sex: null,\r",
											"  startDate,           // ì˜ˆ: \"2025-04-21\"\r",
											"  endDate,             // ì˜ˆ: \"2025-10-21\"\r",
											"  analysisTypes: null,\r",
											"  analysisStatusTypes: [cur],\r",
											"  imageTypes: null,\r",
											"};\r",
											"\r",
											"// (ì„ íƒ) ìºì‹œ ë°©ì§€ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° t ì¶”ê°€\r",
											"const ts = Date.now();\r",
											"const u0 = pm.request.url.toString();\r",
											"pm.request.url = u0.includes(\"?\") ? `${u0}&t=${ts}` : `${u0}?t=${ts}`;\r",
											"\r",
											"// ìµœì¢… ë°”ë”” ì£¼ì…\r",
											"pm.request.body.update({ mode: \"raw\", raw: JSON.stringify(body) });\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === ê³µí†µ ì‘ë‹µ ê²€ì‚¬ & ë¡œê·¸ ===\r",
											"pm.test(\"HTTP 2xx\", () => pm.expect(pm.response.code).to.be.within(200, 299));\r",
											"\r",
											"let j = null;\r",
											"try { j = pm.response.json(); } catch (e) { /* ë°”ë””ê°€ ë¹„JSONì¼ ìˆ˜ë„ ìˆìŒ */ }\r",
											"\r",
											"// ì„œë¹„ìŠ¤ ë˜í•‘ì´ ìˆëŠ” ê²½ìš° code==200 í™•ì¸\r",
											"if (j && typeof j === \"object\" && \"code\" in j) {\r",
											"  pm.test(\"Service code == 200\", () => pm.expect(j.code).to.equal(200));\r",
											"}\r",
											"\r",
											"// í˜„ì¬ ì„ íƒëœ ìƒíƒœ ë° í˜ì´ì§€ í¬ê¸° í‘œì‹œ\r",
											"const cur = pm.environment.get(\"CURRENT_STATUS\");\r",
											"console.log(`[analysis/search] selected status = ${cur}`);\r",
											"\r",
											"pm.test(`Selected status: ${cur}`, () => pm.expect(cur).to.be.oneOf([\r",
											"  \"IN_QUEUE\",\"IN_PROGRESS\",\"NEURO_ENGINE_COMPLETED\",\"ANALYSIS_COMPLETED\",\"COMPLETED\",\"FAILED\",\"CANCELED\",\"PENDING\"\r",
											"]));\r",
											"\r",
											"// ê²°ê³¼ ê°œìˆ˜(ìˆìœ¼ë©´) í‘œì‹œ\r",
											"if (j && j.result && j.result.paginationResult) {\r",
											"  const pr = j.result.paginationResult;\r",
											"  const total = pr.totalItemCount ?? pr.totalCount ?? \"unknown\";\r",
											"  const pageCount = Array.isArray(pr.contents) ? pr.contents.length : 0;\r",
											"  pm.test(`Result page size = ${pageCount}`, () => pm.expect(pageCount).to.be.a(\"number\"));\r",
											"  console.log(`[analysis/search] total=${total}, pageCount=${pageCount}`);\r",
											"} else {\r",
											"  console.log(\"[analysis/search] No structured paginationResult found (OK if empty).\");\r",
											"}\r",
											"\r",
											"// ë‹¤ìŒ ì‹¤í–‰ì— ì‚¬ìš©í•  ë‹¤ìŒ ì¸ë±ìŠ¤ ì•ˆë‚´ ë¡œê·¸\r",
											"const nextIdx = Number(pm.environment.get(\"STATUS_IDX\")) || 0;\r",
											"console.log(`[analysis/search] next index -> ${nextIdx}`);\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{access_token}}",
										"type": "text"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/app/api/analysis/search",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"analysis",
										"search"
									]
								}
							},
							"response": []
						},
						{
							"name": "ë¶„ì„ ëª©ë¡ ì¡°íšŒ_Image Type",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === POST /app/api/analysis/search : imageTypes ìˆœí™˜ + AD Biomarker ë“± í•¨ê»˜ ì¡°íšŒ(ì™„í™” í•„í„°) ===\r",
											"pm.request.method = \"POST\";\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"\r",
											"// (ì˜µì…˜) í† í°ì´ ìˆìœ¼ë©´ Authorization ì£¼ì…\r",
											"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
											"\r",
											"// ---- KST ë‚ ì§œ ìœ í‹¸ ----\r",
											"function kstYMD(d){ return d.toLocaleDateString(\"en-CA\", { timeZone: \"Asia/Seoul\" }); }\r",
											"function todayKST00(){ const s=kstYMD(new Date()); const [y,m,dd]=s.split(\"-\").map(Number); return new Date(Date.UTC(y,m-1,dd)); }\r",
											"function addMonths(d,n){ const t=new Date(d.getTime()); t.setUTCMonth(t.getUTCMonth()+n); return t; }\r",
											"const endDate = kstYMD(todayKST00());\r",
											"const startDate = kstYMD(addMonths(todayKST00(), -6));\r",
											"\r",
											"// ---- ìˆœí™˜í•  ì´ë¯¸ì§€ íƒ€ì… ëª©ë¡ ----\r",
											"const IMG = [\"T1\",\"T2_FLAIR\",\"SWI\",\"GRE\",\"PET_AMYLOID\",\"PET_TAU\"];\r",
											"\r",
											"// ---- ì¸ë±ìŠ¤ ê³„ì‚°(í™˜ê²½ë³€ìˆ˜ IMAGE_IDX ì‚¬ìš©) ----\r",
											"let i = Number(pm.environment.get(\"IMAGE_IDX\"));\r",
											"if (!Number.isInteger(i) || i < 0) i = 0;\r",
											"const curImg = IMG[i];\r",
											"pm.environment.set(\"CURRENT_IMAGE\", curImg);\r",
											"pm.environment.set(\"IMAGE_IDX\", String((i + 1) % IMG.length)); // ë‹¤ìŒ íšŒì°¨ ì¸ë±ìŠ¤\r",
											"\r",
											"// ---- ê¸°ë³¸ ë°”ë””(ì´ë¯¸ì§€íƒ€ì… ë‹¨ì¼ í•„í„°) ----\r",
											"const body = {\r",
											"  paginationReq: { requestPageNumber: 1, itemCountPerPage: 20, order: \"desc\", sortBy: \"id\" },\r",
											"  identifier: \"\",\r",
											"  name: \"\",\r",
											"  sex: null,\r",
											"  startDate,\r",
											"  endDate,\r",
											"  analysisTypes: null,         // â† í•„ìš” ì‹œ ì•„ë˜ì—ì„œ ì¡°ê±´ë¶€ë¡œ ì„¸íŒ…\r",
											"  analysisStatusTypes: null,\r",
											"  imageTypes: [curImg],        // â† ê¸°ë³¸ì€ ë‹¨ì¼ ì´ë¯¸ì§€íƒ€ì… í•„í„°\r",
											"};\r",
											"\r",
											"// ---- â˜… ì™„í™” ê·œì¹™: ë³µí•© ë¶„ì„ê¹Œì§€ í•¨ê»˜ ë³´ì´ë„ë¡ ì¡°ê±´ë¶€ í™•ì¥ ----\r",
											"// T2-FLAIR ì„ íƒ ì‹œ: FLAIR ì „ìš© + AD Biomarker(ë³µí•©) ëª¨ë‘\r",
											"if (curImg === \"T2_FLAIR\") {\r",
											"  body.imageTypes = null;                    // ì´ë¯¸ì§€íƒ€ì… í•„í„° í•´ì œ\r",
											"  body.analysisTypes = [\"FLAIR_HI\", \"AD_STAGING\"];\r",
											"}\r",
											"// Amyloid PET ì„ íƒ ì‹œ: Amyloid ë‹¨ë… + AD Biomarker\r",
											"if (curImg === \"PET_AMYLOID\") {\r",
											"  body.imageTypes = null;\r",
											"  body.analysisTypes = [\"AMYLOID_PET\", \"AD_STAGING\"];\r",
											"}\r",
											"// Tau PET ì„ íƒ ì‹œ: Tau ë‹¨ë… + AD Biomarker\r",
											"if (curImg === \"PET_TAU\") {\r",
											"  body.imageTypes = null;\r",
											"  body.analysisTypes = [\"TAU_PET\", \"AD_STAGING\"];\r",
											"}\r",
											"// (ì˜µì…˜ í™•ì¥) SWI/GRE ì„ íƒ ì‹œ: ARIA-H(SWI/GRE/SG) í•¨ê»˜\r",
											"if (curImg === \"SWI\") {\r",
											"  body.imageTypes = null;\r",
											"  body.analysisTypes = [\"ARIA_H_SWI\", \"ARIA_H_SG\"];\r",
											"}\r",
											"if (curImg === \"GRE\") {\r",
											"  body.imageTypes = [\"GRE\"];\r",
											"  body.analysisTypes = [\"ARIA_H_GRE\"];\r",
											"}\r",
											"// T1ì€ ê¸°ë³¸ í•„í„° ìœ ì§€(í•„ìš” ì‹œ ì•„ë˜ ì£¼ì„ í•´ì œí•´ì„œ BRAIN_VOL/AD_STAGING í•¨ê»˜ ë³´ê¸°)\r",
											"// if (curImg === \"T1\") { body.imageTypes = null; body.analysisTypes = [\"BRAIN_VOL\",\"AD_STAGING\"]; }\r",
											"\r",
											"// ---- ìºì‹œ ë°©ì§€ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ----\r",
											"const ts = Date.now();\r",
											"pm.request.url = pm.request.url.toString().includes(\"?\")\r",
											"  ? pm.request.url + `&t=${ts}` : pm.request.url + `?t=${ts}`;\r",
											"\r",
											"// ---- ìµœì¢… ë°”ë”” ì£¼ì… ----\r",
											"pm.request.body.update({ mode: \"raw\", raw: JSON.stringify(body) });\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === ê³µí†µ: HTTP ì½”ë“œ ===\r",
											"pm.test(\"HTTP 2xx\", () => pm.expect(pm.response.code).to.be.within(200, 299));\r",
											"\r",
											"// === JSON íŒŒì‹± ===\r",
											"let j = null;\r",
											"try { j = pm.response.json(); } catch (e) {}\r",
											"pm.test(\"JSON body exists\", () => pm.expect(j).to.be.an(\"object\"));\r",
											"\r",
											"// === ì„œë¹„ìŠ¤ ë˜í•‘ ì½”ë“œ ê²€ì‚¬ ===\r",
											"if (j && typeof j === \"object\" && \"code\" in j) {\r",
											"  pm.test(\"Service code == 200\", () => pm.expect(j.code).to.equal(200));\r",
											"}\r",
											"\r",
											"// === ì•ˆì „ ì ‘ê·¼ ìœ í‹¸ ===\r",
											"const get = (o, path, dflt) => path.split('.').reduce((v,k)=> (v && v[k]!=null ? v[k] : undefined), o) ?? dflt;\r",
											"\r",
											"// === ì¹´íƒˆë¡œê·¸/íƒ€ì´í‹€/í˜ì´ì§€ë„¤ì´ì…˜ ì¶”ì¶œ ===\r",
											"const catalogs = get(j, \"result.analysisCatalogs\", {});\r",
											"const title = get(j, \"result.title\", {});\r",
											"const pr = get(j, \"result.paginationResult\", { contents: [] });\r",
											"const rows = Array.isArray(pr.contents) ? pr.contents : [];\r",
											"\r",
											"// === ì¹´íƒˆë¡œê·¸ ì¡´ì¬ ê²€ì‚¬ ===\r",
											"pm.test(\"Has imageTypeCatalogList\", () => pm.expect(catalogs.imageTypeCatalogList).to.be.an(\"array\"));\r",
											"pm.test(\"Has analysisStatusTypeCatalogList\", () => pm.expect(catalogs.analysisStatusTypeCatalogList).to.be.an(\"array\"));\r",
											"\r",
											"// === í˜„ì¬ ì„ íƒëœ ì´ë¯¸ì§€ íƒ€ì… ì½”ë“œ -> í‘œì‹œëª… ë§¤í•‘ ===\r",
											"// UIê°€ í‘œì‹œëŠ” name, í•„í„° ì „ì†¡ì€ codeë¥¼ ì“°ë¯€ë¡œ ë§¤í•‘ í•„ìš”\r",
											"const curCode = pm.environment.get(\"CURRENT_IMAGE\"); // ì˜ˆ: \"T1\", \"PET_TAU\"...\r",
											"const code2name = {};\r",
											"for (const it of (catalogs.imageTypeCatalogList || [])) {\r",
											"  if (it && it.code) code2name[it.code] = it.name; // ì˜ˆ: \"PET_TAU\" -> \"Tau PET\"\r",
											"}\r",
											"const curName = code2name[curCode] || curCode; // ë§¤í•‘ ì‹¤íŒ¨ ì‹œ code ê·¸ëŒ€ë¡œ\r",
											"\r",
											"pm.test(`Selected image code mapped to name: ${curCode} -> ${curName}`, () => {\r",
											"  pm.expect(curName).to.be.a(\"string\").and.to.have.length.greaterThan(0);\r",
											"});\r",
											"\r",
											"// === ìš”ì•½ ì •ë³´ ë¡œê¹… ===\r",
											"console.log(\"[title]\", JSON.stringify(title));\r",
											"console.log(`[page] page=${pr.pageNumberToResponse} size=${pr.itemCountPerPage} total=${pr.totalItemCount} pages=${pr.totalPageCount}`);\r",
											"console.log(`[rows] count=${rows.length}, filter=imageTypes:[${curCode}] (display:'${curName}')`);\r",
											"\r",
											"// === í–‰ ê²€ì‚¬: ì²« í–‰ í•„ë“œ ì²´í¬ (ìˆìœ¼ë©´) ===\r",
											"if (rows.length > 0) {\r",
											"  const first = rows[0];\r",
											"  pm.test(\"Row has required fields\", () => {\r",
											"    pm.expect(first).to.have.property(\"id\");\r",
											"    pm.expect(first).to.have.property(\"analysisType\");\r",
											"    pm.expect(first).to.have.property(\"analysisStatusType\");\r",
											"    pm.expect(first).to.have.property(\"imageType\");\r",
											"  });\r",
											"}\r",
											"\r",
											"// === í–‰ ê²€ì‚¬: ê° í–‰ì˜ imageType ë¬¸ìì—´ì— í‘œì‹œëª… í¬í•¨ë˜ëŠ”ì§€ í™•ì¸ ===\r",
											"// ì‘ë‹µì˜ imageTypeì€ \"T1,T2-FLAIR,Amyloid PET,...\" ì²˜ëŸ¼ 'í‘œì‹œëª…'ìœ¼ë¡œ ì˜¨ë‹¤.\r",
											"if (rows.length > 0) {\r",
											"  const missing = [];\r",
											"  rows.forEach(r => {\r",
											"    const imgStr = (r.imageType || \"\");\r",
											"    const ok = imgStr.split(\",\").map(s=>s.trim()).includes(curName);\r",
											"    if (!ok) missing.push({ id: r.id, imageType: imgStr });\r",
											"  });\r",
											"\r",
											"  //pm.test(`All rows contain selected image type name '${curName}'`, () => {\r",
											"    // í•„í„°ê°€ ì„œë²„ìª½ì—ì„œ í™•ì‹¤íˆ ì ìš©ë˜ì§€ ì•ŠëŠ” í™˜ê²½ë„ ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ 'ê²½ê³ ' ì„±ê²©ì˜ í…ŒìŠ¤íŠ¸ë¡œ ìš´ìš©í•˜ë ¤ë©´ ì•„ë˜ë¥¼ ì£¼ì„ ì²˜ë¦¬\r",
											"    //pm.expect(missing, `Rows missing '${curName}': ${JSON.stringify(missing)}`).to.have.length(0);\r",
											"  //});\r",
											"\r",
											"  if (missing.length) {\r",
											"    console.warn(\"[warn] rows not matching filter:\", missing);\r",
											"  }\r",
											"} else {\r",
											"  console.log(\"[info] No rows (empty result for selected image type).\");\r",
											"}\r",
											"\r",
											"// === ì‹¤íŒ¨ ë¦¬í¬íŠ¸ UID ìˆìœ¼ë©´ í™˜ê²½ë³€ìˆ˜ë¡œ ì €ì¥(ë””ë²„ê·¸ í¸ì˜) ===\r",
											"const failed = rows.find(r => r.analysisStatusType === \"FAILED\" && r.failReportUid);\r",
											"if (failed) {\r",
											"  pm.environment.set(\"FAIL_REPORT_UID\", failed.failReportUid);\r",
											"  console.log(`[fail] id=${failed.id}, failReportUid=${failed.failReportUid}`);\r",
											"} else {\r",
											"  pm.environment.unset(\"FAIL_REPORT_UID\");\r",
											"}\r",
											"\r",
											"// === ë¶€ê°€: ì²« í–‰ id/name ë¡œê·¸ ===\r",
											"if (rows.length > 0) {\r",
											"  const f = rows[0];\r",
											"  console.log(`[first] id=${f.id}, patient=${f.patientIdentifier}/${f.patientName}, imageType=\"${f.imageType}\"`);\r",
											"}\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{access_token}}",
										"type": "text"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/app/api/analysis/search",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"analysis",
										"search"
									]
								}
							},
							"response": []
						},
						{
							"name": "ë¶„ì„ ëª©ë¡ ì¡°íšŒ_Analysis requested",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"/**\r",
											" * ë¶„ì„ ëª©ë¡ ê²€ìƒ‰: UIì™€ ë™ì¼í•œ payload êµ¬ì¡°\r",
											" * step 0: Last 6 months\r",
											" * step 1: Last 3 months\r",
											" * step 2: Last 1 month\r",
											" * step 3: Custom (End < Start â†’ êµì •)\r",
											" * step 4: Custom (Start > End â†’ êµì •)\r",
											" */\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"pm.request.headers.upsert({ key: \"Accept\", value: \"application/json\" });\r",
											"\r",
											"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
											"\r",
											"// ==== ë‚ ì§œ ìœ í‹¸ ====\r",
											"function fmtYMD(d) {\r",
											"  const y = d.getFullYear();\r",
											"  const m = String(d.getMonth() + 1).padStart(2, \"0\");\r",
											"  const dd = String(d.getDate()).padStart(2, \"0\");\r",
											"  return `${y}-${m}-${dd}`;\r",
											"}\r",
											"function addMonths(base, months) {\r",
											"  const d = new Date(base);\r",
											"  d.setMonth(d.getMonth() + months);\r",
											"  return d;\r",
											"}\r",
											"function addDays(base, days) {\r",
											"  const d = new Date(base);\r",
											"  d.setDate(d.getDate() + days);\r",
											"  return d;\r",
											"}\r",
											"\r",
											"// ==== ë‹¨ê³„ ê³„ì‚° ====\r",
											"let step = Number(pm.environment.get(\"RANGE_STEP\") || 0);\r",
											"step = step % 5;\r",
											"\r",
											"const today = new Date();\r",
											"let startDate, endDate, mode;\r",
											"\r",
											"switch (step) {\r",
											"  case 0:\r",
											"    mode = \"Last 6 months\";\r",
											"    endDate = fmtYMD(today);\r",
											"    startDate = fmtYMD(addMonths(today, -6));\r",
											"    break;\r",
											"  case 1:\r",
											"    mode = \"Last 3 months\";\r",
											"    endDate = fmtYMD(today);\r",
											"    startDate = fmtYMD(addMonths(today, -3));\r",
											"    break;\r",
											"  case 2:\r",
											"    mode = \"Last 1 month\";\r",
											"    endDate = fmtYMD(today);\r",
											"    startDate = fmtYMD(addMonths(today, -1));\r",
											"    break;\r",
											"  case 3:\r",
											"    mode = \"Custom (End < Start)\";\r",
											"    const e3 = addDays(today, -20);\r",
											"    const s3 = addDays(today, -10);\r",
											"    startDate = fmtYMD(e3);\r",
											"    endDate = fmtYMD(e3); // êµì •\r",
											"    break;\r",
											"  case 4:\r",
											"    mode = \"Custom (Start > End)\";\r",
											"    const s4 = addDays(today, +10);\r",
											"    startDate = fmtYMD(today); // êµì •\r",
											"    endDate = fmtYMD(today);\r",
											"    break;\r",
											"}\r",
											"\r",
											"pm.environment.set(\"RANGE_MODE\", mode);\r",
											"pm.environment.set(\"RANGE_START\", startDate);\r",
											"pm.environment.set(\"RANGE_END\", endDate);\r",
											"pm.environment.set(\"RANGE_STEP\", String(step + 1));\r",
											"\r",
											"// ==== UI ë™ì¼ êµ¬ì¡° Payload ====\r",
											"const payload = {\r",
											"  paginationReq: {\r",
											"    requestPageNumber: 1,\r",
											"    itemCountPerPage: 20,\r",
											"    order: \"desc\",\r",
											"    sortBy: \"id\"\r",
											"  },\r",
											"  analysisStatusTypes: null,\r",
											"  analysisTypes: null,\r",
											"  endDate: endDate,\r",
											"  identifier: null,\r",
											"  imageTypes: null,\r",
											"  name: \"\",\r",
											"  sex: null,\r",
											"  startDate: startDate\r",
											"};\r",
											"\r",
											"pm.request.body.update(JSON.stringify(payload, null, 2));\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"const mode = pm.environment.get(\"RANGE_MODE\");\r",
											"const s = pm.environment.get(\"RANGE_START\");\r",
											"const e = pm.environment.get(\"RANGE_END\");\r",
											"\r",
											"pm.test(\"HTTP 2xx\", () => pm.expect(pm.response.code).to.be.within(200, 299));\r",
											"\r",
											"pm.test(`[Analysis Search] Mode=${mode}`, () => {\r",
											"  pm.expect(s).to.match(/^\\d{4}-\\d{2}-\\d{2}$/);\r",
											"  pm.expect(e).to.match(/^\\d{4}-\\d{2}-\\d{2}$/);\r",
											"  console.log(`[Analysis Search] ${mode} | start=${s} ~ end=${e}`);\r",
											"});\r",
											"\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{access_token}}",
										"type": "text"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/app/api/analysis/search",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"analysis",
										"search"
									]
								}
							},
							"response": []
						},
						{
							"name": "ë¶„ì„ ëª©ë¡ ì¡°íšŒ_Reset",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// ==== ê³µí†µ í—¤ë”/í† í° ====\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
											"\r",
											"// ==== ë‚ ì§œ ìœ í‹¸ (KST ê¸°ì¤€ ì§€ë‚œ 6ê°œì›” ê¸°ë³¸) ====\r",
											"function fmtYMD(d){ return d.toISOString().slice(0,10); }\r",
											"function kstNow(){\r",
											"  const now = new Date();\r",
											"  return new Date(now.getTime() + (9*60 - now.getTimezoneOffset())*60000);\r",
											"}\r",
											"const todayKST = kstNow();\r",
											"const defaultEnd = fmtYMD(todayKST);\r",
											"const sixMonthsAgo = new Date(todayKST); sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6);\r",
											"const defaultStart = fmtYMD(sixMonthsAgo);\r",
											"\r",
											"// ì™¸ë¶€ì—ì„œ ê³ ì •í•˜ê³  ì‹¶ìœ¼ë©´ í™˜ê²½ë³€ìˆ˜ë¡œ ì£¼ì…\r",
											"const START_DATE = pm.environment.get(\"ANALYSIS_START_DATE\") || defaultStart;\r",
											"const END_DATE   = pm.environment.get(\"ANALYSIS_END_DATE\")   || defaultEnd;\r",
											"\r",
											"// ==== 1ë‹¨ê³„(In Queue) ë°”ë”” êµ¬ì„± ====\r",
											"const step1Payload = {\r",
											"  paginationReq: { requestPageNumber: 1, itemCountPerPage: 20, order: \"desc\", sortBy: \"id\" },\r",
											"  identifier: \"\",\r",
											"  name: \"\",\r",
											"  sex: null,\r",
											"  startDate: START_DATE,\r",
											"  endDate: END_DATE,\r",
											"  analysisTypes: null,\r",
											"  analysisStatusTypes: [\"IN_QUEUE\",\"UPDATE\"],\r",
											"  imageTypes: null\r",
											"};\r",
											"\r",
											"// ìš”ì²­ ë°”ë”” ì£¼ì…\r",
											"pm.request.body.update(JSON.stringify(step1Payload));\r",
											"\r",
											"// ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì¬ì‚¬ìš©\r",
											"pm.environment.set(\"ANALYSIS_SEARCH_URL\", pm.request.url.toString());\r",
											"pm.environment.set(\"ANALYSIS_START_DATE\", START_DATE);\r",
											"pm.environment.set(\"ANALYSIS_END_DATE\", END_DATE);\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// ===== Pre-request + Tests í†µí•© (í•œ ë²ˆì— ë³µë¶™) =====\r",
											"// Step 1 : Analysis status_In Queue ì„ íƒ\r",
											"// Step 2 : Reset ë²„íŠ¼\r",
											"\r",
											"// ==== ê³µí†µ í—¤ë”/í† í° ====\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
											"\r",
											"// ==== ë‚ ì§œ ìœ í‹¸ (KST ê¸°ì¤€ ì§€ë‚œ 6ê°œì›” ê¸°ë³¸) ====\r",
											"function fmtYMD(d){ return d.toISOString().slice(0,10); }\r",
											"function kstNow(){\r",
											"  const now = new Date();\r",
											"  return new Date(now.getTime() + (9*60 - now.getTimezoneOffset())*60000);\r",
											"}\r",
											"const todayKST = kstNow();\r",
											"const defaultEnd = fmtYMD(todayKST);\r",
											"const sixMonthsAgo = new Date(todayKST); sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6);\r",
											"const defaultStart = fmtYMD(sixMonthsAgo);\r",
											"\r",
											"// ==== ê¸°ê°„ ì„¤ì • ====\r",
											"const START_DATE = pm.environment.get(\"ANALYSIS_START_DATE\") || defaultStart;\r",
											"const END_DATE   = pm.environment.get(\"ANALYSIS_END_DATE\")   || defaultEnd;\r",
											"\r",
											"// ==== 1ë‹¨ê³„(In Queue) ë°”ë”” êµ¬ì„± ====\r",
											"const step1Payload = {\r",
											"  paginationReq: { requestPageNumber: 1, itemCountPerPage: 20, order: \"desc\", sortBy: \"id\" },\r",
											"  identifier: \"\",\r",
											"  name: \"\",\r",
											"  sex: null,\r",
											"  startDate: START_DATE,\r",
											"  endDate: END_DATE,\r",
											"  analysisTypes: null,\r",
											"  analysisStatusTypes: [\"IN_QUEUE\",\"UPDATE\"],\r",
											"  imageTypes: null\r",
											"};\r",
											"\r",
											"// ìš”ì²­ ë°”ë”” ê°±ì‹ \r",
											"pm.request.body.update(JSON.stringify(step1Payload));\r",
											"\r",
											"// ==== 1ë‹¨ê³„ ì‘ë‹µ ì²˜ë¦¬ í›„ Reset ìë™ í˜¸ì¶œ ====\r",
											"pm.test(\"[Step1] HTTP 200\", () => pm.response.to.have.status(200));\r",
											"\r",
											"let j1 = {};\r",
											"try { j1 = pm.response.json(); } catch (e) {\r",
											"  pm.expect.fail(\"[Step1] ì‘ë‹µ JSON íŒŒì‹± ì‹¤íŒ¨: \" + e);\r",
											"}\r",
											"\r",
											"const c1 =\r",
											"  j1?.result?.paginationResult?.contents ||\r",
											"  j1?.paginationResult?.contents ||\r",
											"  [];\r",
											"\r",
											"if (Array.isArray(c1) && c1.length > 0) {\r",
											"  const onlyInQueueOrUpdate = c1.every(it => [\"IN_QUEUE\",\"UPDATE\"].includes(it?.analysisStatusType));\r",
											"  pm.test(\"[Step1] ê²°ê³¼ ìƒíƒœê°€ IN_QUEUE/UPDATEë§Œ í¬í•¨\", () => pm.expect(onlyInQueueOrUpdate).to.be.true);\r",
											"} else {\r",
											"  pm.test(\"[Step1] ê²°ê³¼ 0ê±´(í—ˆìš©)\", () => pm.expect(true).to.be.true);\r",
											"}\r",
											"\r",
											"// ===== 2ë‹¨ê³„: Reset í˜¸ì¶œ =====\r",
											"const rawUrl = pm.request.url.toString();\r",
											"const url = pm.variables.replaceIn(rawUrl);  // â˜… {{baseUrl}} ì¹˜í™˜ í•„ìˆ˜\r",
											"\r",
											"const step2Payload = {\r",
											"  paginationReq: { requestPageNumber: 1, itemCountPerPage: 20, order: \"desc\", sortBy: \"id\" },\r",
											"  identifier: \"\",\r",
											"  name: \"\",\r",
											"  sex: null,\r",
											"  startDate: START_DATE,\r",
											"  endDate: END_DATE,\r",
											"  analysisTypes: null,\r",
											"  analysisStatusTypes: null, // â˜… Reset íš¨ê³¼\r",
											"  imageTypes: null\r",
											"};\r",
											"\r",
											"pm.sendRequest({\r",
											"  url,\r",
											"  method: \"POST\",\r",
											"  header: [\r",
											"    { key: \"Content-Type\", value: \"application/json\" },\r",
											"    ...(token ? [{ key: \"Authorization\", value: `Bearer ${token}` }] : [])\r",
											"  ],\r",
											"  body: { mode: \"raw\", raw: JSON.stringify(step2Payload) }\r",
											"}, (err, res) => {\r",
											"  pm.test(\"[Step2] ìš”ì²­ì´ ì„±ê³µì ìœ¼ë¡œ ìˆ˜í–‰ë¨\", () => pm.expect(err, String(err || \"\")).to.be.null);\r",
											"  if (err) { console.error(\"Step2 error:\", err); return; }\r",
											"\r",
											"  pm.test(\"[Step2] HTTP 200\", () => pm.expect(res.code).to.equal(200));\r",
											"\r",
											"  let j2 = {};\r",
											"  try { j2 = res.json(); } catch (e) {\r",
											"    pm.expect.fail(\"[Step2] ì‘ë‹µ JSON íŒŒì‹± ì‹¤íŒ¨: \" + e);\r",
											"  }\r",
											"\r",
											"  pm.test(\"[Step2] ë³´ë‚¸ ë°”ë””ì˜ analysisStatusTypes == null\", () =>\r",
											"    pm.expect(step2Payload.analysisStatusTypes).to.equal(null)\r",
											"  );\r",
											"\r",
											"  const c2 =\r",
											"    j2?.result?.paginationResult?.contents ||\r",
											"    j2?.paginationResult?.contents ||\r",
											"    [];\r",
											"\r",
											"  if (Array.isArray(c2) && c2.length > 0) {\r",
											"    const allInQueueOrUpdate = c2.every(it => [\"IN_QUEUE\",\"UPDATE\"].includes(it?.analysisStatusType));\r",
											"    pm.test(\"[Step2] Reset í›„ ê²°ê³¼ê°€ í•„í„°ì— ë¬¶ì—¬ìˆì§€ ì•ŠìŒ(ì „ë¶€ IN_QUEUE/UPDATEë©´ ê²½ê³ )\", () =>\r",
											"      pm.expect(allInQueueOrUpdate, \"ë‹¤ì–‘í•œ ìƒíƒœê°€ ë‚˜ì˜¬ ìˆ˜ ìˆìŒ\").to.be.false\r",
											"    );\r",
											"  } else {\r",
											"    pm.test(\"[Step2] ê²°ê³¼ 0ê±´(í—ˆìš©)\", () => pm.expect(true).to.be.true);\r",
											"  }\r",
											"\r",
											"  console.log(\"âœ… [Step1] count:\", Array.isArray(c1) ? c1.length : 0);\r",
											"  console.log(\"âœ… [Step2] count:\", Array.isArray(c2) ? c2.length : 0);\r",
											"});\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{access_token}}",
										"type": "text"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/app/api/analysis/search",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"analysis",
										"search"
									]
								}
							},
							"response": []
						},
						{
							"name": "ë¶„ì„ ì¬ì‹œì‘",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// env â†’ body\r",
											"let idEnv = pm.environment.get(\"analysisId_failed\") || pm.variables.get(\"analysisId_failed\");\r",
											"let idNum = Number(idEnv);\r",
											"const analysisId = Number.isFinite(idNum) ? idNum : (idEnv ? String(idEnv) : null);\r",
											"\r",
											"if (analysisId === null) {\r",
											"  console.warn(\"[/app/api/analysis/restart] analysisId_failed is missing:\", idEnv);\r",
											"}\r",
											"\r",
											"// headers\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key:\"Authorization\", value:`Bearer ${token}` });\r",
											"\r",
											"// body\r",
											"const body = { analysisId: analysisId };\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(body, null, 2));\r",
											"\r",
											"console.log(\"[POST /app/api/analysis/restart] body =\", body);\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": ""
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/analysis/restart",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"analysis",
										"restart"
									]
								}
							},
							"response": []
						},
						{
							"name": "ë¶„ì„ ëª©ë¡ ì¡°íšŒ(1)",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"pm.test(\"sleep 1s\", function (done) {\r",
											"    const SLEEP_MS = 1000;\r",
											"    console.log(`[sleep] waiting ${SLEEP_MS}ms...`);\r",
											"    setTimeout(done, SLEEP_MS);\r",
											"});\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === 1) ì‘ë‹µ íŒŒì‹± & ê¸°ë³¸ í™•ì¸ ===\r",
											"let j = {};\r",
											"try { j = pm.response.json(); } catch (e) {\r",
											"  pm.environment.unset(\"analysis_inqueue\");\r",
											"  console.error(\"[analysis/search] JSON parse failed:\", e);\r",
											"  pm.test(\"HTTP 2xx\", () => pm.expect(pm.response.code).to.be.within(200,299));\r",
											"  return;\r",
											"}\r",
											"\r",
											"pm.test(\"HTTP 2xx\", () => pm.expect(pm.response.code).to.be.within(200,299));\r",
											"if (typeof j?.code !== \"undefined\") {\r",
											"  pm.test(\"service code === 200\", () => pm.expect(j.code).to.eql(200));\r",
											"}\r",
											"\r",
											"// === 2) ëª©ë¡ ì¶”ì¶œ ===\r",
											"const contents = Array.isArray(j?.result?.paginationResult?.contents)\r",
											"  ? j.result.paginationResult.contents\r",
											"  : [];\r",
											"\r",
											"// === 3) IN_QUEUE í•­ëª© í•„í„°ë§ ===\r",
											"// ì‘ë‹µì— ë‚˜ì˜¨ ìˆœì„œ ê·¸ëŒ€ë¡œ ë‘ê³ , ì²« ë²ˆì§¸ IN_QUEUEë¥¼ ì„ íƒ\r",
											"const inQueueItems = contents.filter(it => String(it?.analysisStatusType).toUpperCase() === \"IN_PROGRESS\" || \"IN_QUEUE\");\r",
											"\r",
											"// === 4) ì„ íƒ/ì €ì¥ ===\r",
											"const chosen = inQueueItems[0] || null;\r",
											"\r",
											"if (chosen && chosen.id !== undefined && chosen.id !== null) {\r",
											"  pm.environment.set(\"analysis_inqueue\", String(chosen.id));\r",
											"  // (ì„ íƒ) ë¶€ê°€ì •ë³´ë„ ì €ì¥í•´ë‘ë©´ í¸ë¦¬\r",
											"  if (chosen.analysisType) pm.environment.set(\"analysisType_inqueue\", String(chosen.analysisType));\r",
											"  console.log(`[analysis/search] IN_QUEUE picked -> id=${chosen.id}, type=${chosen.analysisType || \"-\"}`);\r",
											"  pm.test(\"IN_QUEUE item found and stored\", () => pm.expect(true).to.eql(true));\r",
											"} else {\r",
											"  pm.environment.unset(\"analysis_inqueue\");\r",
											"  console.warn(\"[analysis/search] No IN_QUEUE item found.\", { total: contents.length });\r",
											"  pm.test(\"IN_QUEUE item exists\", () => pm.expect(inQueueItems.length, \"No IN_QUEUE items\").to.be.above(0));\r",
											"}\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n  \"paginationReq\": {\r\n    \"requestPageNumber\": 1,\r\n    \"itemCountPerPage\": 20,\r\n    \"order\": \"DESC\",\r\n    \"sortBy\": \"id\"\r\n},\r\n  \"identifier\": \"\",\r\n  \"name\": \"\",\r\n  \"sex\": null,\r\n  \"startDate\": null,\r\n  \"endDate\": null,\r\n  \"analysisTypes\": null,\r\n  \"analysisStatusTypes\": null,\r\n  \"imageTypes\": null\r\n}\r\n"
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/analysis/search",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"analysis",
										"search"
									]
								}
							},
							"response": []
						},
						{
							"name": "ë¶„ì„ ì·¨ì†Œ",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"\r",
											"// === env -> body ===\r",
											"let idEnv = pm.environment.get(\"analysis_inqueue\") || pm.variables.get(\"analysis_inqueue\");\r",
											"let idNum = Number(idEnv);\r",
											"const analysisId = Number.isFinite(idNum) ? idNum : (idEnv ? String(idEnv) : null);\r",
											"\r",
											"if (analysisId === null) {\r",
											"  console.warn(\"[/app/api/analysis/cancel] analysis_inqueue is missing or invalid:\", idEnv);\r",
											"}\r",
											"\r",
											"// body\r",
											"const body = { analysisId };\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(body, null, 2));\r",
											"\r",
											"console.log(\"[POST /app/api/analysis/cancel] body =\", body);\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": ""
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/analysis/cancel",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"analysis",
										"cancel"
									]
								}
							},
							"response": []
						},
						{
							"name": "ë¶„ì„ ë‚´ì—­ ì‚­ì œ",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"let shouldClear = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"try {\r",
											"  pm.test(\"HTTP 2xx\", () => pm.expect(pm.response.code).to.be.within(200,299));\r",
											"  let j={}; try{ j = pm.response.json(); }catch(_) {}\r",
											"  if (typeof j?.code !== \"undefined\") {\r",
											"    shouldClear = shouldClear && (j.code === 200);\r",
											"  }\r",
											"} finally {\r",
											"  if (shouldClear) {\r",
											"    pm.environment.unset(\"analysis_inqueue\");\r",
											"    console.log(\"[/app/api/analysis/cancel] cleared env: analysis_inqueue\");\r",
											"  }\r",
											"}\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "DELETE",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": ""
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/analysis/{{analysis_inqueue}}",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"analysis",
										"{{analysis_inqueue}}"
									]
								}
							},
							"response": []
						}
					]
				},
				{
					"name": "Integrated analysis",
					"item": [
						{
							"name": "ë¶„ì„ íƒ€ì… í‘œì‹œ ì—¬ë¶€ ë° ë¶„ì„ ì •ë³´ ì¡°íšŒ",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"patientId\" : {{PATIENT_ID}}\r\n}"
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/analysis/integrated",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"analysis",
										"integrated"
									]
								}
							},
							"response": []
						},
						{
							"name": "í™˜ì ë³„ ë¶„ì„ ëª©ë¡ ì¡°íšŒ(2)",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"const id = pm.environment.get(\"TARGET_IDENTIFIER\") || \"\"; // ì—†ìœ¼ë©´ ì „ì²´ê²€ìƒ‰\r",
											"const body = {\r",
											"  identifier: id,\r",
											"  name: \"\",\r",
											"  sex: null,\r",
											"  startDate: null,\r",
											"  endDate: null,\r",
											"  paginationReq: {\r",
											"    requestPageNumber: 1,\r",
											"    itemCountPerPage: 20,\r",
											"    order: \"desc\",\r",
											"    sortBy: \"\"\r",
											"  },\r",
											"  isSortById: false\r",
											"};\r",
											"\r",
											"// Content-Type ë³´ì •\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"// Body ì—…ë°ì´íŠ¸\r",
											"pm.request.body.update(JSON.stringify(body, null, 2));\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === 1) ì‘ë‹µ íŒŒì‹± & ê¸°ë³¸ í™•ì¸ ===\r",
											"let j = {};\r",
											"try { j = pm.response.json(); } catch (e) {\r",
											"  [\"manual_1\",\"manual_2\",\"manual_3\",\"manual_4\"].forEach(k => pm.environment.unset(k));\r",
											"  console.error(\"[patient/{id}/analysis] JSON parse failed:\", e);\r",
											"  pm.test(\"HTTP 2xx\", () => pm.expect(pm.response.code).to.be.within(200,299));\r",
											"  return;\r",
											"}\r",
											"\r",
											"pm.test(\"HTTP 2xx\", () => pm.expect(pm.response.code).to.be.within(200,299));\r",
											"if (typeof j?.code !== \"undefined\") {\r",
											"  pm.test(\"service code === 200\", () => pm.expect(j.code).to.eql(200));\r",
											"}\r",
											"\r",
											"// === 2) ë¦¬ìŠ¤íŠ¸ ì¶”ì¶œ ===\r",
											"const list = Array.isArray(j?.result?.analysisInfoList) ? j.result.analysisInfoList : [];\r",
											"if (!list.length) {\r",
											"  [\"manual_1\",\"manual_2\",\"manual_3\",\"manual_4\"].forEach(k => pm.environment.unset(k));\r",
											"  console.warn(\"[patient/{id}/analysis] analysisInfoList is empty.\");\r",
											"}\r",
											"\r",
											"// === 3) íƒ€ì…ë³„ë¡œ COMPLETED ì²« í•­ëª© id ì €ì¥ ===\r",
											"// ì‘ë‹µ ìˆœì„œ(ë³´í†µ ìµœì‹  ìš°ì„ )ì—ì„œ 'ì²« ë²ˆì§¸' ë§¤ì¹­ì„ ì±„íƒ\r",
											"function pickCompletedId(typeCode) {\r",
											"  const t = String(typeCode).trim().toUpperCase();\r",
											"  for (const it of list) {\r",
											"    const at  = String(it?.analysisType ?? \"\").trim().toUpperCase();\r",
											"    const st  = String(it?.analysisStatusType ?? \"\").trim().toUpperCase();\r",
											"    if (at === t && st === \"COMPLETED\" && it?.id != null) return it.id;\r",
											"  }\r",
											"  return null;\r",
											"}\r",
											"\r",
											"const mapping = {\r",
											"  manual_1: \"BRAIN_VOL\",\r",
											"  manual_2: \"FLAIR_HI\",\r",
											"  manual_3: \"AMYLOID_PET\",\r",
											"  manual_4: \"TAU_PET\"\r",
											"};\r",
											"\r",
											"for (const [envKey, typeCode] of Object.entries(mapping)) {\r",
											"  const id = pickCompletedId(typeCode);\r",
											"  if (id != null) {\r",
											"    pm.environment.set(envKey, String(id));\r",
											"    console.log(`[store] ${envKey} <- ${id} (type=${typeCode})`);\r",
											"  } else {\r",
											"    pm.environment.unset(envKey);\r",
											"    console.warn(`[store] ${envKey} not found (type=${typeCode}, COMPLETED)`);\r",
											"  }\r",
											"}\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/patient/{{PATIENT_ID}}/analysis",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"patient",
										"{{PATIENT_ID}}",
										"analysis"
									]
								}
							},
							"response": []
						},
						{
							"name": "ì¢…í•© ë³´ê³ ì„œ ìƒì„±",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === env -> ids (order: manual_1, manual_2, manual_3, manual_4) ===\r",
											"function toNumOrNull(v){ const n = Number(v); return Number.isFinite(n) ? n : null; }\r",
											"const m1 = pm.environment.get(\"manual_1\");\r",
											"const m2 = pm.environment.get(\"manual_2\");\r",
											"const m3 = pm.environment.get(\"manual_3\");\r",
											"const m4 = pm.environment.get(\"manual_4\");\r",
											"const analysisIds = [m1, m2, m3, m4].map(toNumOrNull).filter(v => v !== null);\r",
											"if (analysisIds.length === 0) {\r",
											"  console.warn(\"[/app/api/analysis/manual] No valid manual_X ids found.\", { m1, m2, m3, m4 });\r",
											"}\r",
											"\r",
											"// === analysisType ì„ íƒ ê·œì¹™ ===\r",
											"const ALLOWED = [\"AD_STAGING\",\"SCREENING\",\"MONITORING\"];\r",
											"\r",
											"// 1) ë‹¨ì¼ ê°’ ìš°ì„ \r",
											"let chosenType = (pm.environment.get(\"ANALYSIS_REPORT\") || \"\").trim().toUpperCase();\r",
											"if (!ALLOWED.includes(chosenType)) chosenType = \"\";\r",
											"\r",
											"// 2) ëª©ë¡ ê¸°ë°˜ ì„ íƒ\r",
											"let listStr = pm.environment.get(\"ANALYSIS_REPORT_LIST\"); // ì˜ˆ: \"AD_STAGING,SCREENING,MONITORING\"\r",
											"let list = (listStr ? listStr.split(\",\") : []).map(s => s.trim().toUpperCase()).filter(Boolean);\r",
											"if (!list.length) list = ALLOWED.slice(); // ê¸°ë³¸ ëª©ë¡\r",
											"list = list.filter(x => ALLOWED.includes(x)); // í—ˆìš©ê°’ë§Œ\r",
											"\r",
											"const mode = (pm.environment.get(\"TYPE_PICK_MODE\") || \"first\").toLowerCase(); // first | round_robin | random\r",
											"if (!chosenType) {\r",
											"  if (mode === \"random\") {\r",
											"    chosenType = list[Math.floor(Math.random()*list.length)];\r",
											"  } else if (mode === \"round_robin\") {\r",
											"    \r",
											"    const cur = Number(pm.environment.get(key) || 0);\r",
											"    const idx = Number.isFinite(cur) ? cur % list.length : 0;\r",
											"    chosenType = list[idx];\r",
											"    pm.environment.set(key, String(idx + 1)); // ë‹¤ìŒ í˜¸ì¶œì„ ìœ„í•´ ì¸ë±ìŠ¤ ì¦ê°€\r",
											"  } else {\r",
											"    // default: first\r",
											"    chosenType = list[0];\r",
											"  }\r",
											"}\r",
											"\r",
											"if (!ALLOWED.includes(chosenType)) {\r",
											"  console.warn(\"[/app/api/analysis/manual] Invalid chosenType, fallback to AD_STAGING:\", chosenType);\r",
											"  chosenType = \"AD_STAGING\";\r",
											"}\r",
											"\r",
											"// === ìµœì¢… body ===\r",
											"const body = {\r",
											"  analysisType: chosenType,   // â† ìœ ì—° ì„ íƒ\r",
											"  analysisIds: analysisIds,   // â† env ê¸°ë°˜\r",
											"  sendPacs: false,\r",
											"  pacsAnalysisId: null\r",
											"};\r",
											"\r",
											"// inject body\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(body, null, 2));\r",
											"\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": ""
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/analysis/manual",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"analysis",
										"manual"
									]
								}
							},
							"response": []
						},
						{
							"name": "ë¶„ì„ ëª©ë¡ ì¡°íšŒ (2)",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === 1) ì‘ë‹µ íŒŒì‹± & ê¸°ë³¸ í™•ì¸ ===\r",
											"let j = {};\r",
											"try { j = pm.response.json(); } catch (e) {\r",
											"  pm.environment.unset(\"analysisId_failed\");\r",
											"  pm.environment.unset(\"analysisType_failed\");\r",
											"  pm.environment.unset(\"FAIL_REPORT_UID\");\r",
											"  pm.environment.unset(\"latest_delete\");\r",
											"  console.error(\"[analysis/search] JSON parse failed:\", e);\r",
											"  pm.test(\"HTTP 2xx\", () => pm.expect(pm.response.code).to.be.within(200,299));\r",
											"  return;\r",
											"}\r",
											"\r",
											"pm.test(\"HTTP 2xx\", () => pm.expect(pm.response.code).to.be.within(200,299));\r",
											"if (typeof j?.code !== \"undefined\") {\r",
											"  pm.test(\"service code === 200\", () => pm.expect(j.code).to.eql(200));\r",
											"}\r",
											"\r",
											"// === ìœ í‹¸ ===\r",
											"const asU = v => String(v ?? \"\").trim().toUpperCase();\r",
											"const filterType = (pm.environment.get(\"FILTER_FAILED_TYPE\") || \"\").trim(); // e.g. \"TAU_PET\"\r",
											"\r",
											"// === í˜„ì¬ í˜ì´ì§€ ë°ì´í„° ===\r",
											"const pageInfo  = j?.result?.paginationResult || {};\r",
											"const contents  = Array.isArray(pageInfo?.contents) ? pageInfo.contents : [];\r",
											"\r",
											"// 1) ì²« ë²ˆì§¸ í•­ëª© id -> latest_delete ì €ì¥(ìƒíƒœ ë¬´ê´€)\r",
											"const firstId = contents?.[0]?.id;\r",
											"if (firstId != null) {\r",
											"  pm.environment.set(\"latest_delete\", String(firstId));\r",
											"  console.log(`[analysis/search] latest_delete set -> ${firstId}`);\r",
											"} else {\r",
											"  pm.environment.unset(\"latest_delete\");\r",
											"  console.warn(\"[analysis/search] contents[0].id not found; latest_delete unset\");\r",
											"}\r",
											"\r",
											"// 2) FAILED/CANCELED(CANCELD í¬í•¨) ì¤‘ ì²« í•­ëª©ë§Œ í˜„ì¬ í˜ì´ì§€ì—ì„œ ì„ íƒ\r",
											"(function pickFailedOnThisPage() {\r",
											"  let failedItems = contents.filter(it => [\"FAILED\",\"CANCELED\",\"CANCELD\"].includes(asU(it?.analysisStatusType)));\r",
											"  if (filterType) {\r",
											"    failedItems = failedItems.filter(it => asU(it?.analysisType) === asU(filterType));\r",
											"  }\r",
											"  const chosen = failedItems[0];\r",
											"  if (chosen && chosen.id != null) {\r",
											"    pm.environment.set(\"analysisId_failed\", String(chosen.id));\r",
											"    pm.environment.set(\"analysisType_failed\", String(chosen.analysisType || \"\"));\r",
											"    if (chosen.failReportUid) pm.environment.set(\"FAIL_REPORT_UID\", String(chosen.failReportUid));\r",
											"    console.log(`[analysis/search] FOUND on current page -> id=${chosen.id}, type=${chosen.analysisType}, status=${chosen.analysisStatusType}`);\r",
											"  } else {\r",
											"    // í•„ìš”ì‹œ ì‹¤íŒ¨ë¡œ ì²˜ë¦¬í•˜ê±°ë‚˜, ê·¸ëƒ¥ ìŠ¤í‚µ ë¡œê·¸ë§Œ ë‚¨ê¸¸ì§€ ì„ íƒ\r",
											"    // pm.test(\"FAILED/CANCELED item exists on current page\", () => pm.expect.fail(\"Not found on current page\"));\r",
											"    pm.environment.unset(\"analysisId_failed\");\r",
											"    pm.environment.unset(\"analysisType_failed\");\r",
											"    pm.environment.unset(\"FAIL_REPORT_UID\");\r",
											"    console.log(\"[analysis/search] no FAILED/CANCELED on current page (skipped)\");\r",
											"  }\r",
											"})();\r",
											"\r",
											"// === ì§‘ê³„ IIFE (ê¸°ì¡´ ê·¸ëŒ€ë¡œ ìœ ì§€) ===\r",
											"// ... (ë„¤ê°€ ì“°ë˜ ì§‘ê³„ ì½”ë“œ ê·¸ëŒ€ë¡œ)\r",
											"\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n  \"paginationReq\": {\r\n    \"requestPageNumber\": 1,\r\n    \"itemCountPerPage\": 20,\r\n    \"order\": \"DESC\",\r\n    \"sortBy\": \"id\"\r\n},\r\n  \"identifier\": \"\",\r\n  \"name\": \"\",\r\n  \"sex\": null,\r\n  \"startDate\": null,\r\n  \"endDate\": null,\r\n  \"analysisTypes\": null,\r\n  \"analysisStatusTypes\": null,\r\n  \"imageTypes\": null\r\n}\r\n"
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/analysis/search",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"analysis",
										"search"
									]
								}
							},
							"response": []
						}
					]
				}
			]
		},
		{
			"name": "user_Series",
			"item": [
				{
					"name": "í™˜ì ëª©ë¡ ì¡°íšŒ_PATIENT ID ì €ì¥",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"const id = pm.environment.get(\"TARGET_IDENTIFIER\") || \"\"; // ì—†ìœ¼ë©´ ì „ì²´ê²€ìƒ‰\r",
									"const body = {\r",
									"  identifier: id,\r",
									"  name: \"\",\r",
									"  sex: null,\r",
									"  startDate: null,\r",
									"  endDate: null,\r",
									"  paginationReq: {\r",
									"    requestPageNumber: 1,\r",
									"    itemCountPerPage: 20,\r",
									"    order: \"desc\",\r",
									"    sortBy: \"\"\r",
									"  },\r",
									"  isSortById: false\r",
									"};\r",
									"\r",
									"// Content-Type ë³´ì •\r",
									"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
									"// Body ì—…ë°ì´íŠ¸\r",
									"pm.request.body.update(JSON.stringify(body, null, 2));"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// === 1) JSON íŒŒì‹± ===\r",
									"let json;\r",
									"try {\r",
									"  json = pm.response.json();\r",
									"} catch (e) {\r",
									"  pm.environment.unset(\"PATIENT_ID\");\r",
									"  console.error(\"ì‘ë‹µì´ JSONì´ ì•„ë‹˜:\", e);\r",
									"  return;\r",
									"}\r",
									"\r",
									"// === 2) contents ë°°ì—´ ì¶”ì¶œ ===\r",
									"let contents = [];\r",
									"try {\r",
									"  if (json && json.result && json.result.patientInfos && Array.isArray(json.result.patientInfos.contents)) {\r",
									"    contents = json.result.patientInfos.contents;\r",
									"  }\r",
									"} catch (_) {}\r",
									"\r",
									"// === 3) íƒ€ê¹ƒ identifier ê²°ì •\r",
									"// ìš°ì„ ìˆœìœ„: í™˜ê²½ë³€ìˆ˜ TARGET_IDENTIFIER > ìš”ì²­ bodyì˜ identifier(ë¹„ì–´ìˆì§€ ì•Šìœ¼ë©´) > \"sample_1\"\r",
									"let targetIdentifier = pm.environment.get(\"TARGET_IDENTIFIER\");\r",
									"if (!targetIdentifier) {\r",
									"  try {\r",
									"    const raw = pm.request.body && pm.request.body.raw ? pm.request.body.raw : \"{}\";\r",
									"    const body = JSON.parse(raw);\r",
									"    if (body && body.identifier) targetIdentifier = body.identifier;\r",
									"  } catch (_) {}\r",
									"}\r",
									"if (!targetIdentifier) targetIdentifier = \"sample_1\";\r",
									"\r",
									"// === 4) ë§¤ì¹­ ì°¾ê¸°\r",
									"const match = contents.find(o => o && o.identifier === targetIdentifier);\r",
									"\r",
									"// === 5) í™˜ê²½ë³€ìˆ˜ ì„¤ì • (ì½”ë“œ 200 + ë§¤ì¹­ ìˆì„ ë•Œë§Œ)\r",
									"if (json && json.code === 200 && match && match.id != null) {\r",
									"  pm.environment.set(\"PATIENT_ID\", String(match.id));\r",
									"  console.log(\"PATIENT_ID set to\", match.id);\r",
									"} else {\r",
									"  pm.environment.unset(\"PATIENT_ID\");\r",
									"  console.warn(\r",
									"    \"PATIENT_ID not set. ì´ìœ :\",\r",
									"    { code: json && json.code, targetIdentifier, identifiers: contents.map(x => x && x.identifier) }\r",
									"  );\r",
									"}\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "{{access_token}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/app/api/patient/search",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"patient",
								"search"
							]
						}
					},
					"response": []
				},
				{
					"name": "ì´ë¯¸ì§€ ìƒì„¸ ì •ë³´ ì¡°íšŒ",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"/**\r",
									" * ëª©ì :\r",
									" *  - sample_1ì˜ patientì—ì„œ \"T2-FLAIR\"ë§Œ ê³¨ë¼ ìµœì‹  1ê±´ì˜ idë¥¼ SERIES_INFO_IDì— ì €ì¥(ìƒì„¸ ì¡°íšŒìš©)\r",
									" *  - ë™ì‹œì— \"T2-FLAIRê°€ ì•„ë‹Œ\" ì‹œë¦¬ì¦ˆ ì¤‘ 1ê±´ì„ ê³¨ë¼ SERIES_DELETE_IDì— ì €ì¥(ì‚­ì œìš©)\r",
									" *  - Send ëˆ„ë¥¼ ë•Œë§ˆë‹¤ SERIES_DELETE_IDì—ëŠ” T2_FLAIRì„ ì œì™¸í•œ ë‚˜ë¨¸ì§€ IDì¤‘ì— í•˜ë‚˜ ëœë¤ ì„ íƒ\r",
									" *\r",
									" * ì˜µì…˜:\r",
									" *  - MANUAL_LOCK=true  : í™˜ê²½ë³€ìˆ˜ SERIES_INFO_IDê°€ ìˆìœ¼ë©´ ê·¸ ê°’ ê³ ì • ì‚¬ìš©(ì„ íƒ ìŠ¤í‚µ). (SERIES_DELETE_IDë„ ì ê·¸ë ¤ë©´ ë³„ë„ ê´€ë¦¬ ê¶Œì¥)\r",
									" *  - SERIES_STATUS_QS  : ê¸°ë³¸ \"analyzed,unanalyzed\"\r",
									" *  - REQUIRE_STATUS    : \"Analyzed\" ë˜ëŠ” \"Unanalyzed\" (ì„ íƒ)\r",
									" *  - PICK_MODE         : \"latest\"(ê¸°ë³¸) | \"first\"  // í›„ë³´ ì¤‘ ì„ íƒ ë°©ì‹\r",
									" */\r",
									"\r",
									"(() => {\r",
									"  // === Namespaced config ===\r",
									"  const NS = \"SERIES_PICK\"; // log prefix\r",
									"\r",
									"  // === Env ===\r",
									"  const BASE_URL   = pm.environment.get(\"baseUrl\") || \"\";\r",
									"  const TOKEN      = pm.environment.get(\"access_token\");\r",
									"  const PATIENT_ID = pm.environment.get(\"PATIENT_ID\");\r",
									"  if (!TOKEN)      throw new Error(\"access_token ì´ ì—†ìŠµë‹ˆë‹¤.\");\r",
									"  if (!PATIENT_ID) throw new Error(\"patient_id ê°€ ì—†ìŠµë‹ˆë‹¤.\");\r",
									"\r",
									"  // ë§¤ ì‹¤í–‰ë§ˆë‹¤ ì¬ì„ íƒ\r",
									"  pm.environment.unset(\"SERIES_DELETE_ID\");\r",
									"\r",
									"  // === Options ===\r",
									"  const STATUS_QS     = (pm.environment.get(\"SERIES_STATUS_QS\") || \"analyzed,unanalyzed\").trim();\r",
									"  const REQUIRE_STAT  = (pm.environment.get(\"REQUIRE_STATUS\") || \"\").trim();\r",
									"  const EXCLUDE_RAW   = (pm.environment.get(\"EXCLUDE_IDS\") || \"\").trim();\r",
									"  const EXCLUDE_SET   = new Set(EXCLUDE_RAW ? EXCLUDE_RAW.split(\",\").map(s => String(s).trim()).filter(Boolean) : []);\r",
									"\r",
									"  // === Utils ===\r",
									"  const norm = (s) => String(s||\"\").toLowerCase().replace(/[^a-z0-9]/g,\"\");\r",
									"  const isT2Flair = (v) => norm(v) === \"t2flair\";\r",
									"  const byStatus = (row) => !REQUIRE_STAT || String(row?.status||\"\").toLowerCase() === REQUIRE_STAT.toLowerCase();\r",
									"\r",
									"  // === Fetch list ===\r",
									"  const url = `${BASE_URL}/app/api/patient/${encodeURIComponent(String(PATIENT_ID))}/series?status=${encodeURIComponent(STATUS_QS)}`;\r",
									"  pm.sendRequest({\r",
									"    url,\r",
									"    method: \"GET\",\r",
									"    header: { \"Authorization\": pm.variables.replaceIn(\"Bearer {{access_token}}\") }\r",
									"  }, (err, res) => {\r",
									"    if (err) throw new Error(`[patient/{id}/series] ìš”ì²­ ì‹¤íŒ¨: ${err.message}`);\r",
									"    if (res.code !== 200) throw new Error(`[patient/{id}/series] HTTP ${res.code} ${res.text()}`);\r",
									"\r",
									"    let j={}; try{ j = res.json(); }catch(_){}\r",
									"    const list = Array.isArray(j?.result?.imageList) ? j.result.imageList : [];\r",
									"    if (!list.length) throw new Error(\"imageList ê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.\");\r",
									"\r",
									"    // 1) T2-FLAIR ìµœì‹  1ê±´ â†’ SERIES_INFO_ID\r",
									"    let flair = list.filter(r=>{\r",
									"      if(!r) return false;\r",
									"      const ok = isT2Flair(r.imageType)||isT2Flair(r.seriesDesc)||isT2Flair(r.seriesDescription);\r",
									"      return ok && byStatus(r);\r",
									"    });\r",
									"    if(!flair.length) throw new Error(\"T2-FLAIR ì‹œë¦¬ì¦ˆë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\");\r",
									"    flair.sort((a,b)=> new Date(b.uploadDate||0) - new Date(a.uploadDate||0));\r",
									"    const chosenFlair = flair[0];\r",
									"    const flairId = chosenFlair?.id ?? chosenFlair?.seriesId ?? chosenFlair?.seriesNo;\r",
									"    if (flairId == null) throw new Error(\"T2-FLAIRì—ì„œ id ì¶”ì¶œ ì‹¤íŒ¨\");\r",
									"    pm.environment.set(\"SERIES_INFO_ID\", String(flairId));\r",
									"    pm.variables.set(\"SERIES_INFO_ID\", String(flairId));\r",
									"\r",
									"    // 2) ë¹„(T2-FLAIR) ëœë¤ 1ê±´ â†’ SERIES_DELETE_ID\r",
									"    const nonFlair = list\r",
									"      .map(r => ({ r, id: r?.id ?? r?.seriesId ?? r?.seriesNo }))\r",
									"      .filter(x=>{\r",
									"        if(x.id == null) return false;\r",
									"        if(String(x.id) === String(flairId)) return false;\r",
									"        const isFlairType = isT2Flair(x.r?.imageType) || isT2Flair(x.r?.seriesDesc) || isT2Flair(x.r?.seriesDescription);\r",
									"        if(isFlairType) return false;\r",
									"        if(!byStatus(x.r)) return false;\r",
									"        if(EXCLUDE_SET.has(String(x.id))) return false;\r",
									"        return true;\r",
									"      });\r",
									"\r",
									"    if(!nonFlair.length) throw new Error(\"ì‚­ì œ í›„ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. (T2-FLAIR ì™¸ ì‹œë¦¬ì¦ˆê°€ ì—†ìŒ ë˜ëŠ” ëª¨ë‘ ì œì™¸ë¨)\");\r",
									"\r",
									"    const idx = Math.floor(Math.random() * nonFlair.length);\r",
									"    const delId = nonFlair[idx].id;\r",
									"\r",
									"    pm.environment.set(\"SERIES_DELETE_ID\", String(delId));\r",
									"    pm.variables.set(\"SERIES_DELETE_ID\", String(delId));\r",
									"\r",
									"    console.log(`[${NS}] PICKED T2-FLAIR (info)`, {\r",
									"      id: String(flairId),\r",
									"      type: chosenFlair?.imageType,\r",
									"      status: chosenFlair?.status,\r",
									"      uploadDate: chosenFlair?.uploadDate\r",
									"    });\r",
									"    console.log(`[${NS}] PICKED NON T2-FLAIR (delete, random)`, {\r",
									"      id: String(delId),\r",
									"      type: nonFlair[idx].r?.imageType,\r",
									"      status: nonFlair[idx].r?.status,\r",
									"      uploadDate: nonFlair[idx].r?.uploadDate\r",
									"    });\r",
									"  });\r",
									"})();"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"HTTP 200\", () => pm.response.to.have.status(200));\r",
									"\r",
									"let j={}; try{ j=pm.response.json(); }catch(_){}\r",
									"pm.test(\"ì„œë¹„ìŠ¤ code == 200\", () => pm.expect(j?.code ?? 200).to.eql(200));\r",
									"\r",
									"const r=j?.result||{};\r",
									"function norm(s){ return String(s||\"\").toLowerCase().replace(/[^a-z0-9]/g,\"\"); }\r",
									"\r",
									"pm.test(\"Image information_T2-FLAIR\", () => {\r",
									"  const t = r.imageType || r.seriesDescription || \"\";\r",
									"  pm.expect(norm(t)).to.eql(\"t2flair\");\r",
									"});\r",
									"\r",
									"console.log(\"[SERIES INFO - T2-FLAIR]\", {\r",
									"  SERIES_INFO_ID: pm.environment.get(\"SERIES_INFO_ID\"),\r",
									"  imageType: r.imageType,\r",
									"  seriesDescription: r.seriesDescription,\r",
									"  studyId: r.studyId,\r",
									"  noOfImages: r.noOfImages\r",
									"});\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/app/api/series/info/{{SERIES_INFO_ID}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"series",
								"info",
								"{{SERIES_INFO_ID}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "ì´ë¯¸ì§€ ì¡°ì‘ ê¶Œí•œ ìœ ë¬´",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// --- Authorization & headers ---\r",
									"const token = pm.environment.get(\"access_token\");\r",
									"if (!token) pm.expect.fail(\"access_token ì´ ì—†ìŠµë‹ˆë‹¤.\");\r",
									"pm.request.headers.upsert({ key: \"Authorization\", value: \"Bearer \" + token });\r",
									"pm.request.headers.upsert({ key: \"Accept\", value: \"application/json\" });\r",
									"\r",
									"// --- URL ë IDë¥¼ ENVë¡œ ì¹˜í™˜ (ìˆ«ì/ë¬¸ì/UUID ëª¨ë‘) ---\r",
									"const sid = pm.environment.get(\"SERIES_INFO_ID\");\r",
									"if (!sid) pm.expect.fail(\"SERIES_INFO_ID ê°€ ì—†ìŠµë‹ˆë‹¤. (ì´ì „ ë‹¨ê³„ì—ì„œ T2-FLAIR ì„ íƒ í•„ìš”)\");\r",
									"pm.request.url = pm.request.url.toString().replace(/(\\/permission\\/)([^/]+)(?=\\/?$)/, `$1${sid}`);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// 1) ê¸°ë³¸ HTTP/ì„œë¹„ìŠ¤ ì½”ë“œ\r",
									"pm.test(\"Verify that HTTP status is 200\", () => pm.response.to.have.status(200));\r",
									"let body={}; try{ body=pm.response.json(); }catch(_){}\r",
									"pm.test(\"Verify that service code is 200\", () => pm.expect(body?.code ?? 200).to.eql(200));\r",
									"\r",
									"// 2) ê¶Œí•œ íŒì •(ì—¬ëŸ¬ ìŠ¤í‚¤ë§ˆ ì§€ì› + í•©ë¦¬ì  í´ë°±)\r",
									"// helper\r",
									"const toBool = v => (typeof v === \"boolean\") ? v : undefined;\r",
									"\r",
									"const r = body?.result ?? body ?? {};\r",
									"let allowed;\r",
									"\r",
									"// (A) result ìì²´ê°€ boolean\r",
									"if (typeof (body?.result) === \"boolean\") allowed = body.result;\r",
									"// (B) ìµœìƒìœ„/ì¤‘ì²© í‚¤ë“¤ì—ì„œ boolean ì°¾ê¸°\r",
									"if (allowed === undefined) {\r",
									"  const candidates = [\r",
									"    r.allowed, r.allow, r.isAllowed, r.permitted, r.permission, r.hasPermission,\r",
									"    r.canModify, r.canEdit, r.canAnalyze, r.manipulable, r.editable, r.canDelete, r.canAnnotate, r.canRun,\r",
									"    r?.permission?.allowed, r?.permission?.modify, r?.permission?.edit, r?.permission?.analyze\r",
									"  ].map(toBool).filter(v => v !== undefined);\r",
									"  // í•˜ë‚˜ë¼ë„ trueë©´ í—ˆìš©, ì „ë¶€ falseë©´ ë¶ˆí—ˆ, ì—†ìœ¼ë©´ undefined ìœ ì§€\r",
									"  if (candidates.length) allowed = candidates.some(Boolean);\r",
									"}\r",
									"\r",
									"// (C) ë°”ë””ê°€ ë¹„ì–´ìˆê±°ë‚˜ í‚¤ê°€ ì „í˜€ ì—†ì§€ë§Œ HTTP 200/204ì¸ ê²½ìš°:\r",
									"// ë§ì€ ê¶Œí•œì²´í¬ APIê°€ 4xx(401/403)ë§Œ 'ë¶ˆí—ˆ'ë¡œ ì£¼ê³ , ì„±ê³µì´ë©´ ë°”ë”” ì—†ì´ 200/204ë¡œ ëëƒ„.\r",
									"if (allowed === undefined) {\r",
									"  const code = pm.response.code;\r",
									"  if (code === 200 || code === 204) allowed = true;\r",
									"}\r",
									"\r",
									"// (D) ê·¸ë˜ë„ ê²°ì • ëª»í•˜ë©´ ë§ˆì§€ë§‰ í´ë°±: 401/403 => DENY, ê·¸ ì™¸ => ALLOW\r",
									"if (allowed === undefined) {\r",
									"  allowed = !(pm.response.code === 401 || pm.response.code === 403);\r",
									"}\r",
									"\r",
									"// 3) ì‹¤íŒ¨ë¡œ ì²˜ë¦¬í•˜ì§€ ì•Šê³  ê²°ê³¼ë¥¼ ì €ì¥/í‘œì‹œ\r",
									"pm.environment.set(\"ANALYSIS_PERMISSION_BOOL\", String(Boolean(allowed)));\r",
									"pm.environment.set(\"ANALYSIS_PERMISSION\", allowed ? \"ALLOW\" : \"DENY\");\r",
									"\r",
									"// 4) ì•ˆë‚´ì„± í…ŒìŠ¤íŠ¸(í•­ìƒ í†µê³¼, ê°’ì€ ë¡œê·¸/ë¹„ì£¼ì–¼ë¼ì´ì €ë¡œ í™•ì¸)\r",
									"pm.test(`Manipulation permission (T2-FLAIR): ${allowed ? 'ALLOW' : 'DENY'}`, () => pm.expect(true).to.be.true);\r",
									"\r",
									"// 5) ë¡œê·¸ & ë¹„ì£¼ì–¼ë¼ì´ì €\r",
									"console.log(\"[Permission Check][T2-FLAIR]\", {\r",
									"  SERIES_INFO_ID: pm.environment.get(\"SERIES_INFO_ID\"),\r",
									"  http: pm.response.code,\r",
									"  rawBody: body,\r",
									"  inferredAllowed: allowed\r",
									"});\r",
									"\r",
									"pm.visualizer.set(`\r",
									"  <style>body{font-family:ui-sans-serif} .ok{color:#16a34a} .no{color:#dc2626}</style>\r",
									"  <h3>Analysis Permission (T2-FLAIR)</h3>\r",
									"  <p><b>ID:</b> {{sid}}</p>\r",
									"  <p><b>Result:</b> <span class=\"{{allowed ? 'ok':'no'}}\">{{allowed ? 'ALLOW' : 'DENY'}}</span></p>\r",
									"  <pre>{{json}}</pre>\r",
									"`, { sid: pm.environment.get(\"SERIES_INFO_ID\"), allowed, json: JSON.stringify(body, null, 2) });\r",
									"\r",
									"// --- Show modal copy in Test Results (safe with fallbacks) ---\r",
									"const sidForModal =\r",
									"  pm.variables.get(\"MODAL_CONTEXT_ID\") ||\r",
									"  pm.environment.get(\"SERIES_INFO_ID\") ||\r",
									"  \"(no id)\";\r",
									"\r",
									"const modalTextForModal =\r",
									"  pm.variables.get(\"MODAL_TEXT_EN\") ||\r",
									"  \"Do you want to delete the selected item?\";\r",
									"\r",
									"pm.test(`[Modal] ${modalTextForModal} | ID: ${sidForModal}`, () => {\r",
									"  pm.expect(true).to.be.true;\r",
									"});\r",
									"\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/app/api/analysis/permission/{{SERIES_INFO_ID}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"analysis",
								"permission",
								"{{SERIES_INFO_ID}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "ë² ì´ìŠ¤ë¼ì¸ ì„¤ì • ìœ íš¨ì„± í™•ì¸",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// --- headers ---\r",
									"const token = pm.environment.get(\"access_token\");\r",
									"if (!token) pm.expect.fail(\"access_token ì´ ì—†ìŠµë‹ˆë‹¤.\");\r",
									"pm.request.headers.upsert({ key: \"Authorization\", value: \"Bearer \" + token });\r",
									"pm.request.headers.upsert({ key: \"Accept\", value: \"application/json\" });\r",
									"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
									"\r",
									"// --- env -> id ìˆ«ì ë³€í™˜ (í•˜ë“œì½”ë”© ë°©ì§€) ---\r",
									"const sidRaw = pm.environment.get(\"SERIES_INFO_ID\");\r",
									"if (!sidRaw) pm.expect.fail(\"SERIES_INFO_ID ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € 'Pick T2-FLAIR' ìš”ì²­ì„ ì‹¤í–‰í•˜ì„¸ìš”.\");\r",
									"const idNum = Number(sidRaw);\r",
									"if (Number.isNaN(idNum)) pm.expect.fail(`SERIES_INFO_IDê°€ ìˆ«ìê°€ ì•„ë‹˜: ${sidRaw}`);\r",
									"\r",
									"// (ê¶Œì¥) í˜„ì¬ patient_idì™€ ì‹œë¦¬ì¦ˆì˜ patientId ì¼ì¹˜ í™•ì¸\r",
									"const baseUrl = pm.environment.get(\"baseUrl\") || \"\";\r",
									"const envPid = String(pm.environment.get(\"PATIENT_ID\") || \"\");\r",
									"pm.sendRequest({\r",
									"  url: `${baseUrl}/app/api/series/info/${encodeURIComponent(String(idNum))}`,\r",
									"  method: \"GET\",\r",
									"  header: { Authorization: \"Bearer \" + token }\r",
									"}, (err, res) => {\r",
									"  if (!err && res.code === 200) {\r",
									"    let ji={}; try { ji = res.json(); } catch(_) {}\r",
									"    const r = ji?.result ?? ji ?? {};\r",
									"    const seriesPid = String(r?.patientId ?? r?.patient?.id ?? \"\");\r",
									"    if (envPid && seriesPid && envPid !== seriesPid) {\r",
									"      pm.expect.fail(\r",
									"        `í™˜ì ë¶ˆì¼ì¹˜: PATIENT_ID=${envPid}, SERIES_INFO_ID(${idNum}) ì†Œì† í™˜ì=${seriesPid}. ` +\r",
									"        `â†’ 'Pick T2-FLAIR' ìš”ì²­ì„ ë¨¼ì € ì‹¤í–‰í•´ SERIES_INFO_IDë¥¼ ê°±ì‹ í•˜ì„¸ìš”.`\r",
									"      );\r",
									"    }\r",
									"  }\r",
									"});\r",
									"\r",
									"// cache-buster (ì„ íƒ)\r",
									"const ts = Date.now();\r",
									"pm.request.url = pm.request.url.toString().includes(\"?\")\r",
									"  ? `${pm.request.url}&t=${ts}` : `${pm.request.url}?t=${ts}`;\r",
									"\r",
									"// --- ìµœì¢… Bodyë¥¼ í•­ìƒ ë™ì ìœ¼ë¡œ êµ¬ì„± ---\r",
									"pm.request.body.update(JSON.stringify({ id: idNum, checkConflict: true }));\r",
									"pm.environment.set(\"SERIES_INFO_ID\", String(idNum));   // í™˜ê²½ë³€ìˆ˜ ë³´ì •(ìˆ«ìâ†’ë¬¸ìì—´)\r",
									"pm.variables.set(\"MODAL_CONTEXT_ID\", String(idNum));   // Testì—ì„œ ì“°ëŠ” ì»¨í…ìŠ¤íŠ¸ í‚¤\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// ìƒíƒœ/ì½”ë“œ ê¸°ë¡\r",
									"const status = pm.response.code;\r",
									"let body = {}; try { body = pm.response.json(); } catch(_) {}\r",
									"\r",
									"pm.test(`[HTTP] status = ${status}`, () => pm.expect(true).to.be.true);\r",
									"pm.test(`[Service] code = ${body?.code ?? '(n/a)'} | msg = ${body?.message ?? '(n/a)'}`, () => pm.expect(true).to.be.true);\r",
									"\r",
									"// ê²°ê³¼ í•´ì„(2xxë©´ OK, 4xx/5xxëŠ” ì‹¤íŒ¨ë¡œ ë³´ì§€ ì•Šê³  ê¸°ë¡ë§Œ)\r",
									"const ok = status >= 200 && status < 300;\r",
									"pm.environment.set(\"BASELINE_VALIDATE_BOOL\", String(Boolean(ok)));\r",
									"pm.environment.set(\"BASELINE_VALIDATE_HTTP\", String(status));\r",
									"\r",
									"// ëª¨ë‹¬ ë¬¸êµ¬ í‘œê¸°\r",
									"const sid = pm.variables.get(\"MODAL_CONTEXT_ID\") || \"(no id)\";\r",
									"const modalText = pm.variables.get(\"MODAL_TEXT_EN\") || \"Do you want to set the selected image as the baseline?\";\r",
									"pm.test(`[Modal] ${modalText} | ID: ${sid}`, () => pm.expect(true).to.be.true);\r",
									"\r",
									"// ë””ë²„ê·¸(ì½˜ì†”)\r",
									"const sentBody = (() => { try { return JSON.parse(pm.request.body?.raw || \"{}\"); } catch(_) { return pm.request.body?.raw; } })();\r",
									"console.log(\"[baseline/validate] request\", { url: pm.request.url.toString(), body: sentBody });\r",
									"console.log(\"[baseline/validate] response\", { status, body });\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/app/api/series/baseline/validate",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"series",
								"baseline",
								"validate"
							]
						}
					},
					"response": []
				},
				{
					"name": "ë² ì´ìŠ¤ë¼ì¸ ì„¤ì •",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// --- Auth & headers ---\r",
									"const token = pm.environment.get(\"access_token\");\r",
									"if (!token) pm.expect.fail(\"access_token ì´ ì—†ìŠµë‹ˆë‹¤.\");\r",
									"pm.request.headers.upsert({ key: \"Authorization\", value: \"Bearer \" + token });\r",
									"pm.request.headers.upsert({ key: \"Accept\", value: \"application/json\" });\r",
									"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
									"\r",
									"// --- ëŒ€ìƒ ì‹œë¦¬ì¦ˆ(T2-FLAIR) ---\r",
									"const sid = pm.environment.get(\"SERIES_INFO_ID\");\r",
									"if (!sid) pm.expect.fail(\"SERIES_INFO_ID ê°€ ì—†ìŠµë‹ˆë‹¤. (T2-FLAIR ì„ íƒ ì„ í–‰ í•„ìš”)\");\r",
									"\r",
									"// (ì˜µì…˜) ìºì‹œ ë°©ì§€ìš© ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° t ì¶”ê°€\r",
									"const ts = Date.now();\r",
									"const u0 = pm.request.url.toString();\r",
									"pm.request.url = u0.includes(\"?\") ? `${u0}&t=${ts}` : `${u0}?t=${ts}`;\r",
									"\r",
									"// force í”Œë˜ê·¸: í™˜ê²½ë³€ìˆ˜(BASELINE_FORCE) â†’ ê¸°ë³¸ false\r",
									"const forceEnv = String(pm.environment.get(\"BASELINE_FORCE\") || \"false\").toLowerCase();\r",
									"const force = (forceEnv === \"true\" || forceEnv === \"1\");\r",
									"\r",
									"// ìˆ«ì ê¸°ëŒ€ ë°±ì—”ë“œ ëŒ€ë¹„\r",
									"const idParsed = Number(sid);\r",
									"const idField = isNaN(idParsed) ? sid : idParsed;\r",
									"\r",
									"// ìµœì¢… ìš”ì²­ ë°”ë”” ì£¼ì…\r",
									"const payload = { id: idField, force };\r",
									"pm.request.body.update(JSON.stringify(payload));\r",
									"\r",
									"// (ì„ íƒ) Testì—ì„œ ë³´ì—¬ì¤„ í…ìŠ¤íŠ¸ ì»¨í…ìŠ¤íŠ¸\r",
									"pm.variables.set(\"BASELINE_SET_CONTEXT_ID\", String(sid));\r",
									"pm.variables.set(\"BASELINE_SET_FORCE\", String(force));\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// ---- ìƒíƒœ/ì„œë¹„ìŠ¤ ì½”ë“œ(ê¸°ë¡ë§Œ) ----\r",
									"const status = pm.response.code;\r",
									"let body = {};\r",
									"try { body = pm.response.json(); } catch (_) {}\r",
									"\r",
									"pm.test(`[HTTP] status = ${status}`, () => pm.expect(true).to.be.true);\r",
									"pm.test(`[Service] code = ${body?.code ?? '(n/a)'} | msg = ${body?.message ?? '(n/a)'}`, () => pm.expect(true).to.be.true);\r",
									"\r",
									"// ---- ì„±ê³µ íŒë‹¨(2xxì´ë©´ ì„±ê³µìœ¼ë¡œ ê°„ì£¼) ----\r",
									"const ok = status >= 200 && status < 300;\r",
									"\r",
									"// ---- ê²°ê³¼ ì €ì¥(í›„ì† ìŠ¤í… ë¶„ê¸°ìš©) ----\r",
									"pm.environment.set(\"BASELINE_SET_RESULT\", ok ? \"SUCCESS\" : \"FAIL\");\r",
									"pm.environment.set(\"BASELINE_SET_HTTP\", String(status));\r",
									"\r",
									"// ---- Test Resultsì— ìš”ì•½ í•œ ì¤„ í‘œì‹œ ----\r",
									"const sid = pm.variables.get(\"BASELINE_SET_CONTEXT_ID\") || pm.environment.get(\"SERIES_INFO_ID\") || \"(no id)\";\r",
									"// force : false(ê¸°ë³¸-ì•ˆì „ëª¨ë“œ)\r",
									"const force = pm.variables.get(\"BASELINE_SET_FORCE\") || \"false\";\r",
									"pm.test(`[Baseline] ${ok ? 'Success' : 'Fail'} | ID: ${sid} | force=${force}`, () => pm.expect(true).to.be.true);\r",
									"\r",
									"// ---- ë””ë²„ê·¸(ì½˜ì†”) ----\r",
									"const reqBody = (() => { try { return JSON.parse(pm.request.body?.raw || \"{}\"); } catch(_) { return pm.request.body?.raw; } })();\r",
									"console.log(\"[Baseline Set] request\", { url: pm.request.url.toString(), body: reqBody });\r",
									"console.log(\"[Baseline Set] response\", { status, body });\r",
									"\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer"
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/app/api/series/baseline",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"series",
								"baseline"
							]
						}
					},
					"response": []
				},
				{
					"name": "ë² ì´ìŠ¤ë¼ì¸ ì„¤ì •_ì¤‘ë³µ",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// === í† í°/í—¤ë” ===\r",
									"pm.request.headers.upsert({ key: \"Accept\", value: \"application/json\" });\r",
									"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
									"const token = pm.environment.get(\"access_token\");\r",
									"if (!token) pm.expect.fail(\"access_token ì´ ì—†ìŠµë‹ˆë‹¤.\");\r",
									"pm.request.headers.upsert({ key: \"Authorization\", value: \"Bearer \" + token });\r",
									"\r",
									"// === ëŒ€ìƒ ì‹œë¦¬ì¦ˆ(T2-FLAIR) ===\r",
									"const sid = pm.environment.get(\"SERIES_INFO_ID\");\r",
									"if (!sid) pm.expect.fail(\"SERIES_INFO_ID ê°€ ì—†ìŠµë‹ˆë‹¤. (T2-FLAIR ì„ íƒ ì„ í–‰ í•„ìš”)\");\r",
									"\r",
									"// === ìºì‹œ ë°©ì§€ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° (t)ë§Œ ë¶€ì°© â€” force/query íŒŒë¼ë¯¸í„° ì ˆëŒ€ ì¶”ê°€í•˜ì§€ ì•ŠìŒ ===\r",
									"const ts = Date.now();\r",
									"const u0 = pm.request.url.toString();\r",
									"pm.request.url = u0.includes(\"?\") ? `${u0}&t=${ts}` : `${u0}?t=${ts}`;\r",
									"\r",
									"// === validate ì „ìš© ë°”ë””: { id, checkConflict:true } ===\r",
									"//   â€» body.force ë“± ë¶ˆí•„ìš”í•œ í•„ë“œëŠ” ì ˆëŒ€ ë„£ì§€ ì•ŠìŒ(500 ìœ ë°œ ê°€ëŠ¥)\r",
									"const body = { id: Number(sid), checkConflict: true };\r",
									"pm.request.body.mode = \"raw\";\r",
									"pm.request.body.update(JSON.stringify(body));\r",
									"\r",
									"// ì§„ë‹¨ ë¡œê·¸\r",
									"pm.environment.set(\"BASELINE_VALIDATE_TARGET_SID\", String(sid));\r",
									"console.log(\"[BASELINE/validate] body=\", body, \"url=\", pm.request.url.toString());\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// === JSON íŒŒì‹± ===\r",
									"let j = null;\r",
									"try { j = pm.response.json(); } catch (e) {\r",
									"  pm.expect.fail(\"JSON íŒŒì‹± ì‹¤íŒ¨: \" + String(e));\r",
									"}\r",
									"\r",
									"// === ê³µí†µ ì •ë³´ ===\r",
									"const http = pm.response.code;\r",
									"const svcCode = Number(j?.code);\r",
									"const msg = j?.message ?? \"\";\r",
									"const resultVal = j?.result;\r",
									"const targetSid = pm.environment.get(\"BASELINE_VALIDATE_TARGET_SID\");\r",
									"pm.environment.set(\"LAST_HTTP_STATUS\", String(http));\r",
									"pm.environment.set(\"LAST_SERVICE_CODE\", String(svcCode));\r",
									"pm.environment.set(\"LAST_SERVICE_MESSAGE\", msg);\r",
									"\r",
									"// === 904ë§Œ 'ì„±ê³µ' ===\r",
									"pm.test(\"code == 904 ì´ì–´ì•¼ í•¨(ë² ì´ìŠ¤ë¼ì¸ ì¶©ëŒ ê°ì§€ ì„±ê³µ)\", function () {\r",
									"  pm.expect(svcCode, `http=${http}, message=\"${msg}\"`).to.eql(904);\r",
									"});\r",
									"\r",
									"// === resultê°€ í˜„ì¬ ë² ì´ìŠ¤ë¼ì¸ SIDë¥¼ ë°˜í™˜(ìŠ¤í¬ë¦°ìƒ·ê³¼ ë™ì¼ ë™ì‘) ===\r",
									"pm.test(\"result(í˜„ì¬ ë² ì´ìŠ¤ë¼ì¸ SID) ì¡´ì¬\", function () {\r",
									"  pm.expect(String(resultVal)).to.match(/^\\d+$/);\r",
									"});\r",
									"\r",
									"// === ìš”ì²­í•œ SID ë¡œê¹… (ì¶©ëŒì„ ìœ ë°œí•œ ëŒ€ìƒ SID) ===\r",
									"console.log(\"[BASELINE/validate] http=%d, code=%s, msg=%s, result(currentBaseline)=%s, requestedSid=%s\",\r",
									"            http, String(svcCode), msg, String(resultVal), String(targetSid));\r",
									"\r",
									"// === 904ê°€ ì•„ë‹ ê²½ìš° ìƒì„¸ ì›ì¸ ë³´ì¡° ë¡œê·¸ ===\r",
									"if (svcCode !== 904) {\r",
									"  console.error(\"[BASELINE/validate][FAIL] ê¸°ëŒ€:904, ì‹¤ì œ:\", svcCode,\r",
									"                \"http=\", http, \"msg=\", msg, \"result=\", resultVal);\r",
									"}\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/app/api/series/baseline/validate",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"series",
								"baseline",
								"validate"
							]
						}
					},
					"response": []
				},
				{
					"name": "ë² ì´ìŠ¤ë¼ì¸ í•´ì œ",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// --- Auth & headers ---\r",
									"const token = pm.environment.get(\"access_token\");\r",
									"if (!token) pm.expect.fail(\"access_token ì´ ì—†ìŠµë‹ˆë‹¤.\");\r",
									"pm.request.headers.upsert({ key: \"Authorization\", value: \"Bearer \" + token });\r",
									"pm.request.headers.upsert({ key: \"Accept\", value: \"application/json\" });\r",
									"\r",
									"// --- ëŒ€ìƒ ì‹œë¦¬ì¦ˆ(T2-FLAIR) ID ---\r",
									"const sid = pm.environment.get(\"SERIES_INFO_ID\");\r",
									"if (!sid) pm.expect.fail(\"SERIES_INFO_ID ê°€ ì—†ìŠµë‹ˆë‹¤. (T2-FLAIR ì„ íƒ ì„ í–‰ í•„ìš”)\");\r",
									"\r",
									"// --- URL ë IDë¥¼ ENVë¡œ ì¹˜í™˜ (ìˆ«ì/ë¬¸ì/UUID ëª¨ë‘) ---\r",
									"let url = pm.request.url.toString();\r",
									"url = url.replace(/(\\/baseline\\/)([^/?#]+)(?=\\/?$|[?#])/, `$1${sid}`);\r",
									"if (url === pm.request.url.toString()) {\r",
									"  // í˜¹ì‹œ IDê°€ ë¹„ì–´ìˆê±°ë‚˜ í•˜ë“œì½”ë”©ëœ ê²½ìš° ëŒ€ë¹„, ë§¨ ëì— ë³´ê°•\r",
									"  const m = url.match(/\\/baseline(\\/)?$/);\r",
									"  if (m) url = url.replace(/\\/baseline(\\/)?$/, `/baseline/${sid}`);\r",
									"}\r",
									"pm.request.url = url;\r",
									"\r",
									"// --- ìºì‹œ ë°©ì§€ìš© ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° (ì„ íƒ) ---\r",
									"const ts = Date.now();\r",
									"pm.request.url = pm.request.url.toString().includes(\"?\")\r",
									"  ? `${pm.request.url}&t=${ts}`\r",
									"  : `${pm.request.url}?t=${ts}`;\r",
									"\r",
									"// --- í…ŒìŠ¤íŠ¸ í‘œì‹œìš© ë¬¸êµ¬/ì»¨í…ìŠ¤íŠ¸ ---\r",
									"pm.variables.set(\"BASELINE_UNSET_CONTEXT_ID\", String(sid));\r",
									"pm.variables.set(\"MODAL_TEXT_EN\", \"Do you want to unset the baseline for the selected image? Unsetting the baseline image may affect future analysis results.\");\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// ---- ìƒíƒœ/ì„œë¹„ìŠ¤ ì½”ë“œ: ì‹¤íŒ¨ ì²˜ë¦¬í•˜ì§€ ì•Šê³  ê¸°ë¡ë§Œ ----\r",
									"const status = pm.response.code;\r",
									"let body = {};\r",
									"try { body = pm.response.json(); } catch (_) {}\r",
									"\r",
									"pm.test(`[HTTP] status = ${status}`, () => pm.expect(true).to.be.true);\r",
									"pm.test(`[Service] code = ${body?.code ?? '(n/a)'} | msg = ${body?.message ?? '(n/a)'}`, () => pm.expect(true).to.be.true);\r",
									"\r",
									"// ---- ì„±ê³µ íŒë‹¨(2xxì´ë©´ ì„±ê³µìœ¼ë¡œ ê°„ì£¼) ----\r",
									"const ok = status >= 200 && status < 300;\r",
									"\r",
									"// ---- ê²°ê³¼ ì €ì¥(í›„ì† ë¶„ê¸°ìš©) ----\r",
									"pm.environment.set(\"BASELINE_UNSET_RESULT\", ok ? \"SUCCESS\" : \"FAIL\");\r",
									"pm.environment.set(\"BASELINE_UNSET_HTTP\", String(status));\r",
									"\r",
									"// ---- Test Resultsì— ëª¨ë‹¬ ì¹´í”¼(ì˜ë¬¸) í‘œì‹œ ----\r",
									"const sid = pm.variables.get(\"BASELINE_UNSET_CONTEXT_ID\") || pm.environment.get(\"SERIES_INFO_ID\") || \"(no id)\";\r",
									"const modalText = pm.variables.get(\"MODAL_TEXT_EN\") || \"Do you want to unset the baseline for the selected image?\";\r",
									"pm.test(`[Modal] ${modalText} | ID: ${sid}`, () => pm.expect(true).to.be.true);\r",
									"\r",
									"// ---- (ì„ íƒ) ì‹¤ì œ í•´ì œ í™•ì¸: GET /series/info/{{SERIES_INFO_ID}} ë¡œ baseline í”Œë˜ê·¸ í™•ì¸ ----\r",
									"const verify = String(pm.environment.get(\"VERIFY_UNSET\") || \"false\").toLowerCase() === \"true\";\r",
									"if (verify && ok) {\r",
									"  const baseUrl = pm.environment.get(\"baseUrl\") || \"\";\r",
									"  pm.sendRequest({\r",
									"    url: `${baseUrl}/app/api/series/info/${encodeURIComponent(String(sid))}`,\r",
									"    method: \"GET\",\r",
									"    header: { \"Authorization\": \"Bearer \" + pm.environment.get(\"access_token\") }\r",
									"  }, (err, res) => {\r",
									"    if (err) {\r",
									"      console.warn(\"[Baseline Unset][verify] request error:\", err.message);\r",
									"      return;\r",
									"    }\r",
									"    let info={}; try{ info = res.json(); } catch(_){}\r",
									"    const r = info?.result ?? info ?? {};\r",
									"    const flag = Boolean(r?.baseline || r?.isBaseline || r?.is_base);\r",
									"    pm.test(\"Verify that baseline flag is now false\", () => pm.expect(flag).to.eql(false));\r",
									"    console.log(\"[Baseline Unset][verify]\", { flag, info: r });\r",
									"  });\r",
									"}\r",
									"\r",
									"// ---- ì½˜ì†” ë””ë²„ê·¸ ----\r",
									"console.log(\"[Baseline Unset] request\", { url: pm.request.url.toString() });\r",
									"console.log(\"[Baseline Unset] response\", { status, body });\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/app/api/series/baseline/{{SERIES_INFO_ID}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"series",
								"baseline",
								"{{SERIES_INFO_ID}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "ì´ë¯¸ì§€ ì‚­ì œ(3íšŒ ë¯¸ë§Œ ì‹¤í–‰!!!)",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// --- Auth & headers ---\r",
									"const token = pm.environment.get(\"access_token\");\r",
									"if (!token) pm.expect.fail(\"access_token ì´ ì—†ìŠµë‹ˆë‹¤.\");\r",
									"pm.request.headers.upsert({ key: \"Authorization\", value: \"Bearer \" + token });\r",
									"pm.request.headers.upsert({ key: \"Accept\", value: \"application/json\" });\r",
									"\r",
									"// --- ì‚­ì œ ëŒ€ìƒ id í™•ë³´ & ìˆ«ì ë³´ì • ---\r",
									"const sidRaw = pm.environment.get(\"SERIES_DELETE_ID\"); // â† ë³€ê²½ ì§€ì \r",
									"if (!sidRaw) pm.expect.fail(\"SERIES_DELETE_ID ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € 'Pick T2-FLAIR & NON-T2' ìš”ì²­ìœ¼ë¡œ ì„¤ì •í•˜ì„¸ìš”.\");\r",
									"const idNum = Number(sidRaw);\r",
									"if (Number.isNaN(idNum)) pm.expect.fail(`SERIES_DELETE_ID ê°€ ìˆ«ìê°€ ì•„ë‹™ë‹ˆë‹¤: ${sidRaw}`);\r",
									"\r",
									"// --- URL ê°•ì œ: /app/api/series/:id (ë ìŠ¬ë˜ì‹œ ì œê±°)\r",
									"const baseUrl = pm.environment.get(\"baseUrl\") || \"\";\r",
									"pm.request.url = `${baseUrl.replace(/\\/$/,'')}/app/api/series/${idNum}`;\r",
									"\r",
									"// --- (ì„ íƒ) ìºì‹œ ë²„ìŠ¤í„°\r",
									"pm.request.url = pm.request.url.toString() + `?t=${Date.now()}`;\r",
									"\r",
									"// --- ê°€ë“œ: ì‚­ì œ ëŒ€ìƒì´ \"T2-FLAIRê°€ ì•„ë‹˜\"ì„ ë³´ì¦ ---\r",
									"const norm = s => String(s||\"\").toLowerCase().replace(/[^a-z0-9]/g,\"\");\r",
									"pm.sendRequest({\r",
									"  url: `${baseUrl}/app/api/series/info/${idNum}`,\r",
									"  method: \"GET\",\r",
									"  header: { Authorization: \"Bearer \" + token }\r",
									"}, (err, res) => {\r",
									"  if (err || res.code !== 200) pm.expect.fail(`series.info ì¡°íšŒ ì‹¤íŒ¨: ${err?.message || res?.code}`);\r",
									"  let ji={}; try { ji = res.json(); } catch(_) {}\r",
									"  const r = ji?.result ?? ji ?? {};\r",
									"  const typeNorm = norm(r?.imageType || r?.seriesDescription);\r",
									"  if (typeNorm === \"t2flair\")\r",
									"    pm.expect.fail(`ì‚­ì œ ëŒ€ìƒì´ T2-FLAIR ì…ë‹ˆë‹¤. (imageType='${r?.imageType || r?.seriesDescription || \"(n/a)\"}')`);\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"const status = pm.response.code;\r",
									"let body = {}; try { body = pm.response.json(); } catch(_){}\r",
									"\r",
									"pm.test(`[HTTP] status = ${status}`, () => pm.expect(true).to.be.true);\r",
									"pm.test(`[Service] code = ${body?.code ?? '(n/a)'} | msg = ${body?.message ?? '(n/a)'}`, () => pm.expect(true).to.be.true);\r",
									"\r",
									"const ok = status >= 200 && status < 300;\r",
									"pm.environment.set(\"SERIES_DELETE_RESULT\", ok ? \"SUCCESS\" : \"FAIL\");\r",
									"pm.environment.set(\"SERIES_DELETE_HTTP\", String(status));\r",
									"\r",
									"const delId = pm.environment.get(\"SERIES_DELETE_ID\");\r",
									"pm.test(`[Modal] Do you want to delete the selected NONâ€“T2-FLAIR series? | ID: ${delId}`, () => pm.expect(true).to.be.true);\r",
									"\r",
									"// ì‚­ì œ í›„ ê²€ì¦(ì˜µì…˜)\r",
									"const verify = String(pm.environment.get(\"VERIFY_DELETE\") || \"false\").toLowerCase() === \"true\";\r",
									"if (verify && ok) {\r",
									"  const baseUrl = pm.environment.get(\"baseUrl\") || \"\";\r",
									"  const token   = pm.environment.get(\"access_token\");\r",
									"  pm.sendRequest({\r",
									"    url: `${baseUrl}/app/api/series/info/${delId}`,\r",
									"    method: \"GET\",\r",
									"    header: { Authorization: \"Bearer \" + token }\r",
									"  }, (err, res) => {\r",
									"    const gone = err || !res || (res.code >= 400 && res.code !== 200);\r",
									"    pm.test(\"Verify that series is no longer accessible\", () => pm.expect(gone).to.eql(true));\r",
									"  });\r",
									"}\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "DELETE",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/series/{{SERIES_INFO_ID}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"series",
								"{{SERIES_INFO_ID}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "user_locale",
			"item": [
				{
					"name": "Locale ì •ë³´ ì¡°íšŒ",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// ê¸°ë³¸ baseUrl ì—†ìœ¼ë©´ ë¡œì»¬ë¡œ ê¸°ë³¸ê°’ ì„¸íŒ…\r",
									"if (!pm.environment.get('baseUrl')) {\r",
									"  pm.environment.set('baseUrl', 'http://localhost');\r",
									"}\r",
									"// ê¸°ëŒ€ê°’(ìŠ¤ëƒ…ìƒ·) ì €ì¥\r",
									"pm.environment.set('expected_locale_snapshot', JSON.stringify({\r",
									"  code: 200,\r",
									"  message: \"\",\r",
									"  result: {\r",
									"    languages: [{ code: \"en\", name: \"English\" }],\r",
									"    system: \"en\"\r",
									"  }\r",
									"}));\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// ê³µí†µ íŒŒì„œ\r",
									"let json;\r",
									"pm.test(\"ì‘ë‹µì´ JSONì´ì–´ì•¼ í•œë‹¤\", function () {\r",
									"  pm.response.to.have.status(200);\r",
									"  pm.response.to.be.withBody;\r",
									"  pm.response.to.be.json;\r",
									"  json = pm.response.json();\r",
									"});\r",
									"\r",
									"// ìµœìƒìœ„ í•„ë“œ ê²€ì¦\r",
									"pm.test(\"ìµœìƒìœ„ í•„ë“œ(code/message/result) ì¡´ì¬ ë° íƒ€ì… ê²€ì¦\", function () {\r",
									"  pm.expect(json).to.have.property(\"code\").that.is.a(\"number\");\r",
									"  pm.expect(json).to.have.property(\"message\").that.is.a(\"string\");\r",
									"  pm.expect(json).to.have.property(\"result\").that.is.an(\"object\");\r",
									"});\r",
									"\r",
									"// code/message ê°’ ê²€ì¦\r",
									"pm.test(\"code=200, message=''\", function () {\r",
									"  pm.expect(json.code).to.eql(200);\r",
									"  pm.expect(json.message).to.eql(\"\");\r",
									"});\r",
									"\r",
									"// result.languages êµ¬ì¡° ê²€ì¦\r",
									"pm.test(\"result.languages ë°°ì—´ ë° í•­ëª© êµ¬ì¡° ê²€ì¦\", function () {\r",
									"  pm.expect(json.result).to.have.property(\"languages\").that.is.an(\"array\");\r",
									"  pm.expect(json.result.languages.length).to.be.greaterThan(0);\r",
									"  json.result.languages.forEach(lang => {\r",
									"    pm.expect(lang).to.have.property(\"code\").that.is.a(\"string\");\r",
									"    pm.expect(lang).to.have.property(\"name\").that.is.a(\"string\");\r",
									"  });\r",
									"});\r",
									"\r",
									"// en(English) ì¡´ì¬ ë° system ê¸°ë³¸ê°’ ê²€ì¦\r",
									"pm.test(\"ì–¸ì–´ ëª©ë¡ì— en(English) ì¡´ì¬ & system=en\", function () {\r",
									"  const hasEN = json.result.languages.some(l => l.code === \"en\" && l.name === \"English\");\r",
									"  pm.expect(hasEN).to.eql(true);\r",
									"  pm.expect(json.result.system).to.eql(\"en\");\r",
									"});\r",
									"\r",
									"// ì „ì²´ ìŠ¤ëƒ…ìƒ·ê³¼ ë¹„êµ(í…ìŠ¤íŠ¸ë·° ê¸°ì¤€)\r",
									"pm.test(\"ì„œë²„ ì‘ë‹µì´ í…ìŠ¤íŠ¸ë·° ìŠ¤ëƒ…ìƒ·ê³¼ ë™ì¼\", function () {\r",
									"  const expected = JSON.parse(pm.environment.get('expected_locale_snapshot'));\r",
									"  pm.expect(json).to.eql(expected);\r",
									"});\r",
									"\r",
									"// ìœ ìš©í•œ ê°’ í™˜ê²½ë³€ìˆ˜ë¡œ ì €ì¥\r",
									"pm.test(\"í™˜ê²½ë³€ìˆ˜ì— í˜„ì¬ system ë° ì§€ì› ì–¸ì–´ì½”ë“œ ì €ì¥\", function () {\r",
									"  pm.environment.set('locale_system', json.result.system);\r",
									"  pm.environment.set('locale_codes', json.result.languages.map(l => l.code).join(','));\r",
									"});\r",
									"\r",
									"// í’ˆì§ˆ ì²´í¬(ì„ íƒ)\r",
									"pm.test(\"ì‘ë‹µì‹œê°„ 500ms ì´í•˜\", function () {\r",
									"  pm.expect(pm.response.responseTime).to.be.below(500);\r",
									"});\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/app/api/locale",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"locale"
							]
						}
					},
					"response": []
				},
				{
					"name": "ë¡œê·¸ì•„ì›ƒ",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {\r",
									"    pm.test(\"ë¡œê·¸ì•„ì›ƒ ì„±ê³µ\", function () {\r",
									"        pm.expect(pm.response.code).to.eql(200);\r",
									"    });\r",
									"\r",
									"    console.log(\"âœ… ë¡œê·¸ì•„ì›ƒ ì„±ê³µ, í† í° ë§Œë£Œ ì²˜ë¦¬ ì‹œì‘\");\r",
									"\r",
									"    // ğŸ”‘ í™˜ê²½ë³€ìˆ˜ì—ì„œ í† í° ì‚­ì œ\r",
									"    pm.environment.unset(\"access_token\");\r",
									"    console.log(\"ğŸ—‘ï¸ accessToken ì‚­ì œ ì™„ë£Œ\");\r",
									"\r",
									"\r",
									"} else {\r",
									"    pm.test(\"ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨\", function () {\r",
									"        pm.expect(pm.response.code).to.eql(200);\r",
									"    });\r",
									"    console.log(\"âŒ ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨ - ì‘ë‹µì½”ë“œ:\", pm.response.code);\r",
									"}\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try {\r",
									"      rows = JSON.parse(pm.collectionVariables.get('__log') || '[]');\r",
									"    } catch (e) {\r",
									"      console.error(TAG, 'parse __log error:', e);\r",
									"      rows = [];\r",
									"    }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"      last:  row\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"  \r",
									"})();\r",
									"// í† í° ì‚­ì œ í™•ì¸ìš©\r",
									"console.log(\"ğŸ“Œ ë¡œê·¸ì•„ì›ƒ ìš”ì²­ í—¤ë”:\", pm.request.headers.toObject());\r",
									"console.log(\"ğŸ“Œ accessToken:\", pm.environment.get(\"access_token\"));\r",
									"console.log(\"ğŸ“Œ ë¡œê·¸ì•„ì›ƒ ì‘ë‹µ Body:\", pm.response.text());\r",
									"\r",
									"\r",
									"// === [AGG DEBUG] ëª¨ë“  ìš”ì²­ ë’¤ì— ì‹¤í–‰ë˜ì–´ ë¡œê·¸/ì¹´ìš´íŠ¸ ëˆ„ì  ===\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "DELETE",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "{{access_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://127.0.0.1/identity/api/access/logout",
							"protocol": "http",
							"host": [
								"127",
								"0",
								"0",
								"1"
							],
							"path": [
								"identity",
								"api",
								"access",
								"logout"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "General user",
			"item": [
				{
					"name": "General user ê¶Œí•œ í…ŒìŠ¤íŠ¸",
					"item": [
						{
							"name": "General user ë¡œê·¸ì¸",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// ===== 0) SJCL ì†ŒìŠ¤ ë¡œë“œ (ë„¤íŠ¸ì›Œí¬ X) =====\r",
											"const SJCL_SRC = pm.environment.get(\"sjcl_src\") || pm.globals.get(\"sjcl_src\");\r",
											"if (!SJCL_SRC) throw new Error(\"sjcl_src ë³€ìˆ˜ì— sjcl.js ì „ì²´ ì†ŒìŠ¤ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.\");\r",
											"\r",
											"// ë…ë¦½ ìŠ¤ì½”í”„ì—ì„œ SJCL ê°ì²´ íšŒìˆ˜ (eval ìŠ¤ì½”í”„ ë¬¸ì œ ë°©ì§€)\r",
											"function buildSJCL(src) {\r",
											"  const factory = new Function(`\r",
											"    var window = {}; var self = window; var global = window;\r",
											"    var module = { exports: {} }; var exports = module.exports;\r",
											"    ${src}\r",
											"    return (typeof sjcl !== \"undefined\") ? sjcl\r",
											"         : (module && module.exports ? module.exports\r",
											"         : (window.sjcl || exports.sjcl));\r",
											"  `);\r",
											"  const lib = factory();\r",
											"  if (!lib || !lib.cipher || !lib.mode || !lib.codec) throw new Error(\"SJCL ë¡œë“œ ì‹¤íŒ¨\");\r",
											"  return lib;\r",
											"}\r",
											"const SJCL = buildSJCL(SJCL_SRC);\r",
											"\r",
											"// ===== 1) CryptoJS (Postman ë‚´ì¥) =====\r",
											"const CryptoJS = require(\"crypto-js\");\r",
											"\r",
											"// ===== 2) ìœ í‹¸ =====\r",
											"function randomBytes(n){\r",
											"  const wa = CryptoJS.lib.WordArray.random(n);\r",
											"  const hex = wa.toString(CryptoJS.enc.Hex);\r",
											"  const out = [];\r",
											"  for (let i=0;i<hex.length;i+=2) out.push(parseInt(hex.substr(i,2),16));\r",
											"  return out;\r",
											"}\r",
											"function bytesToBits(bytes){\r",
											"  let hex = \"\";\r",
											"  for (let i=0;i<bytes.length;i++){\r",
											"    const h = bytes[i].toString(16);\r",
											"    hex += (h.length===1 ? \"0\"+h : h);\r",
											"  }\r",
											"  return SJCL.codec.hex.toBits(hex);\r",
											"}\r",
											"\r",
											"// AES-128-GCM (iv 12B, tag 16B), í‚¤: sha256(key).hex -> ì•16(ASCII, UPPER)\r",
											"function encryptOnce(keyStr, plain){\r",
											"  const ivBytes = randomBytes(12);                        // IV_LENGTH = 12\r",
											"  const ivBits  = bytesToBits(ivBytes);\r",
											"\r",
											"  const tempKeyHex   = CryptoJS.SHA256(keyStr).toString(CryptoJS.enc.Hex).toUpperCase();\r",
											"  const secretKeyStr = tempKeyHex.substring(0,16).toUpperCase();    // ASCII 16 bytes\r",
											"  const keyBits = SJCL.codec.utf8String.toBits(secretKeyStr);\r",
											"\r",
											"  const ptBits = SJCL.codec.utf8String.toBits(plain);\r",
											"  const aes    = new SJCL.cipher.aes(keyBits);\r",
											"\r",
											"  const ctWithTag = SJCL.mode.gcm.encrypt(aes, ptBits, ivBits, [], 128); // tag 128-bit\r",
											"  const combined  = SJCL.bitArray.concat(bytesToBits(ivBytes), ctWithTag);// iv + ct + tag\r",
											"  return SJCL.codec.base64.fromBits(combined);                            // standard Base64\r",
											"}\r",
											"\r",
											"// ===== 3) ë©”ì¸: ë°”ë””ì—ì„œ ID/íŒ¨ìŠ¤ì›Œë“œ ì½ì–´ ë™ì¼ IDë¡œ ì•”í˜¸í™” =====\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"\r",
											"let body;\r",
											"try {\r",
											"  body = JSON.parse(pm.request.body.raw || \"{}\");\r",
											"} catch (e) {\r",
											"  throw new Error(\"Bodyê°€ JSONì´ ì•„ë‹™ë‹ˆë‹¤.\");\r",
											"}\r",
											"\r",
											"// ì„œë²„ê°€ ì½ëŠ” ID í•„ë“œëª…ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš© (loginId / id / userId ì¤‘ í•˜ë‚˜)\r",
											"const keyId = String(body.loginId ?? body.id ?? body.userId ?? \"\").trim();\r",
											"if (!keyId) throw new Error(\"Bodyì— loginId/id/userId ì¤‘ í•˜ë‚˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.\");\r",
											"\r",
											"let plainPw;\r",
											"if (typeof body.password === \"string\" && body.password.trim() && !body.password.includes(\"{{\")) {\r",
											"  // ë°”ë””ì— í‰ë¬¸ì´ ìˆìœ¼ë©´ ê·¸ê±¸ ì‚¬ìš©\r",
											"  plainPw = body.password;\r",
											"} else {\r",
											"  // ì—†ìœ¼ë©´ í™˜ê²½ë³€ìˆ˜ì—ì„œ í‰ë¬¸ì„ ê°€ì ¸ì™€ ì‚¬ìš© (ì„ íƒ)\r",
											"  plainPw = pm.environment.get(\"PLAIN_PW\");\r",
											"  if (!plainPw) throw new Error(\"password í‰ë¬¸ì´ í•„ìš”í•©ë‹ˆë‹¤ (Body.password ë˜ëŠ” í™˜ê²½ë³€ìˆ˜ PLAIN_PW).\");\r",
											"}\r",
											"\r",
											"const encPw = encryptOnce(keyId, plainPw);\r",
											"\r",
											"// ë°”ë””ì— ì•”í˜¸ë¬¸ ë°˜ì˜\r",
											"body.password = encPw;\r",
											"pm.request.body.update(JSON.stringify(body));\r",
											"\r",
											"// í•„ìš” ì‹œ ë³€ìˆ˜ë¡œë„ ë…¸ì¶œ (ë‹¤ë¥¸ ìš”ì²­ì—ì„œ ì¬ì‚¬ìš©)\r",
											"pm.variables.set(\"ENC_PW\", encPw);\r",
											"\r",
											"// ë””ë²„ê·¸ ë¡œê·¸\r",
											"console.log(\"Enc with ID =\", keyId, \", Base64 length =\", encPw.length);\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// ë¡œê·¸ì¸ ì‘ë‹µ ì½”ë“œ ê²€ì‚¬\r",
											"if (pm.response.code === 200) {\r",
											"  pm.test(\"ë¡œê·¸ì¸ ì„±ê³µ\", function () {\r",
											"    pm.expect(pm.response.code).to.eql(200);\r",
											"  });\r",
											"\r",
											"  // ì‘ë‹µ JSON íŒŒì‹±\r",
											"  let jsonData; try { jsonData = pm.response.json(); } catch (e) { jsonData = null; }\r",
											"\r",
											"  if (jsonData && jsonData.result && jsonData.result.accessToken && jsonData.result.accessToken.token) {\r",
											"    const token = jsonData.result.accessToken.token;\r",
											"\r",
											"    // ğŸ‘‰ í™˜ê²½ë³€ìˆ˜ ì €ì¥\r",
											"    pm.environment.set(\"access_token\", token);\r",
											"    console.log(\"ğŸ”‘ í† í° ì €ì¥ë¨:\", token);\r",
											"  } else {\r",
											"    console.log(\"âš ï¸ ì‘ë‹µì—ì„œ í† í°ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\");\r",
											"  }\r",
											"\r",
											"} else {\r",
											"  // ì‹¤íŒ¨ ë©”ì‹œì§€ ì¶œë ¥\r",
											"  pm.test(\"ë¡œê·¸ì¸ ì‹¤íŒ¨ - ì‘ë‹µì½”ë“œ: \" + pm.response.code, function () {\r",
											"    pm.expect(pm.response.code).to.eql(200);\r",
											"  });\r",
											"}\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n  \"loginId\": \"kjhan_g\",\r\n  \"password\": \"marine6c!\",\r\n  \"isRestrictNewToken\": false\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/identity/api/access/login",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"identity",
										"api",
										"access",
										"login"
									]
								}
							},
							"response": []
						},
						{
							"name": "í™˜ì ëª©ë¡ ì¡°íšŒ_PATIENT ID ì €ì¥",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"const id = pm.environment.get(\"TARGET_IDENTIFIER\") || \"\"; // ì—†ìœ¼ë©´ ì „ì²´ê²€ìƒ‰\r",
											"const body = {\r",
											"  identifier: id,\r",
											"  name: \"\",\r",
											"  sex: null,\r",
											"  startDate: null,\r",
											"  endDate: null,\r",
											"  paginationReq: {\r",
											"    requestPageNumber: 1,\r",
											"    itemCountPerPage: 20,\r",
											"    order: \"desc\",\r",
											"    sortBy: \"\"\r",
											"  },\r",
											"  isSortById: false\r",
											"};\r",
											"\r",
											"// Content-Type ë³´ì •\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"// Body ì—…ë°ì´íŠ¸\r",
											"pm.request.body.update(JSON.stringify(body, null, 2));\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === 1) JSON íŒŒì‹± ===\r",
											"let json;\r",
											"try {\r",
											"  json = pm.response.json();\r",
											"} catch (e) {\r",
											"  pm.environment.unset(\"PATIENT_ID\");\r",
											"  console.error(\"ì‘ë‹µì´ JSONì´ ì•„ë‹˜:\", e);\r",
											"  return;\r",
											"}\r",
											"\r",
											"// === 2) contents ë°°ì—´ ì¶”ì¶œ ===\r",
											"let contents = [];\r",
											"try {\r",
											"  if (json && json.result && json.result.patientInfos && Array.isArray(json.result.patientInfos.contents)) {\r",
											"    contents = json.result.patientInfos.contents;\r",
											"  }\r",
											"} catch (_) {}\r",
											"\r",
											"// === 3) íƒ€ê¹ƒ identifier ê²°ì •\r",
											"// ìš°ì„ ìˆœìœ„: í™˜ê²½ë³€ìˆ˜ TARGET_IDENTIFIER > ìš”ì²­ bodyì˜ identifier(ë¹„ì–´ìˆì§€ ì•Šìœ¼ë©´) > \"sample_1\"\r",
											"let targetIdentifier = pm.environment.get(\"TARGET_IDENTIFIER\");\r",
											"if (!targetIdentifier) {\r",
											"  try {\r",
											"    const raw = pm.request.body && pm.request.body.raw ? pm.request.body.raw : \"{}\";\r",
											"    const body = JSON.parse(raw);\r",
											"    if (body && body.identifier) targetIdentifier = body.identifier;\r",
											"  } catch (_) {}\r",
											"}\r",
											"if (!targetIdentifier) targetIdentifier = \"sample_1\";\r",
											"\r",
											"// === 4) ë§¤ì¹­ ì°¾ê¸°\r",
											"const match = contents.find(o => o && o.identifier === targetIdentifier);\r",
											"\r",
											"// === 5) í™˜ê²½ë³€ìˆ˜ ì„¤ì • (ì½”ë“œ 200 + ë§¤ì¹­ ìˆì„ ë•Œë§Œ)\r",
											"if (json && json.code === 200 && match && match.id != null) {\r",
											"  pm.environment.set(\"PATIENT_ID\", String(match.id));\r",
											"  console.log(\"PATIENT_ID set to\", match.id);\r",
											"} else {\r",
											"  pm.environment.unset(\"PATIENT_ID\");\r",
											"  console.warn(\r",
											"    \"PATIENT_ID not set. ì´ìœ :\",\r",
											"    { code: json && json.code, targetIdentifier, identifiers: contents.map(x => x && x.identifier) }\r",
											"  );\r",
											"}\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/patient/search",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"patient",
										"search"
									]
								}
							},
							"response": []
						},
						{
							"name": "ì´ë¯¸ì§€ ìƒì„¸ ì •ë³´ ì¡°íšŒ",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"/**\r",
											" * ëª©ì :\r",
											" *  - sample_1ì˜ patientì—ì„œ \"T2-FLAIR\"ë§Œ ê³¨ë¼ ìµœì‹  1ê±´ì˜ idë¥¼ SERIES_INFO_IDì— ì €ì¥(ìƒì„¸ ì¡°íšŒìš©)\r",
											" *  - ë™ì‹œì— \"T2-FLAIRê°€ ì•„ë‹Œ\" ì‹œë¦¬ì¦ˆ ì¤‘ 1ê±´ì„ ê³¨ë¼ SERIES_DELETE_IDì— ì €ì¥(ì‚­ì œìš©)\r",
											" *  - Send ëˆ„ë¥¼ ë•Œë§ˆë‹¤ SERIES_DELETE_IDì—ëŠ” T2_FLAIRì„ ì œì™¸í•œ ë‚˜ë¨¸ì§€ IDì¤‘ì— í•˜ë‚˜ ëœë¤ ì„ íƒ\r",
											" *\r",
											" * ì˜µì…˜:\r",
											" *  - MANUAL_LOCK=true  : í™˜ê²½ë³€ìˆ˜ SERIES_INFO_IDê°€ ìˆìœ¼ë©´ ê·¸ ê°’ ê³ ì • ì‚¬ìš©(ì„ íƒ ìŠ¤í‚µ). (SERIES_DELETE_IDë„ ì ê·¸ë ¤ë©´ ë³„ë„ ê´€ë¦¬ ê¶Œì¥)\r",
											" *  - SERIES_STATUS_QS  : ê¸°ë³¸ \"analyzed,unanalyzed\"\r",
											" *  - REQUIRE_STATUS    : \"Analyzed\" ë˜ëŠ” \"Unanalyzed\" (ì„ íƒ)\r",
											" *  - PICK_MODE         : \"latest\"(ê¸°ë³¸) | \"first\"  // í›„ë³´ ì¤‘ ì„ íƒ ë°©ì‹\r",
											" */\r",
											"\r",
											"(() => {\r",
											"  // === Namespaced config ===\r",
											"  const NS = \"SERIES_PICK\"; // log prefix\r",
											"\r",
											"  // === Env ===\r",
											"  const BASE_URL   = pm.environment.get(\"baseUrl\") || \"\";\r",
											"  const TOKEN      = pm.environment.get(\"access_token\");\r",
											"  const PATIENT_ID = pm.environment.get(\"PATIENT_ID\");\r",
											"  if (!TOKEN)      throw new Error(\"access_token ì´ ì—†ìŠµë‹ˆë‹¤.\");\r",
											"  if (!PATIENT_ID) throw new Error(\"patient_id ê°€ ì—†ìŠµë‹ˆë‹¤.\");\r",
											"\r",
											"  // ë§¤ ì‹¤í–‰ë§ˆë‹¤ ì¬ì„ íƒ\r",
											"  pm.environment.unset(\"SERIES_DELETE_ID\");\r",
											"\r",
											"  // === Options ===\r",
											"  const STATUS_QS     = (pm.environment.get(\"SERIES_STATUS_QS\") || \"analyzed,unanalyzed\").trim();\r",
											"  const REQUIRE_STAT  = (pm.environment.get(\"REQUIRE_STATUS\") || \"\").trim();\r",
											"  const EXCLUDE_RAW   = (pm.environment.get(\"EXCLUDE_IDS\") || \"\").trim();\r",
											"  const EXCLUDE_SET   = new Set(EXCLUDE_RAW ? EXCLUDE_RAW.split(\",\").map(s => String(s).trim()).filter(Boolean) : []);\r",
											"\r",
											"  // === Utils ===\r",
											"  const norm = (s) => String(s||\"\").toLowerCase().replace(/[^a-z0-9]/g,\"\");\r",
											"  const isT2Flair = (v) => norm(v) === \"t2flair\";\r",
											"  const byStatus = (row) => !REQUIRE_STAT || String(row?.status||\"\").toLowerCase() === REQUIRE_STAT.toLowerCase();\r",
											"\r",
											"  // === Fetch list ===\r",
											"  const url = `${BASE_URL}/app/api/patient/${encodeURIComponent(String(PATIENT_ID))}/series?status=${encodeURIComponent(STATUS_QS)}`;\r",
											"  pm.sendRequest({\r",
											"    url,\r",
											"    method: \"GET\",\r",
											"    header: { \"Authorization\": pm.variables.replaceIn(\"Bearer {{access_token}}\") }\r",
											"  }, (err, res) => {\r",
											"    if (err) throw new Error(`[patient/{id}/series] ìš”ì²­ ì‹¤íŒ¨: ${err.message}`);\r",
											"    if (res.code !== 200) throw new Error(`[patient/{id}/series] HTTP ${res.code} ${res.text()}`);\r",
											"\r",
											"    let j={}; try{ j = res.json(); }catch(_){}\r",
											"    const list = Array.isArray(j?.result?.imageList) ? j.result.imageList : [];\r",
											"    if (!list.length) throw new Error(\"imageList ê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.\");\r",
											"\r",
											"    // 1) T2-FLAIR ìµœì‹  1ê±´ â†’ SERIES_INFO_ID\r",
											"    let flair = list.filter(r=>{\r",
											"      if(!r) return false;\r",
											"      const ok = isT2Flair(r.imageType)||isT2Flair(r.seriesDesc)||isT2Flair(r.seriesDescription);\r",
											"      return ok && byStatus(r);\r",
											"    });\r",
											"    if(!flair.length) throw new Error(\"T2-FLAIR ì‹œë¦¬ì¦ˆë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\");\r",
											"    flair.sort((a,b)=> new Date(b.uploadDate||0) - new Date(a.uploadDate||0));\r",
											"    const chosenFlair = flair[0];\r",
											"    const flairId = chosenFlair?.id ?? chosenFlair?.seriesId ?? chosenFlair?.seriesNo;\r",
											"    if (flairId == null) throw new Error(\"T2-FLAIRì—ì„œ id ì¶”ì¶œ ì‹¤íŒ¨\");\r",
											"    pm.environment.set(\"SERIES_INFO_ID\", String(flairId));\r",
											"    pm.variables.set(\"SERIES_INFO_ID\", String(flairId));\r",
											"\r",
											"    // 2) ë¹„(T2-FLAIR) ëœë¤ 1ê±´ â†’ SERIES_DELETE_ID\r",
											"    const nonFlair = list\r",
											"      .map(r => ({ r, id: r?.id ?? r?.seriesId ?? r?.seriesNo }))\r",
											"      .filter(x=>{\r",
											"        if(x.id == null) return false;\r",
											"        if(String(x.id) === String(flairId)) return false;\r",
											"        const isFlairType = isT2Flair(x.r?.imageType) || isT2Flair(x.r?.seriesDesc) || isT2Flair(x.r?.seriesDescription);\r",
											"        if(isFlairType) return false;\r",
											"        if(!byStatus(x.r)) return false;\r",
											"        if(EXCLUDE_SET.has(String(x.id))) return false;\r",
											"        return true;\r",
											"      });\r",
											"\r",
											"    if(!nonFlair.length) throw new Error(\"ì‚­ì œ í›„ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. (T2-FLAIR ì™¸ ì‹œë¦¬ì¦ˆê°€ ì—†ìŒ ë˜ëŠ” ëª¨ë‘ ì œì™¸ë¨)\");\r",
											"\r",
											"    const idx = Math.floor(Math.random() * nonFlair.length);\r",
											"    const delId = nonFlair[idx].id;\r",
											"\r",
											"    pm.environment.set(\"SERIES_DELETE_ID\", String(delId));\r",
											"    pm.variables.set(\"SERIES_DELETE_ID\", String(delId));\r",
											"\r",
											"    console.log(`[${NS}] PICKED T2-FLAIR (info)`, {\r",
											"      id: String(flairId),\r",
											"      type: chosenFlair?.imageType,\r",
											"      status: chosenFlair?.status,\r",
											"      uploadDate: chosenFlair?.uploadDate\r",
											"    });\r",
											"    console.log(`[${NS}] PICKED NON T2-FLAIR (delete, random)`, {\r",
											"      id: String(delId),\r",
											"      type: nonFlair[idx].r?.imageType,\r",
											"      status: nonFlair[idx].r?.status,\r",
											"      uploadDate: nonFlair[idx].r?.uploadDate\r",
											"    });\r",
											"  });\r",
											"})();"
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"HTTP 200\", () => pm.response.to.have.status(200));\r",
											"\r",
											"let j={}; try{ j=pm.response.json(); }catch(_){}\r",
											"pm.test(\"ì„œë¹„ìŠ¤ code == 200\", () => pm.expect(j?.code ?? 200).to.eql(200));\r",
											"\r",
											"const r=j?.result||{};\r",
											"function norm(s){ return String(s||\"\").toLowerCase().replace(/[^a-z0-9]/g,\"\"); }\r",
											"\r",
											"pm.test(\"Image information_T2-FLAIR\", () => {\r",
											"  const t = r.imageType || r.seriesDescription || \"\";\r",
											"  pm.expect(norm(t)).to.eql(\"t2flair\");\r",
											"});\r",
											"\r",
											"console.log(\"[SERIES INFO - T2-FLAIR]\", {\r",
											"  SERIES_INFO_ID: pm.environment.get(\"SERIES_INFO_ID\"),\r",
											"  imageType: r.imageType,\r",
											"  seriesDescription: r.seriesDescription,\r",
											"  studyId: r.studyId,\r",
											"  noOfImages: r.noOfImages\r",
											"});\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{baseUrl}}/app/api/series/info/{{SERIES_INFO_ID}}",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"series",
										"info",
										"{{SERIES_INFO_ID}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "ì´ë¯¸ì§€ ì¡°ì‘ ê¶Œí•œ ìœ ë¬´_ ì´ë¯¸ì§€ ì‚­ì œ ë¶ˆê°€",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// --- Authorization & headers ---\r",
											"const token = pm.environment.get(\"access_token\");\r",
											"if (!token) pm.expect.fail(\"access_token ì´ ì—†ìŠµë‹ˆë‹¤.\");\r",
											"pm.request.headers.upsert({ key: \"Authorization\", value: \"Bearer \" + token });\r",
											"pm.request.headers.upsert({ key: \"Accept\", value: \"application/json\" });\r",
											"\r",
											"// --- URL ë IDë¥¼ ENVë¡œ ì¹˜í™˜ (ìˆ«ì/ë¬¸ì/UUID ëª¨ë‘) ---\r",
											"const sid = pm.environment.get(\"SERIES_INFO_ID\");\r",
											"if (!sid) pm.expect.fail(\"SERIES_INFO_ID ê°€ ì—†ìŠµë‹ˆë‹¤. (ì´ì „ ë‹¨ê³„ì—ì„œ T2-FLAIR ì„ íƒ í•„ìš”)\");\r",
											"pm.request.url = pm.request.url.toString().replace(/(\\/permission\\/)([^/]+)(?=\\/?$)/, `$1${sid}`);\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// 1) ê¸°ë³¸ HTTP/ì„œë¹„ìŠ¤ ì½”ë“œ + PASS ê¸°ì¤€(2xx OR 500+905)\r",
											"let body = {}; try { body = pm.response.json(); } catch(_) {}\r",
											"const http    = pm.response.code;\r",
											"const svcCode = (typeof body?.code !== \"undefined\") ? Number(body.code) : null;\r",
											"const svcMsg  = (typeof body?.message !== \"undefined\") ? String(body.message) : \"\";\r",
											"\r",
											"// PASS ì¡°ê±´\r",
											"const passVia2xx = http >= 200 && http < 300;\r",
											"const passVia905 = (http === 500 && svcCode === 905); // â˜… ì¶”ê°€: 500 + code=905 í—ˆìš©\r",
											"const PASS = passVia2xx || passVia905;\r",
											"\r",
											"// í•µì‹¬ PASS í…ŒìŠ¤íŠ¸(Runner íŒì •)\r",
											"pm.test(\"Verify that PASS criteria (2xx OR 500+905) is met\", () => {\r",
											"  pm.expect(PASS, `status=${http}, code=${svcCode}, msg=\"${svcMsg}\"`).to.be.true;\r",
											"});\r",
											"\r",
											"// ë³´ì¡° ê°€ë…ì„± í…ŒìŠ¤íŠ¸\r",
											"if (passVia905) {\r",
											"  pm.test(\"Expected exception accepted: 500 + code=905 (Cannot be performed)\", () => pm.expect(true).to.be.true);\r",
											"} else if (passVia2xx) {\r",
											"  // 2xxì¼ ë•Œë§Œ ê¸°ì¡´ ê²€ì¦ ìœ ì§€\r",
											"  pm.test(\"Verify that HTTP status is 200\", () => pm.response.to.have.status(200));\r",
											"  pm.test(\"Verify that service code is 200\", () => pm.expect(body?.code ?? 200).to.eql(200));\r",
											"}\r",
											"\r",
											"// 2) ê¶Œí•œ íŒì •(ì—¬ëŸ¬ ìŠ¤í‚¤ë§ˆ ì§€ì› + í•©ë¦¬ì  í´ë°±) â€” ê¸°ì¡´ ê·¸ëŒ€ë¡œ\r",
											"const toBool = v => (typeof v === \"boolean\") ? v : undefined;\r",
											"const r = body?.result ?? body ?? {};\r",
											"let allowed;\r",
											"\r",
											"// (A) result ìì²´ê°€ boolean\r",
											"if (typeof (body?.result) === \"boolean\") allowed = body.result;\r",
											"// (B) ìµœìƒìœ„/ì¤‘ì²© í‚¤ë“¤ì—ì„œ boolean ì°¾ê¸°\r",
											"if (allowed === undefined) {\r",
											"  const candidates = [\r",
											"    r.allowed, r.allow, r.isAllowed, r.permitted, r.permission, r.hasPermission,\r",
											"    r.canModify, r.canEdit, r.canAnalyze, r.manipulable, r.editable, r.canDelete, r.canAnnotate, r.canRun,\r",
											"    r?.permission?.allowed, r?.permission?.modify, r?.permission?.edit, r?.permission?.analyze\r",
											"  ].map(toBool).filter(v => v !== undefined);\r",
											"  if (candidates.length) allowed = candidates.some(Boolean);\r",
											"}\r",
											"// (C) HTTP 200/204ë©´ allow í´ë°±\r",
											"if (allowed === undefined) {\r",
											"  if (http === 200 || http === 204) allowed = true;\r",
											"}\r",
											"// (D) ë§ˆì§€ë§‰ í´ë°±: 401/403ë§Œ DENY, ê·¸ ì™¸ ALLOW\r",
											"if (allowed === undefined) {\r",
											"  allowed = !(http === 401 || http === 403);\r",
											"}\r",
											"\r",
											"// 3) ì‹¤íŒ¨ë¡œ ì²˜ë¦¬í•˜ì§€ ì•Šê³  ê²°ê³¼ë¥¼ ì €ì¥/í‘œì‹œ\r",
											"pm.environment.set(\"ANALYSIS_PERMISSION_BOOL\", String(Boolean(allowed)));\r",
											"pm.environment.set(\"ANALYSIS_PERMISSION\", allowed ? \"ALLOW\" : \"DENY\");\r",
											"\r",
											"// 4) ì•ˆë‚´ì„± í…ŒìŠ¤íŠ¸(í•­ìƒ í†µê³¼, ê°’ì€ ë¡œê·¸/ë¹„ì£¼ì–¼ë¼ì´ì €ë¡œ í™•ì¸)\r",
											"pm.test(`Manipulation permission (T2-FLAIR): ${allowed ? 'ALLOW' : 'DENY'}`, () => pm.expect(true).to.be.true);\r",
											"\r",
											"// 5) ë¡œê·¸ & ë¹„ì£¼ì–¼ë¼ì´ì €\r",
											"console.log(\"[Permission Check][T2-FLAIR]\", {\r",
											"  SERIES_INFO_ID: pm.environment.get(\"SERIES_INFO_ID\"),\r",
											"  http,\r",
											"  rawBody: body,\r",
											"  inferredAllowed: allowed,\r",
											"  passVia2xx,\r",
											"  passVia905\r",
											"});\r",
											"\r",
											"pm.visualizer.set(`\r",
											"  <style>body{font-family:ui-sans-serif} .ok{color:#16a34a} .no{color:#dc2626}</style>\r",
											"  <h3>Analysis Permission (T2-FLAIR)</h3>\r",
											"  <p><b>ID:</b> {{sid}}</p>\r",
											"  <p><b>PASS:</b> {{pass}}</p>\r",
											"  <p><b>Result:</b> <span class=\"{{allowed ? 'ok':'no'}}\">{{allowed ? 'ALLOW' : 'DENY'}}</span></p>\r",
											"  <pre>{{json}}</pre>\r",
											"`, { sid: pm.environment.get(\"SERIES_INFO_ID\"), allowed, pass: PASS, json: JSON.stringify(body, null, 2) });\r",
											"\r",
											"// --- Show modal copy in Test Results (safe with fallbacks) ---\r",
											"const sidForModal =\r",
											"  pm.variables.get(\"MODAL_CONTEXT_ID\") ||\r",
											"  pm.environment.get(\"SERIES_INFO_ID\") ||\r",
											"  \"(no id)\";\r",
											"\r",
											"const modalTextForModal =\r",
											"  pm.variables.get(\"MODAL_TEXT_EN\") ||\r",
											"  \"Do you want to delete the selected item?\";\r",
											"\r",
											"pm.test(`[Modal] ${modalTextForModal} | ID: ${sidForModal}`, () => {\r",
											"  pm.expect(true).to.be.true;\r",
											"});\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // ì´ˆê¸°í™”\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ ì „\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"\r",
											"    // â˜… ì§‘ê³„ PASS ê¸°ì¤€ë„ ë™ì¼í•˜ê²Œ ë°˜ì˜: (2xx) OR (500+905)\r",
											"    let ok = passVia2xx || passVia905;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/app/api/series/permission/{{SERIES_INFO_ID}}",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"series",
										"permission",
										"{{SERIES_INFO_ID}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "í™˜ì ë³„ ë¶„ì„ ëª©ë¡ ì¡°íšŒ (3)",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"const id = pm.environment.get(\"TARGET_IDENTIFIER\") || \"\"; // ì—†ìœ¼ë©´ ì „ì²´ê²€ìƒ‰\r",
											"const body = {\r",
											"  identifier: id,\r",
											"  name: \"\",\r",
											"  sex: null,\r",
											"  startDate: null,\r",
											"  endDate: null,\r",
											"  paginationReq: {\r",
											"    requestPageNumber: 1,\r",
											"    itemCountPerPage: 20,\r",
											"    order: \"desc\",\r",
											"    sortBy: \"\"\r",
											"  },\r",
											"  isSortById: false\r",
											"};\r",
											"\r",
											"// Content-Type ë³´ì •\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"// Body ì—…ë°ì´íŠ¸\r",
											"pm.request.body.update(JSON.stringify(body, null, 2));\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === 1) ì‘ë‹µ íŒŒì‹± & ê¸°ë³¸ í™•ì¸ ===\r",
											"let j = {}; \r",
											"try { j = pm.response.json(); } catch (e) {\r",
											"  pm.environment.unset(\"general_id\");\r",
											"  pm.test(\"HTTP 200\", () => pm.response.to.have.status(200));\r",
											"  throw new Error(\"[analysis list] JSON parse failed: \" + e);\r",
											"}\r",
											"\r",
											"pm.test(\"HTTP 200\", () => pm.response.to.have.status(200));\r",
											"if (typeof j?.code !== \"undefined\") {\r",
											"  pm.test(\"Service code == 200\", () => pm.expect(j.code).to.eql(200));\r",
											"}\r",
											"\r",
											"// === 2) ë¦¬ìŠ¤íŠ¸ ì¶”ì¶œ ===\r",
											"const list = Array.isArray(j?.result?.analysisInfoList) ? j.result.analysisInfoList : [];\r",
											"pm.test(\"analysisInfoList exists\", () => pm.expect(list.length, \"Empty analysisInfoList\").to.be.greaterThan(0));\r",
											"\r",
											"// === 3) (ì˜µì…˜) í•„í„°: í™˜ê²½ë³€ìˆ˜ë¡œ íƒ€ì…/ìƒíƒœ ì§€ì • ê°€ëŠ¥ ===\r",
											"//   - ANALYSIS_TYPE: ì˜ˆ) BRAIN_VOL / TAU_PET / AMYLOID_PET / ARIA_E / FLAIR_HI ...\r",
											"//   - ANALYSIS_STATUS: ì½¤ë§ˆë¡œ ì—¬ëŸ¬ ê°œ ì§€ì • ê°€ëŠ¥. ì˜ˆ) \"COMPLETED,FAILED\"\r",
											"const wantType   = (pm.environment.get(\"ANALYSIS_TYPE\")   || \"\").trim().toUpperCase(); // optional\r",
											"const wantStatus = (pm.environment.get(\"ANALYSIS_STATUS\") || \"\").trim().toUpperCase(); // optional\r",
											"\r",
											"function matchType(x)   { return !wantType   || String(x || \"\").toUpperCase()   === wantType; }\r",
											"function matchStatus(x) { \r",
											"  if (!wantStatus) return true;\r",
											"  const set = new Set(wantStatus.split(\",\").map(s => s.trim()).filter(Boolean));\r",
											"  return set.has(String(x || \"\").toUpperCase());\r",
											"}\r",
											"\r",
											"// === 4) ì„ íƒ: ì‘ë‹µ ìˆœì„œìƒ 'ì²« ë²ˆì§¸' ë§¤ì¹­ í•­ëª©ì˜ id ===\r",
											"let picked = null;\r",
											"for (const it of list) {\r",
											"  if (matchType(it?.analysisType) && matchStatus(it?.analysisStatusType)) {\r",
											"    picked = it;\r",
											"    break;\r",
											"  }\r",
											"}\r",
											"\r",
											"pm.test(\"Pick first matching item\", () => pm.expect(picked, \"No item matched filters\").to.exist);\r",
											"\r",
											"// === 5) í™˜ê²½ë³€ìˆ˜ ì €ì¥ ===\r",
											"if (picked && picked.id != null) {\r",
											"  const idStr = String(picked.id);\r",
											"  pm.environment.set(\"general_id\", idStr);\r",
											"  console.log(\"[STORE] general_id <-\", idStr, \r",
											"              \"| type=\", picked.analysisType, \r",
											"              \"| status=\", picked.analysisStatusType,\r",
											"              \"| complete=\", picked.analysisComplete);\r",
											"} else {\r",
											"  pm.environment.unset(\"general_id\");\r",
											"  console.warn(\"[STORE] general_id not set (missing id in picked item)\");\r",
											"}\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/patient/{{PATIENT_ID}}/analysis",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"patient",
										"{{PATIENT_ID}}",
										"analysis"
									]
								}
							},
							"response": []
						},
						{
							"name": "ë¶„ì„ ì¡°ì‘ ê¶Œí•œ ìœ ë¬´_ ë¶„ì„ ì‚­ì œ ë¶ˆê°€",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// --- Authorization & headers ---\r",
											"const token = pm.environment.get(\"access_token\");\r",
											"if (!token) pm.expect.fail(\"access_token ì´ ì—†ìŠµë‹ˆë‹¤.\");\r",
											"pm.request.headers.upsert({ key: \"Authorization\", value: \"Bearer \" + token });\r",
											"pm.request.headers.upsert({ key: \"Accept\", value: \"application/json\" });\r",
											"\r",
											"// --- URL ë IDë¥¼ ENVë¡œ ì¹˜í™˜ (ìˆ«ì/ë¬¸ì/UUID ëª¨ë‘) ---\r",
											"const sid = pm.environment.get(\"general_id\");\r",
											"if (!sid) pm.expect.fail(\"general_id_INFO_ID ê°€ ì—†ìŠµë‹ˆë‹¤. (ì´ì „ ë‹¨ê³„ì—ì„œ T2-FLAIR ì„ íƒ í•„ìš”)\");\r",
											"pm.request.url = pm.request.url.toString().replace(/(\\/permission\\/)([^/]+)(?=\\/?$)/, `$1${sid}`);\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// 1) ê¸°ë³¸ HTTP/ì„œë¹„ìŠ¤ ì½”ë“œ + PASS ê¸°ì¤€(2xx OR 500+905)\r",
											"let body = {}; try { body = pm.response.json(); } catch(_) {}\r",
											"const http    = pm.response.code;\r",
											"const svcCode = (typeof body?.code !== \"undefined\") ? Number(body.code) : null;\r",
											"const svcMsg  = (typeof body?.message !== \"undefined\") ? String(body.message) : \"\";\r",
											"\r",
											"// PASS ì¡°ê±´\r",
											"const passVia2xx = http >= 200 && http < 300;\r",
											"const passVia905 = (http === 500 && svcCode === 905); // â˜… ì¶”ê°€: 500 + code=905 í—ˆìš©\r",
											"const PASS = passVia2xx || passVia905;\r",
											"\r",
											"// í•µì‹¬ PASS í…ŒìŠ¤íŠ¸(Runner íŒì •)\r",
											"pm.test(\"Verify that PASS criteria (2xx OR 500+905) is met\", () => {\r",
											"  pm.expect(PASS, `status=${http}, code=${svcCode}, msg=\"${svcMsg}\"`).to.be.true;\r",
											"});\r",
											"\r",
											"// ë³´ì¡° ê°€ë…ì„± í…ŒìŠ¤íŠ¸\r",
											"if (passVia905) {\r",
											"  pm.test(\"Expected exception accepted: 500 + code=905 (Cannot be performed)\", () => pm.expect(true).to.be.true);\r",
											"} else if (passVia2xx) {\r",
											"  // 2xxì¼ ë•Œë§Œ ê¸°ì¡´ ê²€ì¦ ìœ ì§€\r",
											"  pm.test(\"Verify that HTTP status is 200\", () => pm.response.to.have.status(200));\r",
											"  pm.test(\"Verify that service code is 200\", () => pm.expect(body?.code ?? 200).to.eql(200));\r",
											"}\r",
											"\r",
											"// 2) ê¶Œí•œ íŒì •(ì—¬ëŸ¬ ìŠ¤í‚¤ë§ˆ ì§€ì› + í•©ë¦¬ì  í´ë°±) â€” ê¸°ì¡´ ê·¸ëŒ€ë¡œ\r",
											"const toBool = v => (typeof v === \"boolean\") ? v : undefined;\r",
											"const r = body?.result ?? body ?? {};\r",
											"let allowed;\r",
											"\r",
											"// (A) result ìì²´ê°€ boolean\r",
											"if (typeof (body?.result) === \"boolean\") allowed = body.result;\r",
											"// (B) ìµœìƒìœ„/ì¤‘ì²© í‚¤ë“¤ì—ì„œ boolean ì°¾ê¸°\r",
											"if (allowed === undefined) {\r",
											"  const candidates = [\r",
											"    r.allowed, r.allow, r.isAllowed, r.permitted, r.permission, r.hasPermission,\r",
											"    r.canModify, r.canEdit, r.canAnalyze, r.manipulable, r.editable, r.canDelete, r.canAnnotate, r.canRun,\r",
											"    r?.permission?.allowed, r?.permission?.modify, r?.permission?.edit, r?.permission?.analyze\r",
											"  ].map(toBool).filter(v => v !== undefined);\r",
											"  if (candidates.length) allowed = candidates.some(Boolean);\r",
											"}\r",
											"// (C) HTTP 200/204ë©´ allow í´ë°±\r",
											"if (allowed === undefined) {\r",
											"  if (http === 200 || http === 204) allowed = true;\r",
											"}\r",
											"// (D) ë§ˆì§€ë§‰ í´ë°±: 401/403ë§Œ DENY, ê·¸ ì™¸ ALLOW\r",
											"if (allowed === undefined) {\r",
											"  allowed = !(http === 401 || http === 403);\r",
											"}\r",
											"\r",
											"// 3) ì‹¤íŒ¨ë¡œ ì²˜ë¦¬í•˜ì§€ ì•Šê³  ê²°ê³¼ë¥¼ ì €ì¥/í‘œì‹œ\r",
											"pm.environment.set(\"ANALYSIS_PERMISSION_BOOL\", String(Boolean(allowed)));\r",
											"pm.environment.set(\"ANALYSIS_PERMISSION\", allowed ? \"ALLOW\" : \"DENY\");\r",
											"\r",
											"// 4) ì•ˆë‚´ì„± í…ŒìŠ¤íŠ¸(í•­ìƒ í†µê³¼, ê°’ì€ ë¡œê·¸/ë¹„ì£¼ì–¼ë¼ì´ì €ë¡œ í™•ì¸)\r",
											"pm.test(`Manipulation permission (T2-FLAIR): ${allowed ? 'ALLOW' : 'DENY'}`, () => pm.expect(true).to.be.true);\r",
											"\r",
											"// 5) ë¡œê·¸ & ë¹„ì£¼ì–¼ë¼ì´ì €\r",
											"console.log(\"[Permission Check][T2-FLAIR]\", {\r",
											"  general_id: pm.environment.get(\"general_id\"),\r",
											"  http,\r",
											"  rawBody: body,\r",
											"  inferredAllowed: allowed,\r",
											"  passVia2xx,\r",
											"  passVia905\r",
											"});\r",
											"\r",
											"pm.visualizer.set(`\r",
											"  <style>body{font-family:ui-sans-serif} .ok{color:#16a34a} .no{color:#dc2626}</style>\r",
											"  <h3>Analysis Permission (T2-FLAIR)</h3>\r",
											"  <p><b>ID:</b> {{sid}}</p>\r",
											"  <p><b>PASS:</b> {{pass}}</p>\r",
											"  <p><b>Result:</b> <span class=\"{{allowed ? 'ok':'no'}}\">{{allowed ? 'ALLOW' : 'DENY'}}</span></p>\r",
											"  <pre>{{json}}</pre>\r",
											"`, { sid: pm.environment.get(\"general_id\"), allowed, pass: PASS, json: JSON.stringify(body, null, 2) });\r",
											"\r",
											"// --- Show modal copy in Test Results (safe with fallbacks) ---\r",
											"const sidForModal =\r",
											"  pm.variables.get(\"MODAL_CONTEXT_ID\") ||\r",
											"  pm.environment.get(\"general_id\") ||\r",
											"  \"(no id)\";\r",
											"\r",
											"const modalTextForModal =\r",
											"  pm.variables.get(\"MODAL_TEXT_EN\") ||\r",
											"  \"Do you want to delete the selected item?\";\r",
											"\r",
											"pm.test(`[Modal] ${modalTextForModal} | ID: ${sidForModal}`, () => {\r",
											"  pm.expect(true).to.be.true;\r",
											"});\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // ì´ˆê¸°í™”\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ ì „\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"\r",
											"    // â˜… ì§‘ê³„ PASS ê¸°ì¤€ë„ ë™ì¼í•˜ê²Œ ë°˜ì˜: (2xx) OR (500+905)\r",
											"    let ok = passVia2xx || passVia905;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "",
										"value": "",
										"type": "text"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/app/api/analysis/permission/{{general_id}}",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"analysis",
										"permission",
										"{{general_id}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "í™˜ì ë“±ë¡",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === helpers ===\r",
											"function randInt(min,max){ min=Math.ceil(min); max=Math.floor(max); return Math.floor(Math.random()*(max-min+1))+min; }\r",
											"function randDigits(n){ let s=\"\"; for(let i=0;i<n;i++) s += Math.floor(Math.random()*10); return s; }\r",
											"function fmtYMD(d){ const y=d.getFullYear(), m=String(d.getMonth()+1).padStart(2,'0'), da=String(d.getDate()).padStart(2,'0'); return `${y}-${m}-${da}`; }\r",
											"function randDate(start,end){ const t=start.getTime()+Math.random()*(end.getTime()-start.getTime()); return new Date(t); }\r",
											"function pick(a){ return a[Math.floor(Math.random()*a.length)]; }\r",
											"\r",
											"// === options via ENV ===\r",
											"const SEND_PATIENT_ID = String(pm.environment.get(\"SEND_PATIENT_ID\") ?? \"false\").toLowerCase()===\"true\";\r",
											"const STRICT_NUMERIC_IDENTIFIER = String(pm.environment.get(\"STRICT_NUMERIC_IDENTIFIER\") ?? \"true\").toLowerCase()===\"true\";\r",
											"\r",
											"// analysisId ë³´ì •(í•„ìš”ì‹œ ìœ íš¨ê°’ìœ¼ë¡œ)\r",
											"const analysisIdEnv = pm.environment.get(\"ANALYSIS_ID\");\r",
											"const analysisId = Number.isFinite(Number(analysisIdEnv)) ? Number(analysisIdEnv) : 1;\r",
											"\r",
											"// patientId: ì„œë²„ ë°œê¸‰ì´ë©´ ë³´ë‚´ì§€ ë§ ê²ƒ (ENVë¡œ ì¼œë©´ ì „ì†¡)\r",
											"const patientIdSeed = pm.environment.get(\"PATIENT_ID_SEED\");\r",
											"const candidatePatientId = Number.isFinite(Number(patientIdSeed)) ? Number(patientIdSeed) : randInt(1, 9_999_999);\r",
											"\r",
											"// identifier: â˜… ê³ ì • \"taejekim\" (ENV IDENTIFIERê°€ ìˆìœ¼ë©´ ê·¸ ê°’ ì‚¬ìš©)\r",
											"let identifier = String(pm.environment.get(\"IDENTIFIER\") ?? \"general_user\");\r",
											"// ê³ ì •ê°’ì„ ìœ ì§€í•˜ê¸° ìœ„í•´ ìˆ«ìë§Œ ê°•ì œ(STRICT_NUMERIC_IDENTIFIER)ëŠ” ì ìš©í•˜ì§€ ì•ŠìŒ\r",
											"// (í•„ìš”í•˜ë©´ ì•„ë˜ í•œ ì¤„ ì£¼ì„ í•´ì œ)\r",
											"// if (STRICT_NUMERIC_IDENTIFIER) identifier = identifier.replace(/\\D+/g, \"\") || \"0\";\r",
											"\r",
											"// name: ë¬´ì‘ìœ„\r",
											"const firstNames = [\"Alex\",\"Chris\",\"Jordan\",\"Taylor\",\"Morgan\",\"Jamie\",\"Casey\",\"Drew\",\"Riley\",\"Sam\",\"Avery\",\"Jesse\",\"Reeves\"];\r",
											"const lastNames  = [\"Lee\",\"Kim\",\"Park\",\"Choi\",\"Morgan\",\"Scott\",\"Young\",\"Baker\",\"Cooper\",\"Bell\",\"Reeves\"];\r",
											"const name = `${pick(firstNames)} ${pick(lastNames)}`;\r",
											"\r",
											"// sex: ë°˜ë“œì‹œ ëŒ€ë¬¸ì M/F/U ì¤‘ í•˜ë‚˜\r",
											"let sex = (pm.environment.get(\"SEX\") || pick([\"M\",\"F\",\"U\"])).toString().toUpperCase();\r",
											"if (![\"M\",\"F\",\"U\"].includes(sex)) sex = \"M\";\r",
											"\r",
											"// birth: ìœ íš¨ ë‚ ì§œ(1930-01-01 ~ 2025-12-31)\r",
											"let birth = pm.environment.get(\"BIRTH\");\r",
											"if (!/^\\d{4}-\\d{2}-\\d{2}$/.test(birth || \"\")) {\r",
											"  const start = new Date(1930,0,1), end = new Date(2025,11,31);\r",
											"  birth = fmtYMD(randDate(start, end));\r",
											"}\r",
											"\r",
											"// === build body ===\r",
											"const body = {\r",
											"  analysisId: analysisId,\r",
											"  identifier: identifier,   // â† ê³ ì • \"taejekim\"\r",
											"  name:       name,          // â† ëœë¤\r",
											"  sex:        sex,\r",
											"  birth:      birth\r",
											"};\r",
											"if (SEND_PATIENT_ID) body.patientId = candidatePatientId;\r",
											"\r",
											"// === headers & inject ===\r",
											"pm.request.headers.upsert({ key:\"Content-Type\", value:\"application/json\" });\r",
											"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key:\"Authorization\", value:`Bearer ${token}` });\r",
											"\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(body, null, 2));\r",
											"\r",
											"console.log(\"[POST /app/api/patient] body =\", body);\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"HTTP 2xx\", () => pm.expect(pm.response.code).to.be.within(200,299));\r",
											"\r",
											"let j={}; try{ j=pm.response.json(); }catch(e){}\r",
											"if (typeof j.code !== \"undefined\") {\r",
											"  pm.test(\"service code === 200\", () => pm.expect(j.code).to.eql(200));\r",
											"}\r",
											"if (j?.code === 701) {\r",
											"  console.error(\"[701] Invalid parameter: Check patientId sending, analysisId validity, identifier format/length, sex enum, birth date format.\");\r",
											"}\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/patient",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"patient"
									]
								}
							},
							"response": []
						},
						{
							"name": "í™˜ì ëª©ë¡ ì¡°íšŒ_PATIENT ID ì €ì¥(general user)",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"const id = pm.environment.get(\"TARGET_IDENTIFIER\") || \"\"; // ì—†ìœ¼ë©´ ì „ì²´ê²€ìƒ‰\r",
											"const body = {\r",
											"  identifier: id,\r",
											"  name: \"\",\r",
											"  sex: null,\r",
											"  startDate: null,\r",
											"  endDate: null,\r",
											"  paginationReq: {\r",
											"    requestPageNumber: 1,\r",
											"    itemCountPerPage: 20,\r",
											"    order: \"desc\",\r",
											"    sortBy: \"\"\r",
											"  },\r",
											"  isSortById: false\r",
											"};\r",
											"\r",
											"// Content-Type ë³´ì •\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"// Body ì—…ë°ì´íŠ¸\r",
											"pm.request.body.update(JSON.stringify(body, null, 2));\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === 1) JSON íŒŒì‹± ===\r",
											"let json;\r",
											"try {\r",
											"  json = pm.response.json();\r",
											"} catch (e) {\r",
											"  pm.environment.unset(\"PATIENT_DELETE\");\r",
											"  console.error(\"ì‘ë‹µì´ JSONì´ ì•„ë‹˜:\", e);\r",
											"  return;\r",
											"}\r",
											"\r",
											"// === 2) contents ë°°ì—´ ì¶”ì¶œ ===\r",
											"let contents = [];\r",
											"try {\r",
											"  if (json && json.result && json.result.patientInfos && Array.isArray(json.result.patientInfos.contents)) {\r",
											"    contents = json.result.patientInfos.contents;\r",
											"  }\r",
											"} catch (_) {}\r",
											"\r",
											"// === 3) íƒ€ê¹ƒ identifier ê²°ì •\r",
											"// ìš°ì„ ìˆœìœ„: í™˜ê²½ë³€ìˆ˜ TARGET_IDENTIFIER > ìš”ì²­ bodyì˜ identifier(ë¹„ì–´ìˆì§€ ì•Šìœ¼ë©´) > \"general_user\"\r",
											"let targetIdentifier = pm.environment.get(\"TARGET_IDENTIFIER\");\r",
											"if (!targetIdentifier) {\r",
											"  try {\r",
											"    const raw = pm.request.body && pm.request.body.raw ? pm.request.body.raw : \"{}\";\r",
											"    const body = JSON.parse(raw);\r",
											"    if (body && body.identifier) targetIdentifier = body.identifier;\r",
											"  } catch (_) {}\r",
											"}\r",
											"if (!targetIdentifier) targetIdentifier = \"general_user\";\r",
											"\r",
											"// === 4) ë§¤ì¹­ ì°¾ê¸°\r",
											"const match = contents.find(o => o && o.identifier === targetIdentifier);\r",
											"\r",
											"// === 5) í™˜ê²½ë³€ìˆ˜ ì„¤ì • (ì½”ë“œ 200 + ë§¤ì¹­ ìˆì„ ë•Œë§Œ)\r",
											"if (json && json.code === 200 && match && match.id != null) {\r",
											"  pm.environment.set(\"PATIENT_DELETE\", String(match.id));\r",
											"  console.log(\"PATIENT_DELETE set to\", match.id);\r",
											"} else {\r",
											"  pm.environment.unset(\"PATIENT_DELETE\");\r",
											"  console.warn(\r",
											"    \"PATIENT_DELETE not set. ì´ìœ :\",\r",
											"    { code: json && json.code, targetIdentifier, identifiers: contents.map(x => x && x.identifier) }\r",
											"  );\r",
											"}\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											"\r",
											"\r",
											"\r",
											"\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/patient/search",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"patient",
										"search"
									]
								}
							},
							"response": []
						},
						{
							"name": "í™˜ì ì‚­ì œ ì‹¤íŒ¨_general_user",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === DELETE /app/api/patient/{{PATIENT_DELETE}} : PASS ê¸°ì¤€ = (HTTP 2xx) OR (HTTP 403 && code==403) ===\r",
											"(function () {\r",
											"  // ì‘ë‹µ íŒŒì‹±\r",
											"  let j = null;\r",
											"  try { j = pm.response.json(); } catch (e) {}\r",
											"\r",
											"  const http    = pm.response.code;\r",
											"  const svcCode = (j && typeof j.code !== \"undefined\") ? Number(j.code) : null;\r",
											"  const svcMsg  = (j && typeof j.message !== \"undefined\") ? String(j.message) : \"\";\r",
											"\r",
											"  // PASS ì¡°ê±´\r",
											"  const is2xx          = http >= 200 && http < 300;\r",
											"  const isExpected403  = (http === 403 && svcCode === 403); // \"Unauthorized user\"\r",
											"\r",
											"  const PASS = is2xx || isExpected403;\r",
											"\r",
											"  // í•µì‹¬ í…ŒìŠ¤íŠ¸ (Runner PASS íŒì •ìš©)\r",
											"  pm.test(\"DELETE /patient: PASS ì¡°ê±´ ì¶©ì¡±\", function () {\r",
											"    pm.expect(PASS, `status=${http}, code=${svcCode}, msg=\"${svcMsg}\"`).to.be.true;\r",
											"  });\r",
											"\r",
											"  // ë³´ì¡°(ê°€ë…ì„±) í…ŒìŠ¤íŠ¸\r",
											"  if (isExpected403) {\r",
											"    pm.test(\"ì˜ˆìƒëœ ì˜ˆì™¸ ìˆ˜ìš©: 403 + code=403 (Unauthorized user)\", function () {\r",
											"      pm.expect(true).to.be.true;\r",
											"    });\r",
											"  } else if (is2xx) {\r",
											"    pm.test(\"ì •ìƒ ì‚­ì œ(HTTP 2xx)\", function () { pm.expect(true).to.be.true; });\r",
											"  } else {\r",
											"    pm.test(\"ë¹„í—ˆìš© ìƒíƒœ(ì°¸ê³ ìš©)\", function () {\r",
											"      pm.expect.fail(`Unexpected response. status=${http}, code=${svcCode}, message=\"${svcMsg}\"`);\r",
											"    });\r",
											"  }\r",
											"\r",
											"  // ì²´ì´ë‹/ë¦¬í¬íŒ…ìš© ë³€ìˆ˜\r",
											"  pm.environment.set(\"patient_delete_http_status\", String(http));\r",
											"  pm.environment.set(\"patient_delete_svc_code\", svcCode === null ? \"\" : String(svcCode));\r",
											"  pm.environment.set(\"patient_delete_message\", svcMsg);\r",
											"  pm.environment.set(\"patient_delete_pass\", PASS ? \"true\" : \"false\");\r",
											"\r",
											"  console.log(\"[DELETE/PATIENT] status=\", http, \"svcCode=\", svcCode, \"msg=\", svcMsg, \"=> PASS=\", PASS);\r",
											"})();\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 800;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "DELETE",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/patient/{{PATIENT_DELETE}}",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"patient",
										"{{PATIENT_DELETE}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "ë¡œê·¸ì•„ì›ƒ",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"if (pm.response.code === 200) {\r",
											"    pm.test(\"ë¡œê·¸ì•„ì›ƒ ì„±ê³µ\", function () {\r",
											"        pm.expect(pm.response.code).to.eql(200);\r",
											"    });\r",
											"\r",
											"    console.log(\"âœ… ë¡œê·¸ì•„ì›ƒ ì„±ê³µ, í† í° ë§Œë£Œ ì²˜ë¦¬ ì‹œì‘\");\r",
											"\r",
											"    // ğŸ”‘ í™˜ê²½ë³€ìˆ˜ì—ì„œ í† í° ì‚­ì œ\r",
											"    pm.environment.unset(\"access_token\");\r",
											"    console.log(\"ğŸ—‘ï¸ accessToken ì‚­ì œ ì™„ë£Œ\");\r",
											"\r",
											"\r",
											"} else {\r",
											"    pm.test(\"ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨\", function () {\r",
											"        pm.expect(pm.response.code).to.eql(200);\r",
											"    });\r",
											"    console.log(\"âŒ ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨ - ì‘ë‹µì½”ë“œ:\", pm.response.code);\r",
											"}\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try {\r",
											"      rows = JSON.parse(pm.collectionVariables.get('__log') || '[]');\r",
											"    } catch (e) {\r",
											"      console.error(TAG, 'parse __log error:', e);\r",
											"      rows = [];\r",
											"    }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"      last:  row\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"  \r",
											"})();\r",
											"// í† í° ì‚­ì œ í™•ì¸ìš©\r",
											"console.log(\"ğŸ“Œ ë¡œê·¸ì•„ì›ƒ ìš”ì²­ í—¤ë”:\", pm.request.headers.toObject());\r",
											"console.log(\"ğŸ“Œ accessToken:\", pm.environment.get(\"access_token\"));\r",
											"console.log(\"ğŸ“Œ ë¡œê·¸ì•„ì›ƒ ì‘ë‹µ Body:\", pm.response.text());\r",
											"\r",
											"\r",
											"// === [AGG DEBUG] ëª¨ë“  ìš”ì²­ ë’¤ì— ì‹¤í–‰ë˜ì–´ ë¡œê·¸/ì¹´ìš´íŠ¸ ëˆ„ì  ===\r",
											"\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "DELETE",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "http://127.0.0.1/identity/api/access/logout",
									"protocol": "http",
									"host": [
										"127",
										"0",
										"0",
										"1"
									],
									"path": [
										"identity",
										"api",
										"access",
										"logout"
									]
								}
							},
							"response": []
						}
					]
				},
				{
					"name": "general user í™˜ì ì‚­ì œ",
					"item": [
						{
							"name": "Advanced user ë¡œê·¸ì¸",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// ===== 0) SJCL ì†ŒìŠ¤ ë¡œë“œ (ë„¤íŠ¸ì›Œí¬ X) =====\r",
											"const SJCL_SRC = pm.environment.get(\"sjcl_src\") || pm.globals.get(\"sjcl_src\");\r",
											"if (!SJCL_SRC) throw new Error(\"sjcl_src ë³€ìˆ˜ì— sjcl.js ì „ì²´ ì†ŒìŠ¤ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.\");\r",
											"\r",
											"// ë…ë¦½ ìŠ¤ì½”í”„ì—ì„œ SJCL ê°ì²´ íšŒìˆ˜ (eval ìŠ¤ì½”í”„ ë¬¸ì œ ë°©ì§€)\r",
											"function buildSJCL(src) {\r",
											"  const factory = new Function(`\r",
											"    var window = {}; var self = window; var global = window;\r",
											"    var module = { exports: {} }; var exports = module.exports;\r",
											"    ${src}\r",
											"    return (typeof sjcl !== \"undefined\") ? sjcl\r",
											"         : (module && module.exports ? module.exports\r",
											"         : (window.sjcl || exports.sjcl));\r",
											"  `);\r",
											"  const lib = factory();\r",
											"  if (!lib || !lib.cipher || !lib.mode || !lib.codec) throw new Error(\"SJCL ë¡œë“œ ì‹¤íŒ¨\");\r",
											"  return lib;\r",
											"}\r",
											"const SJCL = buildSJCL(SJCL_SRC);\r",
											"\r",
											"// ===== 1) CryptoJS (Postman ë‚´ì¥) =====\r",
											"const CryptoJS = require(\"crypto-js\");\r",
											"\r",
											"// ===== 2) ìœ í‹¸ =====\r",
											"function randomBytes(n){\r",
											"  const wa = CryptoJS.lib.WordArray.random(n);\r",
											"  const hex = wa.toString(CryptoJS.enc.Hex);\r",
											"  const out = [];\r",
											"  for (let i=0;i<hex.length;i+=2) out.push(parseInt(hex.substr(i,2),16));\r",
											"  return out;\r",
											"}\r",
											"function bytesToBits(bytes){\r",
											"  let hex = \"\";\r",
											"  for (let i=0;i<bytes.length;i++){\r",
											"    const h = bytes[i].toString(16);\r",
											"    hex += (h.length===1 ? \"0\"+h : h);\r",
											"  }\r",
											"  return SJCL.codec.hex.toBits(hex);\r",
											"}\r",
											"\r",
											"// AES-128-GCM (iv 12B, tag 16B), í‚¤: sha256(key).hex -> ì•16(ASCII, UPPER)\r",
											"function encryptOnce(keyStr, plain){\r",
											"  const ivBytes = randomBytes(12);                        // IV_LENGTH = 12\r",
											"  const ivBits  = bytesToBits(ivBytes);\r",
											"\r",
											"  const tempKeyHex   = CryptoJS.SHA256(keyStr).toString(CryptoJS.enc.Hex).toUpperCase();\r",
											"  const secretKeyStr = tempKeyHex.substring(0,16).toUpperCase();    // ASCII 16 bytes\r",
											"  const keyBits = SJCL.codec.utf8String.toBits(secretKeyStr);\r",
											"\r",
											"  const ptBits = SJCL.codec.utf8String.toBits(plain);\r",
											"  const aes    = new SJCL.cipher.aes(keyBits);\r",
											"\r",
											"  const ctWithTag = SJCL.mode.gcm.encrypt(aes, ptBits, ivBits, [], 128); // tag 128-bit\r",
											"  const combined  = SJCL.bitArray.concat(bytesToBits(ivBytes), ctWithTag);// iv + ct + tag\r",
											"  return SJCL.codec.base64.fromBits(combined);                            // standard Base64\r",
											"}\r",
											"\r",
											"// ===== 3) ë©”ì¸: ë°”ë””ì—ì„œ ID/íŒ¨ìŠ¤ì›Œë“œ ì½ì–´ ë™ì¼ IDë¡œ ì•”í˜¸í™” =====\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"\r",
											"let body;\r",
											"try {\r",
											"  body = JSON.parse(pm.request.body.raw || \"{}\");\r",
											"} catch (e) {\r",
											"  throw new Error(\"Bodyê°€ JSONì´ ì•„ë‹™ë‹ˆë‹¤.\");\r",
											"}\r",
											"\r",
											"// ì„œë²„ê°€ ì½ëŠ” ID í•„ë“œëª…ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš© (loginId / id / userId ì¤‘ í•˜ë‚˜)\r",
											"const keyId = String(body.loginId ?? body.id ?? body.userId ?? \"\").trim();\r",
											"if (!keyId) throw new Error(\"Bodyì— loginId/id/userId ì¤‘ í•˜ë‚˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.\");\r",
											"\r",
											"let plainPw;\r",
											"if (typeof body.password === \"string\" && body.password.trim() && !body.password.includes(\"{{\")) {\r",
											"  // ë°”ë””ì— í‰ë¬¸ì´ ìˆìœ¼ë©´ ê·¸ê±¸ ì‚¬ìš©\r",
											"  plainPw = body.password;\r",
											"} else {\r",
											"  // ì—†ìœ¼ë©´ í™˜ê²½ë³€ìˆ˜ì—ì„œ í‰ë¬¸ì„ ê°€ì ¸ì™€ ì‚¬ìš© (ì„ íƒ)\r",
											"  plainPw = pm.environment.get(\"PLAIN_PW\");\r",
											"  if (!plainPw) throw new Error(\"password í‰ë¬¸ì´ í•„ìš”í•©ë‹ˆë‹¤ (Body.password ë˜ëŠ” í™˜ê²½ë³€ìˆ˜ PLAIN_PW).\");\r",
											"}\r",
											"\r",
											"const encPw = encryptOnce(keyId, plainPw);\r",
											"\r",
											"// ë°”ë””ì— ì•”í˜¸ë¬¸ ë°˜ì˜\r",
											"body.password = encPw;\r",
											"pm.request.body.update(JSON.stringify(body));\r",
											"\r",
											"// í•„ìš” ì‹œ ë³€ìˆ˜ë¡œë„ ë…¸ì¶œ (ë‹¤ë¥¸ ìš”ì²­ì—ì„œ ì¬ì‚¬ìš©)\r",
											"pm.variables.set(\"ENC_PW\", encPw);\r",
											"\r",
											"// ë””ë²„ê·¸ ë¡œê·¸\r",
											"console.log(\"Enc with ID =\", keyId, \", Base64 length =\", encPw.length);\r",
											"\r",
											"\r",
											"\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// ë¡œê·¸ì¸ ì‘ë‹µ ì½”ë“œ ê²€ì‚¬\r",
											"if (pm.response.code === 200) {\r",
											"  pm.test(\"ë¡œê·¸ì¸ ì„±ê³µ\", function () {\r",
											"    pm.expect(pm.response.code).to.eql(200);\r",
											"  });\r",
											"\r",
											"  // ì‘ë‹µ JSON íŒŒì‹±\r",
											"  let jsonData; try { jsonData = pm.response.json(); } catch (e) { jsonData = null; }\r",
											"\r",
											"  if (jsonData && jsonData.result && jsonData.result.accessToken && jsonData.result.accessToken.token) {\r",
											"    const token = jsonData.result.accessToken.token;\r",
											"\r",
											"    // ğŸ‘‰ í™˜ê²½ë³€ìˆ˜ ì €ì¥\r",
											"    pm.environment.set(\"access_token\", token);\r",
											"    console.log(\"ğŸ”‘ í† í° ì €ì¥ë¨:\", token);\r",
											"  } else {\r",
											"    console.log(\"âš ï¸ ì‘ë‹µì—ì„œ í† í°ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\");\r",
											"  }\r",
											"\r",
											"} else {\r",
											"  // ì‹¤íŒ¨ ë©”ì‹œì§€ ì¶œë ¥\r",
											"  pm.test(\"ë¡œê·¸ì¸ ì‹¤íŒ¨ - ì‘ë‹µì½”ë“œ: \" + pm.response.code, function () {\r",
											"    pm.expect(pm.response.code).to.eql(200);\r",
											"  });\r",
											"}\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n  \"loginId\": \"kjhan\",\r\n  \"password\": \"marine6c!\",\r\n  \"isRestrictNewToken\": true\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/identity/api/access/login",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"identity",
										"api",
										"access",
										"login"
									]
								}
							},
							"response": []
						},
						{
							"name": "í™˜ì ëª©ë¡ ì¡°íšŒ_PATIENT ID ì €ì¥(general user)",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"const id = pm.environment.get(\"TARGET_IDENTIFIER\") || \"\"; // ì—†ìœ¼ë©´ ì „ì²´ê²€ìƒ‰\r",
											"const body = {\r",
											"  identifier: id,\r",
											"  name: \"\",\r",
											"  sex: null,\r",
											"  startDate: null,\r",
											"  endDate: null,\r",
											"  paginationReq: {\r",
											"    requestPageNumber: 1,\r",
											"    itemCountPerPage: 20,\r",
											"    order: \"desc\",\r",
											"    sortBy: \"\"\r",
											"  },\r",
											"  isSortById: false\r",
											"};\r",
											"\r",
											"// Content-Type ë³´ì •\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"// Body ì—…ë°ì´íŠ¸\r",
											"pm.request.body.update(JSON.stringify(body, null, 2));\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === 1) JSON íŒŒì‹± ===\r",
											"let json;\r",
											"try {\r",
											"  json = pm.response.json();\r",
											"} catch (e) {\r",
											"  pm.environment.unset(\"PATIENT_DELETE\");\r",
											"  console.error(\"ì‘ë‹µì´ JSONì´ ì•„ë‹˜:\", e);\r",
											"  return;\r",
											"}\r",
											"\r",
											"// === 2) contents ë°°ì—´ ì¶”ì¶œ ===\r",
											"let contents = [];\r",
											"try {\r",
											"  if (json && json.result && json.result.patientInfos && Array.isArray(json.result.patientInfos.contents)) {\r",
											"    contents = json.result.patientInfos.contents;\r",
											"  }\r",
											"} catch (_) {}\r",
											"\r",
											"// === 3) íƒ€ê¹ƒ identifier ê²°ì •\r",
											"// ìš°ì„ ìˆœìœ„: í™˜ê²½ë³€ìˆ˜ TARGET_IDENTIFIER > ìš”ì²­ bodyì˜ identifier(ë¹„ì–´ìˆì§€ ì•Šìœ¼ë©´) > \"general_user\"\r",
											"let targetIdentifier = pm.environment.get(\"TARGET_IDENTIFIER\");\r",
											"if (!targetIdentifier) {\r",
											"  try {\r",
											"    const raw = pm.request.body && pm.request.body.raw ? pm.request.body.raw : \"{}\";\r",
											"    const body = JSON.parse(raw);\r",
											"    if (body && body.identifier) targetIdentifier = body.identifier;\r",
											"  } catch (_) {}\r",
											"}\r",
											"if (!targetIdentifier) targetIdentifier = \"general_user\";\r",
											"\r",
											"// === 4) ë§¤ì¹­ ì°¾ê¸°\r",
											"const match = contents.find(o => o && o.identifier === targetIdentifier);\r",
											"\r",
											"// === 5) í™˜ê²½ë³€ìˆ˜ ì„¤ì • (ì½”ë“œ 200 + ë§¤ì¹­ ìˆì„ ë•Œë§Œ)\r",
											"if (json && json.code === 200 && match && match.id != null) {\r",
											"  pm.environment.set(\"PATIENT_DELETE\", String(match.id));\r",
											"  console.log(\"PATIENT_DELETE set to\", match.id);\r",
											"} else {\r",
											"  pm.environment.unset(\"PATIENT_DELETE\");\r",
											"  console.warn(\r",
											"    \"PATIENT_DELETE not set. ì´ìœ :\",\r",
											"    { code: json && json.code, targetIdentifier, identifiers: contents.map(x => x && x.identifier) }\r",
											"  );\r",
											"}\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											"\r",
											"\r",
											"\r",
											"\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/patient/search",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"patient",
										"search"
									]
								}
							},
							"response": []
						},
						{
							"name": "í™˜ì ì‚­ì œ ì„±ê³µ_general user",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === DELETE /app/api/patient/{{PATIENT_DELETE}} : PASS ê¸°ì¤€ = (HTTP 2xx) OR (HTTP 403 && code==403) ===\r",
											"(function () {\r",
											"  // ì‘ë‹µ íŒŒì‹±\r",
											"  let j = null;\r",
											"  try { j = pm.response.json(); } catch (e) {}\r",
											"\r",
											"  const http    = pm.response.code;\r",
											"  const svcCode = (j && typeof j.code !== \"undefined\") ? Number(j.code) : null;\r",
											"  const svcMsg  = (j && typeof j.message !== \"undefined\") ? String(j.message) : \"\";\r",
											"\r",
											"  // PASS ì¡°ê±´\r",
											"  const is2xx          = http >= 200 && http < 300;\r",
											"  const isExpected403  = (http === 403 && svcCode === 403); // \"Unauthorized user\"\r",
											"\r",
											"  const PASS = is2xx || isExpected403;\r",
											"\r",
											"  // í•µì‹¬ í…ŒìŠ¤íŠ¸ (Runner PASS íŒì •ìš©)\r",
											"  pm.test(\"DELETE /patient: PASS ì¡°ê±´ ì¶©ì¡±\", function () {\r",
											"    pm.expect(PASS, `status=${http}, code=${svcCode}, msg=\"${svcMsg}\"`).to.be.true;\r",
											"  });\r",
											"\r",
											"  // ë³´ì¡°(ê°€ë…ì„±) í…ŒìŠ¤íŠ¸\r",
											"  if (isExpected403) {\r",
											"    pm.test(\"ì˜ˆìƒëœ ì˜ˆì™¸ ìˆ˜ìš©: 403 + code=403 (Unauthorized user)\", function () {\r",
											"      pm.expect(true).to.be.true;\r",
											"    });\r",
											"  } else if (is2xx) {\r",
											"    pm.test(\"ì •ìƒ ì‚­ì œ(HTTP 2xx)\", function () { pm.expect(true).to.be.true; });\r",
											"  } else {\r",
											"    pm.test(\"ë¹„í—ˆìš© ìƒíƒœ(ì°¸ê³ ìš©)\", function () {\r",
											"      pm.expect.fail(`Unexpected response. status=${http}, code=${svcCode}, message=\"${svcMsg}\"`);\r",
											"    });\r",
											"  }\r",
											"\r",
											"  // ì²´ì´ë‹/ë¦¬í¬íŒ…ìš© ë³€ìˆ˜\r",
											"  pm.environment.set(\"patient_delete_http_status\", String(http));\r",
											"  pm.environment.set(\"patient_delete_svc_code\", svcCode === null ? \"\" : String(svcCode));\r",
											"  pm.environment.set(\"patient_delete_message\", svcMsg);\r",
											"  pm.environment.set(\"patient_delete_pass\", PASS ? \"true\" : \"false\");\r",
											"\r",
											"  console.log(\"[DELETE/PATIENT] status=\", http, \"svcCode=\", svcCode, \"msg=\", svcMsg, \"=> PASS=\", PASS);\r",
											"})();\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "DELETE",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/patient/{{PATIENT_DELETE}}",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"patient",
										"{{PATIENT_DELETE}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "ë¡œê·¸ì•„ì›ƒ",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"if (pm.response.code === 200) {\r",
											"    pm.test(\"ë¡œê·¸ì•„ì›ƒ ì„±ê³µ\", function () {\r",
											"        pm.expect(pm.response.code).to.eql(200);\r",
											"    });\r",
											"\r",
											"    console.log(\"âœ… ë¡œê·¸ì•„ì›ƒ ì„±ê³µ, í† í° ë§Œë£Œ ì²˜ë¦¬ ì‹œì‘\");\r",
											"\r",
											"    // ğŸ”‘ í™˜ê²½ë³€ìˆ˜ì—ì„œ í† í° ì‚­ì œ\r",
											"    pm.environment.unset(\"access_token\");\r",
											"    console.log(\"ğŸ—‘ï¸ accessToken ì‚­ì œ ì™„ë£Œ\");\r",
											"\r",
											"\r",
											"} else {\r",
											"    pm.test(\"ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨\", function () {\r",
											"        pm.expect(pm.response.code).to.eql(200);\r",
											"    });\r",
											"    console.log(\"âŒ ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨ - ì‘ë‹µì½”ë“œ:\", pm.response.code);\r",
											"}\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try {\r",
											"      rows = JSON.parse(pm.collectionVariables.get('__log') || '[]');\r",
											"    } catch (e) {\r",
											"      console.error(TAG, 'parse __log error:', e);\r",
											"      rows = [];\r",
											"    }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"      last:  row\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"  \r",
											"})();\r",
											"// í† í° ì‚­ì œ í™•ì¸ìš©\r",
											"console.log(\"ğŸ“Œ ë¡œê·¸ì•„ì›ƒ ìš”ì²­ í—¤ë”:\", pm.request.headers.toObject());\r",
											"console.log(\"ğŸ“Œ accessToken:\", pm.environment.get(\"access_token\"));\r",
											"console.log(\"ğŸ“Œ ë¡œê·¸ì•„ì›ƒ ì‘ë‹µ Body:\", pm.response.text());\r",
											"\r",
											"\r",
											"// === [AGG DEBUG] ëª¨ë“  ìš”ì²­ ë’¤ì— ì‹¤í–‰ë˜ì–´ ë¡œê·¸/ì¹´ìš´íŠ¸ ëˆ„ì  ===\r",
											"\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "DELETE",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "http://127.0.0.1/identity/api/access/logout",
									"protocol": "http",
									"host": [
										"127",
										"0",
										"0",
										"1"
									],
									"path": [
										"identity",
										"api",
										"access",
										"logout"
									]
								}
							},
							"response": []
						}
					]
				}
			]
		},
		{
			"name": "ê³„ì •",
			"item": [
				{
					"name": "ê²Œì • ì ê¸ˆ/í•´ì œ ì‹œë‚˜ë¦¬ì˜¤",
					"item": [
						{
							"name": "ì ê¸ˆ/í•´ì œ ì‹œë‚˜ë¦¬ì˜¤1. user ê³„ì • ë¡œê·¸ì¸_ë¹„ì •ìƒ ì…ë ¥(6íšŒ ì´ìƒ)",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// ===== 0) SJCL ì†ŒìŠ¤ ë¡œë“œ =====\r",
											"const SJCL_SRC = pm.environment.get(\"sjcl_src\") || pm.globals.get(\"sjcl_src\");\r",
											"if (!SJCL_SRC) throw new Error(\"sjcl_src ë³€ìˆ˜ì— sjcl.js ì „ì²´ ì†ŒìŠ¤ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.\");\r",
											"function buildSJCL(src){\r",
											"  const factory = new Function(`\r",
											"    var window = {}; var self = window; var global = window;\r",
											"    var module = { exports: {} }; var exports = module.exports;\r",
											"    ${src}\r",
											"    return (typeof sjcl !== \"undefined\") ? sjcl\r",
											"         : (module && module.exports ? module.exports\r",
											"         : (window.sjcl || exports.sjcl));\r",
											"  `);\r",
											"  const lib = factory();\r",
											"  if (!lib || !lib.cipher || !lib.mode || !lib.codec) throw new Error(\"SJCL ë¡œë“œ ì‹¤íŒ¨\");\r",
											"  return lib;\r",
											"}\r",
											"const SJCL = buildSJCL(SJCL_SRC);\r",
											"\r",
											"// ===== 1) CryptoJS =====\r",
											"const CryptoJS = require(\"crypto-js\");\r",
											"\r",
											"// ===== 2) ìœ í‹¸ =====\r",
											"function randomBytes(n){\r",
											"  const wa = CryptoJS.lib.WordArray.random(n);\r",
											"  const hex = wa.toString(CryptoJS.enc.Hex);\r",
											"  const out = [];\r",
											"  for (let i=0;i<hex.length;i+=2) out.push(parseInt(hex.substr(i,2),16));\r",
											"  return out;\r",
											"}\r",
											"function bytesToBits(bytes){\r",
											"  let hex = \"\";\r",
											"  for (let i=0;i<bytes.length;i++){\r",
											"    const h = bytes[i].toString(16);\r",
											"    hex += (h.length===1 ? \"0\"+h : h);\r",
											"  }\r",
											"  return SJCL.codec.hex.toBits(hex);\r",
											"}\r",
											"// AES-128-GCM(iv=12, tag=16), key = sha256(loginId).hex ì•16(ASCII UPPER)\r",
											"function encryptOnce(keyStr, plain){\r",
											"  const ivBytes = randomBytes(12);\r",
											"  const ivBits  = bytesToBits(ivBytes);\r",
											"  const tempKeyHex   = CryptoJS.SHA256(keyStr).toString(CryptoJS.enc.Hex).toUpperCase();\r",
											"  const secretKeyStr = tempKeyHex.substring(0,16).toUpperCase();\r",
											"  const keyBits = SJCL.codec.utf8String.toBits(secretKeyStr);\r",
											"  const ptBits  = SJCL.codec.utf8String.toBits(plain);\r",
											"  const aes     = new SJCL.cipher.aes(keyBits);\r",
											"  const ctWithTag = SJCL.mode.gcm.encrypt(aes, ptBits, ivBits, [], 128);\r",
											"  const combined  = SJCL.bitArray.concat(bytesToBits(ivBytes), ctWithTag);\r",
											"  return SJCL.codec.base64.fromBits(combined);\r",
											"}\r",
											"\r",
											"// ===== 3) ëŒ€ìƒ ID/URL/ì˜ëª»ëœ ë¹„ë²ˆ(í‰ë¬¸) ìˆ˜ì§‘ =====\r",
											"const loginUrl = pm.environment.get('LOGIN_URL') || 'http://127.0.0.1/identity/api/access/login';\r",
											"\r",
											"let body={}; try{ body = JSON.parse(pm.request.body.raw||\"{}\"); }catch{}\r",
											"const loginId  = String(body.loginId ?? body.id ?? body.userId ?? pm.environment.get('LOGIN_ID') ?? '').trim();\r",
											"if (!loginId) throw new Error(\"ë¡œê·¸ì¸ ì‹œë„ìš© loginIdê°€ í•„ìš”í•©ë‹ˆë‹¤(Body.loginId ë˜ëŠ” í™˜ê²½ë³€ìˆ˜ LOGIN_ID).\");\r",
											"\r",
											"const wrongPlain = pm.environment.get('PREV_PW_1'); // â¬…ï¸ ì˜ëª»ëœ í‰ë¬¸ ë¹„ë°€ë²ˆí˜¸\r",
											"if (!wrongPlain) throw new Error(\"í™˜ê²½ë³€ìˆ˜ PREV_PW_1(í‹€ë¦° í‰ë¬¸ ë¹„ë°€ë²ˆí˜¸)ê°€ í•„ìš”í•©ë‹ˆë‹¤.\");\r",
											"\r",
											"// ===== 4) ê°™ì€ í‰ë¬¸(PREV_PW_1)ìœ¼ë¡œ 6ê°œì˜ ì•”í˜¸ë¬¸ ìƒì„±(IV ëœë¤) =====\r",
											"const wrongList = [];\r",
											"for (let i=1;i<=6;i++){\r",
											"  wrongList.push(encryptOnce(loginId, wrongPlain));\r",
											"}\r",
											"pm.variables.set('LOGIN_WRONG_ENC_LIST', JSON.stringify(wrongList));\r",
											"pm.variables.set('LOGIN_TARGET_ID', loginId);\r",
											"pm.variables.set('LOGIN_URL_EFFECTIVE', loginUrl);\r",
											"\r",
											"// ì´ ìš”ì²­ì˜ ë³¸ë¬¸ì€ ì˜ë¯¸ ì—†ìŒ(ì•„ë˜ Testsì—ì„œ ì‹¤ì œ ë¡œê·¸ì¸ ì‹œë„ ìˆ˜í–‰)\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"pm.request.body.update(JSON.stringify({ ping: true }));\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// ========== 6íšŒ ì‹¤íŒ¨ ë¡œê·¸ì¸ ì§ë ¬ ì‹œë„ & ìµœì¢… PASS íŒì •( maxTryCount>=6 í—ˆìš© ) ==========\r",
											"let wrongList = []; try { wrongList = JSON.parse(pm.variables.get('LOGIN_WRONG_ENC_LIST') || '[]'); } catch {}\r",
											"const loginId  = pm.variables.get('LOGIN_TARGET_ID');\r",
											"const loginUrl = pm.variables.get('LOGIN_URL_EFFECTIVE') || 'http://127.0.0.1/identity/api/access/login';\r",
											"\r",
											"pm.test('ì‚¬ì „ ì¤€ë¹„ ë³€ìˆ˜ í™•ì¸', () => {\r",
											"  pm.expect(loginId, 'loginId').to.be.a('string').and.not.empty;\r",
											"  pm.expect(wrongList, 'wrongList(6)').to.be.an('array').with.lengthOf(6);\r",
											"});\r",
											"\r",
											"const results = []; // ê° ì‹œë„: {http, svc, tryCount, maxTryCount}\r",
											"\r",
											"function num(x){ const n = Number(x); return isFinite(n) ? n : undefined; }\r",
											"\r",
											"function attempt(i){\r",
											"  if (i >= wrongList.length) {\r",
											"    // ==== ìµœì¢… í‰ê°€ ====\r",
											"    const last = results[results.length-1] || {};\r",
											"    const all401 = results.every(r => r.http === 401);\r",
											"\r",
											"    // ì„œë²„ê°€ ë¶ˆì¼ì¹˜/ë¯¸ì…ë ¥ì— 6010ì„ ì£¼ëŠ” ì¼€ì´ìŠ¤ ê¸°ì¤€(í•„ìš”ì‹œ í—ˆìš© ì½”ë“œ í™•ì¥)\r",
											"    const svcAllowed = (svc) => [6010, 6013].includes(svc);\r",
											"    const allSvcOK   = results.every(r => (typeof r.svc === 'undefined') || svcAllowed(r.svc));\r",
											"\r",
											"    // ì ê¸ˆ íŒë‹¨(ì¹´ìš´í„° ë˜ëŠ” ë³„ë„ ë½ ì½”ë“œ)\r",
											"    const tc = num(last.tryCount);\r",
											"    const mc = num(last.maxTryCount);\r",
											"    const lockedByCounter = (mc !== undefined && tc !== undefined && tc >= mc);\r",
											"    const lockedBySvc     = [6003,6004,6011].includes(last.svc); // í•„ìš” ì‹œ ì‹¤ì œ ë½ ì½”ë“œ ì¶”ê°€\r",
											"    const locked          = lockedByCounter || lockedBySvc;\r",
											"\r",
											"    // ğŸ”¸ ì¶”ê°€ í—ˆìš© ê·œì¹™: maxTryCountê°€ 6 ì´ìƒì´ë©´ í†µê³¼ í—ˆìš©\r",
											"    const passByMaxRule   = (mc !== undefined && mc >= 6);\r",
											"\r",
											"    // --- ëª…ì‹œì  í…ŒìŠ¤íŠ¸ ì¶œë ¥ ---\r",
											"    pm.test('ëª¨ë“  ì‹œë„ê°€ 401ì´ì–´ì•¼ í•¨', () => pm.expect(all401).to.eql(true));\r",
											"    pm.test('ì„œë¹„ìŠ¤ code ë°˜ë³µ(6010 í—ˆìš©)', () => pm.expect(allSvcOK).to.eql(true));\r",
											"\r",
											"    // ì ê¸ˆ ë„ë‹¬ ì—¬ë¶€ëŠ” ì •ë³´ë¡œë§Œ ì²´í¬(ë¶ˆí•©ê²©ì´ë©´ ë©”ì‹œì§€ì— ìƒíƒœ ë…¸ì¶œ)\r",
											"    pm.test('ì ê¸ˆ ë„ë‹¬ ì—¬ë¶€(ì •ë³´)', () => pm.expect(!!locked, `locked=${locked} (try=${tc}/${mc}, svc=${last.svc})`).to.be.a('boolean'));\r",
											"\r",
											"    // âœ… ìµœì¢… PASS ê¸°ì¤€:\r",
											"    //   - 6íšŒ ëª¨ë‘ 401 &&\r",
											"    //   - ì„œë¹„ìŠ¤ ì½”ë“œ í—ˆìš© &&\r",
											"    //   - (ì ê¸ˆ ë„ë‹¬) ë˜ëŠ” (maxTryCountê°€ 6 ì´ìƒ)\r",
											"    const ok = all401 && allSvcOK && (locked || passByMaxRule);\r",
											"\r",
											"    pm.test('ê³„ì • ì ê¸ˆ ìœ ë„ ì‹œë‚˜ë¦¬ì˜¤ê°€ ê¸°ëŒ€ëŒ€ë¡œ ë™ì‘í•´ì•¼ í•¨', () => \r",
											"      pm.expect(ok, `locked=${locked}, passByMaxRule=${passByMaxRule}, last={http:${last.http}, svc:${last.svc}, try:${tc}/${mc}}`).to.eql(true)\r",
											"    );\r",
											"\r",
											"    console.log('[LOCK-SUMMARY]', {\r",
											"      attempts: results.length,\r",
											"      lastHttp: last.http,\r",
											"      lastSvc: last.svc,\r",
											"      tryCount: tc,\r",
											"      maxTryCount: mc,\r",
											"      locked,\r",
											"      passByMaxRule,\r",
											"      ok\r",
											"    });\r",
											"\r",
											"    // ìƒíƒœ ë³€ìˆ˜ ì €ì¥(ì„ íƒ)\r",
											"    pm.collectionVariables.set('LOCK_LAST_HTTP', String(last.http ?? ''));\r",
											"    pm.collectionVariables.set('LOCK_LAST_SVC', String(last.svc ?? ''));\r",
											"    pm.collectionVariables.set('LOCK_LAST_TRY', String(tc ?? ''));\r",
											"    pm.collectionVariables.set('LOCK_LAST_MAX', String(mc ?? ''));\r",
											"    pm.collectionVariables.set('LOCK_LOCKED',   locked ? 'true' : 'false');\r",
											"    pm.collectionVariables.set('LOCK_OK',       ok ? 'true' : 'false');\r",
											"\r",
											"    // ì§‘ê³„ ì¹´ìš´í„° ê°±ì‹ \r",
											"    const total0 = Number(pm.collectionVariables.get('__req_total') || 0);\r",
											"    const pass0  = Number(pm.collectionVariables.get('__req_pass')  || 0);\r",
											"    const fail0  = Number(pm.collectionVariables.get('__req_fail')  || 0);\r",
											"    pm.collectionVariables.set('__req_total', total0 + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  pass0  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  fail0  + (ok ? 0 : 1));\r",
											"    return;\r",
											"  }\r",
											"\r",
											"  pm.sendRequest({\r",
											"    url: loginUrl,\r",
											"    method: 'POST',\r",
											"    header: { 'Content-Type': 'application/json', 'Accept': 'application/json' },\r",
											"    body: { mode: 'raw', raw: JSON.stringify({\r",
											"      loginId: loginId,\r",
											"      password: wrongList[i],     // PREV_PW_1(í‰ë¬¸) ë™ì¼ê°’ì„ ë§¤ì‹œë„ ì•”í˜¸í™”(IVë§Œ ë‹¤ë¦„)\r",
											"      isRestrictNewToken: false\r",
											"    }) }\r",
											"  }, (err, resp) => {\r",
											"    pm.test(`ì‹œë„ #${i+1} ì „ì†¡`, () => pm.expect(err).to.be.null);\r",
											"    let jj = {}; try { jj = resp.json(); } catch {}\r",
											"    results.push({\r",
											"      http: resp.code,\r",
											"      svc: (typeof jj?.code !== 'undefined' ? jj.code : undefined),\r",
											"      tryCount: jj?.result?.tryCount,\r",
											"      maxTryCount: jj?.result?.maxTryCount\r",
											"    });\r",
											"    // ì˜ë„: ì‹¤íŒ¨ì—¬ì•¼ í•˜ë¯€ë¡œ 401 ê¸°ëŒ€\r",
											"    pm.test(`ì‹œë„ #${i+1}ì€ 401ì´ì–´ì•¼ í•¨`, () => pm.expect(resp.code).to.eql(401));\r",
											"    attempt(i+1);\r",
											"  });\r",
											"}\r",
											"\r",
											"// ì§ë ¬ ì‹œì‘\r",
											"attempt(0);\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											"\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n  \"loginId\": \"kjhan\",\r\n  \"password\": \"{{PLAIN_PW}}\",\r\n  \"isRestrictNewToken\": true\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/identity/api/access/login",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"identity",
										"api",
										"access",
										"login"
									]
								}
							},
							"response": []
						},
						{
							"name": "ì ê¸ˆ/í•´ì œ ì‹œë‚˜ë¦¬ì˜¤2. user ê³„ì • ë¡œê·¸ì¸_ê³„ì • ì ê¸ˆ",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// ===== 0) SJCL ì†ŒìŠ¤ ë¡œë“œ (ë„¤íŠ¸ì›Œí¬ X) =====\r",
											"const SJCL_SRC = pm.environment.get(\"sjcl_src\") || pm.globals.get(\"sjcl_src\");\r",
											"if (!SJCL_SRC) throw new Error(\"sjcl_src ë³€ìˆ˜ì— sjcl.js ì „ì²´ ì†ŒìŠ¤ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.\");\r",
											"\r",
											"// ë…ë¦½ ìŠ¤ì½”í”„ì—ì„œ SJCL ê°ì²´ íšŒìˆ˜ (eval ìŠ¤ì½”í”„ ë¬¸ì œ ë°©ì§€)\r",
											"function buildSJCL(src) {\r",
											"  const factory = new Function(`\r",
											"    var window = {}; var self = window; var global = window;\r",
											"    var module = { exports: {} }; var exports = module.exports;\r",
											"    ${src}\r",
											"    return (typeof sjcl !== \"undefined\") ? sjcl\r",
											"         : (module && module.exports ? module.exports\r",
											"         : (window.sjcl || exports.sjcl));\r",
											"  `);\r",
											"  const lib = factory();\r",
											"  if (!lib || !lib.cipher || !lib.mode || !lib.codec) throw new Error(\"SJCL ë¡œë“œ ì‹¤íŒ¨\");\r",
											"  return lib;\r",
											"}\r",
											"const SJCL = buildSJCL(SJCL_SRC);\r",
											"\r",
											"// ===== 1) CryptoJS (Postman ë‚´ì¥) =====\r",
											"const CryptoJS = require(\"crypto-js\");\r",
											"\r",
											"// ===== 2) ìœ í‹¸ =====\r",
											"function randomBytes(n){\r",
											"  const wa = CryptoJS.lib.WordArray.random(n);\r",
											"  const hex = wa.toString(CryptoJS.enc.Hex);\r",
											"  const out = [];\r",
											"  for (let i=0;i<hex.length;i+=2) out.push(parseInt(hex.substr(i,2),16));\r",
											"  return out;\r",
											"}\r",
											"function bytesToBits(bytes){\r",
											"  let hex = \"\";\r",
											"  for (let i=0;i<bytes.length;i++){\r",
											"    const h = bytes[i].toString(16);\r",
											"    hex += (h.length===1 ? \"0\"+h : h);\r",
											"  }\r",
											"  return SJCL.codec.hex.toBits(hex);\r",
											"}\r",
											"\r",
											"// AES-128-GCM (iv 12B, tag 16B), í‚¤: sha256(key).hex -> ì•16(ASCII, UPPER)\r",
											"function encryptOnce(keyStr, plain){\r",
											"  const ivBytes = randomBytes(12);                        // IV_LENGTH = 12\r",
											"  const ivBits  = bytesToBits(ivBytes);\r",
											"\r",
											"  const tempKeyHex   = CryptoJS.SHA256(keyStr).toString(CryptoJS.enc.Hex).toUpperCase();\r",
											"  const secretKeyStr = tempKeyHex.substring(0,16).toUpperCase();    // ASCII 16 bytes\r",
											"  const keyBits = SJCL.codec.utf8String.toBits(secretKeyStr);\r",
											"\r",
											"  const ptBits = SJCL.codec.utf8String.toBits(plain);\r",
											"  const aes    = new SJCL.cipher.aes(keyBits);\r",
											"\r",
											"  const ctWithTag = SJCL.mode.gcm.encrypt(aes, ptBits, ivBits, [], 128); // tag 128-bit\r",
											"  const combined  = SJCL.bitArray.concat(bytesToBits(ivBytes), ctWithTag);// iv + ct + tag\r",
											"  return SJCL.codec.base64.fromBits(combined);                            // standard Base64\r",
											"}\r",
											"\r",
											"// ===== 3) ë©”ì¸: ë°”ë””ì—ì„œ ID/íŒ¨ìŠ¤ì›Œë“œ ì½ì–´ ë™ì¼ IDë¡œ ì•”í˜¸í™” =====\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"\r",
											"let body;\r",
											"try {\r",
											"  body = JSON.parse(pm.request.body.raw || \"{}\");\r",
											"} catch (e) {\r",
											"  throw new Error(\"Bodyê°€ JSONì´ ì•„ë‹™ë‹ˆë‹¤.\");\r",
											"}\r",
											"\r",
											"// ì„œë²„ê°€ ì½ëŠ” ID í•„ë“œëª…ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš© (loginId / id / userId ì¤‘ í•˜ë‚˜)\r",
											"const keyId = String(body.loginId ?? body.id ?? body.userId ?? \"\").trim();\r",
											"if (!keyId) throw new Error(\"Bodyì— loginId/id/userId ì¤‘ í•˜ë‚˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.\");\r",
											"\r",
											"let plainPw;\r",
											"if (typeof body.password === \"string\" && body.password.trim() && !body.password.includes(\"{{\")) {\r",
											"  // ë°”ë””ì— í‰ë¬¸ì´ ìˆìœ¼ë©´ ê·¸ê±¸ ì‚¬ìš©\r",
											"  plainPw = body.password;\r",
											"} else {\r",
											"  // ì—†ìœ¼ë©´ í™˜ê²½ë³€ìˆ˜ì—ì„œ í‰ë¬¸ì„ ê°€ì ¸ì™€ ì‚¬ìš© (ì„ íƒ)\r",
											"  plainPw = pm.environment.get(\"PLAIN_PW\");\r",
											"  if (!plainPw) throw new Error(\"password í‰ë¬¸ì´ í•„ìš”í•©ë‹ˆë‹¤ (Body.password ë˜ëŠ” í™˜ê²½ë³€ìˆ˜ PLAIN_PW).\");\r",
											"}\r",
											"\r",
											"const encPw = encryptOnce(keyId, plainPw);\r",
											"\r",
											"// ë°”ë””ì— ì•”í˜¸ë¬¸ ë°˜ì˜\r",
											"body.password = encPw;\r",
											"pm.request.body.update(JSON.stringify(body));\r",
											"\r",
											"// í•„ìš” ì‹œ ë³€ìˆ˜ë¡œë„ ë…¸ì¶œ (ë‹¤ë¥¸ ìš”ì²­ì—ì„œ ì¬ì‚¬ìš©)\r",
											"pm.variables.set(\"ENC_PW\", encPw);\r",
											"\r",
											"// ë””ë²„ê·¸ ë¡œê·¸\r",
											"console.log(\"Enc with ID =\", keyId, \", Base64 length =\", encPw.length);\r",
											"\r",
											"\r",
											"\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// ========== Tests (Post-response) ==========\r",
											"\r",
											"// 1) ì‘ë‹µ íŒŒì‹±\r",
											"let j = null; try { j = pm.response.json(); } catch (e) { j = null; }\r",
											"const svcRaw = (j && typeof j.code !== 'undefined') ? j.code : undefined;\r",
											"const svcCode = (svcRaw === undefined || svcRaw === null || svcRaw === '') ? undefined : Number(svcRaw);\r",
											"\r",
											"// 2) í—ˆìš© HTTP ë²”ìœ„(ì„±ê³µ/ë„¤ê±°í‹°ë¸Œ í¬í•¨)\r",
											"pm.test('HTTP 2xx/401 í—ˆìš©', () =>\r",
											"  pm.expect(pm.response.code).to.be.oneOf([200,201,401])\r",
											");\r",
											"\r",
											"// 3) ê¸°ëŒ€ ê²°ê³¼ íŒì •\r",
											"const loginOK  = (pm.response.code === 200 || pm.response.code === 201) && svcCode === 200;\r",
											"// âœ… ê³„ì • ì ê¹€(ìš”ì²­ê°’: 401 / 6013) â†’ PASS ì²˜ë¦¬\r",
											"const lockedOK = (pm.response.code === 401 && svcCode === 6013);\r",
											"\r",
											"// 4) í† í° ì €ì¥: ì„±ê³µì¼ ë•Œë§Œ\r",
											"if (loginOK) {\r",
											"  pm.test('ë¡œê·¸ì¸ ì„±ê³µ', () => pm.expect(pm.response.code).to.be.oneOf([200,201]));\r",
											"  const token = j?.result?.accessToken?.token;\r",
											"  if (token) {\r",
											"    pm.environment.set(\"access_token\", token);\r",
											"    console.log(\"ğŸ”‘ í† í° ì €ì¥ë¨:\", token);\r",
											"  } else {\r",
											"    console.log(\"âš ï¸ ì‘ë‹µì—ì„œ í† í°ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\");\r",
											"  }\r",
											"} else if (lockedOK) {\r",
											"  pm.test('ê³„ì • ì ê¹€(ì˜ˆìƒëœ ë„¤ê±°í‹°ë¸Œ) - 6013', () => pm.expect(true).to.eql(true));\r",
											"  const info = {\r",
											"    tryCount: j?.result?.tryCount,\r",
											"    maxTryCount: j?.result?.maxTryCount,\r",
											"    lockedDueTime: j?.result?.lockedDueTime\r",
											"  };\r",
											"  console.log('[LOGIN] ì˜ˆìƒëœ ê³„ì • ì ê¹€(401/6013) â†’ PASS', info);\r",
											"} else {\r",
											"  // ê·¸ ì™¸ëŠ” FAILë¡œ ë‚¨ê¹€\r",
											"  pm.test(`ë¡œê·¸ì¸ ì‹¤íŒ¨(ë¹„ì˜ˆìƒ) - HTTP ${pm.response.code}, svc ${svcCode}`, () => pm.expect(false).to.eql(true));\r",
											"}\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    if (isSummary) return;\r",
											"\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"\r",
											"    // âœ… PASS ê¸°ì¤€: ì •ìƒ ë¡œê·¸ì¸ OR ê³„ì • ì ê¹€(6013)\r",
											"    const ok = !!(loginOK || lockedOK);\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok,\r",
											"      svc: svcCode\r",
											"    };\r",
											"\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after, '| svc=', svcCode);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // IIFE\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n  \"loginId\": \"kjhan\",\r\n  \"password\": \"marine6c!\",\r\n  \"isRestrictNewToken\": false\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/identity/api/access/login",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"identity",
										"api",
										"access",
										"login"
									]
								}
							},
							"response": []
						},
						{
							"name": "ì ê¸ˆ/í•´ì œ ì‹œë‚˜ë¦¬ì˜¤3. master ê³„ì • ë¡œê·¸ì¸",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// ===== 0) SJCL ì†ŒìŠ¤ ë¡œë“œ (ë„¤íŠ¸ì›Œí¬ X) =====\r",
											"const SJCL_SRC = pm.environment.get(\"sjcl_src\") || pm.globals.get(\"sjcl_src\");\r",
											"if (!SJCL_SRC) throw new Error(\"sjcl_src ë³€ìˆ˜ì— sjcl.js ì „ì²´ ì†ŒìŠ¤ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.\");\r",
											"\r",
											"// ë…ë¦½ ìŠ¤ì½”í”„ì—ì„œ SJCL ê°ì²´ íšŒìˆ˜ (eval ìŠ¤ì½”í”„ ë¬¸ì œ ë°©ì§€)\r",
											"function buildSJCL(src) {\r",
											"  const factory = new Function(`\r",
											"    var window = {}; var self = window; var global = window;\r",
											"    var module = { exports: {} }; var exports = module.exports;\r",
											"    ${src}\r",
											"    return (typeof sjcl !== \"undefined\") ? sjcl\r",
											"         : (module && module.exports ? module.exports\r",
											"         : (window.sjcl || exports.sjcl));\r",
											"  `);\r",
											"  const lib = factory();\r",
											"  if (!lib || !lib.cipher || !lib.mode || !lib.codec) throw new Error(\"SJCL ë¡œë“œ ì‹¤íŒ¨\");\r",
											"  return lib;\r",
											"}\r",
											"const SJCL = buildSJCL(SJCL_SRC);\r",
											"\r",
											"// ===== 1) CryptoJS (Postman ë‚´ì¥) =====\r",
											"const CryptoJS = require(\"crypto-js\");\r",
											"\r",
											"// ===== 2) ìœ í‹¸ =====\r",
											"function randomBytes(n){\r",
											"  const wa = CryptoJS.lib.WordArray.random(n);\r",
											"  const hex = wa.toString(CryptoJS.enc.Hex);\r",
											"  const out = [];\r",
											"  for (let i=0;i<hex.length;i+=2) out.push(parseInt(hex.substr(i,2),16));\r",
											"  return out;\r",
											"}\r",
											"function bytesToBits(bytes){\r",
											"  let hex = \"\";\r",
											"  for (let i=0;i<bytes.length;i++){\r",
											"    const h = bytes[i].toString(16);\r",
											"    hex += (h.length===1 ? \"0\"+h : h);\r",
											"  }\r",
											"  return SJCL.codec.hex.toBits(hex);\r",
											"}\r",
											"\r",
											"// AES-128-GCM (iv 12B, tag 16B), í‚¤: sha256(key).hex -> ì•16(ASCII, UPPER)\r",
											"function encryptOnce(keyStr, plain){\r",
											"  const ivBytes = randomBytes(12);                        // IV_LENGTH = 12\r",
											"  const ivBits  = bytesToBits(ivBytes);\r",
											"\r",
											"  const tempKeyHex   = CryptoJS.SHA256(keyStr).toString(CryptoJS.enc.Hex).toUpperCase();\r",
											"  const secretKeyStr = tempKeyHex.substring(0,16).toUpperCase();    // ASCII 16 bytes\r",
											"  const keyBits = SJCL.codec.utf8String.toBits(secretKeyStr);\r",
											"\r",
											"  const ptBits = SJCL.codec.utf8String.toBits(plain);\r",
											"  const aes    = new SJCL.cipher.aes(keyBits);\r",
											"\r",
											"  const ctWithTag = SJCL.mode.gcm.encrypt(aes, ptBits, ivBits, [], 128); // tag 128-bit\r",
											"  const combined  = SJCL.bitArray.concat(bytesToBits(ivBytes), ctWithTag);// iv + ct + tag\r",
											"  return SJCL.codec.base64.fromBits(combined);                            // standard Base64\r",
											"}\r",
											"\r",
											"// ===== 3) ë©”ì¸: ë°”ë””ì—ì„œ ID/íŒ¨ìŠ¤ì›Œë“œ ì½ì–´ ë™ì¼ IDë¡œ ì•”í˜¸í™” =====\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"\r",
											"let body;\r",
											"try {\r",
											"  body = JSON.parse(pm.request.body.raw || \"{}\");\r",
											"} catch (e) {\r",
											"  throw new Error(\"Bodyê°€ JSONì´ ì•„ë‹™ë‹ˆë‹¤.\");\r",
											"}\r",
											"\r",
											"// ì„œë²„ê°€ ì½ëŠ” ID í•„ë“œëª…ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš© (loginId / id / userId ì¤‘ í•˜ë‚˜)\r",
											"const keyId = String(body.loginId ?? body.id ?? body.userId ?? \"\").trim();\r",
											"if (!keyId) throw new Error(\"Bodyì— loginId/id/userId ì¤‘ í•˜ë‚˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.\");\r",
											"\r",
											"let plainPw;\r",
											"if (typeof body.password === \"string\" && body.password.trim() && !body.password.includes(\"{{\")) {\r",
											"  // ë°”ë””ì— í‰ë¬¸ì´ ìˆìœ¼ë©´ ê·¸ê±¸ ì‚¬ìš©\r",
											"  plainPw = body.password;\r",
											"} else {\r",
											"  // ì—†ìœ¼ë©´ í™˜ê²½ë³€ìˆ˜ì—ì„œ í‰ë¬¸ì„ ê°€ì ¸ì™€ ì‚¬ìš© (ì„ íƒ)\r",
											"  plainPw = pm.environment.get(\"PLAIN_MAS_PW\");\r",
											"  if (!plainPw) throw new Error(\"password í‰ë¬¸ì´ í•„ìš”í•©ë‹ˆë‹¤ (Body.password ë˜ëŠ” í™˜ê²½ë³€ìˆ˜ PLAIN_MAS_PW).\");\r",
											"}\r",
											"\r",
											"const encPw = encryptOnce(keyId, plainPw);\r",
											"\r",
											"// ë°”ë””ì— ì•”í˜¸ë¬¸ ë°˜ì˜\r",
											"body.password = encPw;\r",
											"pm.request.body.update(JSON.stringify(body));\r",
											"\r",
											"// í•„ìš” ì‹œ ë³€ìˆ˜ë¡œë„ ë…¸ì¶œ (ë‹¤ë¥¸ ìš”ì²­ì—ì„œ ì¬ì‚¬ìš©)\r",
											"pm.variables.set(\"ENC_PW\", encPw);\r",
											"\r",
											"// ë””ë²„ê·¸ ë¡œê·¸\r",
											"console.log(\"Enc with ID =\", keyId, \", Base64 length =\", encPw.length);\r",
											"\r",
											"\r",
											"\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// ë¡œê·¸ì¸ ì‘ë‹µ ì½”ë“œ ê²€ì‚¬\r",
											"if (pm.response.code === 200) {\r",
											"  pm.test(\"ë¡œê·¸ì¸ ì„±ê³µ\", function () {\r",
											"    pm.expect(pm.response.code).to.eql(200);\r",
											"  });\r",
											"\r",
											"  // ì‘ë‹µ JSON íŒŒì‹±\r",
											"  let jsonData; try { jsonData = pm.response.json(); } catch (e) { jsonData = null; }\r",
											"\r",
											"  if (jsonData && jsonData.result && jsonData.result.accessToken && jsonData.result.accessToken.token) {\r",
											"    const token = jsonData.result.accessToken.token;\r",
											"\r",
											"    // ğŸ‘‰ í™˜ê²½ë³€ìˆ˜ ì €ì¥\r",
											"    pm.environment.set(\"access_token\", token);\r",
											"    console.log(\"ğŸ”‘ í† í° ì €ì¥ë¨:\", token);\r",
											"  } else {\r",
											"    console.log(\"âš ï¸ ì‘ë‹µì—ì„œ í† í°ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\");\r",
											"  }\r",
											"\r",
											"} else {\r",
											"  // ì‹¤íŒ¨ ë©”ì‹œì§€ ì¶œë ¥\r",
											"  pm.test(\"ë¡œê·¸ì¸ ì‹¤íŒ¨ - ì‘ë‹µì½”ë“œ: \" + pm.response.code, function () {\r",
											"    pm.expect(pm.response.code).to.eql(200);\r",
											"  });\r",
											"}\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n  \"loginId\": \"master\",\r\n  \"password\": \"{{PLAIN_MAS_PW}}\",\r\n  \"isRestrictNewToken\": true\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/identity/api/access/login",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"identity",
										"api",
										"access",
										"login"
									]
								}
							},
							"response": []
						},
						{
							"name": "ì ê¸ˆ/í•´ì œ ì‹œë‚˜ë¦¬ì˜¤4. user ê³„ì • ë¡œê·¸ì¸_ê³„ì • ì ê¸ˆ í•´ì œ",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// ========== Tests for UNLOCK (PATCH /identity/api/users/neuro3/unlock) ==========\r",
											"\r",
											"let j = null; try { j = pm.response.json(); } catch (e) {}\r",
											"\r",
											"// 1) HTTP 200ì´ë©´ PASS\r",
											"pm.test(\"HTTP 200\", () => pm.expect(pm.response.code).to.eql(200));\r",
											"\r",
											"// 2) (ì„ íƒ) ì„œë¹„ìŠ¤ codeë„ 200ì´ë©´ PASS\r",
											"if (j && typeof j.code !== \"undefined\") {\r",
											"  pm.test(\"ì„œë¹„ìŠ¤ code == 200\", () => pm.expect(j.code).to.eql(200));\r",
											"}\r",
											"\r",
											"// 3) (ì„ íƒ) URL ê²€ì¦: neuro3 ëŒ€ìƒì¸ì§€ ê°„ë‹¨ í™•ì¸\r",
											"pm.test(\"ëŒ€ìƒ ë¡œê·¸ì¸ID == kjhan\", () => {\r",
											"  const url = pm.request.url.toString();\r",
											"  pm.expect(url).to.include(\"/identity/api/users/kjhan/unlock\");\r",
											"});\r",
											"\r",
											"// 4) ì‹¤íŒ¨ ìƒí™© ë¡œê¹…(ì°¸ê³ )\r",
											"if (pm.response.code !== 200 || (j && typeof j.code !== \"undefined\" && j.code !== 200)) {\r",
											"  console.warn(\"[UNLOCK] ì‹¤íŒ¨ ì‘ë‹µ:\", { http: pm.response.code, svc: j?.code, msg: j?.message });\r",
											"}\r",
											"\r",
											"\r",
											"\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "PATCH",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/identity/api/users/kjhan/unlock",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"identity",
										"api",
										"users",
										"kjhan",
										"unlock"
									]
								}
							},
							"response": []
						},
						{
							"name": "ì ê¸ˆ/í•´ì œ ì‹œë‚˜ë¦¬ì˜¤5. master ë¡œê·¸ì•„ì›ƒ",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"if (pm.response.code === 200) {\r",
											"    pm.test(\"ë¡œê·¸ì•„ì›ƒ ì„±ê³µ\", function () {\r",
											"        pm.expect(pm.response.code).to.eql(200);\r",
											"    });\r",
											"\r",
											"    console.log(\"âœ… ë¡œê·¸ì•„ì›ƒ ì„±ê³µ, í† í° ë§Œë£Œ ì²˜ë¦¬ ì‹œì‘\");\r",
											"\r",
											"    // ğŸ”‘ í™˜ê²½ë³€ìˆ˜ì—ì„œ í† í° ì‚­ì œ\r",
											"    pm.environment.unset(\"access_token\");\r",
											"    console.log(\"ğŸ—‘ï¸ accessToken ì‚­ì œ ì™„ë£Œ\");\r",
											"\r",
											"\r",
											"} else {\r",
											"    pm.test(\"ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨\", function () {\r",
											"        pm.expect(pm.response.code).to.eql(200);\r",
											"    });\r",
											"    console.log(\"âŒ ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨ - ì‘ë‹µì½”ë“œ:\", pm.response.code);\r",
											"}\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try {\r",
											"      rows = JSON.parse(pm.collectionVariables.get('__log') || '[]');\r",
											"    } catch (e) {\r",
											"      console.error(TAG, 'parse __log error:', e);\r",
											"      rows = [];\r",
											"    }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"      last:  row\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"  \r",
											"})();\r",
											"// í† í° ì‚­ì œ í™•ì¸ìš©\r",
											"console.log(\"ğŸ“Œ ë¡œê·¸ì•„ì›ƒ ìš”ì²­ í—¤ë”:\", pm.request.headers.toObject());\r",
											"console.log(\"ğŸ“Œ accessToken:\", pm.environment.get(\"access_token\"));\r",
											"console.log(\"ğŸ“Œ ë¡œê·¸ì•„ì›ƒ ì‘ë‹µ Body:\", pm.response.text());\r",
											"\r",
											"\r",
											"// === [AGG DEBUG] ëª¨ë“  ìš”ì²­ ë’¤ì— ì‹¤í–‰ë˜ì–´ ë¡œê·¸/ì¹´ìš´íŠ¸ ëˆ„ì  ===\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "DELETE",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "http://127.0.0.1/identity/api/access/logout",
									"protocol": "http",
									"host": [
										"127",
										"0",
										"0",
										"1"
									],
									"path": [
										"identity",
										"api",
										"access",
										"logout"
									]
								}
							},
							"response": []
						}
					]
				},
				{
					"name": "user ê³„ì • ë¡œê·¸ì¸ ì‹¤íŒ¨_ê³„ì • ì •ë³´ ì¼ì¹˜í•˜ì§€ ì•ŠìŒ",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// ===== 0) SJCL ì†ŒìŠ¤ ë¡œë“œ (ë„¤íŠ¸ì›Œí¬ X) =====\r",
									"const SJCL_SRC = pm.environment.get(\"sjcl_src\") || pm.globals.get(\"sjcl_src\");\r",
									"if (!SJCL_SRC) throw new Error(\"sjcl_src ë³€ìˆ˜ì— sjcl.js ì „ì²´ ì†ŒìŠ¤ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.\");\r",
									"\r",
									"// ë…ë¦½ ìŠ¤ì½”í”„ì—ì„œ SJCL ê°ì²´ íšŒìˆ˜ (eval ìŠ¤ì½”í”„ ë¬¸ì œ ë°©ì§€)\r",
									"function buildSJCL(src) {\r",
									"  const factory = new Function(`\r",
									"    var window = {}; var self = window; var global = window;\r",
									"    var module = { exports: {} }; var exports = module.exports;\r",
									"    ${src}\r",
									"    return (typeof sjcl !== \"undefined\") ? sjcl\r",
									"         : (module && module.exports ? module.exports\r",
									"         : (window.sjcl || exports.sjcl));\r",
									"  `);\r",
									"  const lib = factory();\r",
									"  if (!lib || !lib.cipher || !lib.mode || !lib.codec) throw new Error(\"SJCL ë¡œë“œ ì‹¤íŒ¨\");\r",
									"  return lib;\r",
									"}\r",
									"const SJCL = buildSJCL(SJCL_SRC);\r",
									"\r",
									"// ===== 1) CryptoJS (Postman ë‚´ì¥) =====\r",
									"const CryptoJS = require(\"crypto-js\");\r",
									"\r",
									"// ===== 2) ìœ í‹¸ =====\r",
									"function randomBytes(n){\r",
									"  const wa = CryptoJS.lib.WordArray.random(n);\r",
									"  const hex = wa.toString(CryptoJS.enc.Hex);\r",
									"  const out = [];\r",
									"  for (let i=0;i<hex.length;i+=2) out.push(parseInt(hex.substr(i,2),16));\r",
									"  return out;\r",
									"}\r",
									"function bytesToBits(bytes){\r",
									"  let hex = \"\";\r",
									"  for (let i=0;i<bytes.length;i++){\r",
									"    const h = bytes[i].toString(16);\r",
									"    hex += (h.length===1 ? \"0\"+h : h);\r",
									"  }\r",
									"  return SJCL.codec.hex.toBits(hex);\r",
									"}\r",
									"\r",
									"// AES-128-GCM (iv 12B, tag 16B), í‚¤: sha256(key).hex -> ì•16(ASCII, UPPER)\r",
									"function encryptOnce(keyStr, plain){\r",
									"  const ivBytes = randomBytes(12);                        // IV_LENGTH = 12\r",
									"  const ivBits  = bytesToBits(ivBytes);\r",
									"\r",
									"  const tempKeyHex   = CryptoJS.SHA256(keyStr).toString(CryptoJS.enc.Hex).toUpperCase();\r",
									"  const secretKeyStr = tempKeyHex.substring(0,16).toUpperCase();    // ASCII 16 bytes\r",
									"  const keyBits = SJCL.codec.utf8String.toBits(secretKeyStr);\r",
									"\r",
									"  const ptBits = SJCL.codec.utf8String.toBits(plain);\r",
									"  const aes    = new SJCL.cipher.aes(keyBits);\r",
									"\r",
									"  const ctWithTag = SJCL.mode.gcm.encrypt(aes, ptBits, ivBits, [], 128); // tag 128-bit\r",
									"  const combined  = SJCL.bitArray.concat(bytesToBits(ivBytes), ctWithTag);// iv + ct + tag\r",
									"  return SJCL.codec.base64.fromBits(combined);                            // standard Base64\r",
									"}\r",
									"\r",
									"// ===== 3) ë©”ì¸: ë°”ë””ì—ì„œ ID/íŒ¨ìŠ¤ì›Œë“œ ì½ì–´ ë™ì¼ IDë¡œ ì•”í˜¸í™” =====\r",
									"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
									"\r",
									"let body;\r",
									"try {\r",
									"  body = JSON.parse(pm.request.body.raw || \"{}\");\r",
									"} catch (e) {\r",
									"  throw new Error(\"Bodyê°€ JSONì´ ì•„ë‹™ë‹ˆë‹¤.\");\r",
									"}\r",
									"\r",
									"// ì„œë²„ê°€ ì½ëŠ” ID í•„ë“œëª…ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš© (loginId / id / userId ì¤‘ í•˜ë‚˜)\r",
									"const keyId = String(body.loginId ?? body.id ?? body.userId ?? \"\").trim();\r",
									"if (!keyId) throw new Error(\"Bodyì— loginId/id/userId ì¤‘ í•˜ë‚˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.\");\r",
									"\r",
									"let plainPw;\r",
									"if (typeof body.password === \"string\" && body.password.trim() && !body.password.includes(\"{{\")) {\r",
									"  // ë°”ë””ì— í‰ë¬¸ì´ ìˆìœ¼ë©´ ê·¸ê±¸ ì‚¬ìš©\r",
									"  plainPw = body.password;\r",
									"} else {\r",
									"  // ì—†ìœ¼ë©´ í™˜ê²½ë³€ìˆ˜ì—ì„œ í‰ë¬¸ì„ ê°€ì ¸ì™€ ì‚¬ìš© (ì„ íƒ)\r",
									"  plainPw = pm.environment.get(\"PLAIN_PW\");\r",
									"  if (!plainPw) throw new Error(\"password í‰ë¬¸ì´ í•„ìš”í•©ë‹ˆë‹¤ (Body.password ë˜ëŠ” í™˜ê²½ë³€ìˆ˜ PLAIN_PW).\");\r",
									"}\r",
									"\r",
									"const encPw = encryptOnce(keyId, plainPw);\r",
									"\r",
									"// ë°”ë””ì— ì•”í˜¸ë¬¸ ë°˜ì˜\r",
									"body.password = encPw;\r",
									"pm.request.body.update(JSON.stringify(body));\r",
									"\r",
									"// í•„ìš” ì‹œ ë³€ìˆ˜ë¡œë„ ë…¸ì¶œ (ë‹¤ë¥¸ ìš”ì²­ì—ì„œ ì¬ì‚¬ìš©)\r",
									"pm.variables.set(\"ENC_PW\", encPw);\r",
									"\r",
									"// ë””ë²„ê·¸ ë¡œê·¸\r",
									"console.log(\"Enc with ID =\", keyId, \", Base64 length =\", encPw.length);\r",
									"\r",
									"\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// ========== Tests (Post-response) ==========\r",
									"\r",
									"// 1) ì‘ë‹µ íŒŒì‹±\r",
									"let j = null; try { j = pm.response.json(); } catch (e) { j = null; }\r",
									"const svcCode = (j && typeof j.code !== 'undefined') ? j.code : undefined;\r",
									"\r",
									"// 2) í—ˆìš© HTTP ë²”ìœ„(ì„±ê³µ/ë„¤ê±°í‹°ë¸Œ í¬í•¨)\r",
									"pm.test('HTTP 2xx/401 í—ˆìš©', () => \r",
									"  pm.expect(pm.response.code).to.be.oneOf([200,201,401])\r",
									");\r",
									"\r",
									"// 3) ê¸°ëŒ€ ê²°ê³¼ íŒì •\r",
									"const loginOK        = (pm.response.code === 200 || pm.response.code === 201) && svcCode === 200;\r",
									"const duplicateOK    = (pm.response.code === 401 && svcCode === 6002); // ì¤‘ë³µ ë¡œê·¸ì¸(ê¸°ì¡´ ë„¤ê±°í‹°ë¸Œ)\r",
									"const invalidCredOK  = (pm.response.code === 401 && svcCode === 6010); // âœ… ê³„ì • ì •ë³´ ë¶ˆì¼ì¹˜(ì´ë²ˆ ìš”ì²­)\r",
									"\r",
									"// ë³´ì¡° í‘œì‹œ\r",
									"pm.test('ì„œë¹„ìŠ¤ code == 200 ë˜ëŠ” 6002/6010(ì˜ˆìƒ ë„¤ê±°í‹°ë¸Œ)', () =>\r",
									"  pm.expect([200, 6002, 6010]).to.include(svcCode)\r",
									");\r",
									"\r",
									"// 4) ì„±ê³µ ì‹œì—ë§Œ í† í° ì €ì¥\r",
									"if (loginOK) {\r",
									"  pm.test('ë¡œê·¸ì¸ ì„±ê³µ', () => pm.expect(pm.response.code).to.be.oneOf([200,201]));\r",
									"  const token = j?.result?.accessToken?.token;\r",
									"  if (token) {\r",
									"    pm.environment.set(\"access_token\", token);\r",
									"    console.log(\"ğŸ”‘ í† í° ì €ì¥ë¨:\", token);\r",
									"  } else {\r",
									"    console.log(\"âš ï¸ ì‘ë‹µì—ì„œ í† í°ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\");\r",
									"  }\r",
									"} else if (duplicateOK) {\r",
									"  console.log('[LOGIN] ì˜ˆìƒëœ ì¤‘ë³µ ë¡œê·¸ì¸(401/6002) â†’ PASS');\r",
									"} else if (invalidCredOK) {\r",
									"  console.log('[LOGIN] ì˜ˆìƒëœ ê³„ì • ì •ë³´ ë¶ˆì¼ì¹˜(401/6010) â†’ PASS');\r",
									"} else {\r",
									"  console.warn('[LOGIN] ë¹„ì •ìƒ ì‘ë‹µ', { http: pm.response.code, svc: svcCode, msg: j?.message });\r",
									"}\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    if (isSummary) return;\r",
									"\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"\r",
									"    // âœ… PASS ê¸°ì¤€: ì •ìƒ ë¡œê·¸ì¸ OR ì¤‘ë³µ ë¡œê·¸ì¸(6002) OR ê³„ì • ë¶ˆì¼ì¹˜(6010)\r",
									"    const ok = !!(loginOK || duplicateOK || invalidCredOK);\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok,\r",
									"      svc: svcCode\r",
									"    };\r",
									"\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after, '| svc=', svcCode);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // IIFE\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "{{access_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"loginId\": \"kjhan\",\r\n  \"password\": \"12\",\r\n  \"isRestrictNewToken\": true\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/identity/api/access/login",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"identity",
								"api",
								"access",
								"login"
							]
						}
					},
					"response": []
				},
				{
					"name": "user ê³„ì • ë¡œê·¸ì¸ ì‹¤íŒ¨_ë¡œê·¸ì¸ ì •ë³´ ì…ë ¥í•˜ì§€ ì•ŠìŒ",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// ===== 0) SJCL ì†ŒìŠ¤ ë¡œë“œ (ë„¤íŠ¸ì›Œí¬ X) =====\r",
									"const SJCL_SRC = pm.environment.get(\"sjcl_src\") || pm.globals.get(\"sjcl_src\");\r",
									"if (!SJCL_SRC) throw new Error(\"sjcl_src ë³€ìˆ˜ì— sjcl.js ì „ì²´ ì†ŒìŠ¤ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.\");\r",
									"\r",
									"// ë…ë¦½ ìŠ¤ì½”í”„ì—ì„œ SJCL ê°ì²´ íšŒìˆ˜ (eval ìŠ¤ì½”í”„ ë¬¸ì œ ë°©ì§€)\r",
									"function buildSJCL(src) {\r",
									"  const factory = new Function(`\r",
									"    var window = {}; var self = window; var global = window;\r",
									"    var module = { exports: {} }; var exports = module.exports;\r",
									"    ${src}\r",
									"    return (typeof sjcl !== \"undefined\") ? sjcl\r",
									"         : (module && module.exports ? module.exports\r",
									"         : (window.sjcl || exports.sjcl));\r",
									"  `);\r",
									"  const lib = factory();\r",
									"  if (!lib || !lib.cipher || !lib.mode || !lib.codec) throw new Error(\"SJCL ë¡œë“œ ì‹¤íŒ¨\");\r",
									"  return lib;\r",
									"}\r",
									"const SJCL = buildSJCL(SJCL_SRC);\r",
									"\r",
									"// ===== 1) CryptoJS (Postman ë‚´ì¥) =====\r",
									"const CryptoJS = require(\"crypto-js\");\r",
									"\r",
									"// ===== 2) ìœ í‹¸ =====\r",
									"function randomBytes(n){\r",
									"  const wa = CryptoJS.lib.WordArray.random(n);\r",
									"  const hex = wa.toString(CryptoJS.enc.Hex);\r",
									"  const out = [];\r",
									"  for (let i=0;i<hex.length;i+=2) out.push(parseInt(hex.substr(i,2),16));\r",
									"  return out;\r",
									"}\r",
									"function bytesToBits(bytes){\r",
									"  let hex = \"\";\r",
									"  for (let i=0;i<bytes.length;i++){\r",
									"    const h = bytes[i].toString(16);\r",
									"    hex += (h.length===1 ? \"0\"+h : h);\r",
									"  }\r",
									"  return SJCL.codec.hex.toBits(hex);\r",
									"}\r",
									"\r",
									"// AES-128-GCM (iv 12B, tag 16B), í‚¤: sha256(key).hex -> ì•16(ASCII, UPPER)\r",
									"function encryptOnce(keyStr, plain){\r",
									"  const ivBytes = randomBytes(12);                        // IV_LENGTH = 12\r",
									"  const ivBits  = bytesToBits(ivBytes);\r",
									"\r",
									"  const tempKeyHex   = CryptoJS.SHA256(keyStr).toString(CryptoJS.enc.Hex).toUpperCase();\r",
									"  const secretKeyStr = tempKeyHex.substring(0,16).toUpperCase();    // ASCII 16 bytes\r",
									"  const keyBits = SJCL.codec.utf8String.toBits(secretKeyStr);\r",
									"\r",
									"  const ptBits = SJCL.codec.utf8String.toBits(plain);\r",
									"  const aes    = new SJCL.cipher.aes(keyBits);\r",
									"\r",
									"  const ctWithTag = SJCL.mode.gcm.encrypt(aes, ptBits, ivBits, [], 128); // tag 128-bit\r",
									"  const combined  = SJCL.bitArray.concat(bytesToBits(ivBytes), ctWithTag);// iv + ct + tag\r",
									"  return SJCL.codec.base64.fromBits(combined);                            // standard Base64\r",
									"}\r",
									"\r",
									"// ===== 3) ë©”ì¸: ë°”ë””ì—ì„œ ID/íŒ¨ìŠ¤ì›Œë“œ ì½ì–´ ë™ì¼ IDë¡œ ì•”í˜¸í™” =====\r",
									"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
									"\r",
									"let body;\r",
									"try {\r",
									"  body = JSON.parse(pm.request.body.raw || \"{}\");\r",
									"} catch (e) {\r",
									"  throw new Error(\"Bodyê°€ JSONì´ ì•„ë‹™ë‹ˆë‹¤.\");\r",
									"}\r",
									"\r",
									"// ì„œë²„ê°€ ì½ëŠ” ID í•„ë“œëª…ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš© (loginId / id / userId ì¤‘ í•˜ë‚˜)\r",
									"const keyId = String(body.loginId ?? body.id ?? body.userId ?? \"\").trim();\r",
									"\r",
									"\r",
									"let plainPw;\r",
									"if (typeof body.password === \"string\" && body.password.trim() && !body.password.includes(\"{{\")) {\r",
									"  // ë°”ë””ì— í‰ë¬¸ì´ ìˆìœ¼ë©´ ê·¸ê±¸ ì‚¬ìš©\r",
									"  plainPw = body.password;\r",
									"} else {\r",
									"  // ì—†ìœ¼ë©´ í™˜ê²½ë³€ìˆ˜ì—ì„œ í‰ë¬¸ì„ ê°€ì ¸ì™€ ì‚¬ìš© (ì„ íƒ)\r",
									"  plainPw = pm.environment.get(\"PLAIN_PW\");\r",
									"  if (!plainPw) throw new Error(\"password í‰ë¬¸ì´ í•„ìš”í•©ë‹ˆë‹¤ (Body.password ë˜ëŠ” í™˜ê²½ë³€ìˆ˜ PLAIN_PW).\");\r",
									"}\r",
									"\r",
									"const encPw = encryptOnce(keyId, plainPw);\r",
									"\r",
									"// ë°”ë””ì— ì•”í˜¸ë¬¸ ë°˜ì˜\r",
									"body.password = encPw;\r",
									"pm.request.body.update(JSON.stringify(body));\r",
									"\r",
									"// í•„ìš” ì‹œ ë³€ìˆ˜ë¡œë„ ë…¸ì¶œ (ë‹¤ë¥¸ ìš”ì²­ì—ì„œ ì¬ì‚¬ìš©)\r",
									"pm.variables.set(\"ENC_PW\", encPw);\r",
									"\r",
									"// ë””ë²„ê·¸ ë¡œê·¸\r",
									"console.log(\"Enc with ID =\", keyId, \", Base64 length =\", encPw.length);\r",
									"\r",
									"\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// ========== Tests (Post-response) ==========\r",
									"\r",
									"// 1) ì‘ë‹µ íŒŒì‹±\r",
									"let j = null; try { j = pm.response.json(); } catch (e) { j = null; }\r",
									"const svcCode = (j && typeof j.code !== 'undefined') ? j.code : undefined;\r",
									"\r",
									"// 2) í—ˆìš© HTTP ë²”ìœ„(ì„±ê³µ/ë„¤ê±°í‹°ë¸Œ í¬í•¨)\r",
									"pm.test('HTTP 2xx/401 í—ˆìš©', () =>\r",
									"  pm.expect(pm.response.code).to.be.oneOf([200,201,401])\r",
									");\r",
									"\r",
									"// 3) ê¸°ëŒ€ ê²°ê³¼ íŒì •\r",
									"const loginOK       = (pm.response.code === 200 || pm.response.code === 201) && svcCode === 200;\r",
									"const duplicateOK   = (pm.response.code === 401 && svcCode === 6002); // ì¤‘ë³µ ë¡œê·¸ì¸\r",
									"const noCredsOK     = (pm.response.code === 401 && svcCode === 6010); // âœ… ìê²© ë¯¸ì…ë ¥/ë¶ˆì¼ì¹˜\r",
									"\r",
									"pm.test('ì„œë¹„ìŠ¤ code == 200 ë˜ëŠ” 6002/6010(ì˜ˆìƒ ë„¤ê±°í‹°ë¸Œ)', () =>\r",
									"  pm.expect([200, 6002, 6010]).to.include(svcCode)\r",
									");\r",
									"\r",
									"// 4) ì„±ê³µ ì‹œì—ë§Œ í† í° ì €ì¥\r",
									"if (loginOK) {\r",
									"  pm.test('ë¡œê·¸ì¸ ì„±ê³µ', () => pm.expect(pm.response.code).to.be.oneOf([200,201]));\r",
									"  const token = j?.result?.accessToken?.token;\r",
									"  if (token) {\r",
									"    pm.environment.set(\"access_token\", token);\r",
									"    console.log(\"ğŸ”‘ í† í° ì €ì¥ë¨:\", token);\r",
									"  } else {\r",
									"    console.log(\"âš ï¸ ì‘ë‹µì—ì„œ í† í°ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\");\r",
									"  }\r",
									"} else if (duplicateOK) {\r",
									"  console.log('[LOGIN] ì˜ˆìƒëœ ì¤‘ë³µ ë¡œê·¸ì¸(401/6002) â†’ PASS');\r",
									"} else if (noCredsOK) {\r",
									"  console.log('[LOGIN] ì˜ˆìƒëœ ìê²©ì •ë³´ ë¯¸ì…ë ¥/ë¶ˆì¼ì¹˜(401/6010) â†’ PASS');\r",
									"} else {\r",
									"  console.warn('[LOGIN] ë¹„ì •ìƒ ì‘ë‹µ', { http: pm.response.code, svc: svcCode, msg: j?.message });\r",
									"}\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    if (isSummary) return;\r",
									"\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"\r",
									"    // âœ… PASS ê¸°ì¤€: ì •ìƒ ë¡œê·¸ì¸ OR (6002/6010) ì˜ˆìƒ ë„¤ê±°í‹°ë¸Œ\r",
									"    const ok = !!(loginOK || duplicateOK || noCredsOK);\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok,\r",
									"      svc: svcCode\r",
									"    };\r",
									"\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after, '| svc=', svcCode);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // IIFE\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "{{access_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"loginId\": \"\",\r\n  \"password\": \"{{PLAIN_PW}}\",\r\n  \"isRestrictNewToken\": true\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/identity/api/access/login",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"identity",
								"api",
								"access",
								"login"
							]
						}
					},
					"response": []
				},
				{
					"name": "user ê³„ì • ë¡œê·¸ì¸ ì‹¤íŒ¨_ë“±ë¡í•˜ì§€ ì•Šì€ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ ì •ë³´ ì…ë ¥",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// ===== 0) SJCL ì†ŒìŠ¤ ë¡œë“œ (ë„¤íŠ¸ì›Œí¬ X) =====\r",
									"const SJCL_SRC = pm.environment.get(\"sjcl_src\") || pm.globals.get(\"sjcl_src\");\r",
									"if (!SJCL_SRC) throw new Error(\"sjcl_src ë³€ìˆ˜ì— sjcl.js ì „ì²´ ì†ŒìŠ¤ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.\");\r",
									"\r",
									"// ë…ë¦½ ìŠ¤ì½”í”„ì—ì„œ SJCL ê°ì²´ íšŒìˆ˜ (eval ìŠ¤ì½”í”„ ë¬¸ì œ ë°©ì§€)\r",
									"function buildSJCL(src) {\r",
									"  const factory = new Function(`\r",
									"    var window = {}; var self = window; var global = window;\r",
									"    var module = { exports: {} }; var exports = module.exports;\r",
									"    ${src}\r",
									"    return (typeof sjcl !== \"undefined\") ? sjcl\r",
									"         : (module && module.exports ? module.exports\r",
									"         : (window.sjcl || exports.sjcl));\r",
									"  `);\r",
									"  const lib = factory();\r",
									"  if (!lib || !lib.cipher || !lib.mode || !lib.codec) throw new Error(\"SJCL ë¡œë“œ ì‹¤íŒ¨\");\r",
									"  return lib;\r",
									"}\r",
									"const SJCL = buildSJCL(SJCL_SRC);\r",
									"\r",
									"// ===== 1) CryptoJS (Postman ë‚´ì¥) =====\r",
									"const CryptoJS = require(\"crypto-js\");\r",
									"\r",
									"// ===== 2) ìœ í‹¸ =====\r",
									"function randomBytes(n){\r",
									"  const wa = CryptoJS.lib.WordArray.random(n);\r",
									"  const hex = wa.toString(CryptoJS.enc.Hex);\r",
									"  const out = [];\r",
									"  for (let i=0;i<hex.length;i+=2) out.push(parseInt(hex.substr(i,2),16));\r",
									"  return out;\r",
									"}\r",
									"function bytesToBits(bytes){\r",
									"  let hex = \"\";\r",
									"  for (let i=0;i<bytes.length;i++){\r",
									"    const h = bytes[i].toString(16);\r",
									"    hex += (h.length===1 ? \"0\"+h : h);\r",
									"  }\r",
									"  return SJCL.codec.hex.toBits(hex);\r",
									"}\r",
									"\r",
									"// AES-128-GCM (iv 12B, tag 16B), í‚¤: sha256(key).hex -> ì•16(ASCII, UPPER)\r",
									"function encryptOnce(keyStr, plain){\r",
									"  const ivBytes = randomBytes(12);                        // IV_LENGTH = 12\r",
									"  const ivBits  = bytesToBits(ivBytes);\r",
									"\r",
									"  const tempKeyHex   = CryptoJS.SHA256(keyStr).toString(CryptoJS.enc.Hex).toUpperCase();\r",
									"  const secretKeyStr = tempKeyHex.substring(0,16).toUpperCase();    // ASCII 16 bytes\r",
									"  const keyBits = SJCL.codec.utf8String.toBits(secretKeyStr);\r",
									"\r",
									"  const ptBits = SJCL.codec.utf8String.toBits(plain);\r",
									"  const aes    = new SJCL.cipher.aes(keyBits);\r",
									"\r",
									"  const ctWithTag = SJCL.mode.gcm.encrypt(aes, ptBits, ivBits, [], 128); // tag 128-bit\r",
									"  const combined  = SJCL.bitArray.concat(bytesToBits(ivBytes), ctWithTag);// iv + ct + tag\r",
									"  return SJCL.codec.base64.fromBits(combined);                            // standard Base64\r",
									"}\r",
									"\r",
									"// ===== 3) ë©”ì¸: ë°”ë””ì—ì„œ ID/íŒ¨ìŠ¤ì›Œë“œ ì½ì–´ ë™ì¼ IDë¡œ ì•”í˜¸í™” =====\r",
									"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
									"\r",
									"let body;\r",
									"try {\r",
									"  body = JSON.parse(pm.request.body.raw || \"{}\");\r",
									"} catch (e) {\r",
									"  throw new Error(\"Bodyê°€ JSONì´ ì•„ë‹™ë‹ˆë‹¤.\");\r",
									"}\r",
									"\r",
									"// ì„œë²„ê°€ ì½ëŠ” ID í•„ë“œëª…ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš© (loginId / id / userId ì¤‘ í•˜ë‚˜)\r",
									"const keyId = String(body.loginId ?? body.id ?? body.userId ?? \"\").trim();\r",
									"\r",
									"\r",
									"let plainPw;\r",
									"if (typeof body.password === \"string\" && body.password.trim() && !body.password.includes(\"{{\")) {\r",
									"  // ë°”ë””ì— í‰ë¬¸ì´ ìˆìœ¼ë©´ ê·¸ê±¸ ì‚¬ìš©\r",
									"  plainPw = body.password;\r",
									"} else {\r",
									"  // ì—†ìœ¼ë©´ í™˜ê²½ë³€ìˆ˜ì—ì„œ í‰ë¬¸ì„ ê°€ì ¸ì™€ ì‚¬ìš© (ì„ íƒ)\r",
									"  plainPw = pm.environment.get(\"PLAIN_PW\");\r",
									"  if (!plainPw) throw new Error(\"password í‰ë¬¸ì´ í•„ìš”í•©ë‹ˆë‹¤ (Body.password ë˜ëŠ” í™˜ê²½ë³€ìˆ˜ PLAIN_PW).\");\r",
									"}\r",
									"\r",
									"const encPw = encryptOnce(keyId, plainPw);\r",
									"\r",
									"// ë°”ë””ì— ì•”í˜¸ë¬¸ ë°˜ì˜\r",
									"body.password = encPw;\r",
									"pm.request.body.update(JSON.stringify(body));\r",
									"\r",
									"// í•„ìš” ì‹œ ë³€ìˆ˜ë¡œë„ ë…¸ì¶œ (ë‹¤ë¥¸ ìš”ì²­ì—ì„œ ì¬ì‚¬ìš©)\r",
									"pm.variables.set(\"ENC_PW\", encPw);\r",
									"\r",
									"// ë””ë²„ê·¸ ë¡œê·¸\r",
									"console.log(\"Enc with ID =\", keyId, \", Base64 length =\", encPw.length);\r",
									"\r",
									"\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// ========== Tests (Post-response) ==========\r",
									"\r",
									"// 1) ì‘ë‹µ íŒŒì‹±\r",
									"let j = null; try { j = pm.response.json(); } catch (e) { j = null; }\r",
									"const svcCode = (j && typeof j.code !== 'undefined') ? j.code : undefined;\r",
									"\r",
									"// 2) í—ˆìš© HTTP ë²”ìœ„(ì„±ê³µ/ë„¤ê±°í‹°ë¸Œ í¬í•¨)\r",
									"pm.test('HTTP 2xx/401 í—ˆìš©', () =>\r",
									"  pm.expect(pm.response.code).to.be.oneOf([200,201,401])\r",
									");\r",
									"\r",
									"// 3) ê¸°ëŒ€ ê²°ê³¼ íŒì •\r",
									"const loginOK       = (pm.response.code === 200 || pm.response.code === 201) && svcCode === 200;\r",
									"const duplicateOK   = (pm.response.code === 401 && svcCode === 6002); // ì¤‘ë³µ ë¡œê·¸ì¸\r",
									"const noCredsOK     = (pm.response.code === 401 && svcCode === 6010); // âœ… ìê²© ë¯¸ì…ë ¥/ë¶ˆì¼ì¹˜\r",
									"\r",
									"pm.test('ì„œë¹„ìŠ¤ code == 200 ë˜ëŠ” 6002/6010(ì˜ˆìƒ ë„¤ê±°í‹°ë¸Œ)', () =>\r",
									"  pm.expect([200, 6002, 6010]).to.include(svcCode)\r",
									");\r",
									"\r",
									"// 4) ì„±ê³µ ì‹œì—ë§Œ í† í° ì €ì¥\r",
									"if (loginOK) {\r",
									"  pm.test('ë¡œê·¸ì¸ ì„±ê³µ', () => pm.expect(pm.response.code).to.be.oneOf([200,201]));\r",
									"  const token = j?.result?.accessToken?.token;\r",
									"  if (token) {\r",
									"    pm.environment.set(\"access_token\", token);\r",
									"    console.log(\"ğŸ”‘ í† í° ì €ì¥ë¨:\", token);\r",
									"  } else {\r",
									"    console.log(\"âš ï¸ ì‘ë‹µì—ì„œ í† í°ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\");\r",
									"  }\r",
									"} else if (duplicateOK) {\r",
									"  console.log('[LOGIN] ì˜ˆìƒëœ ì¤‘ë³µ ë¡œê·¸ì¸(401/6002) â†’ PASS');\r",
									"} else if (noCredsOK) {\r",
									"  console.log('[LOGIN] ì˜ˆìƒëœ ìê²©ì •ë³´ ë¯¸ì…ë ¥/ë¶ˆì¼ì¹˜(401/6010) â†’ PASS');\r",
									"} else {\r",
									"  console.warn('[LOGIN] ë¹„ì •ìƒ ì‘ë‹µ', { http: pm.response.code, svc: svcCode, msg: j?.message });\r",
									"}\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    if (isSummary) return;\r",
									"\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"\r",
									"    // âœ… PASS ê¸°ì¤€: ì •ìƒ ë¡œê·¸ì¸ OR (6002/6010) ì˜ˆìƒ ë„¤ê±°í‹°ë¸Œ\r",
									"    const ok = !!(loginOK || duplicateOK || noCredsOK);\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok,\r",
									"      svc: svcCode\r",
									"    };\r",
									"\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after, '| svc=', svcCode);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // IIFE\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "{{access_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"loginId\": \"\",\r\n  \"password\": \"{{PLAIN_PW}}\",\r\n  \"isRestrictNewToken\": true\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/identity/api/access/login",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"identity",
								"api",
								"access",
								"login"
							]
						}
					},
					"response": []
				},
				{
					"name": "user ê³„ì • ë¡œê·¸ì¸ ì„±ê³µ",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// ===== 0) SJCL ì†ŒìŠ¤ ë¡œë“œ (ë„¤íŠ¸ì›Œí¬ X) =====\r",
									"const SJCL_SRC = pm.environment.get(\"sjcl_src\") || pm.globals.get(\"sjcl_src\");\r",
									"if (!SJCL_SRC) throw new Error(\"sjcl_src ë³€ìˆ˜ì— sjcl.js ì „ì²´ ì†ŒìŠ¤ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.\");\r",
									"\r",
									"// ë…ë¦½ ìŠ¤ì½”í”„ì—ì„œ SJCL ê°ì²´ íšŒìˆ˜ (eval ìŠ¤ì½”í”„ ë¬¸ì œ ë°©ì§€)\r",
									"function buildSJCL(src) {\r",
									"  const factory = new Function(`\r",
									"    var window = {}; var self = window; var global = window;\r",
									"    var module = { exports: {} }; var exports = module.exports;\r",
									"    ${src}\r",
									"    return (typeof sjcl !== \"undefined\") ? sjcl\r",
									"         : (module && module.exports ? module.exports\r",
									"         : (window.sjcl || exports.sjcl));\r",
									"  `);\r",
									"  const lib = factory();\r",
									"  if (!lib || !lib.cipher || !lib.mode || !lib.codec) throw new Error(\"SJCL ë¡œë“œ ì‹¤íŒ¨\");\r",
									"  return lib;\r",
									"}\r",
									"const SJCL = buildSJCL(SJCL_SRC);\r",
									"\r",
									"// ===== 1) CryptoJS (Postman ë‚´ì¥) =====\r",
									"const CryptoJS = require(\"crypto-js\");\r",
									"\r",
									"// ===== 2) ìœ í‹¸ =====\r",
									"function randomBytes(n){\r",
									"  const wa = CryptoJS.lib.WordArray.random(n);\r",
									"  const hex = wa.toString(CryptoJS.enc.Hex);\r",
									"  const out = [];\r",
									"  for (let i=0;i<hex.length;i+=2) out.push(parseInt(hex.substr(i,2),16));\r",
									"  return out;\r",
									"}\r",
									"function bytesToBits(bytes){\r",
									"  let hex = \"\";\r",
									"  for (let i=0;i<bytes.length;i++){\r",
									"    const h = bytes[i].toString(16);\r",
									"    hex += (h.length===1 ? \"0\"+h : h);\r",
									"  }\r",
									"  return SJCL.codec.hex.toBits(hex);\r",
									"}\r",
									"\r",
									"// AES-128-GCM (iv 12B, tag 16B), í‚¤: sha256(key).hex -> ì•16(ASCII, UPPER)\r",
									"function encryptOnce(keyStr, plain){\r",
									"  const ivBytes = randomBytes(12);                        // IV_LENGTH = 12\r",
									"  const ivBits  = bytesToBits(ivBytes);\r",
									"\r",
									"  const tempKeyHex   = CryptoJS.SHA256(keyStr).toString(CryptoJS.enc.Hex).toUpperCase();\r",
									"  const secretKeyStr = tempKeyHex.substring(0,16).toUpperCase();    // ASCII 16 bytes\r",
									"  const keyBits = SJCL.codec.utf8String.toBits(secretKeyStr);\r",
									"\r",
									"  const ptBits = SJCL.codec.utf8String.toBits(plain);\r",
									"  const aes    = new SJCL.cipher.aes(keyBits);\r",
									"\r",
									"  const ctWithTag = SJCL.mode.gcm.encrypt(aes, ptBits, ivBits, [], 128); // tag 128-bit\r",
									"  const combined  = SJCL.bitArray.concat(bytesToBits(ivBytes), ctWithTag);// iv + ct + tag\r",
									"  return SJCL.codec.base64.fromBits(combined);                            // standard Base64\r",
									"}\r",
									"\r",
									"// ===== 3) ë©”ì¸: ë°”ë””ì—ì„œ ID/íŒ¨ìŠ¤ì›Œë“œ ì½ì–´ ë™ì¼ IDë¡œ ì•”í˜¸í™” =====\r",
									"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
									"\r",
									"let body;\r",
									"try {\r",
									"  body = JSON.parse(pm.request.body.raw || \"{}\");\r",
									"} catch (e) {\r",
									"  throw new Error(\"Bodyê°€ JSONì´ ì•„ë‹™ë‹ˆë‹¤.\");\r",
									"}\r",
									"\r",
									"// ì„œë²„ê°€ ì½ëŠ” ID í•„ë“œëª…ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš© (loginId / id / userId ì¤‘ í•˜ë‚˜)\r",
									"const keyId = String(body.loginId ?? body.id ?? body.userId ?? \"\").trim();\r",
									"if (!keyId) throw new Error(\"Bodyì— loginId/id/userId ì¤‘ í•˜ë‚˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.\");\r",
									"\r",
									"let plainPw;\r",
									"if (typeof body.password === \"string\" && body.password.trim() && !body.password.includes(\"{{\")) {\r",
									"  // ë°”ë””ì— í‰ë¬¸ì´ ìˆìœ¼ë©´ ê·¸ê±¸ ì‚¬ìš©\r",
									"  plainPw = body.password;\r",
									"} else {\r",
									"  // ì—†ìœ¼ë©´ í™˜ê²½ë³€ìˆ˜ì—ì„œ í‰ë¬¸ì„ ê°€ì ¸ì™€ ì‚¬ìš© (ì„ íƒ)\r",
									"  plainPw = pm.environment.get(\"PLAIN_PW\");\r",
									"  if (!plainPw) throw new Error(\"password í‰ë¬¸ì´ í•„ìš”í•©ë‹ˆë‹¤ (Body.password ë˜ëŠ” í™˜ê²½ë³€ìˆ˜ PLAIN_PW).\");\r",
									"}\r",
									"\r",
									"const encPw = encryptOnce(keyId, plainPw);\r",
									"\r",
									"// ë°”ë””ì— ì•”í˜¸ë¬¸ ë°˜ì˜\r",
									"body.password = encPw;\r",
									"pm.request.body.update(JSON.stringify(body));\r",
									"\r",
									"// í•„ìš” ì‹œ ë³€ìˆ˜ë¡œë„ ë…¸ì¶œ (ë‹¤ë¥¸ ìš”ì²­ì—ì„œ ì¬ì‚¬ìš©)\r",
									"pm.variables.set(\"ENC_PW\", encPw);\r",
									"\r",
									"// ë””ë²„ê·¸ ë¡œê·¸\r",
									"console.log(\"Enc with ID =\", keyId, \", Base64 length =\", encPw.length);\r",
									"\r",
									"\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// ë¡œê·¸ì¸ ì‘ë‹µ ì½”ë“œ ê²€ì‚¬\r",
									"if (pm.response.code === 200) {\r",
									"  pm.test(\"ë¡œê·¸ì¸ ì„±ê³µ\", function () {\r",
									"    pm.expect(pm.response.code).to.eql(200);\r",
									"  });\r",
									"\r",
									"  // ì‘ë‹µ JSON íŒŒì‹±\r",
									"  let jsonData; try { jsonData = pm.response.json(); } catch (e) { jsonData = null; }\r",
									"\r",
									"  if (jsonData && jsonData.result && jsonData.result.accessToken && jsonData.result.accessToken.token) {\r",
									"    const token = jsonData.result.accessToken.token;\r",
									"\r",
									"    // ğŸ‘‰ í™˜ê²½ë³€ìˆ˜ ì €ì¥\r",
									"    pm.environment.set(\"access_token\", token);\r",
									"    console.log(\"ğŸ”‘ í† í° ì €ì¥ë¨:\", token);\r",
									"  } else {\r",
									"    console.log(\"âš ï¸ ì‘ë‹µì—ì„œ í† í°ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\");\r",
									"  }\r",
									"\r",
									"} else {\r",
									"  // ì‹¤íŒ¨ ë©”ì‹œì§€ ì¶œë ¥\r",
									"  pm.test(\"ë¡œê·¸ì¸ ì‹¤íŒ¨ - ì‘ë‹µì½”ë“œ: \" + pm.response.code, function () {\r",
									"    pm.expect(pm.response.code).to.eql(200);\r",
									"  });\r",
									"}\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "{{access_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"loginId\": \"kjhan\",\r\n  \"password\": \"marine6c!\",\r\n  \"isRestrictNewToken\": false\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/identity/api/access/login",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"identity",
								"api",
								"access",
								"login"
							]
						}
					},
					"response": []
				},
				{
					"name": "user ê³„ì • ë¡œê·¸ì¸ ì‹¤íŒ¨_ì¤‘ë³µ ë¡œê·¸ì¸",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// ===== 0) SJCL ì†ŒìŠ¤ ë¡œë“œ (ë„¤íŠ¸ì›Œí¬ X) =====\r",
									"const SJCL_SRC = pm.environment.get(\"sjcl_src\") || pm.globals.get(\"sjcl_src\");\r",
									"if (!SJCL_SRC) throw new Error(\"sjcl_src ë³€ìˆ˜ì— sjcl.js ì „ì²´ ì†ŒìŠ¤ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.\");\r",
									"\r",
									"// ë…ë¦½ ìŠ¤ì½”í”„ì—ì„œ SJCL ê°ì²´ íšŒìˆ˜ (eval ìŠ¤ì½”í”„ ë¬¸ì œ ë°©ì§€)\r",
									"function buildSJCL(src) {\r",
									"  const factory = new Function(`\r",
									"    var window = {}; var self = window; var global = window;\r",
									"    var module = { exports: {} }; var exports = module.exports;\r",
									"    ${src}\r",
									"    return (typeof sjcl !== \"undefined\") ? sjcl\r",
									"         : (module && module.exports ? module.exports\r",
									"         : (window.sjcl || exports.sjcl));\r",
									"  `);\r",
									"  const lib = factory();\r",
									"  if (!lib || !lib.cipher || !lib.mode || !lib.codec) throw new Error(\"SJCL ë¡œë“œ ì‹¤íŒ¨\");\r",
									"  return lib;\r",
									"}\r",
									"const SJCL = buildSJCL(SJCL_SRC);\r",
									"\r",
									"// ===== 1) CryptoJS (Postman ë‚´ì¥) =====\r",
									"const CryptoJS = require(\"crypto-js\");\r",
									"\r",
									"// ===== 2) ìœ í‹¸ =====\r",
									"function randomBytes(n){\r",
									"  const wa = CryptoJS.lib.WordArray.random(n);\r",
									"  const hex = wa.toString(CryptoJS.enc.Hex);\r",
									"  const out = [];\r",
									"  for (let i=0;i<hex.length;i+=2) out.push(parseInt(hex.substr(i,2),16));\r",
									"  return out;\r",
									"}\r",
									"function bytesToBits(bytes){\r",
									"  let hex = \"\";\r",
									"  for (let i=0;i<bytes.length;i++){\r",
									"    const h = bytes[i].toString(16);\r",
									"    hex += (h.length===1 ? \"0\"+h : h);\r",
									"  }\r",
									"  return SJCL.codec.hex.toBits(hex);\r",
									"}\r",
									"\r",
									"// AES-128-GCM (iv 12B, tag 16B), í‚¤: sha256(key).hex -> ì•16(ASCII, UPPER)\r",
									"function encryptOnce(keyStr, plain){\r",
									"  const ivBytes = randomBytes(12);                        // IV_LENGTH = 12\r",
									"  const ivBits  = bytesToBits(ivBytes);\r",
									"\r",
									"  const tempKeyHex   = CryptoJS.SHA256(keyStr).toString(CryptoJS.enc.Hex).toUpperCase();\r",
									"  const secretKeyStr = tempKeyHex.substring(0,16).toUpperCase();    // ASCII 16 bytes\r",
									"  const keyBits = SJCL.codec.utf8String.toBits(secretKeyStr);\r",
									"\r",
									"  const ptBits = SJCL.codec.utf8String.toBits(plain);\r",
									"  const aes    = new SJCL.cipher.aes(keyBits);\r",
									"\r",
									"  const ctWithTag = SJCL.mode.gcm.encrypt(aes, ptBits, ivBits, [], 128); // tag 128-bit\r",
									"  const combined  = SJCL.bitArray.concat(bytesToBits(ivBytes), ctWithTag);// iv + ct + tag\r",
									"  return SJCL.codec.base64.fromBits(combined);                            // standard Base64\r",
									"}\r",
									"\r",
									"// ===== 3) ë©”ì¸: ë°”ë””ì—ì„œ ID/íŒ¨ìŠ¤ì›Œë“œ ì½ì–´ ë™ì¼ IDë¡œ ì•”í˜¸í™” =====\r",
									"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
									"\r",
									"let body;\r",
									"try {\r",
									"  body = JSON.parse(pm.request.body.raw || \"{}\");\r",
									"} catch (e) {\r",
									"  throw new Error(\"Bodyê°€ JSONì´ ì•„ë‹™ë‹ˆë‹¤.\");\r",
									"}\r",
									"\r",
									"// ì„œë²„ê°€ ì½ëŠ” ID í•„ë“œëª…ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš© (loginId / id / userId ì¤‘ í•˜ë‚˜)\r",
									"const keyId = String(body.loginId ?? body.id ?? body.userId ?? \"\").trim();\r",
									"if (!keyId) throw new Error(\"Bodyì— loginId/id/userId ì¤‘ í•˜ë‚˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.\");\r",
									"\r",
									"let plainPw;\r",
									"if (typeof body.password === \"string\" && body.password.trim() && !body.password.includes(\"{{\")) {\r",
									"  // ë°”ë””ì— í‰ë¬¸ì´ ìˆìœ¼ë©´ ê·¸ê±¸ ì‚¬ìš©\r",
									"  plainPw = body.password;\r",
									"} else {\r",
									"  // ì—†ìœ¼ë©´ í™˜ê²½ë³€ìˆ˜ì—ì„œ í‰ë¬¸ì„ ê°€ì ¸ì™€ ì‚¬ìš© (ì„ íƒ)\r",
									"  plainPw = pm.environment.get(\"PLAIN_PW\");\r",
									"  if (!plainPw) throw new Error(\"password í‰ë¬¸ì´ í•„ìš”í•©ë‹ˆë‹¤ (Body.password ë˜ëŠ” í™˜ê²½ë³€ìˆ˜ PLAIN_PW).\");\r",
									"}\r",
									"\r",
									"const encPw = encryptOnce(keyId, plainPw);\r",
									"\r",
									"// ë°”ë””ì— ì•”í˜¸ë¬¸ ë°˜ì˜\r",
									"body.password = encPw;\r",
									"pm.request.body.update(JSON.stringify(body));\r",
									"\r",
									"// í•„ìš” ì‹œ ë³€ìˆ˜ë¡œë„ ë…¸ì¶œ (ë‹¤ë¥¸ ìš”ì²­ì—ì„œ ì¬ì‚¬ìš©)\r",
									"pm.variables.set(\"ENC_PW\", encPw);\r",
									"\r",
									"// ë””ë²„ê·¸ ë¡œê·¸\r",
									"console.log(\"Enc with ID =\", keyId, \", Base64 length =\", encPw.length);\r",
									"\r",
									"\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// ========== Tests (Post-response) ==========\r",
									"\r",
									"// 1) ì‘ë‹µ íŒŒì‹±\r",
									"let j = null; try { j = pm.response.json(); } catch (e) { j = null; }\r",
									"const svcCode = (j && typeof j.code !== 'undefined') ? j.code : undefined;\r",
									"\r",
									"// 2) í—ˆìš© HTTP ë²”ìœ„(ì„±ê³µ/ë„¤ê±°í‹°ë¸Œ í¬í•¨)\r",
									"pm.test('HTTP 2xx/401 í—ˆìš©', () => \r",
									"  pm.expect(pm.response.code).to.be.oneOf([200,201,401])\r",
									");\r",
									"\r",
									"// 3) ê¸°ëŒ€ ê²°ê³¼ íŒì •\r",
									"const loginOK     = (pm.response.code === 200 || pm.response.code === 201) && svcCode === 200;\r",
									"const duplicateOK = (pm.response.code === 401 && svcCode === 6002);   // âœ… ì¤‘ë³µ ë¡œê·¸ì¸(ì˜ˆìƒ ë„¤ê±°í‹°ë¸Œ)\r",
									"\r",
									"// ë³´ì¡° í‘œì‹œ\r",
									"pm.test('ì„œë¹„ìŠ¤ code == 200 ë˜ëŠ” 6002(ì¤‘ë³µ ë¡œê·¸ì¸)', () =>\r",
									"  pm.expect([200, 6002]).to.include(svcCode)\r",
									");\r",
									"\r",
									"// 4) ì„±ê³µ ì¼€ì´ìŠ¤ì¼ ë•Œë§Œ í† í° ì €ì¥\r",
									"if (loginOK) {\r",
									"  pm.test('ë¡œê·¸ì¸ ì„±ê³µ', () => pm.expect(pm.response.code).to.be.oneOf([200,201]));\r",
									"  const token = j?.result?.accessToken?.token;\r",
									"  if (token) {\r",
									"    pm.environment.set(\"access_token\", token);\r",
									"    console.log(\"ğŸ”‘ í† í° ì €ì¥ë¨:\", token);\r",
									"  } else {\r",
									"    console.log(\"âš ï¸ ì‘ë‹µì—ì„œ í† í°ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\");\r",
									"  }\r",
									"} else if (duplicateOK) {\r",
									"  console.log('[LOGIN] ì˜ˆìƒëœ ì¤‘ë³µ ë¡œê·¸ì¸(401/6002) ë°œìƒ â†’ PASS ì²˜ë¦¬');\r",
									"} else {\r",
									"  // ê·¸ ì™¸ ì¼€ì´ìŠ¤ëŠ” FAILë¡œ ë‚¨ë„ë¡ ë³„ë„ ì²˜ë¦¬ ì—†ìŒ(ì§‘ê³„ì—ì„œ ê²°ì •)\r",
									"  console.warn('[LOGIN] ë¹„ì •ìƒ ì‘ë‹µ', { http: pm.response.code, svc: svcCode, msg: j?.message });\r",
									"}\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    if (isSummary) return;\r",
									"\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"\r",
									"    // âœ… PASS ê¸°ì¤€: ì •ìƒ ë¡œê·¸ì¸ OR ì¤‘ë³µ ë¡œê·¸ì¸(ì˜ˆìƒ ë„¤ê±°í‹°ë¸Œ)\r",
									"    const ok = !!(loginOK || duplicateOK);\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok,\r",
									"      svc: svcCode\r",
									"    };\r",
									"\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after, '| svc=', svcCode);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // IIFE\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "{{access_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"loginId\": \"kjhan\",\r\n  \"password\": \"marine6c!\",\r\n  \"isRestrictNewToken\": true\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/identity/api/access/login",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"identity",
								"api",
								"access",
								"login"
							]
						}
					},
					"response": []
				},
				{
					"name": "ë¹„ë°€ë²ˆí˜¸ ë³€ê²½_ë¹„ë°€ë²ˆí˜¸/ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ê²½ìš°",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// ========== Tests (Post-response) ==========\r",
									"\r",
									"// 1) ì‘ë‹µ íŒŒì‹± & ê¸°ë³¸ ê²€ì‚¬\r",
									"let j = null; try { j = pm.response.json(); } catch (e) { j = null; }\r",
									"\r",
									"// HTTP ì½”ë“œëŠ” ì •ìƒ/ì—ëŸ¬ë¥¼ ëª¨ë‘ í—ˆìš©(ë„¤ê±°í‹°ë¸Œ ì¼€ì´ìŠ¤ í¬í•¨)\r",
									"pm.test('HTTP 2xx/4xx/5xx í—ˆìš©', () => \r",
									"  pm.expect(pm.response.code).to.be.oneOf([200,201,400,401,403,404,409,422,500])\r",
									");\r",
									"\r",
									"// 2) ê¸°ëŒ€ ê²°ê³¼ íŒì •\r",
									"const svcCode = j && typeof j.code !== 'undefined' ? j.code : undefined;\r",
									"\r",
									"// ì„±ê³µ ì¼€ì´ìŠ¤(ë¹„ë²ˆ ì •ìƒ ë³€ê²½)\r",
									"const changedOK = (pm.response.code === 200 || pm.response.code === 201) && j && svcCode === 200;\r",
									"\r",
									"// âœ… ë„¤ê±°í‹°ë¸Œ ì¼€ì´ìŠ¤: \"ë¹„ë°€ë²ˆí˜¸/í™•ì¸ ë¶ˆì¼ì¹˜\"ëŠ” ê¸°ëŒ€ëœ PASS\r",
									"const mismatchOK = (svcCode === 6019);\r",
									"\r",
									"// ë³´ì¡° í…ŒìŠ¤íŠ¸ í‘œì‹œ\r",
									"pm.test('ì„œë¹„ìŠ¤ code === 200 ë˜ëŠ” 6019(ë¶ˆì¼ì¹˜ ê¸°ëŒ€)', () => \r",
									"  pm.expect([200, 6019]).to.include(svcCode)\r",
									");\r",
									"\r",
									"// 3) ì„±ê³µ ì¼€ì´ìŠ¤ì¼ ë•Œë§Œ í›„ì†(ë¡œê·¸ì•„ì›ƒâ†’ë¡œê·¸ì¸â†’ë³€ìˆ˜ìŠ¤ì™‘) ìˆ˜í–‰\r",
									"if (changedOK) {\r",
									"  // 3-1) ìš”ì²­ ë°”ë””ì—ì„œ loginId ì¶”ì¶œ\r",
									"  let loginId = '';\r",
									"  try {\r",
									"    const bodyNow = JSON.parse(pm.request.body.raw || '{}');\r",
									"    loginId = String(bodyNow.loginId ?? bodyNow.id ?? bodyNow.userId ?? '').trim();\r",
									"  } catch(e) {}\r",
									"  if (!loginId) {\r",
									"    loginId = String(pm.environment.get('PW_TARGET_LOGIN_ID') || pm.environment.get('LOGIN_ID') || '').trim();\r",
									"  }\r",
									"  pm.test('ê²€ì¦ ëŒ€ìƒ loginId ì¡´ì¬', () => pm.expect(loginId).to.be.a('string').and.not.empty);\r",
									"\r",
									"  // 3-2) ë¡œê·¸ì¸ìš© ì•”í˜¸ë¬¸(Pre-requestì—ì„œ ë§Œë“  ENC_NEW_PW)\r",
									"  const encPwLogin = pm.variables.get('ENC_NEW_PW');\r",
									"  pm.test('ENC_NEW_PW ì¡´ì¬', () => pm.expect(encPwLogin).to.be.a('string').and.not.empty);\r",
									"\r",
									"  // 3-3) ë¡œê·¸ì•„ì›ƒ â†’ ìƒˆ ë¹„ë²ˆìœ¼ë¡œ ë¡œê·¸ì¸\r",
									"  const logoutUrl = pm.environment.get('LOGOUT_URL') || 'http://127.0.0.1/identity/api/access/logout';\r",
									"  const token     = pm.environment.get('access_token') || pm.environment.get('ACCESS_TOKEN');\r",
									"\r",
									"  pm.sendRequest({\r",
									"    url: logoutUrl,\r",
									"    method: 'DELETE',\r",
									"    header: token ? { 'Authorization': `Bearer ${token}` } : {}\r",
									"  }, (err, resp) => {\r",
									"    pm.test('ë¡œê·¸ì•„ì›ƒ ì „ì†¡', () => pm.expect(err).to.be.null);\r",
									"    if (err) return;\r",
									"\r",
									"    pm.test('ë¡œê·¸ì•„ì›ƒ 200/204/401 í—ˆìš©', () => pm.expect(resp.code).to.be.oneOf([200,204,401]));\r",
									"    pm.environment.unset('access_token');\r",
									"\r",
									"    const loginUrl = pm.environment.get('LOGIN_URL') || 'http://127.0.0.1/identity/api/access/login';\r",
									"    pm.sendRequest({\r",
									"      url: loginUrl,\r",
									"      method: 'POST',\r",
									"      header: { 'Content-Type': 'application/json', 'Accept': 'application/json' },\r",
									"      body: { mode: 'raw', raw: JSON.stringify({\r",
									"        loginId: loginId,\r",
									"        password: encPwLogin,\r",
									"        isRestrictNewToken: false\r",
									"      }) }\r",
									"    }, (err2, resp2) => {\r",
									"      pm.test('ë¡œê·¸ì¸ ìš”ì²­ ì „ì†¡', () => pm.expect(err2).to.be.null);\r",
									"      if (err2) return;\r",
									"\r",
									"      let lj = {}; try { lj = resp2.json(); } catch {}\r",
									"      console.log('[POST-PW][LOGIN] http=', resp2.code, 'svc=', lj && lj.code, 'msg=', lj && lj.message);\r",
									"\r",
									"      pm.test('ë¡œê·¸ì¸ HTTP 200/201', () => pm.expect(resp2.code).to.be.oneOf([200,201]));\r",
									"      pm.test('ë¡œê·¸ì¸ ì„œë¹„ìŠ¤ code === 200', () => pm.expect((lj||{}).code).to.eql(200));\r",
									"\r",
									"      // ìƒˆ í† í° ì €ì¥(ì„ íƒ)\r",
									"      try {\r",
									"        const newTok = lj?.result?.accessToken?.token;\r",
									"        if (newTok) pm.environment.set('access_token', newTok);\r",
									"      } catch(e) {}\r",
									"\r",
									"      // 3-4) ë¹„ë²ˆ ë³€ìˆ˜ ìŠ¤ì™‘\r",
									"      (function () {\r",
									"        const oldPlain = pm.environment.get('PLAIN_PW') || '';\r",
									"        const newPw    = pm.environment.get('NEW_PW')   || '';\r",
									"\r",
									"        pm.environment.set('PREV_PW', oldPlain);          // â‘ \r",
									"        if (newPw) pm.environment.set('PLAIN_PW', newPw); // â‘¡\r",
									"        pm.environment.set('NEW_PW',  oldPlain);          // â‘¢\r",
									"        pm.environment.set('CONF_PW', oldPlain);          // â‘¢\r",
									"        pm.environment.set('PW_CHANGED_AT', new Date().toISOString());\r",
									"\r",
									"        console.log('ğŸ” ë¹„ë²ˆ ë³€ìˆ˜ ê°±ì‹  ì™„ë£Œ(ë§ˆìŠ¤í‚¹): { PREV:\"***\", PLAIN:\"***\", NEW:\"***\", CONF:\"***\" }');\r",
									"      })();\r",
									"    });\r",
									"  });\r",
									"} else if (mismatchOK) {\r",
									"  // ì˜ˆìƒëœ ë„¤ê±°í‹°ë¸Œ â†’ í›„ì† ì‘ì—… ìŠ¤í‚µ (PASSë¡œ ì§‘ê³„)\r",
									"  console.log('[PW-CHANGE] ì˜ˆìƒëœ ë¶ˆì¼ì¹˜(6019) ë°œìƒ â†’ í›„ì† ì‘ì—… ìŠ¤í‚µ');\r",
									"} else {\r",
									"  // ê·¸ ì™¸ ì—ëŸ¬\r",
									"  console.warn('[PW-CHANGE] ë³€ê²½ ì‹¤íŒ¨/ìŠ¤í‚µ', { http: pm.response.code, svc: svcCode });\r",
									"}\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    if (isSummary) { console.log(TAG, 'skip summary request'); return; }\r",
									"\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"\r",
									"    // âœ… PASS ê¸°ì¤€: ì •ìƒ ë³€ê²½ OR ë¶ˆì¼ì¹˜(6019)\r",
									"    const ok = !!(changedOK || mismatchOK);\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok,\r",
									"      svc: svcCode\r",
									"    };\r",
									"\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after, '| svc=', svcCode);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // IIFE\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// ===== í† í° ì£¼ì… =====\r",
									"const token = pm.environment.get(\"access_token\");\r",
									"if (!token) throw new Error(\"ACCESS_TOKEN ì—†ìŒ: ë¨¼ì € ë¡œê·¸ì¸ ìš”ì²­ ì‹¤í–‰í•´ í† í°ì„ ì €ì¥í•˜ì„¸ìš”.\");\r",
									"pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
									"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
									"\r",
									"// ===== SJCL ë¡œë“œ (ë„¤íŠ¸ì›Œí¬ X) =====\r",
									"const SJCL_SRC = pm.environment.get(\"sjcl_src\") || pm.globals.get(\"sjcl_src\");\r",
									"if (!SJCL_SRC) throw new Error(\"sjcl_src ë³€ìˆ˜ì— sjcl.js ì „ì²´ ì†ŒìŠ¤ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.\");\r",
									"function buildSJCL(src){\r",
									"  const factory = new Function(`\r",
									"    var window = {}; var self = window; var global = window;\r",
									"    var module = { exports: {} }; var exports = module.exports;\r",
									"    ${src}\r",
									"    return (typeof sjcl !== \"undefined\") ? sjcl\r",
									"         : (module && module.exports ? module.exports\r",
									"         : (window.sjcl || exports.sjcl));\r",
									"  `);\r",
									"  const lib = factory();\r",
									"  if (!lib || !lib.cipher || !lib.mode || !lib.codec) throw new Error(\"SJCL ë¡œë“œ ì‹¤íŒ¨\");\r",
									"  return lib;\r",
									"}\r",
									"const SJCL = buildSJCL(SJCL_SRC);\r",
									"\r",
									"// ===== CryptoJS =====\r",
									"const CryptoJS = require(\"crypto-js\");\r",
									"\r",
									"// ===== ìœ í‹¸ =====\r",
									"function randomBytes(n){\r",
									"  const wa = CryptoJS.lib.WordArray.random(n);\r",
									"  const hex = wa.toString(CryptoJS.enc.Hex);\r",
									"  const out = [];\r",
									"  for (let i=0;i<hex.length;i+=2) out.push(parseInt(hex.substr(i,2),16));\r",
									"  return out;\r",
									"}\r",
									"function bytesToBits(bytes){\r",
									"  let hex = \"\";\r",
									"  for (let i=0;i<bytes.length;i++){\r",
									"    const h = bytes[i].toString(16);\r",
									"    hex += (h.length===1 ? \"0\"+h : h);\r",
									"  }\r",
									"  return SJCL.codec.hex.toBits(hex);\r",
									"}\r",
									"\r",
									"// AES-128-GCM(iv=12, tag=16), key = sha256(loginId).hex ì•16(ASCII ëŒ€ë¬¸ì)\r",
									"function encryptOnce(keyStr, plain){\r",
									"  const ivBytes = randomBytes(12);\r",
									"  const ivBits  = bytesToBits(ivBytes);\r",
									"  const tempKeyHex   = CryptoJS.SHA256(keyStr).toString(CryptoJS.enc.Hex).toUpperCase();\r",
									"  const secretKeyStr = tempKeyHex.substring(0,16).toUpperCase();      // ASCII 16 bytes\r",
									"  const keyBits = SJCL.codec.utf8String.toBits(secretKeyStr);\r",
									"  const ptBits  = SJCL.codec.utf8String.toBits(plain);\r",
									"  const aes     = new SJCL.cipher.aes(keyBits);\r",
									"  const ctWithTag = SJCL.mode.gcm.encrypt(aes, ptBits, ivBits, [], 128);\r",
									"  const combined  = SJCL.bitArray.concat(bytesToBits(ivBytes), ctWithTag); // iv + ct + tag\r",
									"  return SJCL.codec.base64.fromBits(combined);\r",
									"}\r",
									"\r",
									"// ===== ë°”ë”” ì½ê³  ë™ì¼ IDë¡œ 3ê°œ ë¹„ë²ˆ ì•”í˜¸í™” =====\r",
									"let body;\r",
									"try { body = JSON.parse(pm.request.body.raw || \"{}\"); }\r",
									"catch { throw new Error(\"Bodyê°€ JSONì´ ì•„ë‹™ë‹ˆë‹¤.\"); }\r",
									"\r",
									"// ì„œë²„ê°€ ì½ëŠ” ID í•„ë“œ\r",
									"const keyId = String(body.loginId ?? body.id ?? body.userId ?? \"\").trim();\r",
									"if (!keyId) throw new Error(\"Bodyì— loginId/id/userId ì¤‘ í•˜ë‚˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.\");\r",
									"\r",
									"// í‰ë¬¸ ê°’ ê°€ì ¸ì˜¤ê¸°(í…œí”Œë¦¿ì´ë©´ í™˜ê²½ë³€ìˆ˜ì—ì„œ)\r",
									"function pickPlain(field, envKey){\r",
									"  const v = body[field];\r",
									"  if (typeof v === \"string\" && v.includes(\"{{\")) {\r",
									"    const ev = pm.environment.get(envKey);\r",
									"    if (!ev) throw new Error(`${envKey} í™˜ê²½ë³€ìˆ˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.`);\r",
									"    return ev;\r",
									"  }\r",
									"  if (typeof v === \"string\" && v.trim()) return v;\r",
									"  const ev = pm.environment.get(envKey);\r",
									"  if (!ev) throw new Error(`${field} ë˜ëŠ” ${envKey} ì¤‘ í•˜ë‚˜ëŠ” ê°’ì´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.`);\r",
									"  return ev;\r",
									"}\r",
									"const currPlain = pickPlain(\"currentPassword\", \"PLAIN_PW\");\r",
									"const newPlain  = pickPlain(\"newPassword\",     \"NEW_PW\");\r",
									"const confPlain = pickPlain(\"confirmPassword\", \"CONF_PW\");\r",
									"\r",
									"\r",
									"// ì•”í˜¸í™”\r",
									"const encCurr = encryptOnce(keyId, currPlain);\r",
									"const encNew  = encryptOnce(keyId, newPlain);\r",
									"const encConf = encryptOnce(keyId, confPlain);\r",
									"\r",
									"// ë°”ë”” ë®ì–´ì“°ê¸°\r",
									"body.currentPassword = encCurr;\r",
									"body.newPassword     = encNew;\r",
									"body.confirmPassword = encConf;\r",
									"pm.request.body.update(JSON.stringify(body));\r",
									"\r",
									"// ì°¸ê³ ìš© ë³€ìˆ˜\r",
									"pm.variables.set(\"ENC_CURR_PW\", encCurr);\r",
									"pm.variables.set(\"ENC_NEW_PW\",  encNew);\r",
									"pm.variables.set(\"ENC_CONF_PW\", encConf);\r",
									"\r",
									"// í† í° ì‚¬ìš©ìì™€ loginId ë¶ˆì¼ì¹˜í•˜ë©´ ê²½ê³ (í™˜ê²½ì— LOGIN_ID ìˆìœ¼ë©´ ë¹„êµ)\r",
									"const envLogin = pm.environment.get(\"LOGIN_ID\");\r",
									"if (envLogin && envLogin !== keyId) {\r",
									"  console.warn(`WARNING: token user(${envLogin}) vs body loginId(${keyId}) ë¶ˆì¼ì¹˜ ê°€ëŠ¥ì„±`);\r",
									"}\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "{{access_token}}",
								"type": "text"
							},
							{
								"key": "",
								"value": "",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"loginId\": \"kjhan\",\r\n  \"currentPassword\": \"marine6c!\",\r\n  \"newPassword\": \"pc3002pky337!\",\r\n  \"confirmPassword\": \"1234\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/identity/api/users/password/change",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"identity",
								"api",
								"users",
								"password",
								"change"
							]
						}
					},
					"response": []
				},
				{
					"name": "ë¹„ë°€ë²ˆí˜¸ ë³€ê²½_í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ê²½ìš°",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// ========== Tests (Post-response) ==========\r",
									"\r",
									"// 1) ì‘ë‹µ íŒŒì‹± & ê¸°ë³¸ ê²€ì‚¬\r",
									"let j = null; try { j = pm.response.json(); } catch (e) { j = null; }\r",
									"\r",
									"// HTTP ì½”ë“œëŠ” ì •ìƒ/ì—ëŸ¬ë¥¼ ëª¨ë‘ í—ˆìš©(ë„¤ê±°í‹°ë¸Œ ì¼€ì´ìŠ¤ í¬í•¨)\r",
									"pm.test('HTTP 2xx/4xx/5xx í—ˆìš©', () => \r",
									"  pm.expect(pm.response.code).to.be.oneOf([200,201,400,401,403,404,409,422,500])\r",
									");\r",
									"\r",
									"// 2) ê¸°ëŒ€ ê²°ê³¼ íŒì •\r",
									"const svcCode = j && typeof j.code !== 'undefined' ? j.code : undefined;\r",
									"\r",
									"// ì„±ê³µ ì¼€ì´ìŠ¤(ë¹„ë²ˆ ì •ìƒ ë³€ê²½)\r",
									"const changedOK   = (pm.response.code === 200 || pm.response.code === 201) && j && svcCode === 200;\r",
									"\r",
									"// âœ… ë„¤ê±°í‹°ë¸Œ ì¼€ì´ìŠ¤: \"ìƒˆ ë¹„ë²ˆ/í™•ì¸ ë¶ˆì¼ì¹˜\"\r",
									"const mismatchOK  = (svcCode === 6019);\r",
									"\r",
									"// âœ… ë„¤ê±°í‹°ë¸Œ ì¼€ì´ìŠ¤: \"í˜„ì¬ ë¹„ë²ˆ ë¶ˆì¼ì¹˜\"\r",
									"const wrongCurrOK = (svcCode === 6018);\r",
									"\r",
									"// ë³´ì¡° í…ŒìŠ¤íŠ¸ í‘œì‹œ\r",
									"pm.test('ì„œë¹„ìŠ¤ code === 200 ë˜ëŠ” 6019/6018(ì˜ˆìƒ ë„¤ê±°í‹°ë¸Œ)', () => \r",
									"  pm.expect([200, 6019, 6018]).to.include(svcCode)\r",
									");\r",
									"\r",
									"// 3) ì„±ê³µ ì¼€ì´ìŠ¤ì¼ ë•Œë§Œ í›„ì†(ë¡œê·¸ì•„ì›ƒâ†’ë¡œê·¸ì¸â†’ë³€ìˆ˜ìŠ¤ì™‘) ìˆ˜í–‰\r",
									"if (changedOK) {\r",
									"  // 3-1) ìš”ì²­ ë°”ë””ì—ì„œ loginId ì¶”ì¶œ\r",
									"  let loginId = '';\r",
									"  try {\r",
									"    const bodyNow = JSON.parse(pm.request.body.raw || '{}');\r",
									"    loginId = String(bodyNow.loginId ?? bodyNow.id ?? bodyNow.userId ?? '').trim();\r",
									"  } catch(e) {}\r",
									"  if (!loginId) {\r",
									"    loginId = String(pm.environment.get('PW_TARGET_LOGIN_ID') || pm.environment.get('LOGIN_ID') || '').trim();\r",
									"  }\r",
									"  pm.test('ê²€ì¦ ëŒ€ìƒ loginId ì¡´ì¬', () => pm.expect(loginId).to.be.a('string').and.not.empty);\r",
									"\r",
									"  // 3-2) ë¡œê·¸ì¸ìš© ì•”í˜¸ë¬¸(Pre-requestì—ì„œ ë§Œë“  ENC_NEW_PW)\r",
									"  const encPwLogin = pm.variables.get('ENC_NEW_PW');\r",
									"  pm.test('ENC_NEW_PW ì¡´ì¬', () => pm.expect(encPwLogin).to.be.a('string').and.not.empty);\r",
									"\r",
									"  // 3-3) ë¡œê·¸ì•„ì›ƒ â†’ ìƒˆ ë¹„ë²ˆìœ¼ë¡œ ë¡œê·¸ì¸\r",
									"  const logoutUrl = pm.environment.get('LOGOUT_URL') || 'http://127.0.0.1/identity/api/access/logout';\r",
									"  const token     = pm.environment.get('access_token') || pm.environment.get('ACCESS_TOKEN');\r",
									"\r",
									"  pm.sendRequest({\r",
									"    url: logoutUrl,\r",
									"    method: 'DELETE',\r",
									"    header: token ? { 'Authorization': `Bearer ${token}` } : {}\r",
									"  }, (err, resp) => {\r",
									"    pm.test('ë¡œê·¸ì•„ì›ƒ ì „ì†¡', () => pm.expect(err).to.be.null);\r",
									"    if (err) return;\r",
									"\r",
									"    pm.test('ë¡œê·¸ì•„ì›ƒ 200/204/401 í—ˆìš©', () => pm.expect(resp.code).to.be.oneOf([200,204,401]));\r",
									"    pm.environment.unset('access_token');\r",
									"\r",
									"    const loginUrl = pm.environment.get('LOGIN_URL') || 'http://127.0.0.1/identity/api/access/login';\r",
									"    pm.sendRequest({\r",
									"      url: loginUrl,\r",
									"      method: 'POST',\r",
									"      header: { 'Content-Type': 'application/json', 'Accept': 'application/json' },\r",
									"      body: { mode: 'raw', raw: JSON.stringify({\r",
									"        loginId: loginId,\r",
									"        password: encPwLogin,\r",
									"        isRestrictNewToken: false\r",
									"      }) }\r",
									"    }, (err2, resp2) => {\r",
									"      pm.test('ë¡œê·¸ì¸ ìš”ì²­ ì „ì†¡', () => pm.expect(err2).to.be.null);\r",
									"      if (err2) return;\r",
									"\r",
									"      let lj = {}; try { lj = resp2.json(); } catch {}\r",
									"      console.log('[POST-PW][LOGIN] http=', resp2.code, 'svc=', lj && lj.code, 'msg=', lj && lj.message);\r",
									"\r",
									"      pm.test('ë¡œê·¸ì¸ HTTP 200/201', () => pm.expect(resp2.code).to.be.oneOf([200,201]));\r",
									"      pm.test('ë¡œê·¸ì¸ ì„œë¹„ìŠ¤ code === 200', () => pm.expect((lj||{}).code).to.eql(200));\r",
									"\r",
									"      // ìƒˆ í† í° ì €ì¥(ì„ íƒ)\r",
									"      try {\r",
									"        const newTok = lj?.result?.accessToken?.token;\r",
									"        if (newTok) pm.environment.set('access_token', newTok);\r",
									"      } catch(e) {}\r",
									"\r",
									"      // 3-4) ë¹„ë²ˆ ë³€ìˆ˜ ìŠ¤ì™‘\r",
									"      (function () {\r",
									"        const oldPlain = pm.environment.get('PLAIN_PW') || '';\r",
									"        const newPw    = pm.environment.get('NEW_PW')   || '';\r",
									"\r",
									"        pm.environment.set('PREV_PW', oldPlain);\r",
									"        if (newPw) pm.environment.set('PLAIN_PW', newPw);\r",
									"        pm.environment.set('NEW_PW',  oldPlain);\r",
									"        pm.environment.set('CONF_PW', oldPlain);\r",
									"        pm.environment.set('PW_CHANGED_AT', new Date().toISOString());\r",
									"\r",
									"        console.log('ğŸ” ë¹„ë²ˆ ë³€ìˆ˜ ê°±ì‹  ì™„ë£Œ(ë§ˆìŠ¤í‚¹): { PREV:\"***\", PLAIN:\"***\", NEW:\"***\", CONF:\"***\" }');\r",
									"      })();\r",
									"    });\r",
									"  });\r",
									"} else if (mismatchOK || wrongCurrOK) {\r",
									"  // ì˜ˆìƒëœ ë„¤ê±°í‹°ë¸Œ â†’ í›„ì† ì‘ì—… ìŠ¤í‚µ (PASSë¡œ ì§‘ê³„)\r",
									"  console.log('[PW-CHANGE] ì˜ˆìƒ ë„¤ê±°í‹°ë¸Œ ë°œìƒ â†’ svcCode=', svcCode, ' í›„ì† ì‘ì—… ìŠ¤í‚µ');\r",
									"} else {\r",
									"  // ê·¸ ì™¸ ì—ëŸ¬\r",
									"  console.warn('[PW-CHANGE] ë³€ê²½ ì‹¤íŒ¨/ìŠ¤í‚µ', { http: pm.response.code, svc: svcCode });\r",
									"}\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    if (isSummary) { console.log(TAG, 'skip summary request'); return; }\r",
									"\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"\r",
									"    // âœ… PASS ê¸°ì¤€: ì •ìƒ ë³€ê²½ OR ë¶ˆì¼ì¹˜(6019) OR í˜„ì¬ ë¹„ë²ˆ ë¶ˆì¼ì¹˜(6018)\r",
									"    const ok = !!(changedOK || mismatchOK || wrongCurrOK);\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok,\r",
									"      svc: svcCode\r",
									"    };\r",
									"\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after, '| svc=', svcCode);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // IIFE\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// ===== í† í° ì£¼ì… =====\r",
									"const token = pm.environment.get(\"access_token\");\r",
									"if (!token) throw new Error(\"ACCESS_TOKEN ì—†ìŒ: ë¨¼ì € ë¡œê·¸ì¸ ìš”ì²­ ì‹¤í–‰í•´ í† í°ì„ ì €ì¥í•˜ì„¸ìš”.\");\r",
									"pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
									"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
									"\r",
									"// ===== SJCL ë¡œë“œ (ë„¤íŠ¸ì›Œí¬ X) =====\r",
									"const SJCL_SRC = pm.environment.get(\"sjcl_src\") || pm.globals.get(\"sjcl_src\");\r",
									"if (!SJCL_SRC) throw new Error(\"sjcl_src ë³€ìˆ˜ì— sjcl.js ì „ì²´ ì†ŒìŠ¤ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.\");\r",
									"function buildSJCL(src){\r",
									"  const factory = new Function(`\r",
									"    var window = {}; var self = window; var global = window;\r",
									"    var module = { exports: {} }; var exports = module.exports;\r",
									"    ${src}\r",
									"    return (typeof sjcl !== \"undefined\") ? sjcl\r",
									"         : (module && module.exports ? module.exports\r",
									"         : (window.sjcl || exports.sjcl));\r",
									"  `);\r",
									"  const lib = factory();\r",
									"  if (!lib || !lib.cipher || !lib.mode || !lib.codec) throw new Error(\"SJCL ë¡œë“œ ì‹¤íŒ¨\");\r",
									"  return lib;\r",
									"}\r",
									"const SJCL = buildSJCL(SJCL_SRC);\r",
									"\r",
									"// ===== CryptoJS =====\r",
									"const CryptoJS = require(\"crypto-js\");\r",
									"\r",
									"// ===== ìœ í‹¸ =====\r",
									"function randomBytes(n){\r",
									"  const wa = CryptoJS.lib.WordArray.random(n);\r",
									"  const hex = wa.toString(CryptoJS.enc.Hex);\r",
									"  const out = [];\r",
									"  for (let i=0;i<hex.length;i+=2) out.push(parseInt(hex.substr(i,2),16));\r",
									"  return out;\r",
									"}\r",
									"function bytesToBits(bytes){\r",
									"  let hex = \"\";\r",
									"  for (let i=0;i<bytes.length;i++){\r",
									"    const h = bytes[i].toString(16);\r",
									"    hex += (h.length===1 ? \"0\"+h : h);\r",
									"  }\r",
									"  return SJCL.codec.hex.toBits(hex);\r",
									"}\r",
									"\r",
									"// AES-128-GCM(iv=12, tag=16), key = sha256(loginId).hex ì•16(ASCII ëŒ€ë¬¸ì)\r",
									"function encryptOnce(keyStr, plain){\r",
									"  const ivBytes = randomBytes(12);\r",
									"  const ivBits  = bytesToBits(ivBytes);\r",
									"  const tempKeyHex   = CryptoJS.SHA256(keyStr).toString(CryptoJS.enc.Hex).toUpperCase();\r",
									"  const secretKeyStr = tempKeyHex.substring(0,16).toUpperCase();      // ASCII 16 bytes\r",
									"  const keyBits = SJCL.codec.utf8String.toBits(secretKeyStr);\r",
									"  const ptBits  = SJCL.codec.utf8String.toBits(plain);\r",
									"  const aes     = new SJCL.cipher.aes(keyBits);\r",
									"  const ctWithTag = SJCL.mode.gcm.encrypt(aes, ptBits, ivBits, [], 128);\r",
									"  const combined  = SJCL.bitArray.concat(bytesToBits(ivBytes), ctWithTag); // iv + ct + tag\r",
									"  return SJCL.codec.base64.fromBits(combined);\r",
									"}\r",
									"\r",
									"// ===== ë°”ë”” ì½ê³  ë™ì¼ IDë¡œ 3ê°œ ë¹„ë²ˆ ì•”í˜¸í™” =====\r",
									"let body;\r",
									"try { body = JSON.parse(pm.request.body.raw || \"{}\"); }\r",
									"catch { throw new Error(\"Bodyê°€ JSONì´ ì•„ë‹™ë‹ˆë‹¤.\"); }\r",
									"\r",
									"// ì„œë²„ê°€ ì½ëŠ” ID í•„ë“œ\r",
									"const keyId = String(body.loginId ?? body.id ?? body.userId ?? \"\").trim();\r",
									"if (!keyId) throw new Error(\"Bodyì— loginId/id/userId ì¤‘ í•˜ë‚˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.\");\r",
									"\r",
									"// í‰ë¬¸ ê°’ ê°€ì ¸ì˜¤ê¸°(í…œí”Œë¦¿ì´ë©´ í™˜ê²½ë³€ìˆ˜ì—ì„œ)\r",
									"function pickPlain(field, envKey){\r",
									"  const v = body[field];\r",
									"  if (typeof v === \"string\" && v.includes(\"{{\")) {\r",
									"    const ev = pm.environment.get(envKey);\r",
									"    if (!ev) throw new Error(`${envKey} í™˜ê²½ë³€ìˆ˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.`);\r",
									"    return ev;\r",
									"  }\r",
									"  if (typeof v === \"string\" && v.trim()) return v;\r",
									"  const ev = pm.environment.get(envKey);\r",
									"  if (!ev) throw new Error(`${field} ë˜ëŠ” ${envKey} ì¤‘ í•˜ë‚˜ëŠ” ê°’ì´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.`);\r",
									"  return ev;\r",
									"}\r",
									"const currPlain = pickPlain(\"currentPassword\", \"PLAIN_PW\");\r",
									"const newPlain  = pickPlain(\"newPassword\",     \"NEW_PW\");\r",
									"const confPlain = pickPlain(\"confirmPassword\", \"CONF_PW\");\r",
									"if (newPlain !== confPlain) throw new Error(\"NEW_PWì™€ CONF_PWê°€ ë‹¤ë¦…ë‹ˆë‹¤.\");\r",
									"\r",
									"// ì•”í˜¸í™”\r",
									"const encCurr = encryptOnce(keyId, currPlain);\r",
									"const encNew  = encryptOnce(keyId, newPlain);\r",
									"const encConf = encryptOnce(keyId, confPlain);\r",
									"\r",
									"// ë°”ë”” ë®ì–´ì“°ê¸°\r",
									"body.currentPassword = encCurr;\r",
									"body.newPassword     = encNew;\r",
									"body.confirmPassword = encConf;\r",
									"pm.request.body.update(JSON.stringify(body));\r",
									"\r",
									"// ì°¸ê³ ìš© ë³€ìˆ˜\r",
									"pm.variables.set(\"ENC_CURR_PW\", encCurr);\r",
									"pm.variables.set(\"ENC_NEW_PW\",  encNew);\r",
									"pm.variables.set(\"ENC_CONF_PW\", encConf);\r",
									"\r",
									"// í† í° ì‚¬ìš©ìì™€ loginId ë¶ˆì¼ì¹˜í•˜ë©´ ê²½ê³ (í™˜ê²½ì— LOGIN_ID ìˆìœ¼ë©´ ë¹„êµ)\r",
									"const envLogin = pm.environment.get(\"LOGIN_ID\");\r",
									"if (envLogin && envLogin !== keyId) {\r",
									"  console.warn(`WARNING: token user(${envLogin}) vs body loginId(${keyId}) ë¶ˆì¼ì¹˜ ê°€ëŠ¥ì„±`);\r",
									"}\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "{{access_token}}",
								"type": "text"
							},
							{
								"key": "",
								"value": "",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"loginId\": \"kjhan\",\r\n  \"currentPassword\": \"1234\",\r\n  \"newPassword\": \"marine6c!\",\r\n  \"confirmPassword\": \"marine6c!\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/identity/api/users/password/change",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"identity",
								"api",
								"users",
								"password",
								"change"
							]
						}
					},
					"response": []
				},
				{
					"name": "ë¹„ë°€ë²ˆí˜¸ ë³€ê²½",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// ========== Tests (Post-response) ==========\r",
									"\r",
									"// 1) ì‘ë‹µ íŒŒì‹± & ê¸°ë³¸ ê²€ì‚¬\r",
									"let j = null; try { j = pm.response.json(); } catch(e){}\r",
									"pm.test('HTTP 200/201/401 í—ˆìš©', () => pm.expect(pm.response.code).to.be.oneOf([200,201,401]));\r",
									"if (pm.response.code === 200 || pm.response.code === 201) {\r",
									"  pm.test('ì„œë¹„ìŠ¤ code === 200', () => pm.expect((j||{}).code).to.eql(200));\r",
									"}\r",
									"\r",
									"// 2) ë¹„ë²ˆ ë³€ê²½ ì„±ê³µ ì•„ë‹ˆë©´ ì¢…ë£Œ\r",
									"const changedOK = (pm.response.code === 200 || pm.response.code === 201) && j && j.code === 200;\r",
									"if (!changedOK) {\r",
									"  console.warn('[PW-CHANGE] ë³€ê²½ ì‹¤íŒ¨/ìŠ¤í‚µ â†’ í›„ì† ì‘ì—… ì•ˆ í•¨', { http: pm.response.code, svc: j && j.code });\r",
									"  // === ì§‘ê³„ IIFEëŠ” í•­ìƒ ì‹¤í–‰í•˜ë¯€ë¡œ ì•„ë˜ë¡œ ë„˜ì–´ê°€ì§€ ì•Šê³  ë§ˆì§€ë§‰ì—ì„œ PASS/FAILë§Œ ê¸°ë¡ë©ë‹ˆë‹¤.\r",
									"} else {\r",
									"  // 3) ìš”ì²­ ë°”ë””ì—ì„œ loginId ì¶”ì¶œ (Pre-requestì—ì„œ ì•”í˜¸í™”ëœ ìƒíƒœì§€ë§Œ IDëŠ” ê·¸ëŒ€ë¡œ ì¡´ì¬)\r",
									"  let loginId = '';\r",
									"  try {\r",
									"    const bodyNow = JSON.parse(pm.request.body.raw || '{}');\r",
									"    loginId = String(bodyNow.loginId ?? bodyNow.id ?? bodyNow.userId ?? '').trim();\r",
									"  } catch(e) {}\r",
									"  if (!loginId) {\r",
									"    loginId = String(pm.environment.get('PW_TARGET_LOGIN_ID') || pm.environment.get('LOGIN_ID') || '').trim();\r",
									"  }\r",
									"  pm.test('ê²€ì¦ ëŒ€ìƒ loginId ì¡´ì¬', () => pm.expect(loginId).to.be.a('string').and.not.empty);\r",
									"\r",
									"  // 4) ë¡œê·¸ì¸ ì•”í˜¸ë¬¸: Pre-requestì—ì„œ ìƒì„±ëœ ENC_NEW_PW ì‚¬ìš©(ê°™ì€ ID í‚¤ë¡œ ì•”í˜¸í™”ë¨)\r",
									"  const encPwLogin = pm.variables.get('ENC_NEW_PW');\r",
									"  pm.test('ENC_NEW_PW ì¡´ì¬', () => pm.expect(encPwLogin).to.be.a('string').and.not.empty);\r",
									"\r",
									"  // 5) ë¡œê·¸ì•„ì›ƒ â†’ ë¡œê·¸ì¸(1íšŒ) ì§ë ¬í™”\r",
									"  const logoutUrl = pm.environment.get('LOGOUT_URL') || 'http://127.0.0.1/identity/api/access/logout';\r",
									"  const token     = pm.environment.get('access_token') || pm.environment.get('ACCESS_TOKEN');\r",
									"\r",
									"  pm.sendRequest({\r",
									"    url: logoutUrl,\r",
									"    method: 'DELETE',\r",
									"    header: token ? { 'Authorization': `Bearer ${token}` } : {}\r",
									"  }, (err, resp) => {\r",
									"    pm.test('ë¡œê·¸ì•„ì›ƒ ì „ì†¡', () => pm.expect(err).to.be.null);\r",
									"    if (err) return;\r",
									"    pm.test('ë¡œê·¸ì•„ì›ƒ 200/204/401 í—ˆìš©', () => pm.expect(resp.code).to.be.oneOf([200,204,401]));\r",
									"    pm.environment.unset('access_token');\r",
									"\r",
									"    // --- ìƒˆ ë¹„ë²ˆìœ¼ë¡œ ë¡œê·¸ì¸ í•œ ë²ˆ ---\r",
									"    const loginUrl = pm.environment.get('LOGIN_URL') || 'http://127.0.0.1/identity/api/access/login';\r",
									"\r",
									"    pm.sendRequest({\r",
									"      url: loginUrl,\r",
									"      method: 'POST',\r",
									"      header: { 'Content-Type': 'application/json', 'Accept': 'application/json' },\r",
									"      body: { mode: 'raw', raw: JSON.stringify({\r",
									"        loginId: loginId,\r",
									"        password: encPwLogin,          // Pre-requestì—ì„œ ë§Œë“  ENC_NEW_PW\r",
									"        isRestrictNewToken: false\r",
									"      }) }\r",
									"    }, (err2, resp2) => {\r",
									"      pm.test('ë¡œê·¸ì¸ ìš”ì²­ ì „ì†¡', () => pm.expect(err2).to.be.null);\r",
									"      if (err2) return;\r",
									"\r",
									"      let lj = {}; try { lj = resp2.json(); } catch {}\r",
									"      console.log('[POST-PW][LOGIN] http=', resp2.code, 'svc=', lj && lj.code, 'msg=', lj && lj.message);\r",
									"\r",
									"      pm.test('ë¡œê·¸ì¸ HTTP 200/201', () => pm.expect(resp2.code).to.be.oneOf([200,201]));\r",
									"      pm.test('ë¡œê·¸ì¸ ì„œë¹„ìŠ¤ code === 200', () => pm.expect((lj||{}).code).to.eql(200));\r",
									"\r",
									"      // (ì„ íƒ) ìƒˆ í† í° ì €ì¥\r",
									"      try {\r",
									"        const newTok = lj && lj.result && lj.result.accessToken && lj.result.accessToken.token;\r",
									"        if (newTok) pm.environment.set('access_token', newTok);\r",
									"      } catch(e) {}\r",
									"\r",
									"      // 6) ë¹„ë²ˆ ë³€ìˆ˜ ìŠ¤ì™‘ (ìš”ì²­í•œ ìˆœì„œ)\r",
									"      //    â‘  PREV_PW â† (ì´ì „) PLAIN_PW\r",
									"      //    â‘¡ PLAIN_PW â† (ê¸°ì¡´) NEW_PW (ìˆì„ ë•Œë§Œ)\r",
									"      //    â‘¢ NEW_PW, CONF_PW â† (ì´ì „) PLAIN_PW\r",
									"      (function () {\r",
									"        const oldPlain = pm.environment.get('PLAIN_PW') || '';\r",
									"        const newPw    = pm.environment.get('NEW_PW')   || '';\r",
									"\r",
									"        pm.environment.set('PREV_PW', oldPlain);         // â‘ \r",
									"        if (newPw) pm.environment.set('PLAIN_PW', newPw); // â‘¡\r",
									"        pm.environment.set('NEW_PW',  oldPlain);         // â‘¢\r",
									"        pm.environment.set('CONF_PW', oldPlain);         // â‘¢\r",
									"        pm.environment.set('PW_CHANGED_AT', new Date().toISOString());\r",
									"\r",
									"        console.log('ğŸ” ë¹„ë²ˆ ë³€ìˆ˜ ê°±ì‹  ì™„ë£Œ(ë§ˆìŠ¤í‚¹): { PREV:\"***\", PLAIN:\"***\", NEW:\"***\", CONF:\"***\" }');\r",
									"      })();\r",
									"    });\r",
									"  });\r",
									"}\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    if (isSummary) { console.log(TAG, 'skip summary request'); return; }\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // âœ… PASS ê¸°ì¤€: ì´ë²ˆ ìš”ì²­ì˜ ë¹„ë²ˆ ë³€ê²½ ì„±ê³µ ì—¬ë¶€(changedOK)\r",
									"    const ok = !!changedOK;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ IIFE ë‹«ê¸°\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// ===== í† í° ì£¼ì… =====\r",
									"const token = pm.environment.get(\"access_token\");\r",
									"if (!token) throw new Error(\"ACCESS_TOKEN ì—†ìŒ: ë¨¼ì € ë¡œê·¸ì¸ ìš”ì²­ ì‹¤í–‰í•´ í† í°ì„ ì €ì¥í•˜ì„¸ìš”.\");\r",
									"pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
									"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
									"\r",
									"// ===== SJCL ë¡œë“œ (ë„¤íŠ¸ì›Œí¬ X) =====\r",
									"const SJCL_SRC = pm.environment.get(\"sjcl_src\") || pm.globals.get(\"sjcl_src\");\r",
									"if (!SJCL_SRC) throw new Error(\"sjcl_src ë³€ìˆ˜ì— sjcl.js ì „ì²´ ì†ŒìŠ¤ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.\");\r",
									"function buildSJCL(src){\r",
									"  const factory = new Function(`\r",
									"    var window = {}; var self = window; var global = window;\r",
									"    var module = { exports: {} }; var exports = module.exports;\r",
									"    ${src}\r",
									"    return (typeof sjcl !== \"undefined\") ? sjcl\r",
									"         : (module && module.exports ? module.exports\r",
									"         : (window.sjcl || exports.sjcl));\r",
									"  `);\r",
									"  const lib = factory();\r",
									"  if (!lib || !lib.cipher || !lib.mode || !lib.codec) throw new Error(\"SJCL ë¡œë“œ ì‹¤íŒ¨\");\r",
									"  return lib;\r",
									"}\r",
									"const SJCL = buildSJCL(SJCL_SRC);\r",
									"\r",
									"// ===== CryptoJS =====\r",
									"const CryptoJS = require(\"crypto-js\");\r",
									"\r",
									"// ===== ìœ í‹¸ =====\r",
									"function randomBytes(n){\r",
									"  const wa = CryptoJS.lib.WordArray.random(n);\r",
									"  const hex = wa.toString(CryptoJS.enc.Hex);\r",
									"  const out = [];\r",
									"  for (let i=0;i<hex.length;i+=2) out.push(parseInt(hex.substr(i,2),16));\r",
									"  return out;\r",
									"}\r",
									"function bytesToBits(bytes){\r",
									"  let hex = \"\";\r",
									"  for (let i=0;i<bytes.length;i++){\r",
									"    const h = bytes[i].toString(16);\r",
									"    hex += (h.length===1 ? \"0\"+h : h);\r",
									"  }\r",
									"  return SJCL.codec.hex.toBits(hex);\r",
									"}\r",
									"\r",
									"// AES-128-GCM(iv=12, tag=16), key = sha256(loginId).hex ì•16(ASCII ëŒ€ë¬¸ì)\r",
									"function encryptOnce(keyStr, plain){\r",
									"  const ivBytes = randomBytes(12);\r",
									"  const ivBits  = bytesToBits(ivBytes);\r",
									"  const tempKeyHex   = CryptoJS.SHA256(keyStr).toString(CryptoJS.enc.Hex).toUpperCase();\r",
									"  const secretKeyStr = tempKeyHex.substring(0,16).toUpperCase();      // ASCII 16 bytes\r",
									"  const keyBits = SJCL.codec.utf8String.toBits(secretKeyStr);\r",
									"  const ptBits  = SJCL.codec.utf8String.toBits(plain);\r",
									"  const aes     = new SJCL.cipher.aes(keyBits);\r",
									"  const ctWithTag = SJCL.mode.gcm.encrypt(aes, ptBits, ivBits, [], 128);\r",
									"  const combined  = SJCL.bitArray.concat(bytesToBits(ivBytes), ctWithTag); // iv + ct + tag\r",
									"  return SJCL.codec.base64.fromBits(combined);\r",
									"}\r",
									"\r",
									"// ===== ë°”ë”” ì½ê³  ë™ì¼ IDë¡œ 3ê°œ ë¹„ë²ˆ ì•”í˜¸í™” =====\r",
									"let body;\r",
									"try { body = JSON.parse(pm.request.body.raw || \"{}\"); }\r",
									"catch { throw new Error(\"Bodyê°€ JSONì´ ì•„ë‹™ë‹ˆë‹¤.\"); }\r",
									"\r",
									"// ì„œë²„ê°€ ì½ëŠ” ID í•„ë“œ\r",
									"const keyId = String(body.loginId ?? body.id ?? body.userId ?? \"\").trim();\r",
									"if (!keyId) throw new Error(\"Bodyì— loginId/id/userId ì¤‘ í•˜ë‚˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.\");\r",
									"\r",
									"// í‰ë¬¸ ê°’ ê°€ì ¸ì˜¤ê¸°(í…œí”Œë¦¿ì´ë©´ í™˜ê²½ë³€ìˆ˜ì—ì„œ)\r",
									"function pickPlain(field, envKey){\r",
									"  const v = body[field];\r",
									"  if (typeof v === \"string\" && v.includes(\"{{\")) {\r",
									"    const ev = pm.environment.get(envKey);\r",
									"    if (!ev) throw new Error(`${envKey} í™˜ê²½ë³€ìˆ˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.`);\r",
									"    return ev;\r",
									"  }\r",
									"  if (typeof v === \"string\" && v.trim()) return v;\r",
									"  const ev = pm.environment.get(envKey);\r",
									"  if (!ev) throw new Error(`${field} ë˜ëŠ” ${envKey} ì¤‘ í•˜ë‚˜ëŠ” ê°’ì´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.`);\r",
									"  return ev;\r",
									"}\r",
									"const currPlain = pickPlain(\"currentPassword\", \"PLAIN_PW\");\r",
									"const newPlain  = pickPlain(\"newPassword\",     \"NEW_PW\");\r",
									"const confPlain = pickPlain(\"confirmPassword\", \"CONF_PW\");\r",
									"if (newPlain !== confPlain) throw new Error(\"NEW_PWì™€ CONF_PWê°€ ë‹¤ë¦…ë‹ˆë‹¤.\");\r",
									"\r",
									"// ì•”í˜¸í™”\r",
									"const encCurr = encryptOnce(keyId, currPlain);\r",
									"const encNew  = encryptOnce(keyId, newPlain);\r",
									"const encConf = encryptOnce(keyId, confPlain);\r",
									"\r",
									"// ë°”ë”” ë®ì–´ì“°ê¸°\r",
									"body.currentPassword = encCurr;\r",
									"body.newPassword     = encNew;\r",
									"body.confirmPassword = encConf;\r",
									"pm.request.body.update(JSON.stringify(body));\r",
									"\r",
									"// ì°¸ê³ ìš© ë³€ìˆ˜\r",
									"pm.variables.set(\"ENC_CURR_PW\", encCurr);\r",
									"pm.variables.set(\"ENC_NEW_PW\",  encNew);\r",
									"pm.variables.set(\"ENC_CONF_PW\", encConf);\r",
									"\r",
									"// í† í° ì‚¬ìš©ìì™€ loginId ë¶ˆì¼ì¹˜í•˜ë©´ ê²½ê³ (í™˜ê²½ì— LOGIN_ID ìˆìœ¼ë©´ ë¹„êµ)\r",
									"const envLogin = pm.environment.get(\"LOGIN_ID\");\r",
									"if (envLogin && envLogin !== keyId) {\r",
									"  console.warn(`WARNING: token user(${envLogin}) vs body loginId(${keyId}) ë¶ˆì¼ì¹˜ ê°€ëŠ¥ì„±`);\r",
									"}\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "{{access_token}}",
								"type": "text"
							},
							{
								"key": "",
								"value": "",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"loginId\": \"kjhan\",\r\n  \"currentPassword\": \"marine6c!\",\r\n  \"newPassword\": \"pc3002pky337!\",\r\n  \"confirmPassword\": \"pc3002pky337!\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/identity/api/users/password/change",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"identity",
								"api",
								"users",
								"password",
								"change"
							]
						}
					},
					"response": []
				},
				{
					"name": "ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ Copy",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// ========== Tests (Post-response) ==========\r",
									"\r",
									"// 1) ì‘ë‹µ íŒŒì‹± & ê¸°ë³¸ ê²€ì‚¬\r",
									"let j = null; try { j = pm.response.json(); } catch(e){}\r",
									"pm.test('HTTP 200/201/401 í—ˆìš©', () => pm.expect(pm.response.code).to.be.oneOf([200,201,401]));\r",
									"if (pm.response.code === 200 || pm.response.code === 201) {\r",
									"  pm.test('ì„œë¹„ìŠ¤ code === 200', () => pm.expect((j||{}).code).to.eql(200));\r",
									"}\r",
									"\r",
									"// 2) ë¹„ë²ˆ ë³€ê²½ ì„±ê³µ ì•„ë‹ˆë©´ ì¢…ë£Œ\r",
									"const changedOK = (pm.response.code === 200 || pm.response.code === 201) && j && j.code === 200;\r",
									"if (!changedOK) {\r",
									"  console.warn('[PW-CHANGE] ë³€ê²½ ì‹¤íŒ¨/ìŠ¤í‚µ â†’ í›„ì† ì‘ì—… ì•ˆ í•¨', { http: pm.response.code, svc: j && j.code });\r",
									"  // === ì§‘ê³„ IIFEëŠ” í•­ìƒ ì‹¤í–‰í•˜ë¯€ë¡œ ì•„ë˜ë¡œ ë„˜ì–´ê°€ì§€ ì•Šê³  ë§ˆì§€ë§‰ì—ì„œ PASS/FAILë§Œ ê¸°ë¡ë©ë‹ˆë‹¤.\r",
									"} else {\r",
									"  // 3) ìš”ì²­ ë°”ë””ì—ì„œ loginId ì¶”ì¶œ (Pre-requestì—ì„œ ì•”í˜¸í™”ëœ ìƒíƒœì§€ë§Œ IDëŠ” ê·¸ëŒ€ë¡œ ì¡´ì¬)\r",
									"  let loginId = '';\r",
									"  try {\r",
									"    const bodyNow = JSON.parse(pm.request.body.raw || '{}');\r",
									"    loginId = String(bodyNow.loginId ?? bodyNow.id ?? bodyNow.userId ?? '').trim();\r",
									"  } catch(e) {}\r",
									"  if (!loginId) {\r",
									"    loginId = String(pm.environment.get('PW_TARGET_LOGIN_ID') || pm.environment.get('LOGIN_ID') || '').trim();\r",
									"  }\r",
									"  pm.test('ê²€ì¦ ëŒ€ìƒ loginId ì¡´ì¬', () => pm.expect(loginId).to.be.a('string').and.not.empty);\r",
									"\r",
									"  // 4) ë¡œê·¸ì¸ ì•”í˜¸ë¬¸: Pre-requestì—ì„œ ìƒì„±ëœ ENC_NEW_PW ì‚¬ìš©(ê°™ì€ ID í‚¤ë¡œ ì•”í˜¸í™”ë¨)\r",
									"  const encPwLogin = pm.variables.get('ENC_NEW_PW');\r",
									"  pm.test('ENC_NEW_PW ì¡´ì¬', () => pm.expect(encPwLogin).to.be.a('string').and.not.empty);\r",
									"\r",
									"  // 5) ë¡œê·¸ì•„ì›ƒ â†’ ë¡œê·¸ì¸(1íšŒ) ì§ë ¬í™”\r",
									"  const logoutUrl = pm.environment.get('LOGOUT_URL') || 'http://127.0.0.1/identity/api/access/logout';\r",
									"  const token     = pm.environment.get('access_token') || pm.environment.get('ACCESS_TOKEN');\r",
									"\r",
									"  pm.sendRequest({\r",
									"    url: logoutUrl,\r",
									"    method: 'DELETE',\r",
									"    header: token ? { 'Authorization': `Bearer ${token}` } : {}\r",
									"  }, (err, resp) => {\r",
									"    pm.test('ë¡œê·¸ì•„ì›ƒ ì „ì†¡', () => pm.expect(err).to.be.null);\r",
									"    if (err) return;\r",
									"    pm.test('ë¡œê·¸ì•„ì›ƒ 200/204/401 í—ˆìš©', () => pm.expect(resp.code).to.be.oneOf([200,204,401]));\r",
									"    pm.environment.unset('access_token');\r",
									"\r",
									"    // --- ìƒˆ ë¹„ë²ˆìœ¼ë¡œ ë¡œê·¸ì¸ í•œ ë²ˆ ---\r",
									"    const loginUrl = pm.environment.get('LOGIN_URL') || 'http://127.0.0.1/identity/api/access/login';\r",
									"\r",
									"    pm.sendRequest({\r",
									"      url: loginUrl,\r",
									"      method: 'POST',\r",
									"      header: { 'Content-Type': 'application/json', 'Accept': 'application/json' },\r",
									"      body: { mode: 'raw', raw: JSON.stringify({\r",
									"        loginId: loginId,\r",
									"        password: encPwLogin,          // Pre-requestì—ì„œ ë§Œë“  ENC_NEW_PW\r",
									"        isRestrictNewToken: false\r",
									"      }) }\r",
									"    }, (err2, resp2) => {\r",
									"      pm.test('ë¡œê·¸ì¸ ìš”ì²­ ì „ì†¡', () => pm.expect(err2).to.be.null);\r",
									"      if (err2) return;\r",
									"\r",
									"      let lj = {}; try { lj = resp2.json(); } catch {}\r",
									"      console.log('[POST-PW][LOGIN] http=', resp2.code, 'svc=', lj && lj.code, 'msg=', lj && lj.message);\r",
									"\r",
									"      pm.test('ë¡œê·¸ì¸ HTTP 200/201', () => pm.expect(resp2.code).to.be.oneOf([200,201]));\r",
									"      pm.test('ë¡œê·¸ì¸ ì„œë¹„ìŠ¤ code === 200', () => pm.expect((lj||{}).code).to.eql(200));\r",
									"\r",
									"      // (ì„ íƒ) ìƒˆ í† í° ì €ì¥\r",
									"      try {\r",
									"        const newTok = lj && lj.result && lj.result.accessToken && lj.result.accessToken.token;\r",
									"        if (newTok) pm.environment.set('access_token', newTok);\r",
									"      } catch(e) {}\r",
									"\r",
									"      // 6) ë¹„ë²ˆ ë³€ìˆ˜ ìŠ¤ì™‘ (ìš”ì²­í•œ ìˆœì„œ)\r",
									"      //    â‘  PREV_PW â† (ì´ì „) PLAIN_PW\r",
									"      //    â‘¡ PLAIN_PW â† (ê¸°ì¡´) NEW_PW (ìˆì„ ë•Œë§Œ)\r",
									"      //    â‘¢ NEW_PW, CONF_PW â† (ì´ì „) PLAIN_PW\r",
									"      (function () {\r",
									"        const oldPlain = pm.environment.get('PLAIN_PW') || '';\r",
									"        const newPw    = pm.environment.get('NEW_PW')   || '';\r",
									"\r",
									"        pm.environment.set('PREV_PW', oldPlain);         // â‘ \r",
									"        if (newPw) pm.environment.set('PLAIN_PW', newPw); // â‘¡\r",
									"        pm.environment.set('NEW_PW',  oldPlain);         // â‘¢\r",
									"        pm.environment.set('CONF_PW', oldPlain);         // â‘¢\r",
									"        pm.environment.set('PW_CHANGED_AT', new Date().toISOString());\r",
									"\r",
									"        console.log('ğŸ” ë¹„ë²ˆ ë³€ìˆ˜ ê°±ì‹  ì™„ë£Œ(ë§ˆìŠ¤í‚¹): { PREV:\"***\", PLAIN:\"***\", NEW:\"***\", CONF:\"***\" }');\r",
									"      })();\r",
									"    });\r",
									"  });\r",
									"}\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    if (isSummary) { console.log(TAG, 'skip summary request'); return; }\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // âœ… PASS ê¸°ì¤€: ì´ë²ˆ ìš”ì²­ì˜ ë¹„ë²ˆ ë³€ê²½ ì„±ê³µ ì—¬ë¶€(changedOK)\r",
									"    const ok = !!changedOK;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ IIFE ë‹«ê¸°\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// ===== í† í° ì£¼ì… =====\r",
									"const token = pm.environment.get(\"access_token\");\r",
									"if (!token) throw new Error(\"ACCESS_TOKEN ì—†ìŒ: ë¨¼ì € ë¡œê·¸ì¸ ìš”ì²­ ì‹¤í–‰í•´ í† í°ì„ ì €ì¥í•˜ì„¸ìš”.\");\r",
									"pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
									"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
									"\r",
									"// ===== SJCL ë¡œë“œ (ë„¤íŠ¸ì›Œí¬ X) =====\r",
									"const SJCL_SRC = pm.environment.get(\"sjcl_src\") || pm.globals.get(\"sjcl_src\");\r",
									"if (!SJCL_SRC) throw new Error(\"sjcl_src ë³€ìˆ˜ì— sjcl.js ì „ì²´ ì†ŒìŠ¤ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.\");\r",
									"function buildSJCL(src){\r",
									"  const factory = new Function(`\r",
									"    var window = {}; var self = window; var global = window;\r",
									"    var module = { exports: {} }; var exports = module.exports;\r",
									"    ${src}\r",
									"    return (typeof sjcl !== \"undefined\") ? sjcl\r",
									"         : (module && module.exports ? module.exports\r",
									"         : (window.sjcl || exports.sjcl));\r",
									"  `);\r",
									"  const lib = factory();\r",
									"  if (!lib || !lib.cipher || !lib.mode || !lib.codec) throw new Error(\"SJCL ë¡œë“œ ì‹¤íŒ¨\");\r",
									"  return lib;\r",
									"}\r",
									"const SJCL = buildSJCL(SJCL_SRC);\r",
									"\r",
									"// ===== CryptoJS =====\r",
									"const CryptoJS = require(\"crypto-js\");\r",
									"\r",
									"// ===== ìœ í‹¸ =====\r",
									"function randomBytes(n){\r",
									"  const wa = CryptoJS.lib.WordArray.random(n);\r",
									"  const hex = wa.toString(CryptoJS.enc.Hex);\r",
									"  const out = [];\r",
									"  for (let i=0;i<hex.length;i+=2) out.push(parseInt(hex.substr(i,2),16));\r",
									"  return out;\r",
									"}\r",
									"function bytesToBits(bytes){\r",
									"  let hex = \"\";\r",
									"  for (let i=0;i<bytes.length;i++){\r",
									"    const h = bytes[i].toString(16);\r",
									"    hex += (h.length===1 ? \"0\"+h : h);\r",
									"  }\r",
									"  return SJCL.codec.hex.toBits(hex);\r",
									"}\r",
									"\r",
									"// AES-128-GCM(iv=12, tag=16), key = sha256(loginId).hex ì•16(ASCII ëŒ€ë¬¸ì)\r",
									"function encryptOnce(keyStr, plain){\r",
									"  const ivBytes = randomBytes(12);\r",
									"  const ivBits  = bytesToBits(ivBytes);\r",
									"  const tempKeyHex   = CryptoJS.SHA256(keyStr).toString(CryptoJS.enc.Hex).toUpperCase();\r",
									"  const secretKeyStr = tempKeyHex.substring(0,16).toUpperCase();      // ASCII 16 bytes\r",
									"  const keyBits = SJCL.codec.utf8String.toBits(secretKeyStr);\r",
									"  const ptBits  = SJCL.codec.utf8String.toBits(plain);\r",
									"  const aes     = new SJCL.cipher.aes(keyBits);\r",
									"  const ctWithTag = SJCL.mode.gcm.encrypt(aes, ptBits, ivBits, [], 128);\r",
									"  const combined  = SJCL.bitArray.concat(bytesToBits(ivBytes), ctWithTag); // iv + ct + tag\r",
									"  return SJCL.codec.base64.fromBits(combined);\r",
									"}\r",
									"\r",
									"// ===== ë°”ë”” ì½ê³  ë™ì¼ IDë¡œ 3ê°œ ë¹„ë²ˆ ì•”í˜¸í™” =====\r",
									"let body;\r",
									"try { body = JSON.parse(pm.request.body.raw || \"{}\"); }\r",
									"catch { throw new Error(\"Bodyê°€ JSONì´ ì•„ë‹™ë‹ˆë‹¤.\"); }\r",
									"\r",
									"// ì„œë²„ê°€ ì½ëŠ” ID í•„ë“œ\r",
									"const keyId = String(body.loginId ?? body.id ?? body.userId ?? \"\").trim();\r",
									"if (!keyId) throw new Error(\"Bodyì— loginId/id/userId ì¤‘ í•˜ë‚˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.\");\r",
									"\r",
									"// í‰ë¬¸ ê°’ ê°€ì ¸ì˜¤ê¸°(í…œí”Œë¦¿ì´ë©´ í™˜ê²½ë³€ìˆ˜ì—ì„œ)\r",
									"function pickPlain(field, envKey){\r",
									"  const v = body[field];\r",
									"  if (typeof v === \"string\" && v.includes(\"{{\")) {\r",
									"    const ev = pm.environment.get(envKey);\r",
									"    if (!ev) throw new Error(`${envKey} í™˜ê²½ë³€ìˆ˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.`);\r",
									"    return ev;\r",
									"  }\r",
									"  if (typeof v === \"string\" && v.trim()) return v;\r",
									"  const ev = pm.environment.get(envKey);\r",
									"  if (!ev) throw new Error(`${field} ë˜ëŠ” ${envKey} ì¤‘ í•˜ë‚˜ëŠ” ê°’ì´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.`);\r",
									"  return ev;\r",
									"}\r",
									"const currPlain = pickPlain(\"currentPassword\", \"PLAIN_PW\");\r",
									"const newPlain  = pickPlain(\"newPassword\",     \"NEW_PW\");\r",
									"const confPlain = pickPlain(\"confirmPassword\", \"CONF_PW\");\r",
									"if (newPlain !== confPlain) throw new Error(\"NEW_PWì™€ CONF_PWê°€ ë‹¤ë¦…ë‹ˆë‹¤.\");\r",
									"\r",
									"// ì•”í˜¸í™”\r",
									"const encCurr = encryptOnce(keyId, currPlain);\r",
									"const encNew  = encryptOnce(keyId, newPlain);\r",
									"const encConf = encryptOnce(keyId, confPlain);\r",
									"\r",
									"// ë°”ë”” ë®ì–´ì“°ê¸°\r",
									"body.currentPassword = encCurr;\r",
									"body.newPassword     = encNew;\r",
									"body.confirmPassword = encConf;\r",
									"pm.request.body.update(JSON.stringify(body));\r",
									"\r",
									"// ì°¸ê³ ìš© ë³€ìˆ˜\r",
									"pm.variables.set(\"ENC_CURR_PW\", encCurr);\r",
									"pm.variables.set(\"ENC_NEW_PW\",  encNew);\r",
									"pm.variables.set(\"ENC_CONF_PW\", encConf);\r",
									"\r",
									"// í† í° ì‚¬ìš©ìì™€ loginId ë¶ˆì¼ì¹˜í•˜ë©´ ê²½ê³ (í™˜ê²½ì— LOGIN_ID ìˆìœ¼ë©´ ë¹„êµ)\r",
									"const envLogin = pm.environment.get(\"LOGIN_ID\");\r",
									"if (envLogin && envLogin !== keyId) {\r",
									"  console.warn(`WARNING: token user(${envLogin}) vs body loginId(${keyId}) ë¶ˆì¼ì¹˜ ê°€ëŠ¥ì„±`);\r",
									"}\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "{{access_token}}",
								"type": "text"
							},
							{
								"key": "",
								"value": "",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"loginId\": \"kjhan\",\r\n  \"currentPassword\": \"pc3002pky337!\",\r\n  \"newPassword\": \"marine6c!\",\r\n  \"confirmPassword\": \"marine6c!\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/identity/api/users/password/change",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"identity",
								"api",
								"users",
								"password",
								"change"
							]
						}
					},
					"response": []
				},
				{
					"name": "ë¡œê·¸ì•„ì›ƒ",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {\r",
									"    pm.test(\"ë¡œê·¸ì•„ì›ƒ ì„±ê³µ\", function () {\r",
									"        pm.expect(pm.response.code).to.eql(200);\r",
									"    });\r",
									"\r",
									"    console.log(\"âœ… ë¡œê·¸ì•„ì›ƒ ì„±ê³µ, í† í° ë§Œë£Œ ì²˜ë¦¬ ì‹œì‘\");\r",
									"\r",
									"    // ğŸ”‘ í™˜ê²½ë³€ìˆ˜ì—ì„œ í† í° ì‚­ì œ\r",
									"    pm.environment.unset(\"access_token\");\r",
									"    console.log(\"ğŸ—‘ï¸ accessToken ì‚­ì œ ì™„ë£Œ\");\r",
									"\r",
									"\r",
									"} else {\r",
									"    pm.test(\"ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨\", function () {\r",
									"        pm.expect(pm.response.code).to.eql(200);\r",
									"    });\r",
									"    console.log(\"âŒ ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨ - ì‘ë‹µì½”ë“œ:\", pm.response.code);\r",
									"}\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try {\r",
									"      rows = JSON.parse(pm.collectionVariables.get('__log') || '[]');\r",
									"    } catch (e) {\r",
									"      console.error(TAG, 'parse __log error:', e);\r",
									"      rows = [];\r",
									"    }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"      last:  row\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"  \r",
									"})();\r",
									"// í† í° ì‚­ì œ í™•ì¸ìš©\r",
									"console.log(\"ğŸ“Œ ë¡œê·¸ì•„ì›ƒ ìš”ì²­ í—¤ë”:\", pm.request.headers.toObject());\r",
									"console.log(\"ğŸ“Œ accessToken:\", pm.environment.get(\"access_token\"));\r",
									"console.log(\"ğŸ“Œ ë¡œê·¸ì•„ì›ƒ ì‘ë‹µ Body:\", pm.response.text());\r",
									"\r",
									"\r",
									"// === [AGG DEBUG] ëª¨ë“  ìš”ì²­ ë’¤ì— ì‹¤í–‰ë˜ì–´ ë¡œê·¸/ì¹´ìš´íŠ¸ ëˆ„ì  ===\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "DELETE",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "{{access_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://127.0.0.1/identity/api/access/logout",
							"protocol": "http",
							"host": [
								"127",
								"0",
								"0",
								"1"
							],
							"path": [
								"identity",
								"api",
								"access",
								"logout"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "master_User",
			"item": [
				{
					"name": "List",
					"item": [
						{
							"name": "master ê³„ì • ë¡œê·¸ì¸",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// ===== 0) SJCL ì†ŒìŠ¤ ë¡œë“œ (ë„¤íŠ¸ì›Œí¬ X) =====\r",
											"const SJCL_SRC = pm.environment.get(\"sjcl_src\") || pm.globals.get(\"sjcl_src\");\r",
											"if (!SJCL_SRC) throw new Error(\"sjcl_src ë³€ìˆ˜ì— sjcl.js ì „ì²´ ì†ŒìŠ¤ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.\");\r",
											"\r",
											"// ë…ë¦½ ìŠ¤ì½”í”„ì—ì„œ SJCL ê°ì²´ íšŒìˆ˜ (eval ìŠ¤ì½”í”„ ë¬¸ì œ ë°©ì§€)\r",
											"function buildSJCL(src) {\r",
											"  const factory = new Function(`\r",
											"    var window = {}; var self = window; var global = window;\r",
											"    var module = { exports: {} }; var exports = module.exports;\r",
											"    ${src}\r",
											"    return (typeof sjcl !== \"undefined\") ? sjcl\r",
											"         : (module && module.exports ? module.exports\r",
											"         : (window.sjcl || exports.sjcl));\r",
											"  `);\r",
											"  const lib = factory();\r",
											"  if (!lib || !lib.cipher || !lib.mode || !lib.codec) throw new Error(\"SJCL ë¡œë“œ ì‹¤íŒ¨\");\r",
											"  return lib;\r",
											"}\r",
											"const SJCL = buildSJCL(SJCL_SRC);\r",
											"\r",
											"// ===== 1) CryptoJS (Postman ë‚´ì¥) =====\r",
											"const CryptoJS = require(\"crypto-js\");\r",
											"\r",
											"// ===== 2) ìœ í‹¸ =====\r",
											"function randomBytes(n){\r",
											"  const wa = CryptoJS.lib.WordArray.random(n);\r",
											"  const hex = wa.toString(CryptoJS.enc.Hex);\r",
											"  const out = [];\r",
											"  for (let i=0;i<hex.length;i+=2) out.push(parseInt(hex.substr(i,2),16));\r",
											"  return out;\r",
											"}\r",
											"function bytesToBits(bytes){\r",
											"  let hex = \"\";\r",
											"  for (let i=0;i<bytes.length;i++){\r",
											"    const h = bytes[i].toString(16);\r",
											"    hex += (h.length===1 ? \"0\"+h : h);\r",
											"  }\r",
											"  return SJCL.codec.hex.toBits(hex);\r",
											"}\r",
											"\r",
											"// AES-128-GCM (iv 12B, tag 16B), í‚¤: sha256(key).hex -> ì•16(ASCII, UPPER)\r",
											"function encryptOnce(keyStr, plain){\r",
											"  const ivBytes = randomBytes(12);                        // IV_LENGTH = 12\r",
											"  const ivBits  = bytesToBits(ivBytes);\r",
											"\r",
											"  const tempKeyHex   = CryptoJS.SHA256(keyStr).toString(CryptoJS.enc.Hex).toUpperCase();\r",
											"  const secretKeyStr = tempKeyHex.substring(0,16).toUpperCase();    // ASCII 16 bytes\r",
											"  const keyBits = SJCL.codec.utf8String.toBits(secretKeyStr);\r",
											"\r",
											"  const ptBits = SJCL.codec.utf8String.toBits(plain);\r",
											"  const aes    = new SJCL.cipher.aes(keyBits);\r",
											"\r",
											"  const ctWithTag = SJCL.mode.gcm.encrypt(aes, ptBits, ivBits, [], 128); // tag 128-bit\r",
											"  const combined  = SJCL.bitArray.concat(bytesToBits(ivBytes), ctWithTag);// iv + ct + tag\r",
											"  return SJCL.codec.base64.fromBits(combined);                            // standard Base64\r",
											"}\r",
											"\r",
											"// ===== 3) ë©”ì¸: ë°”ë””ì—ì„œ ID/íŒ¨ìŠ¤ì›Œë“œ ì½ì–´ ë™ì¼ IDë¡œ ì•”í˜¸í™” =====\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"\r",
											"let body;\r",
											"try {\r",
											"  body = JSON.parse(pm.request.body.raw || \"{}\");\r",
											"} catch (e) {\r",
											"  throw new Error(\"Bodyê°€ JSONì´ ì•„ë‹™ë‹ˆë‹¤.\");\r",
											"}\r",
											"\r",
											"// ì„œë²„ê°€ ì½ëŠ” ID í•„ë“œëª…ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš© (loginId / id / userId ì¤‘ í•˜ë‚˜)\r",
											"const keyId = String(body.loginId ?? body.id ?? body.userId ?? \"\").trim();\r",
											"if (!keyId) throw new Error(\"Bodyì— loginId/id/userId ì¤‘ í•˜ë‚˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.\");\r",
											"\r",
											"let plainPw;\r",
											"if (typeof body.password === \"string\" && body.password.trim() && !body.password.includes(\"{{\")) {\r",
											"  // ë°”ë””ì— í‰ë¬¸ì´ ìˆìœ¼ë©´ ê·¸ê±¸ ì‚¬ìš©\r",
											"  plainPw = body.password;\r",
											"} else {\r",
											"  // ì—†ìœ¼ë©´ í™˜ê²½ë³€ìˆ˜ì—ì„œ í‰ë¬¸ì„ ê°€ì ¸ì™€ ì‚¬ìš© (ì„ íƒ)\r",
											"  plainPw = pm.environment.get(\"PLAIN_MAS_PW\");\r",
											"  if (!plainPw) throw new Error(\"password í‰ë¬¸ì´ í•„ìš”í•©ë‹ˆë‹¤ (Body.password ë˜ëŠ” í™˜ê²½ë³€ìˆ˜ PLAIN_MAS_PW).\");\r",
											"}\r",
											"\r",
											"const encPw = encryptOnce(keyId, plainPw);\r",
											"\r",
											"// ë°”ë””ì— ì•”í˜¸ë¬¸ ë°˜ì˜\r",
											"body.password = encPw;\r",
											"pm.request.body.update(JSON.stringify(body));\r",
											"\r",
											"// í•„ìš” ì‹œ ë³€ìˆ˜ë¡œë„ ë…¸ì¶œ (ë‹¤ë¥¸ ìš”ì²­ì—ì„œ ì¬ì‚¬ìš©)\r",
											"pm.variables.set(\"ENC_PW\", encPw);\r",
											"\r",
											"// ë””ë²„ê·¸ ë¡œê·¸\r",
											"console.log(\"Enc with ID =\", keyId, \", Base64 length =\", encPw.length);\r",
											"\r",
											"\r",
											"\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// ë¡œê·¸ì¸ ì‘ë‹µ ì½”ë“œ ê²€ì‚¬\r",
											"if (pm.response.code === 200) {\r",
											"  pm.test(\"ë¡œê·¸ì¸ ì„±ê³µ\", function () {\r",
											"    pm.expect(pm.response.code).to.eql(200);\r",
											"  });\r",
											"\r",
											"  // ì‘ë‹µ JSON íŒŒì‹±\r",
											"  let jsonData; try { jsonData = pm.response.json(); } catch (e) { jsonData = null; }\r",
											"\r",
											"  if (jsonData && jsonData.result && jsonData.result.accessToken && jsonData.result.accessToken.token) {\r",
											"    const token = jsonData.result.accessToken.token;\r",
											"\r",
											"    // ğŸ‘‰ í™˜ê²½ë³€ìˆ˜ ì €ì¥\r",
											"    pm.environment.set(\"access_token\", token);\r",
											"    console.log(\"ğŸ”‘ í† í° ì €ì¥ë¨:\", token);\r",
											"  } else {\r",
											"    console.log(\"âš ï¸ ì‘ë‹µì—ì„œ í† í°ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\");\r",
											"  }\r",
											"\r",
											"} else {\r",
											"  // ì‹¤íŒ¨ ë©”ì‹œì§€ ì¶œë ¥\r",
											"  pm.test(\"ë¡œê·¸ì¸ ì‹¤íŒ¨ - ì‘ë‹µì½”ë“œ: \" + pm.response.code, function () {\r",
											"    pm.expect(pm.response.code).to.eql(200);\r",
											"  });\r",
											"}\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\r\n  \"loginId\": \"master\",\r\n  \"password\": \"{{PLAIN_MAS_PW}}\",\r\n  \"isRestrictNewToken\": true\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/identity/api/access/login",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"identity",
										"api",
										"access",
										"login"
									]
								}
							},
							"response": []
						},
						{
							"name": "ë²„ì „ ì •ë³´ í™•ì¸",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									},
									{
										"key": "",
										"value": "",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/system/information",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"system",
										"information"
									]
								}
							},
							"response": []
						},
						{
							"name": "ì‚¬ìš©ì ë§¤ë‰´ì–¼ ë‹¤ìš´ë¡œë“œ",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// ===== ê³µí†µ í—¤ë” & í† í° =====\r",
											"pm.request.headers.upsert({ key: \"Accept\", value: \"application/zip, application/octet-stream\" });\r",
											"\r",
											"const token =\r",
											"  pm.environment.get(\"access_token\") ||\r",
											"  pm.environment.get(\"ACCESS_TOKEN\") ||\r",
											"  pm.collectionVariables.get(\"access_token\");\r",
											"\r",
											"if (token) {\r",
											"  pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
											"}\r",
											"\r",
											"// ===== ìºì‹œ ë°©ì§€ íŒŒë¼ë¯¸í„° =====\r",
											"const ts = Date.now();\r",
											"const u0 = pm.request.url.toString();\r",
											"pm.request.url = u0.includes(\"?\") ? `${u0}&_t=${ts}` : `${u0}?_t=${ts}`;\r",
											"\r",
											"// (ì˜µì…˜) ê¸°ëŒ€ íŒŒì¼ëª… ì˜¤ë²„ë¼ì´ë“œ ê°€ëŠ¥\r",
											"pm.environment.set(\"EXPECTED_ZIP_NAME\",\r",
											"  pm.environment.get(\"EXPECTED_ZIP_NAME\") || \"Neurophet_AQUA_AD_3.0_Product_Guide_Documentation.zip\");\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// ìƒíƒœ/í—¤ë” ê²€ì‚¬\r",
											"pm.test(\"HTTP 2xx\", () => pm.expect(pm.response.code).to.be.within(200, 299));\r",
											"\r",
											"const ct = pm.response.headers.get(\"Content-Type\") || \"\";\r",
											"pm.test(\"Content-Typeì€ zip/ë°”ì´ë„ˆë¦¬\", () => {\r",
											"  pm.expect(ct.toLowerCase()).to.match(/(application\\/zip|application\\/octet-stream)/);\r",
											"});\r",
											"\r",
											"const cd = pm.response.headers.get(\"Content-Disposition\") || \"\";\r",
											"const m = /filename\\*?=(?:UTF-8'')?\"?([^\\\";]+)\"?/i.exec(cd);\r",
											"const filename = m ? decodeURIComponent(m[1]) : pm.environment.get(\"EXPECTED_ZIP_NAME\");\r",
											"pm.environment.set(\"DOWNLOADED_FILENAME\", filename);\r",
											"\r",
											"pm.test(\"íŒŒì¼ëª… í™•ì¸(ê°€ëŠ¥í•œ ê²½ìš°)\", () => {\r",
											"  pm.expect(filename).to.be.a(\"string\").and.not.empty;\r",
											"});\r",
											"\r",
											"// í¬ê¸°/ë¬´ê²°ì„± íŒíŠ¸\r",
											"const len = Number(pm.response.headers.get(\"Content-Length\") || 0);\r",
											"pm.test(\"ì‘ë‹µ ë°”ì´íŠ¸ > 0\", () => pm.expect(len).to.be.greaterThan(0));\r",
											"\r",
											"// ZIP ì‹œê·¸ë‹ˆì²˜ í™•ì¸ (TextViewê°€ 'PK...' ë¡œ ì‹œì‘í•˜ëŠ”ì§€ ê°€ë³ê²Œ ì²´í¬)\r",
											"try {\r",
											"  const head = pm.response.text().slice(0, 2); // ë°”ì´ë„ˆë¦¬ë¼ë„ ì• 2ë°”ì´íŠ¸ëŠ” 'PK'ì¼ ê²ƒ\r",
											"  pm.test(\"ZIP ë§¤ì§ í—¤ë” PK\", () => pm.expect(head).to.equal(\"PK\"));\r",
											"} catch (e) {\r",
											"  // ë°”ì´ë„ˆë¦¬ ë Œë”ë§ ë¬¸ì œ ì‹œ í—¤ë”/ê¸¸ì´ë¡œ ëŒ€ì²´ íŒì •\r",
											"  console.warn(\"í—¤ë” ìŠ¤ë‹ˆí•‘ ì‹¤íŒ¨, í—¤ë”/ê¸¸ì´ë¡œ ëŒ€ì²´ í™•ì¸\");\r",
											"}\r",
											"\r",
											"// ìºì‹œ ê´€ë ¨ ì •ë³´ ì €ì¥(ìˆìœ¼ë©´)\r",
											"[\"ETag\",\"Last-Modified\"].forEach(h => {\r",
											"  const v = pm.response.headers.get(h);\r",
											"  if (v) pm.environment.set(`ZIP_${h.replace(\"-\",\"_\")}`, v);\r",
											"});\r",
											"\r",
											"// ì½˜ì†” ìš”ì•½\r",
											"console.info(\"[ZIP Download]\", {\r",
											"  contentType: ct,\r",
											"  contentDisposition: cd,\r",
											"  filename,\r",
											"  contentLength: len\r",
											"});\r",
											"\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{baseUrl}}/app/common/license/Neurophet_AQUA_AD_3.0_Product_Guide_Documentation.zip",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"common",
										"license",
										"Neurophet_AQUA_AD_3.0_Product_Guide_Documentation.zip"
									]
								}
							},
							"response": []
						},
						{
							"name": "ìœ ì € search",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// Pre-request Script\r",
											"const basePayload = { requestPageNumber: 1, itemCountPerPage: 10, order: \"DESC\", sortBy: \"createdAt\" };\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(basePayload));\r",
											"\r",
											"\r",
											"// === Random keyword injector (Pre-request Script) ===\r",
											"\r",
											"// 1) í˜„ì¬ ë°”ë”” ì½ê¸°\r",
											"let body = {};\r",
											"try { body = JSON.parse(pm.request.body.raw || \"{}\"); } catch { body = {}; }\r",
											"\r",
											"// 2) ìƒì„± ëª¨ë“œ/ê¸¸ì´ ì„¤ì • (í™˜ê²½ë³€ìˆ˜ë¡œ ì¡°ì ˆ ê°€ëŠ¥)\r",
											"const MODE = String(pm.environment.get(\"KEYWORD_MODE\") || \"guid\").toLowerCase(); // guid|digits|alnum|pool\r",
											"const LEN  = Math.max(1, parseInt(pm.environment.get(\"KEYWORD_LEN\") || \"32\", 10)); // ê¸¸ì´ ì œí•œ\r",
											"\r",
											"// 3) ìœ í‹¸\r",
											"function randDigits(n){ let s=\"\"; for(let i=0;i<n;i++) s += Math.floor(Math.random()*10); return s; }\r",
											"function randAlnum(n){\r",
											"  const chars=\"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\";\r",
											"  let s=\"\"; for(let i=0;i<n;i++) s += chars.charAt(Math.floor(Math.random()*chars.length));\r",
											"  return s;\r",
											"}\r",
											"function getPool(){\r",
											"  const raw = (pm.environment.get(\"KEYWORD_POOL\") || \"\").trim();\r",
											"  if (!raw) return [];\r",
											"  if (raw.startsWith(\"[\")) { try { const arr = JSON.parse(raw); return Array.isArray(arr)?arr:[]; } catch { return []; } }\r",
											"  return raw.split(\",\").map(s=>s.trim()).filter(Boolean);\r",
											"}\r",
											"\r",
											"// 4) í‚¤ì›Œë“œ ìƒì„±\r",
											"let keyword;\r",
											"switch (MODE) {\r",
											"  case \"digits\":\r",
											"    keyword = randDigits(LEN);\r",
											"    break;\r",
											"  case \"alnum\":\r",
											"    keyword = randAlnum(LEN);\r",
											"    break;\r",
											"  case \"pool\": {\r",
											"    const pool = getPool();\r",
											"    keyword = pool.length ? pool[Math.floor(Math.random()*pool.length)] : `kw-${pm.variables.replaceIn(\"{{$guid}}\")}`;\r",
											"    break;\r",
											"  }\r",
											"  case \"guid\":\r",
											"  default: {\r",
											"    const g = pm.variables.replaceIn(\"{{$guid}}\").replace(/-/g, \"\");\r",
											"    keyword = `kw-${g.slice(-LEN)}`; // ê¸¸ì´ ì œí•œ ë§ì¶° ìŠ¬ë¼ì´ìŠ¤\r",
											"    break;\r",
											"  }\r",
											"}\r",
											"\r",
											"// 5) ê¸°ë³¸ í˜ì´ì§•/ì •ë ¬ ê°’ ë³´ì • + keyword ì£¼ì…\r",
											"body.requestPageNumber = body.requestPageNumber ?? 1;\r",
											"body.itemCountPerPage  = body.itemCountPerPage  ?? 10;\r",
											"body.order             = body.order             ?? \"DESC\";\r",
											"body.sortBy            = body.sortBy            ?? \"createdAt\";\r",
											"body.keyword           = keyword;\r",
											"\r",
											"// 6) ìš”ì²­ ì—…ë°ì´íŠ¸\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(body));\r",
											"\r",
											"// 7) ë””ë²„ê·¸ & ì¬ì‚¬ìš©\r",
											"console.log(\"[pre] search keyword:\", keyword);\r",
											"pm.variables.set(\"LAST_KEYWORD\", keyword);\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === Parse JSON ===\r",
											"let j = null;\r",
											"pm.test(\"ì‘ë‹µì´ JSONì´ì–´ì•¼ í•¨\", () => {\r",
											"  j = pm.response.json();\r",
											"  pm.expect(j).to.be.an(\"object\");\r",
											"});\r",
											"\r",
											"// === ìš”ì²­ì— ì‹¤ë¦° keyword íšŒìˆ˜ (ìš°ì„ ìˆœìœ„: ìš”ì²­ ë°”ë”” â†’ LAST_KEYWORD ë³€ìˆ˜) ===\r",
											"let usedKeyword = \"\";\r",
											"try {\r",
											"  const sent = JSON.parse(pm.request.body.raw || \"{}\");\r",
											"  usedKeyword = (sent && typeof sent.keyword !== \"undefined\") ? String(sent.keyword) : \"\";\r",
											"} catch (_) {}\r",
											"if (!usedKeyword) usedKeyword = pm.variables.get(\"LAST_KEYWORD\") || \"\";\r",
											"\r",
											"// === HTTP ìƒíƒœì½”ë“œ í™•ì¸(ê²€ìƒ‰ì´ë¼ ë³´í†µ 200, ìƒí™©ì— ë”°ë¼ 201 í—ˆìš©) ===\r",
											"pm.test(\"HTTP 200 ë˜ëŠ” 201\", () => {\r",
											"  pm.expect(pm.response.code).to.be.oneOf([200, 201]);\r",
											"});\r",
											"\r",
											"// === (ì„ íƒ) ì„œë¹„ìŠ¤ codeê°€ ìˆë‹¤ë©´ 200 í™•ì¸ ===\r",
											"if (j && typeof j.code !== \"undefined\") {\r",
											"  pm.test(\"ì„œë¹„ìŠ¤ code === 200\", () => pm.expect(j.code).to.eql(200));\r",
											"}\r",
											"\r",
											"// === ê²°ê³¼ ê°œìˆ˜ íŒŒì•…(ìŠ¤í‚¤ë§ˆ ë‹¤ì–‘ì„± ëŒ€ì‘) ===\r",
											"const items =\r",
											"  j?.result?.items ??\r",
											"  j?.result?.content ??\r",
											"  j?.result?.list ??\r",
											"  j?.data?.items ??\r",
											"  j?.items ?? [];\r",
											"const total = Array.isArray(items) ? items.length : 0;\r",
											"\r",
											"// === ì½˜ì†” ë¡œê·¸: ì–´ë–¤ keywordë¡œ ê²€ìƒ‰í–ˆê³  OKì¸ì§€ ì¶œë ¥ ===\r",
											"console.log(`ğŸ” keyword: \"${usedKeyword}\" | âœ… HTTP ${pm.response.code} OK | items=${total} | time=${pm.response.responseTime}ms`);\r",
											"\r",
											"\r",
											"\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											"\r",
											"\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/identity/api/users/search",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"identity",
										"api",
										"users",
										"search"
									]
								}
							},
							"response": []
						},
						{
							"name": "ìœ ì € sorting",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === Pre-request: ë©”ì¸ ìš”ì²­ì„ {order:\"DESC\", sortBy:\"isActivated\"}ë¡œ ê³ ì • ===\r",
											"pm.request.method = \"POST\";\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"var token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: \"Bearer \" + token });\r",
											"\r",
											"// UIì™€ ë™ì¼í•œ ê¸°ë³¸ í˜ì´ë¡œë“œ ë³‘í•© (ì˜µì…˜: BASE_BODY_JSON)\r",
											"var baseBody = { requestPageNumber: 1, itemCountPerPage: 10 };\r",
											"try {\r",
											"  var extra = pm.environment.get(\"BASE_BODY_JSON\");\r",
											"  if (extra) baseBody = Object.assign(baseBody, JSON.parse(extra));\r",
											"} catch (e) {}\r",
											"\r",
											"// ì²« ì¼€ì´ìŠ¤(ë©”ì¸ ìš”ì²­ì— ì‹¤ì–´ ë³´ëƒ„)\r",
											"var mainBody = Object.assign({}, baseBody, { order: \"DESC\", sortBy: \"isActivated\" });\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(mainBody));\r",
											"console.log(\"[MAIN REQ] body =\", mainBody);\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === Tests: ë©”ì¸ì€ isActivated DESC í™•ì¸ â†’ ì´í›„ 9ê°œ ìˆœì°¨ í˜¸ì¶œ.\r",
											"// ìœ íš¨ ì¼€ì´ìŠ¤: HTTP 200 ê¸°ëŒ€ / ë¬´íš¨ ì¼€ì´ìŠ¤: HTTP ë¹„-200 ê¸°ëŒ€ ===\r",
											"(function () {\r",
											"  // 0) ë©”ì¸ ì‘ë‹µë„ ì²´í¬ (íƒ­ ìƒë‹¨)\r",
											"  pm.test(\"[MAIN] HTTP 200\", function(){ pm.response.to.have.status(200); });\r",
											"  try {\r",
											"    var mainJson = pm.response.json();\r",
											"    if (mainJson && typeof mainJson.code !== \"undefined\") {\r",
											"      pm.test(\"[MAIN] Business code 200\", function(){ pm.expect(mainJson.code).to.eql(200); });\r",
											"    }\r",
											"  } catch (e) {}\r",
											"\r",
											"  // 1) ë‚˜ë¨¸ì§€ 9ê°œ ì¼€ì´ìŠ¤(ìˆœì„œ ê·¸ëŒ€ë¡œ)\r",
											"  var CASES_REST = [\r",
											"    { order: \"ASC\",  sortBy: \"isActivated\" },\r",
											"    { order: \"DESC\", sortBy: \"loginId\" },\r",
											"    { order: \"ASC\",  sortBy: \"loginId\" },\r",
											"    { order: \"DESC\", sortBy: \"name\" },\r",
											"    { order: \"ASC\",  sortBy: \"name\" },\r",
											"    { order: \"DESC\", sortBy: \"permissionProfiles\" },\r",
											"    { order: \"ASC\",  sortBy: \"permissionProfiles\" },\r",
											"    { order: \"DESC\", sortBy: \"lastLoginAt\" },\r",
											"    { order: \"ASC\",  sortBy: \"lastLoginAt\" }\r",
											"  ];\r",
											"\r",
											"  // ğŸ”§ ì—¬ê¸°ì— ì„ì˜ ì˜¤íƒ€/ì‹¤í—˜ ì¼€ì´ìŠ¤ë¥¼ ë¼ì›Œ ë„£ì–´ë„ ë¨ (ì˜ˆ: { order:\"ASC\", sortBy:\"na\" })\r",
											"  // CASES_REST.splice(0, 0, { order: \"ASC\", sortBy: \"na\" });\r",
											"\r",
											"  // 2) í—ˆìš© ì§‘í•©(ìœ íš¨ì„± ê¸°ì¤€)\r",
											"  var ALLOWED_FIELDS = [\"isActivated\",\"loginId\",\"name\",\"permissionProfiles\",\"lastLoginAt\"];\r",
											"  var ALLOWED_ORDERS = [\"ASC\",\"DESC\"];\r",
											"\r",
											"  // 3) ê³µí†µ ì„¤ì •\r",
											"  var baseUrl = String(pm.environment.get(\"baseUrl\") || pm.variables.get(\"baseUrl\") || \"\").replace(/\\/+$/,\"\");\r",
											"  pm.test(\"baseUrl configured\", function(){ pm.expect(baseUrl, \"í™˜ê²½ë³€ìˆ˜ baseUrl í•„ìš”\").to.not.be.empty; });\r",
											"  var url = baseUrl + \"/identity/api/users/search\";\r",
											"\r",
											"  var token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\") || \"\";\r",
											"  var headers = [{ key: \"Content-Type\", value: \"application/json\" }];\r",
											"  if (token) headers.push({ key: \"Authorization\", value: \"Bearer \" + token });\r",
											"\r",
											"  var DELAY_MS = Number(pm.environment.get(\"INTER_CALL_DELAY_MS\") || 200); // ì¼€ì´ìŠ¤ ê°„ ê°„ê²©\r",
											"  var STOP_ON_FAIL = String(pm.environment.get(\"STOP_ON_FAIL\") || \"false\").toLowerCase() === \"true\";\r",
											"\r",
											"  // UIê°€ ê¸°ë³¸ìœ¼ë¡œ ë³´ë‚´ëŠ” í˜ì´ë¡œë“œê°€ ìˆìœ¼ë©´ ë™ì¼ ë³‘í•©\r",
											"  var baseBody = { requestPageNumber: 1, itemCountPerPage: 50 };\r",
											"  try {\r",
											"    var extra = pm.environment.get(\"BASE_BODY_JSON\");\r",
											"    if (extra) baseBody = Object.assign(baseBody, JSON.parse(extra));\r",
											"  } catch (e) {}\r",
											"\r",
											"  // 4) ìˆœì°¨ í˜¸ì¶œ\r",
											"  var results = [];\r",
											"  var halted = false;\r",
											"\r",
											"  function runCase(i){\r",
											"    if (halted || i >= CASES_REST.length) return finish();\r",
											"\r",
											"    var c = CASES_REST[i];\r",
											"    var ord = String(c.order || \"\").toUpperCase();\r",
											"    var sortBy = String(c.sortBy || \"\");\r",
											"    var isValid = (ALLOWED_ORDERS.indexOf(ord) !== -1) && (ALLOWED_FIELDS.indexOf(sortBy) !== -1);\r",
											"\r",
											"    var body = Object.assign({}, baseBody, { order: ord, sortBy: sortBy });\r",
											"\r",
											"    pm.sendRequest({\r",
											"      url: url,\r",
											"      method: \"POST\",\r",
											"      header: headers,\r",
											"      body: { mode: \"raw\", raw: JSON.stringify(body) }\r",
											"    }, function (err, res) {\r",
											"      if (err) {\r",
											"        results.push({ i:i+2, sortBy:sortBy, order:ord, http:0, pass:false, expected: isValid ? \"200\" : \"non-200\", reason:\"request-error\" });\r",
											"        pm.test(\"[\"+ (i+2) +\"] request error (\"+sortBy+\" \"+ord+\")\", function(){ throw new Error(String(err)); });\r",
											"        if (STOP_ON_FAIL) { halted = true; return finish(); }\r",
											"        return setTimeout(function(){ runCase(i+1); }, DELAY_MS);\r",
											"      }\r",
											"\r",
											"      var httpCode = res.code;\r",
											"      var httpOk = (httpCode === 200);\r",
											"\r",
											"      if (isValid) {\r",
											"        // âœ… ìœ íš¨ ì¼€ì´ìŠ¤: 200 ì´ì–´ì•¼ í•¨\r",
											"        pm.test(\"[\"+ (i+2) +\"/10] HTTP 200 (VALID \"+sortBy+\" \"+ord+\")\", function(){\r",
											"          pm.expect(httpOk, \"ìœ íš¨ ì¼€ì´ìŠ¤ì¸ë° 200ì´ ì•„ë‹˜\").to.eql(true);\r",
											"        });\r",
											"        results.push({ i:i+2, sortBy:sortBy, order:ord, http:httpCode, pass:httpOk, expected:\"200\" });\r",
											"      } else {\r",
											"        // âŒ ë¬´íš¨ ì¼€ì´ìŠ¤: 200ì´ë©´ FAIL (ë¹„-200 ê¸°ëŒ€)\r",
											"        pm.test(\"[\"+ (i+2) +\"] HTTP non-200 expected (INVALID \"+sortBy+\" \"+ord+\")\", function(){\r",
											"          pm.expect(httpOk, \"ë¬´íš¨ ì¼€ì´ìŠ¤ë¥¼ 200ìœ¼ë¡œ í—ˆìš©í•¨\").to.eql(false);\r",
											"        });\r",
											"        results.push({ i:i+2, sortBy:sortBy, order:ord, http:httpCode, pass:!httpOk, expected:\"non-200\" });\r",
											"      }\r",
											"\r",
											"      console.log(\"[CASE \"+(i+2)+\"] \"+(isValid?\"VALID \":\"INVALID \")+sortBy+\" \"+ord+\" -> http=\"+httpCode+\", pass=\"+results[results.length-1].pass);\r",
											"\r",
											"      if (STOP_ON_FAIL && !results[results.length-1].pass) { halted = true; return finish(); }\r",
											"      setTimeout(function(){ runCase(i+1); }, DELAY_MS);\r",
											"    });\r",
											"  }\r",
											"\r",
											"  function finish(){\r",
											"    // +1ì€ ë©”ì¸ ì¼€ì´ìŠ¤ í¬í•¨ ìˆ˜(ì´ 10ê±´)\r",
											"    var total = results.length + 1;\r",
											"    var failed = results.filter(function(r){ return !r.pass; }).length;\r",
											"\r",
											"    console.log(\"[SUMMARY] total=\"+total+\" (main + \"+results.length+\" rest), failed=\"+failed);\r",
											"    for (var k=0;k<results.length;k++){\r",
											"      var r = results[k];\r",
											"      console.log(\"[SUMMARY] [\"+r.i+\"/10] \"+r.sortBy+\" \"+r.order+\" -> http=\"+(r.http||\"-\")+\", expected=\"+r.expected+\", pass=\"+r.pass+(r.reason?(\" reason=\"+r.reason):\"\"));\r",
											"    }\r",
											"\r",
											"    pm.environment.set(\"SORT_SINGLE_SUMMARY\", JSON.stringify({ total: total, failed: failed, results: results }));\r",
											"    pm.test(\"Executed all 10 (main+rest)\", function(){ pm.expect(total).to.eql(10); });\r",
											"    pm.test(\"All cases met expected behavior\", function(){ pm.expect(failed).to.eql(0); });\r",
											"  }\r",
											"\r",
											"  // ì‹œì‘(ë©”ì¸ì€ ì´ë¯¸ ì „ì†¡ë¨)\r",
											"  runCase(0);\r",
											"})();\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/identity/api/users/search",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"identity",
										"api",
										"users",
										"search"
									]
								}
							},
							"response": []
						}
					]
				},
				{
					"name": "Create",
					"item": [
						{
							"name": "ìœ ì € ìƒì„± ì„±ê³µ_permission: Advanced user/ status: Active",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// ---- 1) ëœë¤ suffix ìƒì„± (íƒ€ì„ìŠ¤íƒ¬í”„ ë’¤ 6ìë¦¬ ì‚¬ìš©) ----\r",
											"const ts = String(pm.variables.replaceIn(\"{{$timestamp}}\") || Date.now());\r",
											"const suffix = ts.slice(-6);\r",
											"const genId  = `neurophet${suffix}`;\r",
											"\r",
											"// ---- 2) í™˜ê²½ë³€ìˆ˜ì—ì„œ PW ì½ê¸° (ì—†ìœ¼ë©´ ë¹ˆë¬¸ìì—´) ----\r",
											"const newPw  = pm.environment.get(\"NEW_PW\")  || \"\";\r",
											"const confPw = pm.environment.get(\"CONF_PW\") || \"\";\r",
											"\r",
											"// ---- 3) ê¸°ì¡´ ë°”ë””ë¥¼ ì“°ì§€ ë§ê³ , ìŠ¤í™ì— ë§ê²Œ ìƒˆë¡œ êµ¬ì„± ----\r",
											"const body = {\r",
											"  loginId: genId,\r",
											"  name: genId,\r",
											"  description: \"\",\r",
											"  department: \"\",\r",
											"  permissionProfileIdList: [2],\r",
											"  isActivated: true,\r",
											"  password: newPw,\r",
											"  confirmPassword: confPw,\r",
											"  email: \"\"\r",
											"};\r",
											"\r",
											"// ---- 4) ìš”ì²­ì— ë°˜ì˜ ----\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(body));\r",
											"\r",
											"// ---- 5) ë‚˜ì¤‘ì— ì¬ì‚¬ìš©/ë¡œê·¸ìš© ë³€ìˆ˜ ----\r",
											"pm.variables.set(\"GENERATED_LOGIN_ID\", genId);\r",
											"pm.variables.set(\"SUFFIX\", suffix);\r",
											"console.log(\"[pre] create-user body:\", body);\r",
											"\r",
											"\r",
											"\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === Parse JSON ===\r",
											"let j = null;\r",
											"pm.test(\"ì‘ë‹µì´ JSONì´ì–´ì•¼ í•¨\", () => { j = pm.response.json(); pm.expect(j).to.be.an(\"object\"); });\r",
											"\r",
											"// === HTTP 200/201 í™•ì¸ ===\r",
											"pm.test(\"HTTP 200 ë˜ëŠ” 201 ì´ì–´ì•¼ í•¨\", () => {\r",
											"  pm.expect(pm.response.code).to.be.oneOf([200, 201]);\r",
											"});\r",
											"\r",
											"// === (ì„ íƒ) ì„œë¹„ìŠ¤ ì½”ë“œê°€ ìˆë‹¤ë©´ 200 í™•ì¸ ===\r",
											"if (j && typeof j.code !== \"undefined\") {\r",
											"  pm.test(\"ì„œë¹„ìŠ¤ code === 200\", () => pm.expect(j.code).to.eql(200));\r",
											"}\r",
											"\r",
											"// === ìƒì„±ëœ ê³„ì • ì‹ë³„ ì •ë³´ ì¶”ì¶œ ===\r",
											"// pre-requestì—ì„œ ë§Œë“  ê°’(ìš°ë¦¬ê°€ ë³´ë‚¸ loginId)ë„ ê°€ì ¸ì™€ ë¹„êµ/ë¡œê·¸ ìš©ìœ¼ë¡œ ì‚¬ìš©\r",
											"const sentLoginId = pm.variables.get(\"GENERATED_LOGIN_ID\") || \"\";\r",
											"\r",
											"// ì•ˆì „í•˜ê²Œ ê²½ë¡œ íƒìƒ‰í•˜ëŠ” í—¬í¼\r",
											"const pick = (obj, paths) => {\r",
											"  for (const p of paths) {\r",
											"    try {\r",
											"      const val = p.split(\".\").reduce((o, k) => (o && o[k] !== undefined ? o[k] : undefined), obj);\r",
											"      if (val !== undefined && val !== null) return val;\r",
											"    } catch (_) {}\r",
											"  }\r",
											"  return undefined;\r",
											"};\r",
											"\r",
											"// ì‘ë‹µ í¬ë§·ì´ ì–´ë–¤ ê²ƒì´ë“  ì»¤ë²„(ì¼ë°˜ì ìœ¼ë¡œ result.* ë˜ëŠ” data.*ë¡œ ë‚´ë ¤ì˜¤ëŠ” ê²½ìš° í¬í•¨)\r",
											"const loginId = pick(j, [\"result.loginId\", \"data.loginId\", \"loginId\"]) || sentLoginId;\r",
											"const userId  = pick(j, [\"result.id\", \"data.id\", \"id\", \"userId\"]);\r",
											"\r",
											"// === ê¸°ë³¸ ê²€ì¦ ===\r",
											"pm.test(\"ìƒì„±ëœ loginId í™•ì¸\", () => pm.expect(loginId).to.be.a(\"string\").and.not.empty);\r",
											"\r",
											"// === ë¡œê·¸/ë³€ìˆ˜ ì €ì¥ ===\r",
											"console.log(\"âœ… User created:\", {\r",
											"  http: pm.response.code,\r",
											"  loginId,\r",
											"  userId: userId ?? \"(n/a)\",\r",
											"  sentLoginId\r",
											"});\r",
											"\r",
											"if (loginId) pm.environment.set(\"LAST_CREATED_LOGIN_ID\", String(loginId));\r",
											"if (userId  ) pm.environment.set(\"LAST_CREATED_USER_ID\",  String(userId ));\r",
											"\r",
											"// === âœ… í™˜ê²½ë³€ìˆ˜ 'MakeUser' ë¡œ ì €ì¥ ===\r",
											"pm.environment.set(\"MakeUser\", String(loginId));\r",
											"// í•„ìš”ì‹œ ì „ì²´ ì‘ë‹µë„ ì°¸ê³  ë¡œê·¸\r",
											"// console.log(\"ğŸ“¦ full response:\", j);\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											"\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/identity/api/users",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"identity",
										"api",
										"users"
									]
								}
							},
							"response": []
						},
						{
							"name": "ìœ ì € ìƒì„± ì„±ê³µ_permission: General user/ status: Inactive",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// ---- 1) ëœë¤ suffix ìƒì„± (íƒ€ì„ìŠ¤íƒ¬í”„ ë’¤ 6ìë¦¬ ì‚¬ìš©) ----\r",
											"const ts = String(pm.variables.replaceIn(\"{{$timestamp}}\") || Date.now());\r",
											"const suffix = ts.slice(-6);\r",
											"const genId  = `neurophet1${suffix}`;\r",
											"\r",
											"// ---- 2) í™˜ê²½ë³€ìˆ˜ì—ì„œ PW ì½ê¸° (ì—†ìœ¼ë©´ ë¹ˆë¬¸ìì—´) ----\r",
											"const newPw  = pm.environment.get(\"NEW_PW\")  || \"\";\r",
											"const confPw = pm.environment.get(\"CONF_PW\") || \"\";\r",
											"\r",
											"// ---- 3) ê¸°ì¡´ ë°”ë””ë¥¼ ì“°ì§€ ë§ê³ , ìŠ¤í™ì— ë§ê²Œ ìƒˆë¡œ êµ¬ì„± ----\r",
											"const body = {\r",
											"  loginId: genId,\r",
											"  name: genId,\r",
											"  description: \"\",\r",
											"  department: \"\",\r",
											"  permissionProfileIdList: [3],\r",
											"  isActivated: false,\r",
											"  password: newPw,\r",
											"  confirmPassword: confPw,\r",
											"  email: \"\"\r",
											"};\r",
											"\r",
											"// ---- 4) ìš”ì²­ì— ë°˜ì˜ ----\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(body));\r",
											"\r",
											"// ---- 5) ë‚˜ì¤‘ì— ì¬ì‚¬ìš©/ë¡œê·¸ìš© ë³€ìˆ˜ ----\r",
											"pm.variables.set(\"GENERATED_LOGIN_ID\", genId);\r",
											"pm.variables.set(\"SUFFIX\", suffix);\r",
											"console.log(\"[pre] create-user body:\", body);\r",
											"\r",
											"\r",
											"\r",
											"\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === Parse JSON ===\r",
											"let j = null;\r",
											"pm.test(\"ì‘ë‹µì´ JSONì´ì–´ì•¼ í•¨\", () => { j = pm.response.json(); pm.expect(j).to.be.an(\"object\"); });\r",
											"\r",
											"// === HTTP 200/201 í™•ì¸ ===\r",
											"pm.test(\"HTTP 200 ë˜ëŠ” 201 ì´ì–´ì•¼ í•¨\", () => {\r",
											"  pm.expect(pm.response.code).to.be.oneOf([200, 201]);\r",
											"});\r",
											"\r",
											"// === (ì„ íƒ) ì„œë¹„ìŠ¤ ì½”ë“œê°€ ìˆë‹¤ë©´ 200 í™•ì¸ ===\r",
											"if (j && typeof j.code !== \"undefined\") {\r",
											"  pm.test(\"ì„œë¹„ìŠ¤ code === 200\", () => pm.expect(j.code).to.eql(200));\r",
											"}\r",
											"\r",
											"// === ìƒì„±ëœ ê³„ì • ì‹ë³„ ì •ë³´ ì¶”ì¶œ ===\r",
											"// pre-requestì—ì„œ ë§Œë“  ê°’(ìš°ë¦¬ê°€ ë³´ë‚¸ loginId)ë„ ê°€ì ¸ì™€ ë¹„êµ/ë¡œê·¸ ìš©ìœ¼ë¡œ ì‚¬ìš©\r",
											"const sentLoginId = pm.variables.get(\"GENERATED_LOGIN_ID\") || \"\";\r",
											"\r",
											"// ì•ˆì „í•˜ê²Œ ê²½ë¡œ íƒìƒ‰í•˜ëŠ” í—¬í¼\r",
											"const pick = (obj, paths) => {\r",
											"  for (const p of paths) {\r",
											"    try {\r",
											"      const val = p.split(\".\").reduce((o, k) => (o && o[k] !== undefined ? o[k] : undefined), obj);\r",
											"      if (val !== undefined && val !== null) return val;\r",
											"    } catch (_) {}\r",
											"  }\r",
											"  return undefined;\r",
											"};\r",
											"\r",
											"// ì‘ë‹µ í¬ë§·ì´ ì–´ë–¤ ê²ƒì´ë“  ì»¤ë²„(ì¼ë°˜ì ìœ¼ë¡œ result.* ë˜ëŠ” data.*ë¡œ ë‚´ë ¤ì˜¤ëŠ” ê²½ìš° í¬í•¨)\r",
											"const loginId = pick(j, [\"result.loginId\", \"data.loginId\", \"loginId\"]) || sentLoginId;\r",
											"const userId  = pick(j, [\"result.id\", \"data.id\", \"id\", \"userId\"]);\r",
											"\r",
											"// === ê¸°ë³¸ ê²€ì¦ ===\r",
											"pm.test(\"ìƒì„±ëœ loginId í™•ì¸\", () => pm.expect(loginId).to.be.a(\"string\").and.not.empty);\r",
											"\r",
											"// === ë¡œê·¸/ë³€ìˆ˜ ì €ì¥ ===\r",
											"console.log(\"âœ… User created:\", {\r",
											"  http: pm.response.code,\r",
											"  loginId,\r",
											"  userId: userId ?? \"(n/a)\",\r",
											"  sentLoginId\r",
											"});\r",
											"\r",
											"if (loginId) pm.environment.set(\"LAST_CREATED_LOGIN_ID\", String(loginId));\r",
											"if (userId  ) pm.environment.set(\"LAST_CREATED_USER_ID\",  String(userId ));\r",
											"\r",
											"// === âœ… í™˜ê²½ë³€ìˆ˜ 'MakeUser' ë¡œ ì €ì¥ ===\r",
											"pm.environment.set(\"MakeUser\", String(loginId));\r",
											"// í•„ìš”ì‹œ ì „ì²´ ì‘ë‹µë„ ì°¸ê³  ë¡œê·¸\r",
											"// console.log(\"ğŸ“¦ full response:\", j);\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/identity/api/users",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"identity",
										"api",
										"users"
									]
								}
							},
							"response": []
						},
						{
							"name": "ìœ ì € ìƒì„± ì‹¤íŒ¨_ ì¤‘ë³µëœ userId",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											"\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/identity/api/users/{{MakeUser}}/exist",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"identity",
										"api",
										"users",
										"{{MakeUser}}",
										"exist"
									]
								}
							},
							"response": []
						}
					]
				},
				{
					"name": "Revise",
					"item": [
						{
							"name": "ìœ ì € ì •ë³´ ìˆ˜ì •",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === PUT /identity/api/users : ì „ì²´ ê°ì²´ë¡œ ì „ì†¡ ===\r",
											"// loginId â† {{MakeUser}}, name â† 'neurophet' + ìˆ«ì suffix\r",
											"// ë‚˜ë¨¸ì§€ í•„ë“œ: description/department/permissionProfileIdList/isActivated/email ê·¸ëŒ€ë¡œ í¬í•¨\r",
											"\r",
											"pm.request.method = \"PUT\";\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"\r",
											"// 1) loginId = {{MakeUser}} (í•„ìˆ˜)\r",
											"const loginId = pm.variables.replaceIn(\"{{MakeUser}}\");\r",
											"if (!loginId || loginId === \"{{MakeUser}}\") {\r",
											"  throw new Error(\"í™˜ê²½ë³€ìˆ˜ 'MakeUser'ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ì‚¬ìš©ì ìƒì„± í›„ MakeUserì— loginIdë¥¼ ì €ì¥í•˜ì„¸ìš”.\");\r",
											"}\r",
											"\r",
											"// 2) ìˆ«ì suffix (ê¸°ë³¸ 6ìë¦¬, NAME_TS_LENìœ¼ë¡œ ì¡°ì ˆ ê°€ëŠ¥: ìˆ«ì ë˜ëŠ” 'full')\r",
											"const tsRaw = pm.variables.replaceIn(\"{{$timestamp}}\");               // ìˆ«ì ë¬¸ìì—´\r",
											"const ts = /^\\d+$/.test(tsRaw || \"\") ? tsRaw : String(Date.now());    // ìˆ«ìë§Œ ë³´ì¥\r",
											"const len = (pm.environment.get(\"NAME_TS_LEN\") || \"6\").toString().toLowerCase();\r",
											"const n = len === \"full\" ? null : parseInt(len, 10);\r",
											"const suffix = n && !Number.isNaN(n) ? ts.slice(-n) : ts;\r",
											"\r",
											"// 3) name ì¡°ë¦½\r",
											"const newName = `neurophet${suffix}`;\r",
											"\r",
											"// 4) permissionProfileIdList ê¸°ë³¸ê°’(í™˜ê²½ë³€ìˆ˜ë¡œ ë°”ê¿€ ìˆ˜ ìˆê²Œ)\r",
											"let profId = Number(pm.environment.get(\"PERMISSION_PROFILE_ID\") || 2);\r",
											"if (!Number.isFinite(profId)) profId = 2;\r",
											"\r",
											"// 5) ìš”ì²­ ë°”ë””ë¥¼ â€œì •í™•í•œ ìŠ¤í‚¤ë§ˆâ€ë¡œ ìƒì„±\r",
											"const body = {\r",
											"  loginId: String(loginId),\r",
											"  name: newName,\r",
											"  description: \"\",\r",
											"  department: \"\",\r",
											"  permissionProfileIdList: [profId],\r",
											"  isActivated: true,\r",
											"  email: \"\"\r",
											"};\r",
											"\r",
											"// 6) ìš”ì²­ ì ìš©\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(body));\r",
											"\r",
											"// 7) ë””ë²„ê·¸/ê³µìœ  ë³€ìˆ˜\r",
											"pm.variables.set(\"NEW_NAME\", newName);\r",
											"console.log(\"[pre] body:\", body);\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"let j = null;\r",
											"pm.test(\"ì‘ë‹µì´ JSON\", () => { j = pm.response.json(); pm.expect(j).to.be.an(\"object\"); });\r",
											"pm.test(\"HTTP 200/201\", () => pm.expect(pm.response.code).to.be.oneOf([200, 201]));\r",
											"if (j && typeof j.code !== \"undefined\") {\r",
											"  pm.test(\"ì„œë¹„ìŠ¤ code === 200\", () => pm.expect(j.code).to.eql(200));\r",
											"}\r",
											"console.log(`âœ… renamed to ${pm.variables.get(\"NEW_NAME\")} | HTTP ${pm.response.code}`);\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											"\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "PUT",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/identity/api/users",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"identity",
										"api",
										"users"
									]
								}
							},
							"response": []
						},
						{
							"name": "ìœ ì € ë¹„ë°€ë²ˆí˜¸ ë³€ê²½",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// =====(ì„ íƒ) í† í°: ìˆìœ¼ë©´ í—¤ë”ì— ë„£ê³ , ì—†ìœ¼ë©´ ìŠ¤í‚µ =====\r",
											"const token = pm.environment.get(\"access_token\");\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"pm.request.headers.upsert({ key: \"Accept\", value: \"application/json\" });\r",
											"\r",
											"// ===== SJCL ë¡œë“œ =====\r",
											"const SJCL_SRC = pm.environment.get(\"sjcl_src\") || pm.globals.get(\"sjcl_src\");\r",
											"if (!SJCL_SRC) { throw new Error(\"sjcl_src ë³€ìˆ˜ì— sjcl.js ì „ì²´ ì†ŒìŠ¤ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.\"); }\r",
											"function buildSJCL(src){\r",
											"  const f = new Function(`var window={};var self=window;var global=window;var module={exports:{}};var exports=module.exports;${src};return (typeof sjcl!=='undefined')?sjcl:(module&&module.exports?module.exports:(window.sjcl||exports.sjcl));`);\r",
											"  const lib = f(); if(!lib || !lib.cipher || !lib.mode || !lib.codec) throw new Error(\"SJCL ë¡œë“œ ì‹¤íŒ¨\"); return lib;\r",
											"}\r",
											"const SJCL = buildSJCL(SJCL_SRC);\r",
											"\r",
											"// ===== CryptoJS =====\r",
											"let CryptoJSLib = null; try { CryptoJSLib = require(\"crypto-js\"); } catch { CryptoJSLib = CryptoJS; }\r",
											"if (!CryptoJSLib) throw new Error(\"CryptoJS ë¡œë“œ ì‹¤íŒ¨\");\r",
											"const CJS = CryptoJSLib;\r",
											"\r",
											"// ===== ìœ í‹¸ =====\r",
											"function randomBytes(n){ const wa=CJS.lib.WordArray.random(n); const hex=wa.toString(CJS.enc.Hex); const out=[]; for(let i=0;i<hex.length;i+=2) out.push(parseInt(hex.substr(i,2),16)); return out; }\r",
											"function bytesToBits(bytes){ let hex=\"\"; for(let i=0;i<bytes.length;i++){ const h=bytes[i].toString(16); hex+=(h.length===1?\"0\"+h:h);} return SJCL.codec.hex.toBits(hex); }\r",
											"// AES-128-GCM(iv12, tag16) | key = SHA256(loginId).hex ì•16(ëŒ€ë¬¸ì ASCII)\r",
											"function encryptOnce(keyStr, plain){\r",
											"  const ivBytes=randomBytes(12), ivBits=bytesToBits(ivBytes);\r",
											"  const kHex=CJS.SHA256(keyStr).toString(CJS.enc.Hex).toUpperCase();\r",
											"  const secret=kHex.substring(0,16).toUpperCase();\r",
											"  const keyBits=SJCL.codec.utf8String.toBits(secret);\r",
											"  const ptBits=SJCL.codec.utf8String.toBits(String(plain));\r",
											"  const aes=new SJCL.cipher.aes(keyBits);\r",
											"  const ct=SJCL.mode.gcm.encrypt(aes, ptBits, ivBits, [], 128);\r",
											"  const combined=SJCL.bitArray.concat(bytesToBits(ivBytes), ct);\r",
											"  return SJCL.codec.base64.fromBits(combined);\r",
											"}\r",
											"\r",
											"// ===== ì…ë ¥ê°’(ê·¸ëƒ¥ í™˜ê²½ë³€ìˆ˜ ê·¸ëŒ€ë¡œ ì”€) =====\r",
											"const loginId = pm.variables.replaceIn(\"{{MakeUser}}\");\r",
											"const newPw   = pm.variables.replaceIn(\"{{NEW_PW}}\");\r",
											"const confPw  = pm.variables.replaceIn(\"{{CONF_PW}}\");\r",
											"if (!loginId || loginId === \"{{MakeUser}}\") throw new Error(\"MakeUser í™˜ê²½ë³€ìˆ˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.\");\r",
											"if (!newPw   || newPw   === \"{{NEW_PW}}\")   throw new Error(\"NEW_PW í™˜ê²½ë³€ìˆ˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.\");\r",
											"if (!confPw  || confPw  === \"{{CONF_PW}}\")  throw new Error(\"CONF_PW í™˜ê²½ë³€ìˆ˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.\");\r",
											"\r",
											"// ===== ì•”í˜¸í™” =====\r",
											"const encNew  = encryptOnce(loginId, newPw);\r",
											"const encConf = encryptOnce(loginId, confPw);\r",
											"\r",
											"// ===== ì–´ë–¤ ì—”ë“œí¬ì¸íŠ¸ì¸ì§€ í™•ì¸ (force / change) =====\r",
											"const urlStr = pm.request.url.toString();\r",
											"const isForce  = /\\/password\\/force(\\b|$)/.test(urlStr);\r",
											"const isChange = /\\/password\\/change(\\b|$)/.test(urlStr);\r",
											"\r",
											"// ===== ë°”ë”” êµ¬ì„± =====\r",
											"let body = {};\r",
											"if (isChange) {\r",
											"  // \"í˜„ì¬ë¹„ë²ˆì€ NEW_PWë¡œ\" ì›í•˜ì…¨ìœ¼ë‹ˆ currentPasswordë„ NEW_PWë¡œ ì•”í˜¸í™”í•´ì„œ ë„£ìŠµë‹ˆë‹¤.\r",
											"  const encCurr = encryptOnce(loginId, newPw);\r",
											"  body = { loginId: String(loginId), currentPassword: encCurr, newPassword: encNew, confirmPassword: encConf };\r",
											"} else {\r",
											"  // ê¸°ë³¸(force): currentPassword ì—†ì´ ìƒˆ/í™•ì¸ë§Œ\r",
											"  body = { loginId: String(loginId), newPassword: encNew, confirmPassword: encConf };\r",
											"}\r",
											"\r",
											"// ìš”ì²­ì— ì ìš©\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(body));\r",
											"\r",
											"// ë””ë²„ê·¸(ë¯¼ê°ê°’ ì§ì ‘ ë…¸ì¶œ X)\r",
											"console.log(\"[pre] endpoint:\", isForce ? \"force\" : (isChange ? \"change\" : \"unknown\"));\r",
											"console.log(\"[pre] loginId:\", loginId);\r",
											"console.log(\"[pre] body keys:\", Object.keys(body));\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"const text = pm.response.text(); let j=null; try{ j=pm.response.json(); }catch{}\r",
											"console.log(\"[res][status]\", pm.response.code);\r",
											"console.log(\"[res][body]\", text);\r",
											"pm.test(\"HTTP 2xx\", () => pm.expect(pm.response.code).to.be.oneOf([200,201,204]));\r",
											"if (j && typeof j.code !== \"undefined\") pm.test(\"ì„œë¹„ìŠ¤ code===200\", () => pm.expect(j.code).to.eql(200));\r",
											"\r",
											"// 1) ì‹¤ì œë¡œ ë³´ë‚¸ ìš”ì²­ ë°”ë””(ì•”í˜¸ë¬¸ í¬í•¨) íŒŒì‹±\r",
											"let sent = {};\r",
											"try { sent = JSON.parse(pm.request.body.raw || \"{}\"); } catch { sent = {}; }\r",
											"\r",
											"// 2) í™˜ê²½ë³€ìˆ˜(í‰ë¬¸)ë„ ì°¸ê³ í•´ì„œ ë§ˆìŠ¤í‚¹ ì¶œë ¥\r",
											"const loginId = sent.loginId ?? pm.variables.replaceIn(\"{{MakeUser}}\");\r",
											"const plainNew  = pm.variables.replaceIn(\"{{NEW_PW}}\");\r",
											"const plainConf = pm.variables.replaceIn(\"{{CONF_PW}}\");\r",
											"\r",
											"function mask(s, keepStart=2, keepEnd=2) {\r",
											"  if (!s) return \"(empty)\";\r",
											"  if (s.length <= keepStart + keepEnd) return \"*\".repeat(s.length);\r",
											"  return s.slice(0, keepStart) + \"*\".repeat(Math.max(4, s.length - keepStart - keepEnd)) + s.slice(-keepEnd);\r",
											"}\r",
											"function trunc(s, head=8, tail=4) {\r",
											"  if (!s) return \"(empty)\";\r",
											"  return s.length <= head + tail ? s : s.slice(0, head) + \"â€¦\" + s.slice(-tail);\r",
											"}\r",
											"\r",
											"// 3) ì½˜ì†” ë¡œê·¸\r",
											"console.log(`[post] ${pm.request.method} ${pm.request.url.toString()} â†’ HTTP ${pm.response.code}`);\r",
											"console.log(`[post] loginId: ${loginId}`);\r",
											"console.log(`[post] newPw(plain, masked): ${mask(plainNew)} | confPw(plain, masked): ${mask(plainConf)}`);\r",
											"console.log(`[post] newPassword(enc): ${trunc(sent.newPassword)} (len=${(sent.newPassword||\"\").length})`);\r",
											"console.log(`[post] confirmPassword(enc): ${trunc(sent.confirmPassword)} (len=${(sent.confirmPassword||\"\").length})`);\r",
											"\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											"\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "PATCH",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{baseUrl}}/identity/api/users/password/force",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"identity",
										"api",
										"users",
										"password",
										"force"
									]
								}
							},
							"response": []
						}
					]
				}
			]
		},
		{
			"name": "master_License",
			"item": [
				{
					"name": "í˜„ì¬ ë¼ì´ì„ ìŠ¤ ì •ë³´ ì¡°íšŒ",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "{{access_token}}",
								"type": "text"
							},
							{
								"key": "",
								"value": "",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/app/api/licenses/remain",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"licenses",
								"remain"
							]
						}
					},
					"response": []
				},
				{
					"name": "ë¼ì´ì„ ìŠ¤ ì¦‰ì‹œ í™œì„±í™” ê°€ëŠ¥ì—¬ë¶€ í™•ì¸",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "{{access_token}}",
								"type": "text"
							},
							{
								"key": "",
								"value": "",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/app/api/licenses/validate",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"licenses",
								"validate"
							]
						}
					},
					"response": []
				},
				{
					"name": "ë¼ì´ì„ ìŠ¤ ëª©ë¡ ì¡°íšŒ",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// === 1) ì‘ë‹µ íŒŒì‹± & ê¸°ë³¸ í™•ì¸ ===\r",
									"let j = {};\r",
									"try { j = pm.response.json(); } catch (e) {\r",
									"  pm.environment.unset(\"licenseKey\");\r",
									"  console.error(\"[licenses/search] JSON parse failed:\", e);\r",
									"  pm.test(\"HTTP 2xx\", () => pm.expect(pm.response.code).to.be.within(200,299));\r",
									"  return;\r",
									"}\r",
									"\r",
									"pm.test(\"HTTP 2xx\", () => pm.expect(pm.response.code).to.be.within(200,299));\r",
									"if (typeof j?.code !== \"undefined\") {\r",
									"  pm.test(\"service code === 200\", () => pm.expect(j.code).to.eql(200));\r",
									"}\r",
									"\r",
									"// === 2) ëª©ë¡ ì¶”ì¶œ ===\r",
									"const contents = Array.isArray(j?.result?.contents) ? j.result.contents : [];\r",
									"if (!contents.length) {\r",
									"  pm.environment.unset(\"licenseKey\");\r",
									"  console.warn(\"[licenses/search] contents is empty\");\r",
									"}\r",
									"\r",
									"// (ì˜µì…˜) ìƒíƒœ ë¶„í¬ ë¡œê·¸\r",
									"const counts = {};\r",
									"for (const it of contents) {\r",
									"  const s = String(it?.status ?? \"\").trim().toUpperCase();\r",
									"  counts[s] = (counts[s] || 0) + 1;\r",
									"}\r",
									"console.log(\"[licenses/search] status counts:\", counts);\r",
									"\r",
									"// === 3) IN_USEDë§Œ í•„í„°ë§ (ì‘ë‹µ ìˆœì„œ ìœ ì§€) ===\r",
									"const inUsed = contents.filter(it =>\r",
									"  String(it?.status ?? \"\").trim().toUpperCase() === \"IN_USED\"\r",
									");\r",
									"\r",
									"// === 4) ì²« í•­ëª© ì„ íƒ/ì €ì¥ ===\r",
									"const chosen = inUsed[0] || null;\r",
									"if (chosen && chosen.licenseKey) {\r",
									"  pm.environment.set(\"licenseKey\", String(chosen.licenseKey));\r",
									"  console.log(`[licenses/search] licenseKey set -> ${chosen.licenseKey}`, {\r",
									"    expireAt: chosen.expireAt, hostId: chosen.hostId\r",
									"  });\r",
									"  pm.test(\"IN_USED item found\", () => pm.expect(true).to.eql(true));\r",
									"} else {\r",
									"  pm.environment.unset(\"licenseKey\");\r",
									"  console.warn(\"[licenses/search] No IN_USED item found.\");\r",
									"  pm.test(\"IN_USED item exists\", () => pm.expect(inUsed.length, \"No IN_USED items\").to.be.above(0));\r",
									"}\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "{{access_token}}",
								"type": "text"
							},
							{
								"key": "",
								"value": "",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"requestPageNumber\": 1,\r\n  \"itemCountPerPage\": 10,\r\n  \"sortBy\": \"id\",\r\n  \"order\": \"ASC\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/app/api/licenses/search",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"licenses",
								"search"
							]
						}
					},
					"response": []
				},
				{
					"name": "ë¼ì´ì„ ìŠ¤ ìƒíƒœ ìˆ˜ì •_In use -> pending",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// --- env -> licenseKey (ì˜¤íƒ€ ëŒ€ë¹„: licensKeyë„ í—ˆìš©) ---\r",
									"const keyFromEnv =\r",
									"  pm.environment.get(\"licenseKey\") ||\r",
									"  pm.environment.get(\"licensKey\"); // ì˜¤íƒ€ ëŒ€ë¹„\r",
									"\r",
									"if (!keyFromEnv) {\r",
									"  console.warn(\"[/app/api/licenses/search] licenseKey env ê°’ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.\");\r",
									"}\r",
									"\r",
									"// --- headers ---\r",
									"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
									"const tok = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
									"if (tok) pm.request.headers.upsert({ key:\"Authorization\", value: /^Bearer\\s/i.test(tok) ? tok : `Bearer ${tok}` });\r",
									"\r",
									"// í•„ìš”í•˜ë©´ ê¶Œí•œ í—¤ë” ì¶”ê°€(ìˆì„ ë•Œë§Œ)\r",
									"// const perms = pm.environment.get(\"PERMISSIONS\");\r",
									"// if (perms) pm.request.headers.upsert({ key: \"Permissions\", value: String(perms) });\r",
									"\r",
									"// --- body ---\r",
									"const body = {\r",
									"  licenseKey: keyFromEnv || \"\",    // envì—ì„œ ê°€ì ¸ì˜¨ í‚¤\r",
									"  status: \"PENDING\"                // ê³ ì •\r",
									"};\r",
									"\r",
									"pm.request.body.mode = \"raw\";\r",
									"pm.request.body.update(JSON.stringify(body, null, 2));\r",
									"\r",
									"console.log(\"[POST /app/api/licenses/search] body =\", body);\r",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "{{access_token}}",
								"type": "text"
							},
							{
								"key": "",
								"value": "",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/app/api/licenses/status",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"licenses",
								"status"
							]
						}
					},
					"response": []
				},
				{
					"name": "ë¼ì´ì„ ìŠ¤ ìƒíƒœ ìˆ˜ì •_pending -> disabled",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// --- env -> licenseKey (ì˜¤íƒ€ ëŒ€ë¹„: licensKeyë„ í—ˆìš©) ---\r",
									"const keyFromEnv =\r",
									"  pm.environment.get(\"licenseKey\") ||\r",
									"  pm.environment.get(\"licensKey\"); // ì˜¤íƒ€ ëŒ€ë¹„\r",
									"\r",
									"if (!keyFromEnv) {\r",
									"  console.warn(\"[/app/api/licenses/search] licenseKey env ê°’ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.\");\r",
									"}\r",
									"\r",
									"// --- headers ---\r",
									"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
									"const tok = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
									"if (tok) pm.request.headers.upsert({ key:\"Authorization\", value: /^Bearer\\s/i.test(tok) ? tok : `Bearer ${tok}` });\r",
									"\r",
									"// í•„ìš”í•˜ë©´ ê¶Œí•œ í—¤ë” ì¶”ê°€(ìˆì„ ë•Œë§Œ)\r",
									"// const perms = pm.environment.get(\"PERMISSIONS\");\r",
									"// if (perms) pm.request.headers.upsert({ key: \"Permissions\", value: String(perms) });\r",
									"\r",
									"// --- body ---\r",
									"const body = {\r",
									"  licenseKey: keyFromEnv || \"\",    // envì—ì„œ ê°€ì ¸ì˜¨ í‚¤\r",
									"  status: \"DISABLED\"                // ê³ ì •\r",
									"};\r",
									"\r",
									"pm.request.body.mode = \"raw\";\r",
									"pm.request.body.update(JSON.stringify(body, null, 2));\r",
									"\r",
									"console.log(\"[POST /app/api/licenses/search] body =\", body);\r",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "{{access_token}}",
								"type": "text"
							},
							{
								"key": "",
								"value": "",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/app/api/licenses/status",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"licenses",
								"status"
							]
						}
					},
					"response": []
				},
				{
					"name": "ë¼ì´ì„ ìŠ¤ ìƒíƒœ ìˆ˜ì •_disabled -> in use",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// --- env -> licenseKey (ì˜¤íƒ€ ëŒ€ë¹„: licensKeyë„ í—ˆìš©) ---\r",
									"const keyFromEnv =\r",
									"  pm.environment.get(\"licenseKey\") ||\r",
									"  pm.environment.get(\"licensKey\"); // ì˜¤íƒ€ ëŒ€ë¹„\r",
									"\r",
									"if (!keyFromEnv) {\r",
									"  console.warn(\"[/app/api/licenses/search] licenseKey env ê°’ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.\");\r",
									"}\r",
									"\r",
									"// --- headers ---\r",
									"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
									"const tok = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
									"if (tok) pm.request.headers.upsert({ key:\"Authorization\", value: /^Bearer\\s/i.test(tok) ? tok : `Bearer ${tok}` });\r",
									"\r",
									"// í•„ìš”í•˜ë©´ ê¶Œí•œ í—¤ë” ì¶”ê°€(ìˆì„ ë•Œë§Œ)\r",
									"// const perms = pm.environment.get(\"PERMISSIONS\");\r",
									"// if (perms) pm.request.headers.upsert({ key: \"Permissions\", value: String(perms) });\r",
									"\r",
									"// --- body ---\r",
									"const body = {\r",
									"  licenseKey: keyFromEnv || \"\",    // envì—ì„œ ê°€ì ¸ì˜¨ í‚¤\r",
									"  status: \"IN_USED\"                // ê³ ì •\r",
									"};\r",
									"\r",
									"pm.request.body.mode = \"raw\";\r",
									"pm.request.body.update(JSON.stringify(body, null, 2));\r",
									"\r",
									"console.log(\"[POST /app/api/licenses/search] body =\", body);\r",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "{{access_token}}",
								"type": "text"
							},
							{
								"key": "",
								"value": "",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/app/api/licenses/status",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"licenses",
								"status"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "master_Analysis",
			"item": [
				{
					"name": "DICOM Tag ì„¤ì • ì¡°íšŒ",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// === Common Pre-request ===\r",
									"const token = pm.environment.get(\"access_token\");\r",
									"const cookieRaw = pm.environment.get(\"cookie_raw\") || \"\";\r",
									"const xsrf = pm.environment.get(\"xsrf_token\") || \"\";\r",
									"\r",
									"// Bearer ë°©ì‹ì´ë©´:\r",
									"if (token) {\r",
									"  pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
									"}\r",
									"\r",
									"// ì„¸ì…˜/CSRF ë°©ì‹ì´ë©´:\r",
									"if (cookieRaw) {\r",
									"  pm.request.headers.upsert({ key: \"Cookie\", value: cookieRaw });\r",
									"}\r",
									"if (xsrf) {\r",
									"  pm.request.headers.upsert({ key: \"X-XSRF-TOKEN\", value: xsrf });\r",
									"}\r",
									"\r",
									"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
									"pm.request.headers.upsert({ key: \"Accept\", value: \"application/json\" });\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"HTTP 200\", () => pm.response.to.have.status(200));\r",
									"\r",
									"let j={}; try{ j=pm.response.json(); }catch(e){ j={}; }\r",
									"\r",
									"// 1) ì¹´íƒˆë¡œê·¸ë„ í•¨ê»˜ ì €ì¥(ì„ íƒ)\r",
									"//    - ì´í›„ ë“œë¡­ë‹¤ìš´/ê²€ì¦ ë“±ì— í™œìš© ê°€ëŠ¥\r",
									"const catalogs = j?.result?.dicomTagsSettingCatalogs || {};\r",
									"pm.environment.set(\"CATALOG_MODALITIES\", JSON.stringify(catalogs.modalityTypes || []));\r",
									"pm.environment.set(\"CATALOG_MRI_SUBTYPES\", JSON.stringify(catalogs.mriSubTypes || []));\r",
									"pm.environment.set(\"CATALOG_AMYLOID_SUBTYPES\", JSON.stringify(catalogs.amyloidSubTypes || []));\r",
									"pm.environment.set(\"CATALOG_TAU_SUBTYPES\", JSON.stringify(catalogs.tauSubTypes || []));\r",
									"\r",
									"// 2) rows íŒŒì‹±\r",
									"const rows = j?.result?.dicomTags?.contents || j?.result?.items || j?.result || [];\r",
									"pm.test(\"rows exist\", () => pm.expect(Array.isArray(rows) && rows.length>0).to.eql(true));\r",
									"\r",
									"// 3) (ì˜µì…˜) í•„í„°: í™˜ê²½ë³€ìˆ˜ ìˆìœ¼ë©´ ì ìš©\r",
									"//    - TAG_MODALITY: MRI | PET_AMYLOID | PET_TAU\r",
									"//    - SEQ_OR_TRACER: T1 | T2_FLAIR | F_18_FLUTEMETAMOL | ...\r",
									"//    - TAG_GROUP: 0008 | 0018 | ...\r",
									"//    - TAG_ELEMENT: 103E | 0031 | ...\r",
									"function UP(x){ return (x==null) ? \"\" : String(x).toUpperCase(); }\r",
									"\r",
									"const wantMod  = pm.environment.get(\"TAG_MODALITY\");     // ex) MRI\r",
									"const wantSeq  = pm.environment.get(\"SEQ_OR_TRACER\");    // ex) T2_FLAIR\r",
									"const wantGrp  = pm.environment.get(\"TAG_GROUP\");        // ex) 0008\r",
									"const wantElem = pm.environment.get(\"TAG_ELEMENT\");      // ex) 103E\r",
									"\r",
									"let filtered = rows;\r",
									"if (wantMod || wantSeq || wantGrp || wantElem) {\r",
									"  filtered = rows.filter(r=>{\r",
									"    const okM = !wantMod  || String(r.tagModalityTypeCode) === String(wantMod);\r",
									"    const okS = !wantSeq  || String(r.sequenceOrTracerTypeCode) === String(wantSeq);\r",
									"    const okG = !wantGrp  || UP(r.groupNumber)   === UP(wantGrp);\r",
									"    const okE = !wantElem || UP(r.elementNumber) === UP(wantElem);\r",
									"    return okM && okS && okG && okE;\r",
									"  });\r",
									"}\r",
									"\r",
									"// 4) í›„ë³´ ì„ íƒ: í•„í„° ê²°ê³¼ ìš°ì„ , ì—†ìœ¼ë©´ ì „ì²´ ì²« í–‰\r",
									"const chosen = filtered[0] || rows[0] || {};\r",
									"const id = chosen.id || chosen.dicomId || chosen.uid;\r",
									"\r",
									"pm.test(\"id exists\", () => pm.expect(!!id).to.eql(true));\r",
									"\r",
									"// 5) í™˜ê²½ë³€ìˆ˜ ì €ì¥(ë‹¤ìŒ PUTì—ì„œ ìë™ ì‚¬ìš©_PUT DICOM TAG ìˆ˜ì •)\r",
									"if (id) {\r",
									"  pm.environment.set(\"DICOM_ID\", String(id));\r",
									"  pm.environment.set(\"TAG_MODALITY\", String(chosen.tagModalityTypeCode || wantMod || \"MRI\"));\r",
									"  pm.environment.set(\"SEQ_OR_TRACER\", String(chosen.sequenceOrTracerTypeCode || wantSeq || \"T1\"));\r",
									"  pm.environment.set(\"TAG_GROUP\", UP(chosen.groupNumber || wantGrp || \"0008\"));\r",
									"  pm.environment.set(\"TAG_ELEMENT\", UP(chosen.elementNumber || wantElem || \"103E\"));\r",
									"\r",
									"  console.log(\"[SEED][POST /search] total:\", rows.length, \r",
									"              \"filtered:\", filtered.length, \r",
									"              \"â†’ DICOM_ID =\", id,\r",
									"              \"ctx:\", {\r",
									"                modality: pm.environment.get(\"TAG_MODALITY\"),\r",
									"                seq: pm.environment.get(\"SEQ_OR_TRACER\"),\r",
									"                group: pm.environment.get(\"TAG_GROUP\"),\r",
									"                element: pm.environment.get(\"TAG_ELEMENT\")\r",
									"              });\r",
									"} else {\r",
									"  console.warn(\"[SEED] No usable id field in:\", chosen);\r",
									"}\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "{{access_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"itemCountPerPage\": 10,\r\n  \"order\": \"DESC\",\r\n  \"requestPageNumber\": 1,\r\n  \"sortBy\": \"id\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/app/api/analysis/settings/dicom/search",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"analysis",
								"settings",
								"dicom",
								"search"
							]
						}
					},
					"response": []
				},
				{
					"name": "DICOM Tag ì„¤ì • ì¶”ê°€",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// --- auth/headers ---\r",
									"const t = pm.environment.get(\"access_token\");\r",
									"const c = pm.environment.get(\"cookie_raw\") || \"\";\r",
									"const x = pm.environment.get(\"xsrf_token\") || \"\";\r",
									"if (t) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${t}` });\r",
									"if (c) pm.request.headers.upsert({ key: \"Cookie\", value: c });\r",
									"if (x) pm.request.headers.upsert({ key: \"X-XSRF-TOKEN\", value: x });\r",
									"pm.request.headers.upsert({ key: \"Accept\", \"value\": \"application/json\" });\r",
									"pm.request.headers.upsert({ key: \"Content-Type\", \"value\": \"application/json\" });\r",
									"\r",
									"// --- helpers ---\r",
									"function base() {\r",
									"  let b = (pm.environment.get(\"baseUrl\") || \"\").trim();\r",
									"  if (!/^https?:\\/\\//i.test(b)) b = \"http://\" + b;\r",
									"  return b.replace(/\\/+$/,\"\");\r",
									"}\r",
									"function hex4(s){\r",
									"  const cleaned = String(s || \"\").replace(/^0x/i, \"\").toUpperCase();\r",
									"  return cleaned.padStart(4, \"0\");\r",
									"}\r",
									"\r",
									"// --- pick values (í™˜ê²½ë³€ìˆ˜ ìˆìœ¼ë©´ ìš°ì„ , ì—†ìœ¼ë©´ ì˜ˆì‹œ/ëœë¤) ---\r",
									"const modality = pm.environment.get(\"tag_modality\") || \"MRI\";\r",
									"const seq      = pm.environment.get(\"tag_sequence\") || \"T1\";\r",
									"const group    = hex4(pm.environment.get(\"tag_group\")   || \"0008\");\r",
									"const element  = hex4(pm.environment.get(\"tag_element\") || \"103E\");\r",
									"const valueStr = pm.environment.get(\"tag_value\") || `flair_${(Date.now()%10000)}`;\r",
									"const exacted  = String(pm.environment.get(\"tag_exact\") || \"false\").toLowerCase() === \"true\";\r",
									"\r",
									"// --- build & inject body ---\r",
									"const body = {\r",
									"  tagModalityTypeCode: modality,\r",
									"  sequenceOrTracerTypeCode: seq,\r",
									"  groupNumber: group,\r",
									"  elementNumber: element,\r",
									"  tagValue: valueStr,\r",
									"  exacted\r",
									"};\r",
									"pm.request.body.update(JSON.stringify(body));\r",
									"\r",
									"// ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì“¸ ì˜ˆìƒê°’ ì €ì¥\r",
									"pm.environment.set(\"NEW_DICOM_TAG_BODY\", JSON.stringify(body));\r",
									"pm.environment.set(\"NEW_DICOM_TAG_EXPECT_VALUE\", valueStr);\r",
									"pm.variables.set(\"searchUrl\", `${base()}/app/api/analysis/settings/dicom/search`);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// --- basic checks ---\r",
									"pm.test(\"HTTP 200\", () => pm.response.to.have.status(200));\r",
									"let j={}; try{ j=pm.response.json(); }catch(e){ j={}; }\r",
									"pm.test(\"Business code == 200\", () => pm.expect(j?.code ?? 200).to.eql(200));\r",
									"\r",
									"const r = j?.result ?? {};\r",
									"pm.test(\"Created id present\", () => pm.expect(r).to.have.property(\"id\"));\r",
									"\r",
									"// ì €ì¥ëœ í•„ë“œ í™•ì¸ (ì •í•©ì„±)\r",
									"const exp = JSON.parse(pm.environment.get(\"NEW_DICOM_TAG_BODY\") || \"{}\");\r",
									"pm.test(\"modality matches\", () => pm.expect(r.tagModalityTypeCode).to.eql(exp.tagModalityTypeCode));\r",
									"pm.test(\"sequence matches\", () => pm.expect(r.sequenceOrTracerTypeCode).to.eql(exp.sequenceOrTracerTypeCode));\r",
									"pm.test(\"groupNumber matches\", () => pm.expect(String(r.groupNumber).toUpperCase()).to.eql(String(exp.groupNumber).toUpperCase()));\r",
									"pm.test(\"elementNumber matches\", () => pm.expect(String(r.elementNumber).toUpperCase()).to.eql(String(exp.elementNumber).toUpperCase()));\r",
									"pm.test(\"tagValue matches\", () => pm.expect(r.tagValue).to.eql(exp.tagValue));\r",
									"\r",
									"// ì²´ì´ë‹ ë³€ìˆ˜\r",
									"pm.environment.set(\"dicom_new_id\", String(r.id));\r",
									"pm.environment.set(\"dicom_new_modality\", r.tagModalityTypeCode);\r",
									"pm.environment.set(\"dicom_new_sequence\", r.sequenceOrTracerTypeCode);\r",
									"\r",
									"// --- follow-up: ê²€ìƒ‰ìœ¼ë¡œ ë°©ê¸ˆ ë§Œë“  í•­ëª© ë³´ì´ëŠ”ì§€ ê²€ì¦ ---\r",
									"const searchBody = JSON.stringify({\r",
									"  requestPageNumber: 1,\r",
									"  itemCountPerPage: 100,   // ì²« í˜ì´ì§€ì—ì„œ ì°¾ë„ë¡ ë„‰ë„‰í•˜ê²Œ\r",
									"  sortBy: \"id\",\r",
									"  order: \"DESC\"\r",
									"});\r",
									"pm.sendRequest({\r",
									"  url: pm.variables.get(\"searchUrl\"),\r",
									"  method: \"POST\",\r",
									"  header: { \"Accept\":\"application/json\", \"Content-Type\":\"application/json\",\r",
									"            ...(pm.environment.get(\"access_token\") ? {\"Authorization\": `Bearer ${pm.environment.get(\"access_token\")}`} : {}),\r",
									"            ...(pm.environment.get(\"cookie_raw\") ? {\"Cookie\": pm.environment.get(\"cookie_raw\")} : {}),\r",
									"            ...(pm.environment.get(\"xsrf_token\") ? {\"X-XSRF-TOKEN\": pm.environment.get(\"xsrf_token\")} : {}) },\r",
									"  body: { mode:\"raw\", raw: searchBody }\r",
									"}, (err, res) => {\r",
									"  pm.test(\"Search 200\", () => {\r",
									"    pm.expect(err).to.be.null;\r",
									"    pm.expect(res).to.have.property(\"code\", 200);\r",
									"  });\r",
									"  if (!res) return;\r",
									"  let sj={}; try{ sj=res.json(); }catch(e){ sj={}; }\r",
									"  const contents = sj?.result?.dicomTags?.contents ?? [];\r",
									"  const createdId = Number(pm.environment.get(\"dicom_new_id\"));\r",
									"\r",
									"  const found = Array.isArray(contents) && contents.some(x => Number(x.id) === createdId);\r",
									"  pm.test(\"New tag appears in search list\", () => pm.expect(found).to.be.true);\r",
									"\r",
									"  // ë¡œê·¸/ìš”ì•½ ì €ì¥\r",
									"  pm.environment.set(\"dicom_total_count\", String(sj?.result?.dicomTags?.totalItemCount ?? \"\"));\r",
									"  console.log(\"[DICOM CREATE] id=\", createdId, \" value=\", exp.tagValue, \" found=\", found);\r",
									"});\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "{{access_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/app/api/analysis/settings/dicom",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"analysis",
								"settings",
								"dicom"
							]
						}
					},
					"response": []
				},
				{
					"name": "DICOM Tag ì„¤ì • ìˆ˜ì •",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"/*** ê³µí†µ í—¤ë” ***/\r",
									"const token = pm.environment.get(\"access_token\");\r",
									"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
									"pm.request.headers.upsert({ key: \"Accept\", value: \"application/json\" });\r",
									"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
									"\r",
									"/*** DICOM_ID ***/\r",
									"function resolveDicomId() {\r",
									"  try {\r",
									"    const vlist = pm.request.url.variables;\r",
									"    if (vlist) {\r",
									"      const v = vlist.get && vlist.get(\"DICOM_ID\");\r",
									"      if (v && v.value) return String(v.value);\r",
									"      const obj = vlist.toObject && vlist.toObject();\r",
									"      if (obj && obj.DICOM_ID) return String(obj.DICOM_ID);\r",
									"    }\r",
									"  } catch (_) {}\r",
									"  try {\r",
									"    const raw = pm.variables.replaceIn(pm.request.url.toString());\r",
									"    const m = raw.match(/\\/dicom\\/([^/?#]+)/i);\r",
									"    if (m && m[1]) return decodeURIComponent(m[1]);\r",
									"  } catch (_) {}\r",
									"  const fromEnv = pm.environment.get(\"DICOM_ID\") || pm.collectionVariables.get(\"DICOM_ID\");\r",
									"  if (fromEnv) return String(fromEnv);\r",
									"  throw new Error(\"[DICOM PUT] DICOM_IDë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. Seed ìš”ì²­ì„ ë¨¼ì € ì‹¤í–‰í•˜ì„¸ìš”.\");\r",
									"}\r",
									"const dicomId = resolveDicomId();\r",
									"\r",
									"/*** ìœ í‹¸ ***/\r",
									"const rand = (n)=>Math.floor(Math.random()*n);\r",
									"const pick = (arr)=>arr[Math.max(0, rand(arr.length))];\r",
									"const UP = (x)=> (x==null ? \"\" : String(x).toUpperCase());\r",
									"const asBool = (v, d=false)=> (v==null ? d : String(v).toLowerCase()===\"true\");\r",
									"\r",
									"/*** í˜„ì¬ê°’(Seedì—ì„œ ì €ì¥) ***/\r",
									"const curMod  = pm.environment.get(\"TAG_MODALITY\")   || \"MRI\";\r",
									"const curSeq  = pm.environment.get(\"SEQ_OR_TRACER\")  || \"T1\";\r",
									"const curGrp  = UP(pm.environment.get(\"TAG_GROUP\")   || \"0008\");\r",
									"const curElem = UP(pm.environment.get(\"TAG_ELEMENT\") || \"103E\");\r",
									"\r",
									"/*** ì¹´íƒˆë¡œê·¸(ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ í´ë°±) ***/\r",
									"function parseJSONEnv(key, def=[]) {\r",
									"  try { return JSON.parse(pm.environment.get(key) || \"\"); } catch (_) { return def; }\r",
									"}\r",
									"const catMods  = parseJSONEnv(\"CATALOG_MODALITIES\", []);         // [{code,name}, ...]\r",
									"const catMRI   = parseJSONEnv(\"CATALOG_MRI_SUBTYPES\", []);       // [{code,name}, ...]\r",
									"const catAmy   = parseJSONEnv(\"CATALOG_AMYLOID_SUBTYPES\", []);\r",
									"const catTau   = parseJSONEnv(\"CATALOG_TAU_SUBTYPES\", []);\r",
									"\r",
									"const STATIC = {\r",
									"  MRI: [\"T1\",\"T2_FLAIR\",\"SWI\",\"GRE\",\"DWI\",\"ADC\"],\r",
									"  PET_AMYLOID: [\"F_18_FLUTEMETAMOL\",\"F_18_FLORBETABEN\",\"F_18_FLORBETAPIR\",\"F_18_FLORAPRONOL\",\"C_11_PIB\",\"F_18_NAV4694\"],\r",
									"  PET_TAU: [\"F_18_FLORTAUCIPIR\",\"F_18_PI_2620\",\"F_18_MK_6240\"]\r",
									"};\r",
									"const CATALOG = {\r",
									"  MRI: (catMRI.length ? catMRI.map(x=>x.code) : STATIC.MRI),\r",
									"  PET_AMYLOID: (catAmy.length ? catAmy.map(x=>x.code) : STATIC.PET_AMYLOID),\r",
									"  PET_TAU: (catTau.length ? catTau.map(x=>x.code) : STATIC.PET_TAU)\r",
									"};\r",
									"const MODS = (catMods.length ? catMods.map(x=>x.code) : Object.keys(STATIC));\r",
									"\r",
									"/*** ê·¸ë£¹/ì—˜ë¦¬ë¨¼íŠ¸ í›„ë³´êµ° â€” Seed rowsì—ì„œ ëª» ëª¨ì•˜ë‹¤ë©´ ì•ˆì „ í´ë°± ì‚¬ìš© ***/\r",
									"// í•„ìš” ì‹œ ì—¬ê¸°ì— í›„ë³´ë¥¼ ì¶”ê°€í•˜ì„¸ìš”.\r",
									"const GROUP_ELEM_POOL = [\r",
									"  {g:\"0008\", e:\"103E\"},\r",
									"  {g:\"0018\", e:\"0031\"}\r",
									"];\r",
									"\r",
									"/*** â€œí˜„ì¬ê°’ê³¼ ë‹¤ë¥¸ ê°’â€ì„ ë½‘ëŠ” í—¬í¼ë“¤ ***/\r",
									"function pickOther(arr, cur) {\r",
									"  const set = (arr || []).filter(Boolean);\r",
									"  if (!set.length) return cur;\r",
									"  if (set.length === 1) return set[0];\r",
									"  let candidate = pick(set);\r",
									"  // í˜„ì¬ê°’ê³¼ ë‹¤ë¥¼ ë•Œê¹Œì§€ ìµœëŒ€ 10íšŒ ì‹œë„\r",
									"  for (let i=0; i<10 && String(candidate)===String(cur); i++) candidate = pick(set);\r",
									"  return candidate;\r",
									"}\r",
									"function seqFor(mod) {\r",
									"  const lst = CATALOG[mod] || [];\r",
									"  return pickOther(lst, curSeq);\r",
									"}\r",
									"\r",
									"/*** ìë™ íšŒì „ ê·œì¹™ â€” ê¸°ë³¸: â€œê°€ëŠ¥í•˜ë©´ ì „ë¶€ ë°”ê¾¸ê¸°â€ ***/\r",
									"// ì˜µì…˜(í•„ìš” ì‹œ envë¡œ ì œì–´): \r",
									"//   ROTATE_SCOPE = \"same_modality\" | \"any\" (ê¸°ë³¸ any)\r",
									"//   ROTATE_EXACTED = \"toggle\" | \"random\" | \"false\" (ê¸°ë³¸ toggle)\r",
									"const rotateScope = (pm.environment.get(\"ROTATE_SCOPE\") || \"any\").toLowerCase();\r",
									"const rotateExact = (pm.environment.get(\"ROTATE_EXACTED\") || \"toggle\").toLowerCase();\r",
									"\r",
									"let newMod = curMod;\r",
									"if (rotateScope === \"any\") {\r",
									"  newMod = pickOther(MODS, curMod);\r",
									"} else if (rotateScope === \"same_modality\") {\r",
									"  newMod = curMod;\r",
									"}\r",
									"\r",
									"let newSeq = seqFor(newMod);\r",
									"\r",
									"// ê·¸ë£¹/ì—˜ë¦¬ë¨¼íŠ¸ë„ í˜„ì¬ì™€ ë‹¤ë¥¸ ì¡°í•© ì„ íƒ\r",
									"let newGE = pickOther(GROUP_ELEM_POOL.map(x=>`${x.g}:${x.e}`), `${curGrp}:${curElem}`);\r",
									"let [newGrp, newElem] = (newGE||\"\").split(\":\");\r",
									"newGrp  = UP(newGrp || curGrp);\r",
									"newElem = UP(newElem || curElem);\r",
									"\r",
									"// tagValue ìë™ ìƒì„± (ëª¨ë‹¬ë¦¬í‹°ì— ë”°ë¼ ì ‘ë‘ì‚¬ ë³€ê²½)\r",
									"let newVal = pm.environment.get(\"NEW_TAG_VALUE\"); // ìˆìœ¼ë©´ ìš°ì„ \r",
									"if (!newVal) {\r",
									"  const prefix = (newMod === \"MRI\") ? \"flair\" : \"pet\";\r",
									"  newVal = `${prefix}_${1000 + rand(9000)}`;\r",
									"}\r",
									"\r",
									"// exacted ìë™\r",
									"let newExact;\r",
									"if (rotateExact === \"toggle\") newExact = !asBool(pm.environment.get(\"EXPECT_EXACTED\"), false);\r",
									"else if (rotateExact === \"random\") newExact = !!rand(2);\r",
									"else newExact = false; // \"false\" ë˜ëŠ” ê¸°íƒ€ â†’ false\r",
									"\r",
									"/*** URL/Body êµ¬ì„± ***/\r",
									"const baseUrl = pm.variables.replaceIn(\"{{baseUrl}}\");\r",
									"pm.request.url = `${baseUrl}/app/api/analysis/settings/dicom/${dicomId}`;\r",
									"pm.request.body.update({\r",
									"  mode: \"raw\",\r",
									"  raw: JSON.stringify({\r",
									"    tagModalityTypeCode: newMod,\r",
									"    sequenceOrTracerTypeCode: newSeq,\r",
									"    groupNumber: newGrp,\r",
									"    elementNumber: newElem,\r",
									"    tagValue: newVal,\r",
									"    exacted: newExact\r",
									"  }, null, 2)\r",
									"});\r",
									"\r",
									"/*** ê¸°ëŒ€ê°’ ì €ì¥ (Tests í™•ì¸ìš©) ***/\r",
									"pm.environment.set(\"EXPECT_TAG_MODALITY\", newMod);\r",
									"pm.environment.set(\"EXPECT_SEQ_OR_TRACER\", newSeq);\r",
									"pm.environment.set(\"EXPECT_TAG_GROUP\", newGrp);\r",
									"pm.environment.set(\"EXPECT_TAG_ELEMENT\", newElem);\r",
									"pm.environment.set(\"EXPECT_TAG_VALUE\", newVal);\r",
									"pm.environment.set(\"EXPECT_EXACTED\", String(newExact));\r",
									"\r",
									"console.log(\"[AUTO ROTATE PUT] id=\", dicomId, \"â†’\", {\r",
									"  modality:newMod, seq:newSeq, group:newGrp, element:newElem, tagValue:newVal, exacted:newExact\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"HTTP 200\", () => pm.response.to.have.status(200));\r",
									"\r",
									"let j={}; try{ j=pm.response.json(); }catch(e){ j={}; }\r",
									"const r = j?.result ?? j ?? {};\r",
									"\r",
									"function UP(x){ return (x==null) ? \"\" : String(x).toUpperCase(); }\r",
									"\r",
									"const exp = {\r",
									"  modality: pm.environment.get(\"EXPECT_TAG_MODALITY\"),\r",
									"  seq: pm.environment.get(\"EXPECT_SEQ_OR_TRACER\"),\r",
									"  group: pm.environment.get(\"EXPECT_TAG_GROUP\"),\r",
									"  elem: pm.environment.get(\"EXPECT_TAG_ELEMENT\"),\r",
									"  value: pm.environment.get(\"EXPECT_TAG_VALUE\"),\r",
									"  exact: String(pm.environment.get(\"EXPECT_EXACTED\"))\r",
									"};\r",
									"\r",
									"if (r && typeof r === \"object\") {\r",
									"  // tagValue / exacted\r",
									"  if (typeof r.tagValue !== \"undefined\")\r",
									"    pm.test(\"tagValue updated\", () => pm.expect(String(r.tagValue)).to.eql(String(exp.value)));\r",
									"  if (typeof r.exacted !== \"undefined\")\r",
									"    pm.test(\"exacted updated\", () => pm.expect(String(!!r.exacted)).to.eql(exp.exact));\r",
									"\r",
									"  // ëª¨ë‹¬ë¦¬í‹°/ì‹œí€€ìŠ¤/ê·¸ë£¹/ì—˜ë¦¬ë¨¼íŠ¸ (ì¼ë¶€ ì„œë²„ëŠ” í‚¤ í•„ë“œ ë³€ê²½ì„ ê¸ˆì§€í•¨)\r",
									"  if (typeof r.tagModalityTypeCode !== \"undefined\")\r",
									"    pm.test(\"modality updated (or immutable)\", () => pm.expect(String(r.tagModalityTypeCode)).to.eql(String(exp.modality)));\r",
									"  if (typeof r.sequenceOrTracerTypeCode !== \"undefined\")\r",
									"    pm.test(\"sequence/tracer updated (or immutable)\", () => pm.expect(String(r.sequenceOrTracerTypeCode)).to.eql(String(exp.seq)));\r",
									"  if (typeof r.groupNumber !== \"undefined\")\r",
									"    pm.test(\"groupNumber updated (or immutable)\", () => pm.expect(UP(r.groupNumber)).to.eql(UP(exp.group)));\r",
									"  if (typeof r.elementNumber !== \"undefined\")\r",
									"    pm.test(\"elementNumber updated (or immutable)\", () => pm.expect(UP(r.elementNumber)).to.eql(UP(exp.elem)));\r",
									"\r",
									"  // ë³€ê²½ ë¶ˆê°€(immutable) íƒì§€ ì•ˆë‚´\r",
									"  const immutables = [];\r",
									"  if (String(r.tagModalityTypeCode) !== String(exp.modality)) immutables.push(\"tagModalityTypeCode\");\r",
									"  if (String(r.sequenceOrTracerTypeCode) !== String(exp.seq)) immutables.push(\"sequenceOrTracerTypeCode\");\r",
									"  if (UP(r.groupNumber) !== UP(exp.group)) immutables.push(\"groupNumber\");\r",
									"  if (UP(r.elementNumber) !== UP(exp.elem)) immutables.push(\"elementNumber\");\r",
									"\r",
									"  if (immutables.length) {\r",
									"    console.warn(\"[NOTICE] ì„œë²„ê°€ í‚¤ í•„ë“œ ë³€ê²½ì„ í—ˆìš©í•˜ì§€ ì•ŠëŠ” ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤:\", immutables);\r",
									"    console.warn(\"í•„ìš” ì‹œ: ìƒˆ í–‰ ìƒì„±(POST) â†’ ê¸°ì¡´ í–‰ ì‚­ì œ(DELETE) ì „ëµì„ ê³ ë ¤í•˜ì„¸ìš”.\");\r",
									"  }\r",
									"}\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/app/api/analysis/settings/dicom/{{DICOM_ID}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"analysis",
								"settings",
								"dicom",
								"{{DICOM_ID}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "DICOM Tag ì„¤ì • ì‚­ì œ",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// --- ê³µí†µ í—¤ë”/ì¸ì¦ ---\r",
									"const t = pm.environment.get(\"access_token\");\r",
									"const c = pm.environment.get(\"cookie_raw\") || \"\";\r",
									"const x = pm.environment.get(\"xsrf_token\") || \"\";\r",
									"if (t) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${t}` });\r",
									"if (c) pm.request.headers.upsert({ key: \"Cookie\", value: c });\r",
									"if (x) pm.request.headers.upsert({ key: \"X-XSRF-TOKEN\", value: x });\r",
									"pm.request.headers.upsert({ key: \"Accept\", value: \"application/json\" });\r",
									"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
									"\r",
									"// --- ì‚­ì œ ëŒ€ìƒ ID ì„ íƒ: dicom_new_id > tag_delete_id ---\r",
									"const delId = String(\r",
									"  pm.environment.get(\"dicom_new_id\") ||\r",
									"  pm.environment.get(\"tag_delete_id\") ||\r",
									"  \"\"\r",
									").trim();\r",
									"\r",
									"// ìš”ì²­/í™˜ê²½ ìŠ¤ì½”í”„ ëª¨ë‘ì— ì„¤ì • (ìŠ¤ì½”í”„ ì¶©ëŒ ë°©ì§€)\r",
									"pm.variables.set(\"TAG_DELETE_ID\", delId);\r",
									"pm.environment.set(\"TAG_DELETE_ID\", delId);\r",
									"\r",
									"// --- ê°€ë“œ: ì—†ìœ¼ë©´ ì¤‘ë‹¨ ---\r",
									"if (!delId) {\r",
									"  console.error(\"[DELETE] TAG_DELETE_IDê°€ ë¹„ì—ˆìŠµë‹ˆë‹¤. dicom_new_id ë˜ëŠ” tag_delete_idë¥¼ ì„¸íŒ…í•˜ì„¸ìš”.\");\r",
									"  pm.test(\"ì‚­ì œ ëŒ€ìƒ IDê°€ ìˆì–´ì•¼ í•¨ (dicom_new_id ë˜ëŠ” tag_delete_id)\", function () {\r",
									"    pm.expect(delId.length, \"dicom_new_id/tag_delete_id ë‘˜ ë‹¤ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.\").to.be.greaterThan(0);\r",
									"  });\r",
									"  // ë‹¤ìŒ ìš”ì²­ ì§„í–‰ì„ ë©ˆì¶”ê³  ì´ ìš”ì²­ë„ ì „ì†¡í•˜ì§€ ì•ŠìŒ\r",
									"  postman.setNextRequest(null);\r",
									"}\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// 1) ìƒíƒœ ì½”ë“œ (ì„±ê³µ ì¼€ì´ìŠ¤)\r",
									"pm.test(\"DELETE ì‘ë‹µ ìƒíƒœ (200/202/204)\", () => {\r",
									"  pm.expect([200,202,204]).to.include(pm.response.code);\r",
									"});\r",
									"\r",
									"// 2) ë¹„ì¦ˆë‹ˆìŠ¤ ì½”ë“œ (204ëŠ” ë°”ë”” ì—†ì„ ìˆ˜ ìˆìŒ)\r",
									"let j = {};\r",
									"try { j = pm.response.json(); } catch(e) {}\r",
									"const biz = j?.code ?? j?.status ?? (pm.response.code === 204 ? 200 : undefined);\r",
									"pm.test(\"Business code ì„±ê³µ(ê¸°ë³¸ 200)\", () => {\r",
									"  pm.expect([200, undefined]).to.include(biz);\r",
									"});\r",
									"\r",
									"// 3) ì‚­ì œ í›„ ê²€ìƒ‰ìœ¼ë¡œ ë¶€ì¬ í™•ì¸\r",
									"function hdrs() {\r",
									"  const h = { \"Accept\":\"application/json\", \"Content-Type\":\"application/json\" };\r",
									"  if (pm.environment.get(\"access_token\")) h[\"Authorization\"] = `Bearer ${pm.environment.get(\"access_token\")}`;\r",
									"  if (pm.environment.get(\"cookie_raw\"))   h[\"Cookie\"]        = pm.environment.get(\"cookie_raw\");\r",
									"  if (pm.environment.get(\"xsrf_token\"))   h[\"X-XSRF-TOKEN\"]  = pm.environment.get(\"xsrf_token\");\r",
									"  return h;\r",
									"}\r",
									"const base = (pm.environment.get(\"baseUrl\") || \"\").replace(/\\/+$/,\"\");\r",
									"const searchUrl = `${base}/app/api/analysis/settings/dicom/search`;\r",
									"const deletedId = Number(pm.variables.get(\"TAG_DELETE_ID\"));\r",
									"const searchBody = JSON.stringify({ requestPageNumber: 1, itemCountPerPage: 100, sortBy: \"id\", order: \"DESC\" });\r",
									"\r",
									"pm.sendRequest({ url: searchUrl, method: \"POST\", header: hdrs(), body: { mode:\"raw\", raw: searchBody } }, (err, res) => {\r",
									"  pm.test(\"ê²€ìƒ‰ ìš”ì²­ ì •ìƒ(HTTP 200)\", () => {\r",
									"    pm.expect(err).to.be.null;\r",
									"    pm.expect(res && res.code).to.eql(200);\r",
									"  });\r",
									"\r",
									"  if (!res || res.code !== 200) return;\r",
									"  let sj={}; try { sj = res.json(); } catch(e) {}\r",
									"  const contents = sj?.result?.dicomTags?.contents ?? [];\r",
									"  const found = Array.isArray(contents) && contents.some(x => Number(x.id) === deletedId);\r",
									"  const softDeleted = Array.isArray(contents) && contents.some(x =>\r",
									"    Number(x.id) === deletedId && (x.deleted === true || x.isDeleted === true || x.active === false)\r",
									"  );\r",
									"\r",
									"  pm.test(`ì‚­ì œëœ ID(${deletedId})ê°€ ê²€ìƒ‰ ê²°ê³¼ì— ì—†ì–´ì•¼ í•¨(ë˜ëŠ” ì†Œí”„íŠ¸ì‚­ì œ í‘œì‹œ)`, () => {\r",
									"    pm.expect(found && !softDeleted, \"ë¦¬ìŠ¤íŠ¸ì— ì—¬ì „íˆ ì¡´ì¬(ì†Œí”„íŠ¸ì‚­ì œ ì•„ë‹˜)\").to.be.false;\r",
									"  });\r",
									"});\r",
									"\r",
									"// 4) ì •ë¦¬(ì„ íƒ)\r",
									"if (String(pm.environment.get(\"dicom_new_id\")) === String(pm.variables.get(\"TAG_DELETE_ID\"))) {\r",
									"  pm.environment.unset(\"dicom_new_id\");\r",
									"  pm.environment.unset(\"NEW_DICOM_TAG_BODY\");\r",
									"  pm.environment.unset(\"NEW_DICOM_TAG_EXPECT_VALUE\");\r",
									"}\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "{{access_token}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/app/api/analysis/settings/dicom/{{TAG_DELETE_ID}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"analysis",
								"settings",
								"dicom",
								"{{TAG_DELETE_ID}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "PET ë¶„ì„ ì„¤ì • ì¡°íšŒ",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"HTTP 200\", () => pm.response.to.have.status(200));\r",
									"let j={}; try{ j=pm.response.json(); }catch(e){ j={}; }\r",
									"\r",
									"const catalogs = j?.result?.petSettingCatalogs || {};\r",
									"const rows = j?.result?.petSettings?.contents || j?.result?.items || j?.result || [];\r",
									"\r",
									"pm.test(\"rows exist\", () => pm.expect(Array.isArray(rows) && rows.length>0).to.eql(true));\r",
									"\r",
									"// ì¹´íƒˆë¡œê·¸ ì €ì¥(ì„ íƒ)\r",
									"pm.environment.set(\"PET_CATALOG_TYPES\", JSON.stringify(catalogs.petTypes || []));\r",
									"pm.environment.set(\"PET_CATALOG_TRACERS_AMY\", JSON.stringify(catalogs.amyloidTracers || []));\r",
									"pm.environment.set(\"PET_CATALOG_TRACERS_TAU\", JSON.stringify(catalogs.tauTracers || []));\r",
									"pm.environment.set(\"PET_CATALOG_REF_REGIONS\", JSON.stringify(catalogs.petRefRegions || []));\r",
									"pm.environment.set(\"PET_CATALOG_TAU_CUTOFFS\", JSON.stringify(catalogs.tauSuvrCutOffs || []));\r",
									"pm.environment.set(\"PET_CATALOG_COLOR_MAPS\", JSON.stringify(catalogs.colorMaps || []));\r",
									"pm.environment.set(\"PET_CATALOG_RANGE_TYPES\", JSON.stringify(catalogs.rangeSelectTypes || []));\r",
									"\r",
									"// í•„í„° ë„ê³  ì „ì²´ì—ì„œ AMY/TAU í•˜ë‚˜ì”© ì°¾ê¸°\r",
									"const findId = (r)=> r && (r.id || r.presetId || r.uid);\r",
									"const amyRow = rows.find(r => String(r.petTypeCode)===\"AMYLOID\");\r",
									"const tauRow = rows.find(r => String(r.petTypeCode)===\"TAU\");\r",
									"\r",
									"const amyId = findId(amyRow) || \"\";\r",
									"const tauId = findId(tauRow) || \"\";\r",
									"if (amyId) pm.environment.set(\"PET_ID_AMY\", String(amyId));\r",
									"if (tauId) pm.environment.set(\"PET_ID_TAU\", String(tauId));\r",
									"\r",
									"// ê¸°ë³¸ PET_IDë„ í•˜ë‚˜ ì €ì¥(ì—†ìœ¼ë©´ ë¹ˆ ê°’ ìœ ì§€)\r",
									"const defRow = amyRow || tauRow || rows[0] || {};\r",
									"const defId  = findId(defRow) || \"\";\r",
									"if (defId) {\r",
									"  pm.environment.set(\"PET_ID\", String(defId));\r",
									"  pm.environment.set(\"PET_TYPE\", String(defRow.petTypeCode || \"\"));\r",
									"  pm.environment.set(\"TRACER\", String(defRow.tracerTypeCode || \"\"));\r",
									"  pm.environment.set(\"REF_REGION\", String(defRow.referenceRegionCode || \"\"));\r",
									"  pm.environment.set(\"RANGE_TYPE\", String(defRow.rangeSelectType || \"\"));\r",
									"}\r",
									"\r",
									"console.log(\"[SEED][PET] total rows=\", rows.length,\r",
									"            \"AMY_ID=\", amyId || \"(none)\",\r",
									"            \"TAU_ID=\", tauId || \"(none)\",\r",
									"            \"default PET_ID=\", defId || \"(none)\");\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// === Common Pre-request ===\r",
									"const token = pm.environment.get(\"access_token\");\r",
									"const cookieRaw = pm.environment.get(\"cookie_raw\") || \"\";\r",
									"const xsrf = pm.environment.get(\"xsrf_token\") || \"\";\r",
									"\r",
									"// Bearer ë°©ì‹ì´ë©´:\r",
									"if (token) {\r",
									"  pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
									"}\r",
									"\r",
									"// ì„¸ì…˜/CSRF ë°©ì‹ì´ë©´:\r",
									"if (cookieRaw) {\r",
									"  pm.request.headers.upsert({ key: \"Cookie\", value: cookieRaw });\r",
									"}\r",
									"if (xsrf) {\r",
									"  pm.request.headers.upsert({ key: \"X-XSRF-TOKEN\", value: xsrf });\r",
									"}\r",
									"\r",
									"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
									"pm.request.headers.upsert({ key: \"Accept\", value: \"application/json\" });\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "{{access_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"itemCountPerPage\": 10,\r\n  \"order\": \"DESC\",\r\n  \"requestPageNumber\": 1,\r\n  \"sortBy\": \"id\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/app/api/analysis/settings/pet/search",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"analysis",
								"settings",
								"pet",
								"search"
							]
						}
					},
					"response": []
				},
				{
					"name": "PET ë¶„ì„ ì„¤ì • ì¶”ê°€",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// ===== helpers =====\r",
									"const J = s => { try { return JSON.parse(s); } catch(e){ return null; } };\r",
									"const pick = arr => (Array.isArray(arr) && arr.length) ? arr[Math.floor(Math.random()*arr.length)] : null;\r",
									"const randint = (a,b)=>Math.floor(Math.random()*(b-a+1))+a;\r",
									"const randbool = (p=0.5)=>Math.random()<p;\r",
									"const randfloat = (min,max,dp=1)=> Number((Math.random()*(max-min)+min).toFixed(dp));\r",
									"const clamp = (v,a,b)=> Math.max(a, Math.min(b, v));\r",
									"const uniqPairs = list => {\r",
									"  const seen = new Set();\r",
									"  return list.filter(x=>{\r",
									"    const k = `${x.petTypeCode}::${x.tracerTypeCode}`;\r",
									"    if (seen.has(k)) return false; seen.add(k); return true;\r",
									"  });\r",
									"};\r",
									"\r",
									"// ===== headers =====\r",
									"const token = pm.environment.get(\"access_token\");\r",
									"if (token) pm.request.headers.upsert({ key:\"Authorization\", value:`Bearer ${token}` });\r",
									"pm.request.headers.upsert({ key:\"Accept\", value:\"application/json\" });\r",
									"pm.request.headers.upsert({ key:\"Content-Type\", value:\"application/json\" });\r",
									"\r",
									"// ===== 1) ì¹´íƒˆë¡œê·¸ + ê¸°ì¡´ í”„ë¦¬ì…‹ ì¡°íšŒ =====\r",
									"function fetchCats(cb){\r",
									"  pm.sendRequest({\r",
									"    url: pm.environment.get(\"baseUrl\") + \"/app/api/analysis/settings/pet/search\",\r",
									"    method: \"POST\",\r",
									"    header: { \"Content-Type\":\"application/json\", \"Accept\":\"application/json\", ...(token?{Authorization:`Bearer ${token}`}:{}) },\r",
									"    body: { mode:\"raw\", raw: JSON.stringify({ requestPageNumber:1, itemCountPerPage:500, sortBy:\"id\", order:\"DESC\" }) }\r",
									"  }, (err,res)=>{\r",
									"    if(err || !res) return cb(new Error(\"pet/search ì‹¤íŒ¨\"));\r",
									"    const j = J(res.text())||{};\r",
									"    const cats = j?.result?.petSettingCatalogs || {};\r",
									"    const rows = j?.result?.petSettings?.contents || [];\r",
									"    pm.environment.set(\"pet_catalogs\", JSON.stringify(cats));\r",
									"    pm.environment.set(\"pet_last_list\", JSON.stringify(rows));\r",
									"    cb(null, {cats, rows});\r",
									"  });\r",
									"}\r",
									"\r",
									"// ===== 2) ê³µí†µ íŒŒë¼ë¯¸í„° ìƒì„± (type/Tracer ì œì™¸) =====\r",
									"function buildCommon(cats){\r",
									"  const refs   = (cats.petRefRegions||[]).map(x=>x.code);\r",
									"  const cmaps  = (cats.colorMaps||[]).map(x=>x.code);\r",
									"  const ranges = (cats.rangeSelectTypes||[]).map(x=>x.code);\r",
									"  const tauCutCodes = (cats.tauSuvrCutOffs||[]).map(x=>x.code);\r",
									"\r",
									"  // reference region\r",
									"  let ref = pm.environment.get(\"PET_ref_region_code\") || pick(refs) || \"306\";\r",
									"\r",
									"  // PVC / PSF\r",
									"  let pvc = pm.environment.get(\"PET_pvc_used\");\r",
									"  pvc = (pvc==null||pvc===\"\") ? randbool(0.7) : (String(pvc).toLowerCase()===\"true\");\r",
									"  let psf = pm.environment.get(\"PET_psf\");\r",
									"  psf = (psf==null||psf===\"\") ? randfloat(0.1,10,1) : Number(psf);\r",
									"  psf = Number.isFinite(psf) ? clamp(psf, 0.1, 10) : 5;\r",
									"\r",
									"  // Colormap\r",
									"  let cmap = (pm.environment.get(\"PET_colormap\")||\"\").toUpperCase();\r",
									"  if (!cmap) cmap = pick(cmaps) || \"GRAYSCALE\";\r",
									"\r",
									"  // Range type + range\r",
									"  let rtype = (pm.environment.get(\"PET_range_type\")||\"\").toUpperCase();\r",
									"  if (!rtype) rtype = pick(ranges) || \"CUSTOM\";\r",
									"  let minV = Number(pm.environment.get(\"PET_range_min\"));\r",
									"  let maxV = Number(pm.environment.get(\"PET_range_max\"));\r",
									"  if (rtype===\"CUSTOM\") {\r",
									"    if (!Number.isFinite(minV) || !Number.isFinite(maxV) || minV >= maxV) {\r",
									"      minV = randfloat(0, 4, 1);\r",
									"      maxV = randfloat(minV+0.5, Math.min(10, minV+5), 1);\r",
									"    }\r",
									"  }\r",
									"\r",
									"  // Opacity\r",
									"  let opPet = pm.environment.get(\"PET_opacity_pet\");  opPet = clamp(Number(opPet ?? randint(30,80)), 0, 100);\r",
									"  let opBg  = pm.environment.get(\"PET_opacity_bg\");   opBg  = clamp(Number(opBg  ?? randint(80,100)), 0, 100);\r",
									"\r",
									"  // TAU cutoff ê¸°ë³¸ ë§µ (í•„ìš” ì‹œ)\r",
									"  const envMap = J(pm.environment.get(\"PET_tau_cutoffs_map\") || \"null\") || {};\r",
									"  const tauCutoffValues = (tauCutCodes||[]).map(code => {\r",
									"    let v = envMap[code];\r",
									"    if (v == null) v = randfloat(0, 999.99, 2);\r",
									"    v = Number.isFinite(Number(v)) ? Number(v) : 0;\r",
									"    return { code, value: Number(clamp(v,0,999.99).toFixed(2)) };\r",
									"  });\r",
									"\r",
									"  const common = {\r",
									"    referenceRegionCode: ref,\r",
									"    pvcUsed: pvc,\r",
									"    ...(pvc ? { psfValue: psf } : {}),\r",
									"    colorMapCode: cmap,\r",
									"    rangeSelectType: rtype,\r",
									"    ...(rtype===\"CUSTOM\" ? { colorRangeMin: minV, colorRangeMax: maxV } : {}),\r",
									"    opacityPet: opPet,\r",
									"    opacityBackground: opBg,\r",
									"    _tauCutoffValues: tauCutoffValues   // ë‚´ë¶€ìš©(ì¡°ë¦½ ì‹œ TAUì—ë§Œ í¬í•¨)\r",
									"  };\r",
									"  return common;\r",
									"}\r",
									"\r",
									"// ===== 3) í›„ë³´ tracer ëª©ë¡ ë§Œë“¤ê¸° (ì‚¬ìš©ì¤‘ ì œì™¸ + êµì°¨ ìœ í˜•ê¹Œì§€) =====\r",
									"function makeCandidates(cats, rows){\r",
									"  const petTypes = (cats.petTypes||[]).map(x=>x.code);            // [\"AMYLOID\",\"TAU\",...]\r",
									"  const amyPool  = (cats.amyloidTracers||[]).map(x=>x.code);\r",
									"  const tauPool  = (cats.tauTracers||[]).map(x=>x.code);\r",
									"\r",
									"  const usedAmy = new Set(rows.filter(r=>r.petTypeCode===\"AMYLOID\").map(r=>r.tracerTypeCode));\r",
									"  const usedTau = new Set(rows.filter(r=>r.petTypeCode===\"TAU\").map(r=>r.tracerTypeCode));\r",
									"\r",
									"  const forceRandom = String(pm.environment.get(\"PET_force_random_type\")||\"false\").toLowerCase()===\"true\";\r",
									"  const petTypeEnv  = (pm.environment.get(\"PET_type\")||\"\").toUpperCase();\r",
									"  const pref = (!petTypeEnv || petTypeEnv===\"RANDOM\" || forceRandom)\r",
									"    ? (Math.random() < 0.5 ? [\"AMYLOID\",\"TAU\"] : [\"TAU\",\"AMYLOID\"])\r",
									"    : [petTypeEnv, petTypeEnv===\"AMYLOID\"?\"TAU\":\"AMYLOID\"];\r",
									"\r",
									"  // env tracerê°€ ìˆìœ¼ë©´ ì œì¼ ì•ì— ë‘ë˜, ì‚¬ìš©ì¤‘ì´ë©´ ì œì™¸\r",
									"  let tracerEnv = (pm.environment.get(\"PET_tracer_code\")||\"\").toUpperCase();\r",
									"\r",
									"  const list = [];\r",
									"  for (const t of pref) {\r",
									"    const pool = (t===\"TAU\") ? tauPool : amyPool;\r",
									"    const used = (t===\"TAU\") ? usedTau : usedAmy;\r",
									"    // ìš°ì„ ìˆœìœ„: (envê°€ ìœ íš¨í•˜ê³  ë¯¸ì‚¬ìš©) -> (ë¯¸ì‚¬ìš©) -> (ì „ì²´ ì¤‘ ëœë¤)\r",
									"    if (pool.includes(tracerEnv) && !used.has(tracerEnv)) {\r",
									"      list.push({ petTypeCode:t, tracerTypeCode:tracerEnv });\r",
									"    }\r",
									"    pool.forEach(c => { if (!used.has(c)) list.push({ petTypeCode:t, tracerTypeCode:c }); });\r",
									"  }\r",
									"\r",
									"  // ì „ë¶€ ì‚¬ìš©ì¤‘ì´ë©´, ì¤‘ë³µì„ í—ˆìš©í•´ì„œë¼ë„ ìƒì„± ì‹œë„í•  ìˆ˜ ìˆë„ë¡ ì „ì²´ poolë„ í›„ë³´ë¡œ ì¶”ê°€\r",
									"  if (list.length === 0) {\r",
									"    amyPool.forEach(c => list.push({ petTypeCode:\"AMYLOID\", tracerTypeCode:c }));\r",
									"    tauPool.forEach(c => list.push({ petTypeCode:\"TAU\", tracerTypeCode:c }));\r",
									"  }\r",
									"\r",
									"  return uniqPairs(list);\r",
									"}\r",
									"\r",
									"// ===== 4) ë³¸ë¬¸ ì¡°ë¦½ + í›„ë³´/ê³µí†µ ì €ì¥ =====\r",
									"function applyFirstAndSave(common, candidates){\r",
									"  if (!candidates.length) throw new Error(\"[PET] ì„ íƒ ê°€ëŠ¥í•œ tracer í›„ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.\");\r",
									"  const [first, ...rest] = candidates;\r",
									"\r",
									"  const base = {\r",
									"    petTypeCode: first.petTypeCode,\r",
									"    tracerTypeCode: first.tracerTypeCode,\r",
									"    referenceRegionCode: common.referenceRegionCode,\r",
									"    pvcUsed: common.pvcUsed,\r",
									"    ...(common.pvcUsed ? { psfValue: common.psfValue } : {}),\r",
									"    colorMapCode: common.colorMapCode,\r",
									"    rangeSelectType: common.rangeSelectType,\r",
									"    ...(common.rangeSelectType===\"CUSTOM\" ? { colorRangeMin: common.colorRangeMin, colorRangeMax: common.colorRangeMax } : {}),\r",
									"    opacityPet: common.opacityPet,\r",
									"    opacityBackground: common.opacityBackground,\r",
									"  };\r",
									"  if (first.petTypeCode === \"TAU\") base.tauSuvrCutOffValues = common._tauCutoffValues;\r",
									"\r",
									"  pm.request.body.update(JSON.stringify(base, null, 2));\r",
									"\r",
									"  pm.environment.set(\"PET_candidates\", JSON.stringify(rest));  // ë‚¨ì€ í›„ë³´\r",
									"  pm.environment.set(\"PET_common\", JSON.stringify(common));   // ê³µí†µê°’ ì €ì¥\r",
									"  pm.environment.set(\"PET_retry_left\", \"3\");\r",
									"  pm.environment.set(\"PET_effective_type\", first.petTypeCode);\r",
									"  pm.environment.set(\"PET_effective_tracer\", first.tracerTypeCode);\r",
									"}\r",
									"\r",
									"// ===== ì‹¤í–‰ =====\r",
									"fetchCats((e,{cats,rows})=>{\r",
									"  if (e) throw e;\r",
									"  const common = buildCommon(cats);\r",
									"  const cands  = makeCandidates(cats, rows);\r",
									"  applyFirstAndSave(common, cands);\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// ====== ê³µí†µ íŒŒì„œ ======\r",
									"const J = s => { try { return JSON.parse(s); } catch(e){ return null; } };\r",
									"\r",
									"// ====== ì‘ë‹µ ê¸°ë³¸ ê²€ì‚¬ ======\r",
									"let j = J(pm.response.text()) || {};\r",
									"const httpOk = [200,201].includes(pm.response.code);\r",
									"const bizOk  = j?.code == null ? httpOk : Number(j.code) === 200;\r",
									"const createdId = j?.result?.id;\r",
									"\r",
									"pm.test(\"HTTP 200/201\", () => pm.expect(httpOk).to.eql(true));\r",
									"pm.test(\"Service code == 200 (if exists)\", () => pm.expect(bizOk).to.eql(true));\r",
									"\r",
									"let __earlySuccess = false;\r",
									"\r",
									"// ====== ì„±ê³µì´ë©´ ì¢…ë£Œ ì²˜ë¦¬(ë‹¨, return í•˜ì§€ ì•ŠìŒ!) ======\r",
									"if (httpOk && bizOk && typeof createdId === \"number\") {\r",
									"  pm.test(\"created id exists\", () => pm.expect(createdId).to.be.a(\"number\"));\r",
									"  pm.environment.set(\"pet_new_id\", String(createdId));\r",
									"  console.log(\"[PET create] âœ” success id=\", createdId);\r",
									"  __earlySuccess = true; // â† ì„±ê³µ í”Œë˜ê·¸ë§Œ ì„¸ìš°ê³  ì•„ë˜ ì§‘ê³„ëŠ” ê³„ì† ì§„í–‰\r",
									"}\r",
									"\r",
									"// ====== ì‹¤íŒ¨ ì‹œ: ì¤‘ë³µ/ì´ë¯¸ ì¡´ì¬/409/400 â†’ ìë™ ì¬ì‹œë„ ======\r",
									"function shouldRetry() {\r",
									"  const msg = (j?.message || \"\").toLowerCase();\r",
									"  if (pm.response.code === 409) return true;\r",
									"  if (pm.response.code === 400 && /exist|already/.test(msg)) return true;\r",
									"  if (/already exists|ì´ë¯¸ ì¡´ì¬|duplicate/i.test(pm.response.text())) return true;\r",
									"  return false;\r",
									"}\r",
									"\r",
									"function tryNextCandidate() {\r",
									"  let left = Number(pm.environment.get(\"PET_retry_left\") || \"0\");\r",
									"  let candList = J(pm.environment.get(\"PET_candidates\") || \"[]\") || [];\r",
									"  const common = J(pm.environment.get(\"PET_common\") || \"{}\") || {};\r",
									"\r",
									"  if (left <= 0 || !candList.length) {\r",
									"    console.log(\"[PET create] âœ– no more candidates or retries\");\r",
									"    pm.test(\"ì¬ì‹œë„ ì†Œì§„\", () => pm.expect(true).to.eql(false)); // í‘œì‹œìš©\r",
									"    return;\r",
									"  }\r",
									"\r",
									"  const next = candList.shift();\r",
									"  left -= 1;\r",
									"\r",
									"  // ë³¸ë¬¸ ì¬ì¡°ë¦½\r",
									"  const body = {\r",
									"    petTypeCode: next.petTypeCode,\r",
									"    tracerTypeCode: next.tracerTypeCode,\r",
									"    referenceRegionCode: common.referenceRegionCode,\r",
									"    pvcUsed: common.pvcUsed,\r",
									"    ...(common.pvcUsed ? { psfValue: common.psfValue } : {}),\r",
									"    colorMapCode: common.colorMapCode,\r",
									"    rangeSelectType: common.rangeSelectType,\r",
									"    ...(common.rangeSelectType===\"CUSTOM\" ? { colorRangeMin: common.colorRangeMin, colorRangeMax: common.colorRangeMax } : {}),\r",
									"    opacityPet: common.opacityPet,\r",
									"    opacityBackground: common.opacityBackground,\r",
									"    ...(next.petTypeCode===\"TAU\" ? { tauSuvrCutOffValues: common._tauCutoffValues } : {})\r",
									"  };\r",
									"\r",
									"  // ìƒíƒœ ì €ì¥\r",
									"  pm.environment.set(\"PET_candidates\", JSON.stringify(candList));\r",
									"  pm.environment.set(\"PET_retry_left\", String(left));\r",
									"  pm.environment.set(\"PET_effective_type\", next.petTypeCode);\r",
									"  pm.environment.set(\"PET_effective_tracer\", next.tracerTypeCode);\r",
									"\r",
									"  const url = pm.environment.get(\"baseUrl\") + \"/app/api/analysis/settings/pet\";\r",
									"  const headers = {\r",
									"    \"Content-Type\":\"application/json\",\r",
									"    \"Accept\":\"application/json\",\r",
									"    ...(pm.environment.get(\"access_token\") ? { \"Authorization\": `Bearer ${pm.environment.get(\"access_token\")}` } : {})\r",
									"  };\r",
									"\r",
									"  console.log(`[PET create] â†» retry (${3-left}/3) with`, next);\r",
									"\r",
									"  pm.sendRequest({ url, method:\"POST\", header: headers, body:{mode:\"raw\", raw: JSON.stringify(body)} }, (err, res) => {\r",
									"    if (err || !res) {\r",
									"      console.log(\"[PET create] retry error:\", err);\r",
									"      return tryNextCandidate();\r",
									"    }\r",
									"    const jj = J(res.text()) || {};\r",
									"    const ok = [200,201].includes(res.code) && (jj?.code == null ? true : Number(jj.code)===200) && typeof jj?.result?.id === \"number\";\r",
									"\r",
									"    pm.test(`ì¬ì‹œë„ ì‘ë‹µ (${res.code})`, () => pm.expect([200,201]).to.include(res.code));\r",
									"    if (ok) {\r",
									"      pm.test(\"ì¬ì‹œë„ ì„±ê³µ - created id exists\", () => pm.expect(jj.result.id).to.be.a(\"number\"));\r",
									"      pm.environment.set(\"pet_new_id\", String(jj.result.id));\r",
									"      console.log(\"[PET create] âœ” retry success id=\", jj.result.id);\r",
									"    } else if (shouldRetry()) {\r",
									"      return tryNextCandidate();\r",
									"    } else {\r",
									"      pm.test(\"ì¬ì‹œë„ ì‹¤íŒ¨\", () => pm.expect(true).to.eql(false));\r",
									"      console.log(\"[PET create] âœ– retry failed text=\", res.text());\r",
									"    }\r",
									"  });\r",
									"}\r",
									"\r",
									"// ì„±ê³µì´ ì•„ë‹ˆê³ , ì¬ì‹œë„ ì¡°ê±´ì´ë©´ ì‹œë„\r",
									"if (!__earlySuccess) {\r",
									"  if (shouldRetry()) {\r",
									"    tryNextCandidate();\r",
									"  } else if (!httpOk || !bizOk) {\r",
									"    // ê¸°íƒ€ ì‹¤íŒ¨(ê¶Œí•œ/ê²€ì¦ ë“±)\r",
									"    console.log(\"[PET create] âœ– non-retryable failure:\", pm.response.text());\r",
									"  }\r",
									"}\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // í•­ìƒ ì‹¤í–‰\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/app/api/analysis/settings/pet",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"analysis",
								"settings",
								"pet"
							]
						}
					},
					"response": []
				},
				{
					"name": "PET ë¶„ì„ ì„¤ì • ì¶”ê°€_Abnormal",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// ==== ê³µí†µ í—¤ë”/í† í° ====\r",
									"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
									"pm.request.headers.upsert({ key: \"Accept\", value: \"application/json\" });\r",
									"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
									"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
									"\r",
									"// ==== í™˜ê²½ ====\r",
									"let baseUrl = pm.environment.get(\"baseUrl\");\r",
									"if (!baseUrl) { try { baseUrl = pm.variables.replaceIn(\"{{baseUrl}}\"); } catch(e){} }\r",
									"if (!baseUrl) throw new Error(\"baseUrl í™˜ê²½ë³€ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.\");\r",
									"\r",
									"// ==== ì„ íƒ: UI íƒ€ì… ìš°ì„ ìˆœìœ„(ê¸°ë³¸ TAU ë¨¼ì €) ====\r",
									"// í•„ìš” ì‹œ AMYLOID ë¨¼ì € ë³´ê³  ì‹¶ë‹¤ë©´, ì•„ë˜ ë°°ì—´ì„ [\"AMYLOID\",\"TAU\"]ë¡œ ë°”ê¾¸ì„¸ìš”.\r",
									"const TYPE_ORDER = (pm.environment.get(\"PET_UI_TYPE_ORDER\") || \"TAU,AMYLOID\")\r",
									"  .split(\",\").map(s=>s.trim().toUpperCase()).filter(Boolean);\r",
									"\r",
									"// ==== ìµœì‹  ëª©ë¡ ì¡°íšŒ â†’ UIìŠ¤ëŸ¬ìš´ ì •ë ¬ â†’ ì²« í–‰ ì„ íƒ ====\r",
									"const searchUrl = `${baseUrl}/app/api/analysis/settings/pet/search`;\r",
									"const hdrs = [\r",
									"  { key:\"Content-Type\", value:\"application/json\" },\r",
									"  { key:\"Accept\",       value:\"application/json\" },\r",
									"];\r",
									"if (token) hdrs.push({ key:\"Authorization\", value:`Bearer ${token}` });\r",
									"\r",
									"pm.sendRequest({\r",
									"  url: searchUrl,\r",
									"  method: \"POST\",\r",
									"  header: hdrs,\r",
									"  body: { mode:\"raw\", raw: JSON.stringify({ requestPageNumber:1, itemCountPerPage:500, sortBy:\"id\", order:\"DESC\" }) }\r",
									"}, (err, res) => {\r",
									"  if (err || !res || res.code !== 200) {\r",
									"    // ì¡°íšŒ ì‹¤íŒ¨ ì‹œ ë§ˆì§€ë§‰ í´ë°±(í™˜ê²½ë³€ìˆ˜/ë””í´íŠ¸)\r",
									"    const petTypeCode    = (pm.environment.get(\"PET_DUP_TYPE\")   || pm.environment.get(\"PET_TYPE\") || \"AMYLOID\").toUpperCase();\r",
									"    const tracerTypeCode = (pm.environment.get(\"PET_DUP_TRACER\") || pm.environment.get(\"TRACER\")    || \"C_11_PIB\").toUpperCase();\r",
									"    const refCode        = String(pm.environment.get(\"REF_REGION\") || \"7\");\r",
									"    const rangeType      = (pm.environment.get(\"RANGE_TYPE\") || \"CUSTOM\").toUpperCase();\r",
									"    pm.request.body = { mode:\"raw\", raw: JSON.stringify({\r",
									"      petTypeCode, tracerTypeCode, referenceRegionCode: refCode,\r",
									"      pvcUsed:false, colorMapCode:\"RAINBOW\", rangeSelectType:rangeType,\r",
									"      opacityPet:50, opacityBackground:100, psfValue:null, colorRangeMin:0, colorRangeMax:2.5\r",
									"    })};\r",
									"    pm.variables.set(\"REQ_TRACER_CODE\", tracerTypeCode);\r",
									"    pm.variables.set(\"REQ_PET_TYPE\", petTypeCode);\r",
									"    console.warn(\"[PET PRESET][DUP] search ì‹¤íŒ¨ â†’ env/default ì‚¬ìš©:\", { petTypeCode, tracerTypeCode });\r",
									"    return;\r",
									"  }\r",
									"\r",
									"  // íŒŒì‹±\r",
									"  let j = {};\r",
									"  try { j = res.json(); } catch(e) { j = {}; }\r",
									"  const rows = j?.result?.petSettings?.contents || [];\r",
									"\r",
									"  // UIìŠ¤ëŸ¬ìš´ ì •ë ¬: 1) PET íƒ€ì… ìš°ì„ ìˆœìœ„(TYPE_ORDER) 2) id DESC\r",
									"  const orderIndex = t => {\r",
									"    const idx = TYPE_ORDER.indexOf(String(t||\"\").toUpperCase());\r",
									"    return idx === -1 ? TYPE_ORDER.length : idx;\r",
									"  };\r",
									"  rows.sort((a,b) => {\r",
									"    const t = orderIndex(a.petTypeCode) - orderIndex(b.petTypeCode);\r",
									"    if (t !== 0) return t;\r",
									"    // idê°€ ì—†ìœ¼ë©´ 0 ì·¨ê¸‰\r",
									"    return (Number(b.id||0) - Number(a.id||0));\r",
									"  });\r",
									"\r",
									"  // ì²« í–‰ í”½\r",
									"  const first = rows[0] || {};\r",
									"  let petTypeCode    = String(first.petTypeCode || \"\").toUpperCase();\r",
									"  let tracerTypeCode = String(first.tracerTypeCode || \"\").toUpperCase();\r",
									"  let refCode        = String(first.referenceRegionCode || \"7\");\r",
									"  let rangeType      = String(first.rangeSelectType || \"CUSTOM\").toUpperCase();\r",
									"\r",
									"  // ì•ˆì „ ë³´ì •(í˜¹ì‹œ ë¹ˆ ê°’ì´ë©´ í´ë°±)\r",
									"  if (!petTypeCode)    petTypeCode    = (pm.environment.get(\"PET_TYPE\") || \"AMYLOID\").toUpperCase();\r",
									"  if (!tracerTypeCode) tracerTypeCode = (pm.environment.get(\"TRACER\")    || \"C_11_PIB\").toUpperCase();\r",
									"  if (!refCode)        refCode        = \"7\";\r",
									"  if (!rangeType)      rangeType      = \"CUSTOM\";\r",
									"\r",
									"  // ìµœì¢… payload\r",
									"  const payload = {\r",
									"    petTypeCode, tracerTypeCode,\r",
									"    referenceRegionCode: refCode,\r",
									"    pvcUsed:false, colorMapCode:\"RAINBOW\", rangeSelectType:rangeType,\r",
									"    opacityPet:50, opacityBackground:100, psfValue:null, colorRangeMin:0, colorRangeMax:2.5\r",
									"  };\r",
									"\r",
									"  pm.request.body = { mode:\"raw\", raw: JSON.stringify(payload) };\r",
									"  pm.variables.set(\"REQ_TRACER_CODE\", tracerTypeCode);\r",
									"  pm.variables.set(\"REQ_PET_TYPE\", petTypeCode);\r",
									"\r",
									"  // ë””ë²„ê·¸ ë¡œê·¸: ì‹¤ì œë¡œ ì–´ë–¤ í–‰ì„ ì¼ëŠ”ì§€\r",
									"  console.log(\"[PET PRESET][DUP] using FIRST ROW (sorted):\", {\r",
									"    petTypeCode, tracerTypeCode, id:first.id, refCode, rangeType\r",
									"  });\r",
									"\r",
									"  // ìµœì‹  rowsë¥¼ í™˜ê²½ë³€ìˆ˜ë¡œë„ ìºì‹œ(ì›í•˜ë©´)\r",
									"  pm.environment.set(\"PET_ROWS_JSON\", JSON.stringify(rows));\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// ===== ê³µí†µ íŒŒì„œ/í—¬í¼ =====\r",
									"const J = s => { try { return JSON.parse(s); } catch(e){ return null; } };\r",
									"const text = pm.response.text();\r",
									"const j = J(text) || {};\r",
									"const http = pm.response.code;\r",
									"const svc  = (j && j.code != null) ? Number(j.code) : null;\r",
									"const createdId = j?.result?.id;\r",
									"\r",
									"// ì¤‘ë³µ/ì´ë¯¸ ì¡´ì¬ íƒì§€ (HTTP ì½”ë“œì™€ ë¬´ê´€)\r",
									"function isDuplicateLike() {\r",
									"  const msg = (j?.message || text || \"\").toLowerCase();\r",
									"  if (svc === 7011) return true;\r",
									"  return /\\b(duplicate|already\\s*exist|exists|unique|constraint)\\b/i.test(msg) || /ì¤‘ë³µ|ì´ë¯¸\\s*ì¡´ì¬/.test(msg);\r",
									"}\r",
									"\r",
									"const httpOk = [200,201].includes(http);\r",
									"const bizOk  = svc == null ? httpOk : (svc === 200);\r",
									"const dupOk  = isDuplicateLike();\r",
									"\r",
									"// === 1) ìµœì¢… ì„±ê³µ íŒì • ===\r",
									"// - ì •ìƒ 200/201 ë˜ëŠ” ì„œë¹„ìŠ¤code 200 â†’ ì„±ê³µ\r",
									"// - í˜¹ì€ \"ì¤‘ë³µìœ¼ë¡œ íŒë‹¨\"ë˜ë©´ HTTP 500ì´ì–´ë„ ì„±ê³µ ì²˜ë¦¬\r",
									"pm.test(\"ì„±ê³µ íŒì •(200/201 ë˜ëŠ” 'ì¤‘ë³µ'ì€ ì„±ê³µ ê°„ì£¼)\", () => {\r",
									"  pm.expect(httpOk || bizOk || dupOk, `http=${http}, svc=${svc}, msg=${j?.message}`).to.be.true;\r",
									"});\r",
									"\r",
									"// === 2) ë¡œê·¸ ===\r",
									"if (dupOk) {\r",
									"  console.warn(`[PET PRESET] Duplicate detected â†’ ì„±ê³µ ê°„ì£¼ (http=${http}, svc=${svc}) tracer=${pm.variables.get(\"REQ_TRACER_CODE\")}`);\r",
									"} else if (!(httpOk || bizOk)) {\r",
									"  console.error(\"[PET PRESET] Non-duplicate failure\", { http, svc, msg: j?.message, raw: text });\r",
									"}\r",
									"\r",
									"// === 3) ìƒì„± ì„±ê³µ ì‹œ id í™•ì¸ ===\r",
									"if (!dupOk && (httpOk || bizOk) && typeof createdId === \"number\") {\r",
									"  pm.test(\"created id exists\", () => pm.expect(createdId).to.be.a(\"number\"));\r",
									"  pm.environment.set(\"pet_new_id\", String(createdId));\r",
									"}\r",
									"\r",
									"// === 4) (ì„ íƒ) ì¤‘ë³µì¼ ë•Œ ì‹¤ì œë¡œ ì¶”ê°€ë˜ì§€ ì•Šì•˜ëŠ”ì§€ ê²€ì¦ (GET ìš°ì„ , ì‹¤íŒ¨ ì‹œ ìƒëµ/ìŠ¤í‚µ) ===\r",
									"(function verifyNoDuplicateWhenDupOk(){\r",
									"  if (!dupOk) return;\r",
									"  const listUrl = pm.variables.get(\"PRESET_LIST_URL\") || \"\";\r",
									"  const tracer  = (pm.variables.get(\"REQ_TRACER_CODE\") || \"\").trim().toUpperCase();\r",
									"  if (!listUrl || !tracer) return;\r",
									"\r",
									"  const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
									"  const headers = token ? { Authorization: `Bearer ${token}` } : {};\r",
									"\r",
									"  pm.sendRequest({ url: listUrl, method: \"GET\", header: headers }, (err, res) => {\r",
									"    pm.test(\"ì¤‘ë³µ ì‹œ ì‹¤ì œ ì¶”ê°€ë˜ì§€ ì•ŠìŒ(í•´ë‹¹ tracer â‰¤ 1) [GET]\", () => {\r",
									"      if (err || !res || res.code !== 200) {\r",
									"        pm.expect(true, \"list fetch error or non-200 â†’ skip\").to.be.true; \r",
									"        return;\r",
									"      }\r",
									"      let arr=[]; try {\r",
									"        const jj = res.json();\r",
									"        if (Array.isArray(jj)) arr=jj;\r",
									"        else if (Array.isArray(jj?.result)) arr=jj.result;\r",
									"        else if (Array.isArray(jj?.result?.contents)) arr=jj.result.contents;\r",
									"        else if (Array.isArray(jj?.contents)) arr=jj.contents;\r",
									"      } catch(e) {}\r",
									"      const count = arr.filter(x => String(x?.tracerTypeCode || \"\").toUpperCase() === tracer).length;\r",
									"      pm.expect(count, `tracer='${tracer}' count`).to.be.at.most(1);\r",
									"    });\r",
									"  });\r",
									"})();\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/app/api/analysis/settings/pet",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"analysis",
								"settings",
								"pet"
							]
						}
					},
					"response": []
				},
				{
					"name": "PET ë¶„ì„ ì„¤ì • ìˆ˜ì •",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"/*** === Common Pre-request === ***/\r",
									"const token = pm.environment.get(\"access_token\");\r",
									"const cookieRaw = pm.environment.get(\"cookie_raw\") || \"\";\r",
									"const xsrf = pm.environment.get(\"xsrf_token\") || \"\";\r",
									"\r",
									"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
									"if (cookieRaw) pm.request.headers.upsert({ key: \"Cookie\", value: cookieRaw });\r",
									"if (xsrf) pm.request.headers.upsert({ key: \"X-XSRF-TOKEN\", value: xsrf });\r",
									"\r",
									"pm.request.headers.upsert({ key: \"Accept\", \"value\": \"application/json\" });\r",
									"pm.request.headers.upsert({ key: \"Content-Type\", \"value\": \"application/json\" });\r",
									"\r",
									"/*** === Utils === ***/\r",
									"const rand = (n)=>Math.floor(Math.random()*n);\r",
									"const pick = (arr)=>arr[Math.max(0, rand(arr.length))];\r",
									"const asBool = (v,d=false)=> (v==null ? d : String(v).toLowerCase()===\"true\");\r",
									"const toNum = (v, d=null)=> (v==null || v===\"\" ? d : Number(v));\r",
									"function parseJSONEnv(key, def=[]) { try { return JSON.parse(pm.environment.get(key) || \"\"); } catch { return def; } }\r",
									"function clamp(x, lo, hi){ return Math.min(Math.max(x, lo), hi); }\r",
									"function pickOther(arr, cur) { const s=(arr||[]).filter(Boolean); if(!s.length) return cur; if(s.length===1) return s[0]; let c=pick(s); for(let i=0;i<10&&String(c)===String(cur);i++) c=pick(s); return c; }\r",
									"\r",
									"/*** === Catalog / Current (from search step) === ***/\r",
									"const curType   = pm.environment.get(\"PET_TYPE\")  || \"AMYLOID\";\r",
									"const curTracer = pm.environment.get(\"TRACER\")    || \"F_18_FLUTEMETAMOL\";\r",
									"const curRef    = pm.environment.get(\"REF_REGION\")|| \"31\";\r",
									"const curRangeT = pm.environment.get(\"RANGE_TYPE\")|| \"AUTO\";\r",
									"\r",
									"const catTypes = parseJSONEnv(\"PET_CATALOG_TYPES\", []);\r",
									"const catAmy   = parseJSONEnv(\"PET_CATALOG_TRACERS_AMY\", []);\r",
									"const catTau   = parseJSONEnv(\"PET_CATALOG_TRACERS_TAU\", []);\r",
									"const catRefs  = parseJSONEnv(\"PET_CATALOG_REF_REGIONS\", []);\r",
									"const catMaps  = parseJSONEnv(\"PET_CATALOG_COLOR_MAPS\", []);\r",
									"const catRange = parseJSONEnv(\"PET_CATALOG_RANGE_TYPES\", []);\r",
									"const catCut   = parseJSONEnv(\"PET_CATALOG_TAU_CUTOFFS\", []);\r",
									"\r",
									"const TYPES   = (catTypes.length ? catTypes.map(x=>x.code) : [\"AMYLOID\",\"TAU\"]);\r",
									"const TRACERS = {\r",
									"  AMYLOID: (catAmy.length ? catAmy.map(x=>x.code) : [\"F_18_FLUTEMETAMOL\",\"F_18_FLORBETABEN\",\"F_18_FLORBETAPIR\",\"F_18_FLORAPRONOL\",\"C_11_PIB\",\"F_18_NAV4694\"]),\r",
									"  TAU:     (catTau.length ? catTau.map(x=>x.code) : [\"F_18_FLORTAUCIPIR\",\"F_18_PI_2620\",\"F_18_MK_6240\"])\r",
									"};\r",
									"const REFS   = (catRefs.length ? catRefs.map(x=>x.code)  : [\"31\",\"32\",\"39\",\"49\",\"98\",\"301\",\"302\",\"303\",\"304\",\"305\"]);\r",
									"const MAPS   = (catMaps.length ? catMaps.map(x=>x.code)  : [\"GRAYSCALE\",\"HOT\",\"JET\",\"RAINBOW\",\"SOKOLOFF\"]);\r",
									"const RANGES = (catRange.length? catRange.map(x=>x.code) : [\"AUTO\",\"CUSTOM\"]);\r",
									"const TAU_CODES = (catCut.length ? catCut.map(x=>x.code) : [\"1007\",\"1008\",\"1009\"]);\r",
									"\r",
									"/*** === Resolve PET_ID === ***/\r",
									"function resolvePetIdByUrl() {\r",
									"  try {\r",
									"    const vlist = pm.request.url.variables;\r",
									"    if (vlist) {\r",
									"      const v = vlist.get && vlist.get(\"PET_ID\");\r",
									"      if (v && v.value) return String(v.value);\r",
									"      const obj = vlist.toObject && vlist.toObject();\r",
									"      if (obj && obj.PET_ID) return String(obj.PET_ID);\r",
									"    }\r",
									"  } catch (_) {}\r",
									"  try {\r",
									"    const raw = pm.variables.replaceIn(pm.request.url.toString());\r",
									"    const m = raw.match(/\\/pet\\/([^/?#]+)/i);\r",
									"    if (m && m[1]) return decodeURIComponent(m[1]);\r",
									"  } catch (_) {}\r",
									"  return \"\";\r",
									"}\r",
									"\r",
									"let nextType = pm.environment.get(\"NEW_PET_TYPE\");\r",
									"if (!nextType) {\r",
									"  const last = pm.environment.get(\"PET_ALT_LAST_TYPE\") || curType;\r",
									"  nextType = (String(last)===\"AMYLOID\") ? \"TAU\" : \"AMYLOID\";\r",
									"  if (!TYPES.includes(nextType)) nextType = (TYPES.includes(\"AMYLOID\") ? \"AMYLOID\" : (TYPES[0]||\"AMYLOID\"));\r",
									"}\r",
									"pm.environment.set(\"PET_ALT_LAST_TYPE\", nextType);\r",
									"\r",
									"// Pick targetId from env seeded by search\r",
									"const amyId = pm.environment.get(\"PET_ID_AMY\");\r",
									"const tauId = pm.environment.get(\"PET_ID_TAU\");\r",
									"let targetId = (nextType===\"AMYLOID\") ? amyId : tauId;\r",
									"\r",
									"// Fallbacks\r",
									"if (!targetId) targetId = pm.environment.get(\"PET_ID\") || pm.collectionVariables.get(\"PET_ID\") || resolvePetIdByUrl();\r",
									"if (!targetId) throw new Error(`[PET PUT] ${nextType===\"AMYLOID\"?\"PET_ID_AMY\":\"PET_ID_TAU\"} ë˜ëŠ” PET_IDê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € search ìš”ì²­ì„ ì‹¤í–‰í•´ ì£¼ì„¸ìš”.`);\r",
									"\r",
									"/*** === Field rotation (NEW_* ìš°ì„ ) === ***/\r",
									"let tracer = pm.environment.get(\"NEW_TRACER\") || pickOther((TRACERS[nextType] || []), (nextType===curType ? curTracer : \"\")) || (TRACERS[nextType]||[])[0];\r",
									"if (!(TRACERS[nextType]||[]).includes(tracer)) tracer = (TRACERS[nextType]||[])[0];\r",
									"\r",
									"let refRegion = pm.environment.get(\"NEW_REF_REGION\") || pickOther(REFS, curRef);\r",
									"let colorMap = pm.environment.get(\"NEW_COLOR_MAP\") || pickOther(MAPS, \"JET\");\r",
									"let rangeType = pm.environment.get(\"NEW_RANGE_TYPE\") || pickOther(RANGES, curRangeT);\r",
									"\r",
									"let pvcUsed = (pm.environment.get(\"NEW_PVC_USED\")!=null) ? asBool(pm.environment.get(\"NEW_PVC_USED\")) : !!rand(2);\r",
									"let psfValue = (pm.environment.get(\"NEW_PSF_VALUE\")!=null) ? toNum(pm.environment.get(\"NEW_PSF_VALUE\"), null)\r",
									"             : (pvcUsed ? Math.round((3.0 + Math.random()*6.0)*10)/10 : null);\r",
									"if (psfValue!=null) psfValue = clamp(psfValue, 0.1, 10.0);\r",
									"\r",
									"let rMin = null, rMax = null;\r",
									"if (rangeType === \"CUSTOM\") {\r",
									"  const envMin = toNum(pm.environment.get(\"NEW_RANGE_MIN\"), null);\r",
									"  const envMax = toNum(pm.environment.get(\"NEW_RANGE_MAX\"), null);\r",
									"  if (envMin!=null && envMax!=null && envMax>envMin) {\r",
									"    rMin = clamp(envMin, 0, 999.99);\r",
									"    rMax = clamp(envMax, 0, 999.99);\r",
									"  } else {\r",
									"    let a = Math.round((1.0 + Math.random()*3.0)*100)/100;\r",
									"    let b = Math.round((a + (1.5 + Math.random()*3.5))*100)/100;\r",
									"    rMin = clamp(a, 0, 999.99);\r",
									"    rMax = clamp(b, 0, 999.99);\r",
									"  }\r",
									"}\r",
									"\r",
									"let opacityPet = toNum(pm.environment.get(\"NEW_OPACITY_PET\"), null);\r",
									"if (opacityPet==null) opacityPet = 40 + rand(61);\r",
									"let opacityBackground = toNum(pm.environment.get(\"NEW_OPACITY_BG\"), null);\r",
									"if (opacityBackground==null) opacityBackground = 70 + rand(26);\r",
									"\r",
									"let tauCutoffs = [];\r",
									"if (nextType === \"TAU\") {\r",
									"  const fromEnv = pm.environment.get(\"NEW_TAU_CUTOFFS\");\r",
									"  if (fromEnv) { try { const arr = JSON.parse(fromEnv); if (Array.isArray(arr)) tauCutoffs = arr; } catch {} }\r",
									"  if (!tauCutoffs.length) { tauCutoffs = (TAU_CODES).map(code => ({ code, value: Math.round((300 + Math.random()*400)*100)/100 })); }\r",
									"}\r",
									"\r",
									"/*** === Compose URL & Body === ***/\r",
									"const baseUrl = pm.variables.replaceIn(\"{{baseUrl}}\");\r",
									"pm.request.url = `${baseUrl}/app/api/analysis/settings/pet/${targetId}`;\r",
									"pm.request.body.update({\r",
									"  mode: \"raw\",\r",
									"  raw: JSON.stringify({\r",
									"    petTypeCode: nextType,\r",
									"    tracerTypeCode: tracer,\r",
									"    referenceRegionCode: refRegion,\r",
									"    pvcUsed: pvcUsed,\r",
									"    psfValue: psfValue,\r",
									"    colorMapCode: colorMap,\r",
									"    rangeSelectType: rangeType,\r",
									"    colorRangeMin: (rangeType===\"AUTO\" ? null : rMin),\r",
									"    colorRangeMax: (rangeType===\"AUTO\" ? null : rMax),\r",
									"    opacityPet: opacityPet,\r",
									"    opacityBackground: opacityBackground,\r",
									"    tauSuvrCutOffValues: (nextType===\"TAU\" ? tauCutoffs : [])\r",
									"  }, null, 2)\r",
									"});\r",
									"\r",
									"/*** === EXPECT_* for test === ***/\r",
									"pm.environment.set(\"PET_ID\", String(targetId));\r",
									"pm.environment.set(\"EXPECT_PET_TYPE\", nextType);\r",
									"pm.environment.set(\"EXPECT_TRACER\", tracer);\r",
									"pm.environment.set(\"EXPECT_REF_REGION\", refRegion);\r",
									"pm.environment.set(\"EXPECT_PVC_USED\", String(pvcUsed));\r",
									"pm.environment.set(\"EXPECT_PSF_VALUE\", psfValue===null ? \"\" : String(psfValue));\r",
									"pm.environment.set(\"EXPECT_COLOR_MAP\", colorMap);\r",
									"pm.environment.set(\"EXPECT_RANGE_TYPE\", rangeType);\r",
									"pm.environment.set(\"EXPECT_RANGE_MIN\", rMin===null ? \"\" : String(rMin));\r",
									"pm.environment.set(\"EXPECT_RANGE_MAX\", rMax===null ? \"\" : String(rMax));\r",
									"pm.environment.set(\"EXPECT_OPACITY_PET\", String(opacityPet));\r",
									"pm.environment.set(\"EXPECT_OPACITY_BG\", String(opacityBackground));\r",
									"pm.environment.set(\"EXPECT_TAU_CUTOFFS\", JSON.stringify(nextType===\"TAU\" ? tauCutoffs : []));\r",
									"\r",
									"console.log(\"[PET PUT][no-seed] nextType=\", nextType, \" targetId=\", targetId);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"/*** ê³µí†µ í—¤ë” ***/\r",
									"const token = pm.environment.get(\"access_token\");\r",
									"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
									"pm.request.headers.upsert({ key: \"Accept\", value: \"application/json\" });\r",
									"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
									"\r",
									"/*** PET_ID í•´ì„ ***/\r",
									"function resolvePetId() {\r",
									"  try {\r",
									"    const vlist = pm.request.url.variables;\r",
									"    if (vlist) {\r",
									"      const v = vlist.get && vlist.get(\"PET_ID\");\r",
									"      if (v && v.value) return String(v.value);\r",
									"      const obj = vlist.toObject && vlist.toObject();\r",
									"      if (obj && obj.PET_ID) return String(obj.PET_ID);\r",
									"    }\r",
									"  } catch (_) {}\r",
									"  try {\r",
									"    const raw = pm.variables.replaceIn(pm.request.url.toString());\r",
									"    const m = raw.match(/\\/pet\\/([^/?#]+)/i);\r",
									"    if (m && m[1]) return decodeURIComponent(m[1]);\r",
									"  } catch (_) {}\r",
									"  const fromEnv = pm.environment.get(\"PET_ID\") || pm.collectionVariables.get(\"PET_ID\");\r",
									"  if (fromEnv) return String(fromEnv);\r",
									"  throw new Error(\"[PET PUT] PET_IDë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë¨¼ì € search(Seed)ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”.\");\r",
									"}\r",
									"const petId = resolvePetId();\r",
									"\r",
									"/*** ìœ í‹¸ ***/\r",
									"const rand = (n)=>Math.floor(Math.random()*n);\r",
									"const pick = (arr)=>arr[Math.max(0, rand(arr.length))];\r",
									"const asBool = (v,d=false)=> (v==null ? d : String(v).toLowerCase()===\"true\");\r",
									"const toNum = (v, d=null)=> (v==null || v===\"\" ? d : Number(v));\r",
									"function parseJSONEnv(key, def=[]) { try { return JSON.parse(pm.environment.get(key) || \"\"); } catch { return def; } }\r",
									"function clamp(x, lo, hi){ return Math.min(Math.max(x, lo), hi); }\r",
									"function pickOther(arr, cur) {\r",
									"  const set = (arr || []).filter(Boolean);\r",
									"  if (!set.length) return cur;\r",
									"  if (set.length===1) return set[0];\r",
									"  let c = pick(set);\r",
									"  for (let i=0; i<10 && String(c)===String(cur); i++) c = pick(set);\r",
									"  return c;\r",
									"}\r",
									"\r",
									"/*** í˜„ì¬/ì¹´íƒˆë¡œê·¸ (Seedì—ì„œ ì €ì¥ë¨) ***/\r",
									"const curType   = pm.environment.get(\"PET_TYPE\")  || \"AMYLOID\";\r",
									"const curTracer = pm.environment.get(\"TRACER\")    || \"F_18_FLUTEMETAMOL\";\r",
									"const curRef    = pm.environment.get(\"REF_REGION\")|| \"31\";\r",
									"const curRangeT = pm.environment.get(\"RANGE_TYPE\")|| \"AUTO\";\r",
									"\r",
									"const catTypes = parseJSONEnv(\"PET_CATALOG_TYPES\", []); // [{code,name}]\r",
									"const catAmy   = parseJSONEnv(\"PET_CATALOG_TRACERS_AMY\", []);\r",
									"const catTau   = parseJSONEnv(\"PET_CATALOG_TRACERS_TAU\", []);\r",
									"const catRefs  = parseJSONEnv(\"PET_CATALOG_REF_REGIONS\", []);\r",
									"const catMaps  = parseJSONEnv(\"PET_CATALOG_COLOR_MAPS\", []);\r",
									"const catRange = parseJSONEnv(\"PET_CATALOG_RANGE_TYPES\", []);\r",
									"const catCut   = parseJSONEnv(\"PET_CATALOG_TAU_CUTOFFS\", []);\r",
									"\r",
									"const TYPES = (catTypes.length ? catTypes.map(x=>x.code) : [\"AMYLOID\",\"TAU\"]);\r",
									"const TRACERS = {\r",
									"  AMYLOID: (catAmy.length ? catAmy.map(x=>x.code) : [\"F_18_FLUTEMETAMOL\",\"F_18_FLORBETABEN\",\"F_18_FLORBETAPIR\",\"F_18_FLORAPRONOL\",\"C_11_PIB\",\"F_18_NAV4694\"]),\r",
									"  TAU:     (catTau.length ? catTau.map(x=>x.code) : [\"F_18_FLORTAUCIPIR\",\"F_18_PI_2620\",\"F_18_MK_6240\"])\r",
									"};\r",
									"const REFS = (catRefs.length ? catRefs.map(x=>x.code) : [\"31\",\"32\",\"39\",\"49\",\"98\",\"301\",\"302\",\"303\",\"304\",\"305\"]);\r",
									"const MAPS = (catMaps.length ? catMaps.map(x=>x.code) : [\"GRAYSCALE\",\"HOT\",\"JET\",\"RAINBOW\",\"SOKOLOFF\"]);\r",
									"const RANGES = (catRange.length ? catRange.map(x=>x.code) : [\"AUTO\",\"CUSTOM\"]);\r",
									"const TAU_CODES = (catCut.length ? catCut.map(x=>x.code) : [\"1007\",\"1008\",\"1009\"]);\r",
									"\r",
									"/*** â¶ íƒ€ì… ë²ˆê°ˆì•„ í† ê¸€ (AMYLOID â†” TAU) ***/\r",
									"// ìˆ˜ë™ ê³ ì •ì´ ìˆìœ¼ë©´ ìš°ì„ \r",
									"let nextType = pm.environment.get(\"NEW_PET_TYPE\");\r",
									"if (!nextType) {\r",
									"  const last = pm.environment.get(\"PET_ALT_LAST_TYPE\") || curType; // ì²˜ìŒì—” í˜„ì¬ê°’ ê¸°ì¤€\r",
									"  nextType = (String(last)===\"AMYLOID\") ? \"TAU\" : \"AMYLOID\";\r",
									"  if (!TYPES.includes(nextType)) nextType = (TYPES.includes(\"AMYLOID\") ? \"AMYLOID\" : (TYPES[0]||\"AMYLOID\"));\r",
									"}\r",
									"// ê¸°ë¡(ë‹¤ìŒ ì‹¤í–‰ ë•Œ ì°¸ê³ )\r",
									"pm.environment.set(\"PET_ALT_LAST_TYPE\", nextType);\r",
									"\r",
									"/*** â· tracer/ref/color/range ìë™ íšŒì „ (NEW_*ê°€ ìˆìœ¼ë©´ ìš°ì„ ) ***/\r",
									"let tracer = pm.environment.get(\"NEW_TRACER\") || pickOther(TRACERS[nextType] || [], (nextType===curType ? curTracer : \"\")) || (TRACERS[nextType]||[])[0];\r",
									"let refRegion = pm.environment.get(\"NEW_REF_REGION\") || pickOther(REFS, curRef);\r",
									"let colorMap = pm.environment.get(\"NEW_COLOR_MAP\") || pickOther(MAPS, \"JET\");\r",
									"let rangeType = pm.environment.get(\"NEW_RANGE_TYPE\") || pickOther(RANGES, curRangeT);\r",
									"if (!TRACERS[nextType]?.includes(tracer)) tracer = (TRACERS[nextType]||[])[0];\r",
									"\r",
									"/*** â¸ pvc/psf & color range & opacity ***/\r",
									"let pvcUsed = (pm.environment.get(\"NEW_PVC_USED\")!=null)\r",
									"  ? asBool(pm.environment.get(\"NEW_PVC_USED\"))\r",
									"  : !!rand(2); // ëœë¤\r",
									"\r",
									"let psfValue = (pm.environment.get(\"NEW_PSF_VALUE\")!=null)\r",
									"  ? toNum(pm.environment.get(\"NEW_PSF_VALUE\"), null)\r",
									"  : (pvcUsed ? Math.round((3.0 + Math.random()*6.0)*10)/10 : null); // 3.0~9.0 (1 decimal)\r",
									"if (psfValue!=null) psfValue = clamp(psfValue, 0.1, 10.0); // ì…ë ¥ ê·œê²©\r",
									"\r",
									"// range\r",
									"let rMin = null, rMax = null;\r",
									"if (rangeType === \"CUSTOM\") {\r",
									"  const envMin = toNum(pm.environment.get(\"NEW_RANGE_MIN\"), null);\r",
									"  const envMax = toNum(pm.environment.get(\"NEW_RANGE_MAX\"), null);\r",
									"  if (envMin!=null && envMax!=null && envMax>envMin) {\r",
									"    rMin = clamp(envMin, 0, 999.99);\r",
									"    rMax = clamp(envMax, 0, 999.99);\r",
									"  } else {\r",
									"    let a = Math.round((1.0 + Math.random()*3.0)*100)/100;           // 1.00~4.00\r",
									"    let b = Math.round((a + (1.5 + Math.random()*3.5))*100)/100;     // +1.5~+5.0\r",
									"    rMin = clamp(a, 0, 999.99);\r",
									"    rMax = clamp(b, 0, 999.99);\r",
									"  }\r",
									"}\r",
									"\r",
									"// opacity\r",
									"let opacityPet = toNum(pm.environment.get(\"NEW_OPACITY_PET\"), null);\r",
									"if (opacityPet==null) opacityPet = 40 + rand(61); // 40~100\r",
									"let opacityBackground = toNum(pm.environment.get(\"NEW_OPACITY_BG\"), null);\r",
									"if (opacityBackground==null) opacityBackground = 70 + rand(26); // 70~95\r",
									"\r",
									"/*** â¹ TAUì´ë©´ cutoff ìƒì„±/ìœ ì§€ ***/\r",
									"let tauCutoffs = [];\r",
									"if (nextType === \"TAU\") {\r",
									"  const fromEnv = pm.environment.get(\"NEW_TAU_CUTOFFS\");\r",
									"  if (fromEnv) {\r",
									"    try { const arr = JSON.parse(fromEnv); if (Array.isArray(arr)) tauCutoffs = arr; } catch {}\r",
									"  }\r",
									"  if (!tauCutoffs.length) {\r",
									"    tauCutoffs = (TAU_CODES).map(code => ({\r",
									"      code,\r",
									"      value: Math.round((300 + Math.random()*400)*100)/100  // 300~700\r",
									"    }));\r",
									"  }\r",
									"}\r",
									"\r",
									"/*** URL/Body ***/\r",
									"const baseUrl = pm.variables.replaceIn(\"{{baseUrl}}\");\r",
									"pm.request.url = `${baseUrl}/app/api/analysis/settings/pet/${petId}`;\r",
									"pm.request.body.update({\r",
									"  mode: \"raw\",\r",
									"  raw: JSON.stringify({\r",
									"    petTypeCode: nextType,\r",
									"    tracerTypeCode: tracer,\r",
									"    referenceRegionCode: refRegion,\r",
									"    pvcUsed: pvcUsed,\r",
									"    psfValue: psfValue,\r",
									"    colorMapCode: colorMap,\r",
									"    rangeSelectType: rangeType,\r",
									"    colorRangeMin: (rangeType===\"AUTO\" ? null : rMin),\r",
									"    colorRangeMax: (rangeType===\"AUTO\" ? null : rMax),\r",
									"    opacityPet: opacityPet,\r",
									"    opacityBackground: opacityBackground,\r",
									"    tauSuvrCutOffValues: (nextType===\"TAU\" ? tauCutoffs : [])\r",
									"  }, null, 2)\r",
									"});\r",
									"\r",
									"/*** ê¸°ëŒ€ê°’ ì €ì¥ (Testsì—ì„œ ê²€ì¦) ***/\r",
									"pm.environment.set(\"EXPECT_PET_TYPE\", nextType);\r",
									"pm.environment.set(\"EXPECT_TRACER\", tracer);\r",
									"pm.environment.set(\"EXPECT_REF_REGION\", refRegion);\r",
									"pm.environment.set(\"EXPECT_PVC_USED\", String(pvcUsed));\r",
									"pm.environment.set(\"EXPECT_PSF_VALUE\", psfValue===null ? \"\" : String(psfValue));\r",
									"pm.environment.set(\"EXPECT_COLOR_MAP\", colorMap);\r",
									"pm.environment.set(\"EXPECT_RANGE_TYPE\", rangeType);\r",
									"pm.environment.set(\"EXPECT_RANGE_MIN\", rMin===null ? \"\" : String(rMin));\r",
									"pm.environment.set(\"EXPECT_RANGE_MAX\", rMax===null ? \"\" : String(rMax));\r",
									"pm.environment.set(\"EXPECT_OPACITY_PET\", String(opacityPet));\r",
									"pm.environment.set(\"EXPECT_OPACITY_BG\", String(opacityBackground));\r",
									"pm.environment.set(\"EXPECT_TAU_CUTOFFS\", JSON.stringify(nextType===\"TAU\" ? tauCutoffs : []));\r",
									"\r",
									"console.log(\"[PET PUT ALT] id=\", petId, \"â†’\", {\r",
									"  type: nextType, tracer, refRegion, pvcUsed, psfValue, colorMap, rangeType, rMin, rMax, opacityPet, opacityBackground,\r",
									"  tauCutoffsLen: (nextType===\"TAU\" ? tauCutoffs.length : 0)\r",
									"});\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/app/api/analysis/settings/pet/{{PET_ID}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"analysis",
								"settings",
								"pet",
								"{{PET_ID}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "PET ë¶„ì„ ì„¤ì • ì‚­ì œ",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// ===== Auth / headers =====\r",
									"const token = pm.environment.get(\"access_token\");\r",
									"if (!token) throw new Error(\"access_token í™˜ê²½ë³€ìˆ˜ê°€ ë¹„ì—ˆìŠµë‹ˆë‹¤.\");\r",
									"pm.request.headers.upsert({ key:\"Authorization\", value:`Bearer ${token}` });\r",
									"pm.request.headers.upsert({ key:\"Accept\", value:\"application/json\" });\r",
									"\r",
									"// ===== helpers =====\r",
									"const J = s => { try { return JSON.parse(s); } catch(e){ return null; } };\r",
									"\r",
									"// ===== í›„ë³´ ID ìˆ˜ì§‘ (envë“¤) =====\r",
									"const envIds = [\r",
									"  pm.environment.get(\"TAG_DELETE_ID\"),\r",
									"  pm.environment.get(\"PET_DELETE_ID\"),\r",
									"  pm.environment.get(\"pet_new_id\")\r",
									"].filter(Boolean);\r",
									"\r",
									"// ===== ëª©ë¡ ì¡°íšŒí•´ ì‹¤ì œ ì¡´ì¬í•˜ëŠ” ID ê³ ë¥´ê¸° =====\r",
									"function fetchList(cb) {\r",
									"  pm.sendRequest({\r",
									"    url: pm.environment.get(\"baseUrl\") + \"/app/api/analysis/settings/pet/search\",\r",
									"    method: \"POST\",\r",
									"    header: {\r",
									"      \"Content-Type\":\"application/json\",\r",
									"      \"Accept\":\"application/json\",\r",
									"      Authorization: `Bearer ${token}`\r",
									"    },\r",
									"    body: { mode:\"raw\", raw: JSON.stringify({\r",
									"      requestPageNumber:1, itemCountPerPage:500, sortBy:\"id\", order:\"DESC\"\r",
									"    }) }\r",
									"  }, (err, res) => {\r",
									"    if (err || !res) return cb(new Error(\"search í˜¸ì¶œ ì‹¤íŒ¨\"));\r",
									"    if (res.code !== 200) return cb(new Error(\"search ì‘ë‹µ ì½”ë“œ: \" + res.code));\r",
									"    const j = J(res.text()) || {};\r",
									"    const rows = j?.result?.petSettings?.contents || [];\r",
									"    cb(null, rows);\r",
									"  });\r",
									"}\r",
									"\r",
									"fetchList((e, rows) => {\r",
									"  if (e) throw e;\r",
									"  if (!rows.length) throw new Error(\"ì‚­ì œí•  í”„ë¦¬ì…‹ì´ ì—†ìŠµë‹ˆë‹¤. (ëª©ë¡ ë¹„ì–´ìˆìŒ)\");\r",
									"\r",
									"  // 1) envì—ì„œ ì˜¨ id ì¤‘ ì‹¤ì œ ëª©ë¡ì— ì¡´ì¬í•˜ëŠ” ì²«ë²ˆì§¸ë¥¼ ì±„íƒ\r",
									"  const idFromEnv = envIds.find(id => rows.some(r => String(r.id) === String(id)));\r",
									"\r",
									"  // 2) ì—†ìœ¼ë©´ ëª©ë¡ì˜ ì²« í–‰ id ì‚¬ìš©\r",
									"  const id = idFromEnv || String(rows[0].id);\r",
									"\r",
									"  if (!/^\\d+$/.test(id)) throw new Error(`ìœ íš¨í•˜ì§€ ì•Šì€ ID: ${id}`);\r",
									"\r",
									"  // URL ê°•ì œ ì¹˜í™˜ ({{TAG_DELETE_ID}}ê°€ ë‚¨ì•„ìˆì–´ë„ ë¬´ì¡°ê±´ ì¹˜í™˜)\r",
									"  const rawUrl = pm.request.url.toString();\r",
									"  const newUrl = rawUrl.replace(/\\/pet\\/[^/?#]+/, `/pet/${id}`);\r",
									"  pm.request.url = newUrl;\r",
									"\r",
									"  // URL ë³€ìˆ˜ë„ ì„¸íŒ…\r",
									"  pm.variables.set(\"TAG_DELETE_ID\", id);\r",
									"\r",
									"  // DELETEëŠ” Body/Content-Type ì œê±° (701 ë°©ì§€)\r",
									"  try { if (pm.request.body) pm.request.body.update(''); } catch(_) {}\r",
									"  pm.request.headers.each(h => {\r",
									"    if (/^content-type$/i.test(h.key)) pm.request.headers.remove(h.key);\r",
									"  });\r",
									"\r",
									"  console.log(\"[PET DELETE] final URL =\", pm.request.url.toString());\r",
									"  console.log(\"[PET DELETE] deleting id =\", id);\r",
									"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"HTTP 200\", () => pm.response.to.have.status(200));\r",
									"let j={}; try{ j=pm.response.json(); }catch(e){}\r",
									"const code = j?.code ?? pm.response.code;\r",
									"if (code !== 200) {\r",
									"  console.warn(\"[PET DELETE] failed:\", j || pm.response.text());\r",
									"  if (code === 701) console.warn(\"Hint: Invalid parameter â†’ URLì— ìˆ«ì IDê°€ ì¹˜í™˜ë˜ì§€ ì•Šì•˜ê±°ë‚˜, ì´ë¯¸ ì‚­ì œëœ IDì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\");\r",
									"} else {\r",
									"  // ì„±ê³µ ì‹œ ìºì‹œ ì •ë¦¬(ì„ íƒ)\r",
									"  const delId = pm.variables.get(\"TAG_DELETE_ID\");\r",
									"  const J = s => { try { return JSON.parse(s); } catch(e){ return null; } };\r",
									"  const list = J(pm.environment.get(\"pet_last_list\")||\"[]\") || [];\r",
									"  pm.environment.set(\"pet_last_list\", JSON.stringify(list.filter(x => String(x.id) !== String(delId))));\r",
									"  if (pm.environment.get(\"pet_new_id\") === delId) pm.environment.unset(\"pet_new_id\");\r",
									"}\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/app/api/analysis/settings/pet/{{TAG_DELETE_ID}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"analysis",
								"settings",
								"pet",
								"{{TAG_DELETE_ID}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "ê³µí†µ ë¶„ì„ ì„¤ì • ì¡°íšŒ",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"const token = pm.environment.get(\"access_token\");\r",
									"const cookieRaw = pm.environment.get(\"cookie_raw\") || \"\";\r",
									"const xsrf = pm.environment.get(\"xsrf_token\") || \"\";\r",
									"\r",
									"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
									"if (cookieRaw) pm.request.headers.upsert({ key: \"Cookie\", value: cookieRaw });\r",
									"if (xsrf) pm.request.headers.upsert({ key: \"X-XSRF-TOKEN\", value: xsrf });\r",
									"\r",
									"pm.request.headers.upsert({ key: \"Accept\", value: \"application/json\" });\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// === ê¸°ë³¸ ê²€ì¦ ===\r",
									"pm.test(\"Status 200\", () => pm.response.to.have.status(200));\r",
									"pm.test(\"JSON ì‘ë‹µ\", () => {\r",
									"  const ct = (pm.response.headers.get(\"Content-Type\") || \"\").toLowerCase();\r",
									"  pm.expect(ct).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"// === JSON íŒŒì‹± ===\r",
									"let j = {}; try { j = pm.response.json(); } catch (e) {}\r",
									"const r = j?.result ?? j?.data ?? {};\r",
									"const amy = r?.amyloidSetting ?? r?.amyloid ?? {};\r",
									"const phase = r?.phaseSetting ?? r?.phase ?? {};\r",
									"\r",
									"// ìœ í‹¸: ì—¬ëŸ¬ í›„ë³´ í‚¤ ì¤‘ ì²« ê°’ì„ ë°˜í™˜\r",
									"function pick(obj, ...names) {\r",
									"  for (const n of names) {\r",
									"    if (obj && obj[n] !== undefined && obj[n] !== null) return obj[n];\r",
									"  }\r",
									"  return undefined;\r",
									"}\r",
									"\r",
									"// â”€â”€ í•„ë“œëª… ë³€ë™ ëŒ€ì‘ â”€â”€\r",
									"const cutoffOption = pick(amy, \"cutOffOption\", \"cutoffOption\", \"mode\");\r",
									"let   cutoffValue  = pick(amy, \"cutOffValue\",  \"cutoffValue\",  \"threshold\");\r",
									"let   rangeMin     = pick(amy, \"rangeMin\", \"min\");\r",
									"let   rangeMax     = pick(amy, \"rangeMax\", \"max\");\r",
									"const mriScanType  = pick(phase, \"mriScanType\", \"scannerType\", \"mri\");\r",
									"\r",
									"// ìˆ«ìê°€ ë¬¸ìì—´ë¡œ ì˜¤ëŠ” ê²½ìš° ëŒ€ë¹„\r",
									"function num(x){ return (typeof x === \"string\") ? Number(x) : x; }\r",
									"cutoffValue = num(cutoffValue);\r",
									"rangeMin    = num(rangeMin);\r",
									"rangeMax    = num(rangeMax);\r",
									"\r",
									"// === ë¹„ì¦ˆë‹ˆìŠ¤ ê²€ì¦ ===\r",
									"pm.test(\"amyloidSetting.mode ìœ íš¨\", () => {\r",
									"  pm.expect(cutoffOption, \"cutoffOption\").to.be.oneOf([\"CUTOFF\",\"BORDERLINE\"]);\r",
									"});\r",
									"\r",
									"if (cutoffOption === \"CUTOFF\") {\r",
									"  pm.test(\"cutoffValue ìˆ«ì\", () => pm.expect(cutoffValue).to.be.a(\"number\"));\r",
									"} else if (cutoffOption === \"BORDERLINE\") {\r",
									"  pm.test(\"rangeMin/Max ìˆ«ì ë° ë²”ìœ„\", () => {\r",
									"    pm.expect(rangeMin).to.be.a(\"number\");\r",
									"    pm.expect(rangeMax).to.be.a(\"number\");\r",
									"    pm.expect(rangeMin).to.be.at.most(rangeMax);\r",
									"  });\r",
									"}\r",
									"\r",
									"pm.test(\"MRI ìŠ¤ìºë„ˆ íƒ€ì… ìœ íš¨\", () => {\r",
									"  pm.expect(mriScanType).to.be.oneOf([\"LEFT\",\"RIGHT\"]);\r",
									"});\r",
									"\r",
									"// === ë¡œê·¸ & ì²´ì´ë‹ ===\r",
									"console.log(\"[COMMON] amyloidSetting =\", amy);\r",
									"console.log(\"[COMMON] cutoffOption:\", cutoffOption, \r",
									"            cutoffOption === \"CUTOFF\" ? `threshold=${cutoffValue}` \r",
									"                                      : `borderline=${rangeMin}-${rangeMax}`);\r",
									"console.log(\"[COMMON] MRI scanner:\", mriScanType);\r",
									"\r",
									"pm.environment.set(\"common_cutoffOption\", cutoffOption ?? \"\");\r",
									"pm.environment.set(\"common_cutoffValue\",  String(cutoffValue ?? \"\"));\r",
									"pm.environment.set(\"common_rangeMin\",     String(rangeMin ?? \"\"));\r",
									"pm.environment.set(\"common_rangeMax\",     String(rangeMax ?? \"\"));\r",
									"pm.environment.set(\"common_mriScanType\",  mriScanType ?? \"\");\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/app/api/analysis/settings/common",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"analysis",
								"settings",
								"common"
							]
						}
					},
					"response": []
				},
				{
					"name": "ê³µí†µ ë¶„ì„ ì„¤ì • ìˆ˜ì •_Positivity Cutoff",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// 1~99 ëœë¤ ê°’ ìƒì„±\r",
									"const val = Math.floor(Math.random() * 99) + 1;\r",
									"pm.environment.set('cutoffValue', val);\r",
									"\r",
									"// (ì„ íƒ) ìš”ì²­ ë³¸ë¬¸ì„ ì½”ë“œë¡œ ì§ì ‘ ê°±ì‹ í•˜ê³  ì‹¶ì„ ë•Œ:\r",
									"const body = {\r",
									"  amyloidSetting: {\r",
									"    cutOffOption: \"CUTOFF\",\r",
									"    cutOffValue: val,   // â† ëœë¤ê°’ ì£¼ì…\r",
									"    rangeMin: 6,\r",
									"    rangeMax: 20\r",
									"  },\r",
									"  phaseSetting: { mriScanType: \"LEFT\" },\r",
									"  ariahSetting: {\r",
									"    severityNone: 0,\r",
									"    severityMildMin: 1,\r",
									"    severityMildMax: 4,\r",
									"    severityModerateMin: 5,\r",
									"    severityModerateMax: 9,\r",
									"    severitySevere: 10\r",
									"  }\r",
									"};\r",
									"\r",
									"// ì•„ë˜ ì¤„ì˜ ì£¼ì„ì„ í•´ì œí•˜ë©´, Body(TEXTVIEW)ì— ë³€ìˆ˜ ì“°ì§€ ì•Šì•„ë„ ë³¸ë¬¸ì„ ì¦‰ì‹œ ê°±ì‹ í•©ë‹ˆë‹¤.\r",
									"// pm.request.body.update(JSON.stringify(body));\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// ìƒíƒœ ì½”ë“œ í™•ì¸\r",
									"pm.test(\"ì‘ë‹µ ìƒíƒœ 200/204\", function () {\r",
									"  pm.expect([200, 204]).to.include(pm.response.code);\r",
									"});\r",
									"\r",
									"// ìš°ë¦¬ê°€ ì „ì†¡í•œ ê°’\r",
									"const sent = Number(pm.environment.get('cutoffValue'));\r",
									"pm.test(`ì „ì†¡ cutOffValue = ${sent}`, function () {\r",
									"  pm.expect(sent).to.be.within(1, 99);\r",
									"});\r",
									"\r",
									"// ì„œë²„ê°€ JSONìœ¼ë¡œ ì—ì½”í•  ë•Œ(200 + application/json)\r",
									"let echoed;\r",
									"if (pm.response.code === 200 && pm.response.headers.get('Content-Type')?.includes('application/json')) {\r",
									"  const json = pm.response.json();\r",
									"  echoed = json?.amyloidSetting?.cutOffValue;\r",
									"\r",
									"  if (typeof echoed !== 'undefined') {\r",
									"    pm.test(`ì„œë²„ ë°˜ì˜ cutOffValue = ${echoed}`, function () {\r",
									"      pm.expect(echoed).to.eql(sent);\r",
									"    });\r",
									"    pm.test(`âœ… CUTOFF ë³€ê²½ ì™„ë£Œ: ${sent} â†’ ${echoed}`, function () {\r",
									"      pm.expect(true).to.be.true;\r",
									"    });\r",
									"  } else {\r",
									"    // í…ŒìŠ¤íŠ¸ ê²°ê³¼ì°½ì—” ì•ˆ ë„ìš°ê³  ì½˜ì†”ë§Œ\r",
									"    console.warn(\"ì‘ë‹µì— amyloidSetting.cutOffValue ì—†ìŒ: ìŠ¤í‚¤ë§ˆ í™•ì¸ í•„ìš”\", { json });\r",
									"  }\r",
									"} else if (pm.response.code === 204) {\r",
									"  pm.test(`âœ… CUTOFF ì „ì†¡ê°’(204 No Content): ${sent}`, function () {\r",
									"    pm.expect(true).to.be.true;\r",
									"  });\r",
									"}\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\"amyloidSetting\":{\"cutOffOption\":\"CUTOFF\",\"cutOffValue\":{{cutoffValue}},\"rangeMin\":6,\"rangeMax\":20},\"phaseSetting\":{\"mriScanType\":\"LEFT\"},\"ariahSetting\":{\"severityNone\":0,\"severityMildMin\":1,\"severityMildMax\":4,\"severityModerateMin\":5,\"severityModerateMax\":9,\"severitySevere\":10}}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/app/api/analysis/settings/common",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"analysis",
								"settings",
								"common"
							]
						}
					},
					"response": []
				},
				{
					"name": "ê³µí†µ ë¶„ì„ ì„¤ì • ìˆ˜ì •_Borderline",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// 1~99 ëœë¤ ì •ìˆ˜\r",
									"const r = () => Math.floor(Math.random() * 99) + 1;\r",
									"\r",
									"// ì„œë¡œ ë‹¤ë¥¸ ë‘ ìˆ˜ ë½‘ì•„ ì •ë ¬\r",
									"let a = r(), b = r();\r",
									"while (a === b) b = r();\r",
									"const rangeMin = Math.min(a,b), rangeMax = Math.max(a,b);\r",
									"\r",
									"// ì§ì „ ìš”ì²­ì—ì„œ ì €ì¥í•œ CUTOFF í˜„ì¬ê°’ (í•„ìˆ˜ì¼ ìˆ˜ ìˆìŒ)\r",
									"const cutoffExisting = Number(pm.environment.get('cutoffValue'));\r",
									"if (!cutoffExisting || !Number.isInteger(cutoffExisting)) {\r",
									"  throw new Error(\"cutoffValue ì—†ìŒ: ë¨¼ì € 'Cutoff ìˆ˜ì • ë° ì €ì¥' ìš”ì²­ì„ ì‹¤í–‰í•˜ì„¸ìš”.\");\r",
									"}\r",
									"\r",
									"// ë””ë²„ê¹…ìš© ê¸°ë¡\r",
									"pm.environment.set('border_min', rangeMin);\r",
									"pm.environment.set('border_max', rangeMax);\r",
									"\r",
									"// ìš”ì²­ ë³¸ë¬¸: BORDERLINE + ê¸°ì¡´ cutoff ìœ ì§€\r",
									"const body = {\r",
									"  amyloidSetting: {\r",
									"    cutOffOption: \"BORDERLINE\",\r",
									"    cutOffValue: cutoffExisting,   // ì„œë²„ê°€ í•„ìˆ˜ ìš”êµ¬ ì‹œ í˜„ì¬ê°’ì„ ê·¸ëŒ€ë¡œ ì „ì†¡ â†’ ê°’ ìœ ì§€\r",
									"    rangeMin,\r",
									"    rangeMax\r",
									"  },\r",
									"  // í•„ìš”í•œ ê²½ìš°ì—ë§Œ ìœ ì§€í•˜ì„¸ìš”. (ìŠ¤í‚¤ë§ˆ í•„ìˆ˜ë¼ë©´ ì‚­ì œí•˜ì§€ ë§ ê²ƒ)\r",
									"  phaseSetting: { mriScanType: \"LEFT\" },\r",
									"  ariahSetting: {\r",
									"    severityNone: 0,\r",
									"    severityMildMin: 1,\r",
									"    severityMildMax: 4,\r",
									"    severityModerateMin: 5,\r",
									"    severityModerateMax: 9,\r",
									"    severitySevere: 10\r",
									"  }\r",
									"};\r",
									"\r",
									"pm.request.headers.upsert({ key: 'Content-Type', value: 'application/json' });\r",
									"pm.request.body.update(JSON.stringify(body));\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"ì‘ë‹µ 200/204\", () => pm.expect([200,204]).to.include(pm.response.code));\r",
									"\r",
									"const minV = Number(pm.environment.get('border_min'));\r",
									"const maxV = Number(pm.environment.get('border_max'));\r",
									"pm.test(`ìˆ˜ì •ëœ Borderline ê°’(MIN~MAX) ${minV}~${maxV}`, () => {\r",
									"  pm.expect(minV).to.be.within(1,99);\r",
									"  pm.expect(maxV).to.be.within(1,99);\r",
									"  pm.expect(maxV).to.be.greaterThan(minV);\r",
									"});\r",
									"\r",
									"// ì„œë²„ê°€ JSONìœ¼ë¡œ ì—ì½”í•˜ë©´ ì¼ì¹˜ í™•ì¸\r",
									"if (pm.response.headers.get('Content-Type')?.includes('application/json')) {\r",
									"  const j = pm.response.json();\r",
									"  const eMin = j?.amyloidSetting?.rangeMin;\r",
									"  const eMax = j?.amyloidSetting?.rangeMax;\r",
									"  const echoedCut = j?.amyloidSetting?.cutOffValue;\r",
									"\r",
									"  if (typeof eMin === 'number' && typeof eMax === 'number') {\r",
									"    pm.test(\"ì„œë²„ ë°˜ì˜ Borderline ì¼ì¹˜\", () => {\r",
									"      pm.expect(eMin).to.eql(minV);\r",
									"      pm.expect(eMax).to.eql(maxV);\r",
									"    });\r",
									"  }\r",
									"  const cutoffExisting = Number(pm.environment.get('cutoff_current'));\r",
									"  if (typeof echoedCut === 'number') {\r",
									"    pm.test(\"cutOffValue ìœ ì§€\", () => pm.expect(echoedCut).to.eql(cutoffExisting));\r",
									"  }\r",
									"}\r",
									"\r",
									"// ë””ë²„ê¹…: ì‹¤íŒ¨ ì‹œ ë³¸ë¬¸ ì¶œë ¥\r",
									"if (![200,204].includes(pm.response.code)) {\r",
									"  console.log('Status:', pm.response.code, 'Body:', pm.response.text());\r",
									"}\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\"amyloidSetting\":{\"cutOffOption\":\"BORDERLINE\",\"cutOffValue\":{{cutoffValue}},\"rangeMin\":15,\"rangeMax\":30},\"phaseSetting\":{\"mriScanType\":\"LEFT\"},\"ariahSetting\":{\"severityNone\":0,\"severityMildMin\":1,\"severityMildMax\":4,\"severityModerateMin\":5,\"severityModerateMax\":9,\"severitySevere\":10}}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/app/api/analysis/settings/common",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"analysis",
								"settings",
								"common"
							]
						}
					},
					"response": []
				},
				{
					"name": "ì´ë¯¸ì§€ë³„ ìë™ ë¶„ì„ ì„¤ì • ì¡°íšŒ",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// === 1) ì‘ë‹µ or ìš”ì²­ ë°”ë””ì—ì„œ JSON í™•ë³´ ===\r",
									"function tryParseJSON(txt) { try { return JSON.parse(txt); } catch (e) { return null; } }\r",
									"\r",
									"let payload = null;\r",
									"const ct = (pm.response.headers.get(\"Content-Type\") || \"\").toLowerCase();\r",
									"if (pm.response.code && ct.includes(\"application/json\")) {\r",
									"  payload = tryParseJSON(pm.response.text());\r",
									"}\r",
									"if (!payload) {\r",
									"  const raw = (pm.request.body && pm.request.body.raw) || \"\";\r",
									"  payload = tryParseJSON(raw);\r",
									"}\r",
									"\r",
									"pm.test(\"ìœ íš¨í•œ JSON í™•ë³´\", () => {\r",
									"  pm.expect(payload, \"ì‘ë‹µë„ ì—†ê³  ìš”ì²­ BODYë„ JSONì´ ì•„ë‹˜\").to.be.an(\"object\");\r",
									"});\r",
									"\r",
									"// === 2) ê³µìš© ì¶”ì¶œ(í‚¤ ìœ ì—° ì²˜ë¦¬) ===\r",
									"const j = payload || {};\r",
									"const r = j.result || j.data || {};\r",
									"\r",
									"const isPacsAutomated   = !!(r.isPacsAutomated   ?? r.pacsAuto   ?? r.autoPacs);\r",
									"const isManualAutomated = !!(r.isManualAutomated ?? r.manualAuto ?? r.autoManual);\r",
									"\r",
									"// ê° ëª¨ë‹¬ë¦¬í‹° ë¸”ë¡(ì—†ìœ¼ë©´ ë¹ˆ ê°ì²´)\r",
									"const t1      = r.t1      || {};\r",
									"const flair   = r.flair   || {};\r",
									"const swi     = r.swi     || {};\r",
									"const gre     = r.gre     || {};\r",
									"const sg      = r.sg      || {};        // SWI+GRE\r",
									"const amyloid = r.amyloid || {};\r",
									"const tau     = r.tau     || {};\r",
									"\r",
									"// === 3) ê¸°ë³¸ í…ŒìŠ¤íŠ¸(ê°„ë‹¨ ê²€ì¦) ===\r",
									"pm.test(\"ìë™ë¶„ì„ í† ê¸€ì€ boolean\", () => {\r",
									"  pm.expect(isPacsAutomated).to.be.a(\"boolean\");\r",
									"  pm.expect(isManualAutomated).to.be.a(\"boolean\");\r",
									"});\r",
									"\r",
									"// === 4) í‘œë¡œ í‘œì‹œí•  í–‰ êµ¬ì„± ===\r",
									"const rows = [\r",
									"  { image: \"T1\",               analysis: \"Brain Volumetry\",                 flag: !!t1.BRAIN_VOL },\r",
									"  { image: \"T2-FLAIR\",         analysis: \"Microvascular Ischemic Change\",   flag: !!flair.FLAIR_HI },\r",
									"  { image: \"T2-FLAIR\",         analysis: \"ARIA-E\",                          flag: !!flair.ARIA_E },\r",
									"  { image: \"SWI\",              analysis: \"ARIA-H (SWI)\",                    flag: !!swi.ARIA_H_SWI },\r",
									"  { image: \"GRE\",              analysis: \"ARIA-H (GRE)\",                    flag: !!gre.ARIA_H_GRE },\r",
									"  { image: \"SWI+GRE\",          analysis: \"ARIA-H (SWI+GRE)\",                flag: !!sg.ARIA_H_SG },\r",
									"  { image: \"Amyloid PET + T1\", analysis: \"Amyloid PET\",                     flag: !!amyloid.AMYLOID_PET },\r",
									"  { image: \"Tau PET + T1\",     analysis: \"Tau PET\",                         flag: !!tau.TAU_PET }\r",
									"];\r",
									"\r",
									"// === 5) ì‹œê°í™” (pm.visualizer) ===\r",
									"const template = `\r",
									"<style>\r",
									"  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }\r",
									"  .toggles { display: flex; gap: 12px; margin: 12px 0; }\r",
									"  .pill { padding: 6px 10px; border-radius: 999px; border: 1px solid #e5e7eb; }\r",
									"  .on { background:#e6ffed; border-color:#22c55e; }\r",
									"  .off { background:#fff1f2; border-color:#ef4444; }\r",
									"  table { border-collapse: collapse; width: 100%; }\r",
									"  th, td { border: 1px solid #e5e7eb; padding: 8px 10px; text-align: left; }\r",
									"  th { background: #f8fafc; }\r",
									"  .check { font-weight:700; }\r",
									"</style>\r",
									"\r",
									"<h3>Automatic Image Analysis</h3>\r",
									"<div class=\"toggles\">\r",
									"  <div class=\"pill {{#if isPacsAutomated}}on{{else}}off{{/if}}\">\r",
									"    Automatic for PACS-transferred images:\r",
									"    <span class=\"check\">{{#if isPacsAutomated}}ON{{else}}OFF{{/if}}</span>\r",
									"  </div>\r",
									"  <div class=\"pill {{#if isManualAutomated}}on{{else}}off{{/if}}\">\r",
									"    Automatic for user-uploaded images:\r",
									"    <span class=\"check\">{{#if isManualAutomated}}ON{{else}}OFF{{/if}}</span>\r",
									"  </div>\r",
									"</div>\r",
									"\r",
									"<table>\r",
									"  <thead><tr><th style=\"width:30%\">Image</th><th>Analysis</th><th style=\"width:12%\">Enabled</th></tr></thead>\r",
									"  <tbody>\r",
									"    {{#each rows}}\r",
									"      <tr>\r",
									"        <td>{{this.image}}</td>\r",
									"        <td>{{this.analysis}}</td>\r",
									"        <td class=\"check\">{{#if this.flag}}âœ“{{else}}â€”{{/if}}</td>\r",
									"      </tr>\r",
									"    {{/each}}\r",
									"  </tbody>\r",
									"</table>\r",
									"`;\r",
									"\r",
									"pm.visualizer.set(template, { isPacsAutomated, isManualAutomated, rows });\r",
									"\r",
									"// === 6) ì²´ì´ë‹ì„ ìœ„í•œ í™˜ê²½ë³€ìˆ˜ ì €ì¥(ì„ íƒ)\r",
									"pm.environment.set(\"auto_pacs\",   String(isPacsAutomated));\r",
									"pm.environment.set(\"auto_manual\", String(isManualAutomated));\r",
									"pm.environment.set(\"auto_t1_brain_vol\", String(!!t1.BRAIN_VOL));\r",
									"pm.environment.set(\"auto_flair_hi\",     String(!!flair.FLAIR_HI));\r",
									"pm.environment.set(\"auto_flair_aria_e\", String(!!flair.ARIA_E));\r",
									"pm.environment.set(\"auto_swi_aria_h\",   String(!!swi.ARIA_H_SWI));\r",
									"pm.environment.set(\"auto_gre_aria_h\",   String(!!gre.ARIA_H_GRE));\r",
									"pm.environment.set(\"auto_sg_aria_h\",    String(!!sg.ARIA_H_SG));\r",
									"pm.environment.set(\"auto_amyloid\",      String(!!amyloid.AMYLOID_PET));\r",
									"pm.environment.set(\"auto_tau\",          String(!!tau.TAU_PET));\r",
									"\r",
									"pm.environment.set(\"auto_last\", pm.response.text());\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "{{access_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"code\": 200,\r\n  \"message\": \"\",\r\n  \"result\": {\r\n    \"isPacsAutomated\": true,\r\n    \"isManualAutomated\": true,\r\n    \"t1\": {\r\n      \"BRAIN_VOL\": true\r\n    },\r\n    \"flair\": {\r\n      \"FLAIR_HI\": true,\r\n      \"ARIA_E\": true\r\n    },\r\n    \"swi\": {\r\n      \"ARIA_H_SWI\": true\r\n    },\r\n    \"gre\": {\r\n      \"ARIA_H_GRE\": true\r\n    },\r\n    \"sg\": {\r\n      \"ARIA_H_SG\": true\r\n    },\r\n    \"amyloid\": {\r\n      \"AMYLOID_PET\": true\r\n    },\r\n    \"tau\": {\r\n      \"TAU_PET\": true\r\n    }\r\n  }\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/app/api/analysis/settings/common/auto",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"analysis",
								"settings",
								"common",
								"auto"
							]
						}
					},
					"response": []
				},
				{
					"name": "ì´ë¯¸ì§€ë³„ ìë™ ë¶„ì„ ì„¤ì • ìˆ˜ì •",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// ---- seed ë°ì´í„°: (env:auto_last) > (PATCH Body RAW) > ìµœì†Œ êµ¬ì¡° ----\r",
									"function J(x){ try { return JSON.parse(x); } catch(e){ return null; } }\r",
									"\r",
									"let seed = null;\r",
									"const saved = pm.environment.get(\"auto_last\");\r",
									"if (saved) seed = J(saved);\r",
									"\r",
									"if (!seed) {\r",
									"  const raw = (pm.request.body && pm.request.body.raw) || \"\";\r",
									"  seed = J(raw);\r",
									"}\r",
									"if (!seed) seed = { result: {} };\r",
									"\r",
									"const resultIn = seed.result || seed; // {result:{...}} ë˜ëŠ” {...} ëª¨ë‘ ì²˜ë¦¬\r",
									"\r",
									"// ---- ëª¨ë“  ë¶ˆë¦¬ì–¸ í† ê¸€(true <-> false). ê·¸ ì™¸ íƒ€ì…ì€ ê·¸ëŒ€ë¡œ ìœ ì§€ ----\r",
									"function toggleBooleans(obj){\r",
									"  if (Array.isArray(obj)) return obj.map(toggleBooleans);\r",
									"  if (obj && typeof obj === \"object\") {\r",
									"    const out = {};\r",
									"    Object.keys(obj).forEach(k => out[k] = toggleBooleans(obj[k]));\r",
									"    return out;\r",
									"  }\r",
									"  if (typeof obj === \"boolean\") return !obj;\r",
									"  return obj;\r",
									"}\r",
									"\r",
									"const resultOut = toggleBooleans(resultIn);\r",
									"\r",
									"// ---- ë˜í¼ ëª¨ë“œ: inner(ê¸°ë³¸) | result | full ----\r",
									"const mode = (pm.environment.get(\"PATCH_payload_mode\") || \"inner\").toLowerCase();\r",
									"let payload;\r",
									"if (mode === \"full\" && seed.result) {\r",
									"  payload = Object.assign({}, seed, { result: resultOut });\r",
									"} else if (mode === \"result\") {\r",
									"  payload = { result: resultOut };\r",
									"} else {\r",
									"  payload = resultOut;\r",
									"}\r",
									"\r",
									"// PATCH Body ë°˜ì˜\r",
									"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
									"pm.request.body.update(JSON.stringify(payload, null, 2));\r",
									"\r",
									"// ---- í† ê¸€ ì „/í›„ ìŠ¤ëƒ…ìƒ· ì €ì¥(í…ŒìŠ¤íŠ¸ì—ì„œ ë¹„êµìš©) ----\r",
									"pm.environment.set(\"auto_patch_before\", JSON.stringify(resultIn));\r",
									"pm.environment.set(\"auto_patch_after\",  JSON.stringify(resultOut));\r",
									"\r",
									"console.log(\"[PATCH auto] mode:\", mode, \"| before:\", resultIn, \"| after:\", resultOut);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"HTTP 200\", ()=> pm.response.to.have.status(200));\r",
									"\r",
									"function J(x){ try { return JSON.parse(x); } catch(e){ return null; } }\r",
									"\r",
									"const resp = J(pm.response.text());\r",
									"const sent = J(pm.request.body.raw) || {};\r",
									"const beforeEnv = J(pm.environment.get(\"auto_patch_before\") || \"{}\");\r",
									"const afterEnv  = J(pm.environment.get(\"auto_patch_after\")  || \"{}\");\r",
									"\r",
									"// ì‘ë‹µ ìš°ì„ (ê°ì²´ì¸ resultì¼ ë•Œë§Œ), ì—†ìœ¼ë©´ ìš°ë¦¬ê°€ ë³´ë‚¸ ë°”ë””(sent.result/ sent), ê·¸ë˜ë„ ì—†ìœ¼ë©´ env.after\r",
									"let after =\r",
									"  (resp && typeof resp.result === \"object\" && resp.result) ||\r",
									"  (resp && (resp.t1 || resp.flair || resp.swi || resp.gre || resp.sg || resp.amyloid || resp.tau) && resp) ||\r",
									"  (typeof sent.result === \"object\" ? sent.result : (Object.keys(sent).length ? sent : null)) ||\r",
									"  afterEnv || {};\r",
									"\r",
									"const before = (typeof beforeEnv === \"object\" ? beforeEnv : {});\r",
									"\r",
									"// ---- before ëŒ€ë¹„ afterê°€ \"ë¶ˆë¦¬ì–¸ë§Œ í† ê¸€\" ë˜ì—ˆëŠ”ì§€ ì¬ê·€ ê²€ì¦ ----\r",
									"function assertToggled(b, a, path = \"\"){\r",
									"  if (typeof b === \"boolean\") {\r",
									"    pm.expect(a, `${path} toggled`).to.eql(!b);\r",
									"    return;\r",
									"    }\r",
									"  if (b && typeof b === \"object\"){\r",
									"    Object.keys(b).forEach(k=>{\r",
									"      const np = path ? `${path}.${k}` : k;\r",
									"      if (typeof b[k] === \"boolean\"){\r",
									"        pm.test(`${np} toggled`, ()=> pm.expect(a && a.hasOwnProperty(k) ? a[k] : undefined, `${np} missing`).to.eql(!b[k]));\r",
									"      } else if (b[k] && typeof b[k] === \"object\"){\r",
									"        assertToggled(b[k], a ? a[k] : undefined, np);\r",
									"      }\r",
									"    });\r",
									"  }\r",
									"}\r",
									"assertToggled(before, after);\r",
									"\r",
									"// ---- ì‹œê°í™” ----\r",
									"const r = after || {};\r",
									"const t1      = r.t1      || {};\r",
									"const flair   = r.flair   || {};\r",
									"const swi     = r.swi     || {};\r",
									"const gre     = r.gre     || {};\r",
									"const sg      = r.sg      || {};\r",
									"const amyloid = r.amyloid || {};\r",
									"const tau     = r.tau     || {};\r",
									"\r",
									"const rows = [\r",
									"  { image: \"T1\",               analysis: \"Brain Volumetry\",               flag: !!t1.BRAIN_VOLUMETRY },\r",
									"  { image: \"T2-FLAIR\",         analysis: \"Microvascular Ischemic Change\", flag: !!flair.FLAIR_MIC },\r",
									"  { image: \"T2-FLAIR\",         analysis: \"ARIA-E\",                        flag: !!flair.ARIA_E },\r",
									"  { image: \"SWI\",              analysis: \"ARIA-H (SWI)\",                  flag: !!swi.ARIA_H_SWI },\r",
									"  { image: \"GRE\",              analysis: \"ARIA-H (GRE)\",                  flag: !!gre.ARIA_H_GRE },\r",
									"  { image: \"SWI+GRE\",          analysis: \"ARIA-H (SWI+GRE)\",              flag: !!sg.ARIA_H_SWI_GRE },\r",
									"  { image: \"Amyloid PET + T1\", analysis: \"Amyloid PET\",                   flag: !!amyloid.AMYLOID_PET },\r",
									"  { image: \"Tau PET + T1\",     analysis: \"Tau PET\",                       flag: !!tau.TAU_PET }\r",
									"];\r",
									"\r",
									"const template = `\r",
									"<style>\r",
									"body{font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}\r",
									".badge{display:inline-block;margin:8px 0;padding:4px 8px;border:1px solid #e5e7eb;border-radius:999px;background:#f8fafc}\r",
									"table{border-collapse:collapse;width:100%}th,td{border:1px solid #e5e7eb;padding:8px 10px}\r",
									"th{background:#f8fafc}.check{font-weight:700}\r",
									"</style>\r",
									"<div class=\"badge\">source: {{source}}</div>\r",
									"<h3>Saved (toggled)</h3>\r",
									"<table>\r",
									"  <thead><tr><th style=\"width:30%\">Image</th><th>Analysis</th><th style=\"width:12%\">Enabled</th></tr></thead>\r",
									"  <tbody>\r",
									"    {{#each rows}}\r",
									"      <tr><td>{{image}}</td><td>{{analysis}}</td><td class=\"check\">{{#if flag}}âœ“{{else}}â€”{{/if}}</td></tr>\r",
									"    {{/each}}\r",
									"  </tbody>\r",
									"</table>\r",
									"`;\r",
									"const usedSource =\r",
									"  (resp && typeof resp.result === \"object\" && \"response.result\") ||\r",
									"  (resp && (resp.t1 || resp.flair || resp.swi || resp.gre || resp.sg || resp.amyloid || resp.tau) && \"response\") ||\r",
									"  (Object.keys(sent||{}).length ? \"request-body\" : \"env.after\");\r",
									"pm.visualizer.set(template, { rows, source: usedSource });\r",
									"\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/app/api/analysis/settings/common/auto",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"analysis",
								"settings",
								"common",
								"auto"
							]
						}
					},
					"response": []
				},
				{
					"name": "ëŒ€í‘œ ì´ë¯¸ì§€ ì„ íƒ ì„¤ì • ì¡°íšŒ",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// === 1) ì‘ë‹µ or ìš”ì²­ ë°”ë””ì—ì„œ JSON í™•ë³´ ===\r",
									"function tryParseJSON(txt) {\r",
									"  try { return JSON.parse(txt); } catch (e) { return null; }\r",
									"}\r",
									"\r",
									"let payload = null;\r",
									"\r",
									"// (A) ì‘ë‹µì´ JSONì´ë©´ ìš°ì„  ì‚¬ìš©\r",
									"const ct = (pm.response.headers.get(\"Content-Type\") || \"\").toLowerCase();\r",
									"if (pm.response.code && ct.includes(\"application/json\")) {\r",
									"  payload = tryParseJSON(pm.response.text());\r",
									"}\r",
									"\r",
									"// (B) ì‘ë‹µì´ ì—†ê±°ë‚˜ JSONì´ ì•„ë‹ˆë©´ ìš”ì²­ BODY RAW ì‚¬ìš© (ë‹¹ì‹ ì´ ë„£ì€ ìƒ˜í”Œ JSON)\r",
									"if (!payload) {\r",
									"  const raw = pm.request.body && pm.request.body.raw || \"\";\r",
									"  payload = tryParseJSON(raw);\r",
									"}\r",
									"\r",
									"// ì•ˆì „ ê°€ë“œ\r",
									"pm.test(\"ìœ íš¨í•œ JSON í™•ë³´\", function () {\r",
									"  pm.expect(payload, \"ì‘ë‹µë„ ì—†ê³  ìš”ì²­ BODYë„ JSONì´ ì•„ë‹˜\").to.be.an(\"object\");\r",
									"});\r",
									"\r",
									"// === 2) ê³µìš© ì¶”ì¶œ(í‚¤ ìœ ì—° ì²˜ë¦¬) ===\r",
									"const j = payload || {};\r",
									"const r = j.result || j.data || {};\r",
									"const catalogs = r.representativeCatalogs || r.catalogs || {};\r",
									"const planes = catalogs.planeCatalogList || catalogs.planes || [];\r",
									"const rois = catalogs.roiCatalogList || catalogs.rois || [];\r",
									"const t1 = r.t1 || r.T1 || {};\r",
									"const amyloid = r.amyloid || r.Amyloid || {};\r",
									"const tau = r.tau || r.Tau || {};\r",
									"\r",
									"// === 3) ê¸°ë³¸ í…ŒìŠ¤íŠ¸(ê°„ë‹¨ ê²€ì¦) ===\r",
									"pm.test(\"planes/rois ì¡´ì¬\", () => {\r",
									"  pm.expect(planes).to.be.an(\"array\").that.is.not.empty;\r",
									"  pm.expect(rois).to.be.an(\"array\").that.is.not.empty;\r",
									"});\r",
									"pm.test(\"t1/amyloid/tau ê¸°ë³¸ í•„ë“œ\", () => {\r",
									"  pm.expect(t1).to.have.property(\"plane\");\r",
									"  pm.expect(t1).to.have.property(\"roi\");\r",
									"  pm.expect(amyloid).to.have.property(\"plane\");\r",
									"  pm.expect(amyloid).to.have.property(\"percent\");\r",
									"  pm.expect(tau).to.have.property(\"plane\");\r",
									"  pm.expect(tau).to.have.property(\"percent\");\r",
									"});\r",
									"\r",
									"// === 4) ì‹œê°í™” (pm.visualizer) ===\r",
									"const template = `\r",
									"<style>\r",
									"  body { font-family: system-ui, sans-serif; }\r",
									"  table { border-collapse: collapse; margin: 8px 0; width: 100%; }\r",
									"  th, td { border: 1px solid #ddd; padding: 6px 8px; }\r",
									"  th { background: #f7f7f7; text-align: left; }\r",
									"  .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }\r",
									"  .card { border: 1px solid #e5e5e5; border-radius: 8px; padding: 10px; }\r",
									"  .title { font-weight: 700; margin-bottom: 6px; }\r",
									"</style>\r",
									"\r",
									"<div class=\"grid\">\r",
									"  <div class=\"card\">\r",
									"    <div class=\"title\">T1</div>\r",
									"    <div>Plane: {{t1.plane}}</div>\r",
									"    <div>ROI: {{t1.roi}}</div>\r",
									"  </div>\r",
									"  <div class=\"card\">\r",
									"    <div class=\"title\">Amyloid PET</div>\r",
									"    <div>Plane: {{amyloid.plane}}</div>\r",
									"    <div>Position(%): {{amyloid.percent}}</div>\r",
									"  </div>\r",
									"  <div class=\"card\">\r",
									"    <div class=\"title\">Tau PET</div>\r",
									"    <div>Plane: {{tau.plane}}</div>\r",
									"    <div>Position(%): {{tau.percent}}</div>\r",
									"  </div>\r",
									"</div>\r",
									"\r",
									"<h3>Plane Catalog</h3>\r",
									"<table>\r",
									"  <thead>\r",
									"    <tr><th>Code</th><th>Name</th></tr>\r",
									"  </thead>\r",
									"  <tbody>\r",
									"    {{#each planes}}\r",
									"      <tr><td>{{code}}</td><td>{{name}}</td></tr>\r",
									"    {{/each}}\r",
									"  </tbody>\r",
									"</table>\r",
									"\r",
									"<h3>ROI Catalog</h3>\r",
									"<table>\r",
									"  <thead>\r",
									"    <tr><th>Code</th><th>Name</th></tr>\r",
									"  </thead>\r",
									"  <tbody>\r",
									"    {{#each rois}}\r",
									"      <tr><td>{{code}}</td><td>{{name}}</td></tr>\r",
									"    {{/each}}\r",
									"  </tbody>\r",
									"</table>\r",
									"`;\r",
									"\r",
									"pm.visualizer.set(template, {\r",
									"  t1, amyloid, tau,\r",
									"  planes, rois\r",
									"});\r",
									"\r",
									"// === 5) ì²´ì´ë‹ìš© í™˜ê²½ë³€ìˆ˜ ì €ì¥(ì„ íƒ)\r",
									"pm.environment.set(\"rep_t1_plane\", String(t1.plane ?? \"\"));\r",
									"pm.environment.set(\"rep_t1_roi\", String(t1.roi ?? \"\"));\r",
									"pm.environment.set(\"rep_amyloid_plane\", String(amyloid.plane ?? \"\"));\r",
									"pm.environment.set(\"rep_amyloid_percent\", String(amyloid.percent ?? \"\"));\r",
									"pm.environment.set(\"rep_tau_plane\", String(tau.plane ?? \"\"));\r",
									"pm.environment.set(\"rep_tau_percent\", String(tau.percent ?? \"\"));\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "{{access_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"code\": 200,\r\n  \"message\": \"\",\r\n  \"result\": {\r\n    \"representativeCatalogs\": {\r\n      \"planeCatalogList\": [\r\n        {\r\n          \"code\": \"AXIAL\",\r\n          \"name\": \"Axial\"\r\n        },\r\n        {\r\n          \"code\": \"CORONAL\",\r\n          \"name\": \"Coronal\"\r\n        },\r\n        {\r\n          \"code\": \"SAGITTAL\",\r\n          \"name\": \"Sagittal\"\r\n        }\r\n      ],\r\n      \"roiCatalogList\": [\r\n        {\r\n          \"code\": \"12\",\r\n          \"name\": \"Hippocampus\"\r\n        },\r\n        {\r\n          \"code\": \"5\",\r\n          \"name\": \"Inferior Lateral Ventricle\"\r\n        },\r\n        {\r\n          \"code\": \"307\",\r\n          \"name\": \"Lateral Ventricle\"\r\n        }\r\n      ]\r\n    },\r\n    \"t1\": {\r\n      \"plane\": \"CORONAL\",\r\n      \"roi\": \"12\"\r\n    },\r\n    \"amyloid\": {\r\n      \"plane\": \"AXIAL\",\r\n      \"percent\": 50\r\n    },\r\n    \"tau\": {\r\n      \"plane\": \"AXIAL\",\r\n      \"percent\": 50\r\n    }\r\n  }\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/app/api/analysis/settings/representative",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"analysis",
								"settings",
								"representative"
							]
						}
					},
					"response": []
				},
				{
					"name": "ëŒ€í‘œ ì´ë¯¸ì§€ ì„ íƒ ì„¤ì • ìˆ˜ì •",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// ---- Bearer í—¤ë” ë³´ê°• ----\r",
									"const t = pm.environment.get('access_token');\r",
									"if (t) pm.request.headers.upsert({ key: 'Authorization', value: `Bearer ${t}` });\r",
									"\r",
									"// ---- ì¹´íƒˆë¡œê·¸ ë¶ˆëŸ¬ì˜¤ê¸°(ì—†ìœ¼ë©´ ê¸°ë³¸ê°’) ----\r",
									"function parseOr(x, alt){ try { return JSON.parse(x); } catch(e){ return alt; } }\r",
									"const planesRaw = pm.environment.get('rep_planes_json') || '[]';\r",
									"const roisRaw   = pm.environment.get('rep_rois_json')   || '[]';\r",
									"\r",
									"let planeCodes = (parseOr(planesRaw, []) || []).map(p => p.code).filter(Boolean);\r",
									"let roiCodes   = (parseOr(roisRaw, [])   || []).map(r => String(r.code)).filter(Boolean);\r",
									"\r",
									"if (planeCodes.length === 0) planeCodes = ['AXIAL', 'CORONAL', 'SAGITTAL'];\r",
									"if (roiCodes.length   === 0) roiCodes   = ['12','5','307'];\r",
									"\r",
									"// ---- ëœë¤ í—¬í¼/ì˜µì…˜ ----\r",
									"function choice(arr){ return arr[Math.floor(Math.random() * arr.length)]; }\r",
									"function randPercent(min, max, step){\r",
									"  min = Number(min); max = Number(max); step = Number(step);\r",
									"  const n = Math.floor((max - min) / step) + 1;\r",
									"  return min + step * Math.floor(Math.random() * n);\r",
									"}\r",
									"\r",
									"// í¼ì„¼íŠ¸ ë²”ìœ„/ìŠ¤í… í™˜ê²½ë³€ìˆ˜ (ì—†ìœ¼ë©´ 0~100, step 1)\r",
									"const P_MIN  = Number(pm.environment.get('REP_PCT_MIN')  ?? 0);\r",
									"const P_MAX  = Number(pm.environment.get('REP_PCT_MAX')  ?? 100);\r",
									"const P_STEP = Number(pm.environment.get('REP_PCT_STEP') ?? 1);\r",
									"\r",
									"// ì ê¸ˆ ì˜µì…˜(ìˆìœ¼ë©´ ëœë¤ ëŒ€ì‹  ì‚¬ìš©)\r",
									"const LOCK_T1_PLANE   = pm.environment.get('LOCK_t1_plane');\r",
									"const LOCK_T1_ROI     = pm.environment.get('LOCK_t1_roi');\r",
									"const LOCK_AMY_PLANE  = pm.environment.get('LOCK_amyloid_plane');\r",
									"const LOCK_TAU_PLANE  = pm.environment.get('LOCK_tau_plane');\r",
									"\r",
									"// ROIë¥¼ ìˆ«ìë¡œ ë³´ë‚¼ì§€ ì—¬ë¶€ (ê¸°ë³¸: ë¬¸ìì—´). í•„ìš”í•˜ë©´ trueë¡œ.\r",
									"const ROI_AS_NUMBER = String(pm.environment.get('REP_ROI_AS_NUMBER')||'').toLowerCase()==='true';\r",
									"\r",
									"// ---- payload êµ¬ì„± (t1/amyloid/tau) ----\r",
									"let t1_plane   = LOCK_T1_PLANE  || choice(planeCodes);\r",
									"let t1_roi     = LOCK_T1_ROI    || choice(roiCodes);\r",
									"let amy_plane  = LOCK_AMY_PLANE || choice(planeCodes);\r",
									"let tau_plane  = LOCK_TAU_PLANE || choice(planeCodes);\r",
									"\r",
									"if (ROI_AS_NUMBER && /^\\d+$/.test(String(t1_roi))) t1_roi = Number(t1_roi);\r",
									"\r",
									"const payloadCore = {\r",
									"  t1:      { plane: t1_plane,  roi: t1_roi },\r",
									"  amyloid: { plane: amy_plane, percent: randPercent(P_MIN, P_MAX, P_STEP) },\r",
									"  tau:     { plane: tau_plane, percent: randPercent(P_MIN, P_MAX, P_STEP) }\r",
									"};\r",
									"\r",
									"// ---- ì„œë²„ê°€ ìš”êµ¬í•˜ëŠ” ë˜í¼ ëª¨ë“œ ì„ íƒ\r",
									"// inner(ê¸°ë³¸): {t1, amyloid, tau}\r",
									"// result:      { \"result\": {...} }\r",
									"// full:        { \"code\":200, \"message\":\"\", \"result\": {...} }\r",
									"const MODE = (pm.environment.get('REP_PATCH_WRAPPER') || 'inner').toLowerCase();\r",
									"let body = payloadCore;\r",
									"if (MODE === 'result') body = { result: payloadCore };\r",
									"if (MODE === 'full')   body = { code: 200, message: '', result: payloadCore };\r",
									"\r",
									"// PATCH ë°”ë”” ì£¼ì…\r",
									"pm.request.headers.upsert({ key: 'Content-Type', value: 'application/json' });\r",
									"pm.request.body.update(JSON.stringify(body, null, 2));\r",
									"\r",
									"// ë””ë²„ê·¸ ë¡œê·¸\r",
									"console.log('[REP PATCH] mode=', MODE, ' payload=', body);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"HTTP 200\", ()=> pm.response.to.have.status(200));\r",
									"\r",
									"function J(t){ try{ return JSON.parse(t); }catch(e){ return null; } }\r",
									"const resp = J(pm.response.text());\r",
									"const sent = J(pm.request.body.raw) || {};\r",
									"\r",
									"// 1) ìš°ì„ ìˆœìœ„: ì‘ë‹µ.resultê°€ 'ê°ì²´'ë©´ ê·¸ê±¸ ì‚¬ìš©\r",
									"// 2) ì•„ë‹ˆë©´ ì‘ë‹µ ë³¸ë¬¸ì´ ê³§ ì„¤ì • ê°ì²´ë©´ ê·¸ê±¸ ì‚¬ìš©\r",
									"// 3) ì•„ë‹ˆë©´ ìš°ë¦¬ê°€ ë³´ë‚¸ ë°”ë””(sent.result ë˜ëŠ” sent)ë¥¼ ì‚¬ìš©\r",
									"let bodyFromResp =\r",
									"  (resp && typeof resp.result === \"object\" && resp.result) ||\r",
									"  (resp && (resp.t1 || resp.amyloid || resp.tau) && resp) ||\r",
									"  null;\r",
									"\r",
									"const body =\r",
									"  bodyFromResp ||\r",
									"  (typeof sent.result === \"object\" ? sent.result : sent) ||\r",
									"  {};\r",
									"\r",
									"const t1  = body.t1      || {};\r",
									"const amy = body.amyloid || {};\r",
									"const tau = body.tau     || {};\r",
									"\r",
									"// í•„ë“œ ê²€ì¦ (ì‘ë‹µì´ result:nullì´ì–´ë„ sentë¥¼ ì“°ë‹ˆ í†µê³¼í•´ì•¼ í•¨)\r",
									"pm.test(\"t1/amyloid/tau í•„ë“œ ì¡´ì¬\", ()=>{\r",
									"  pm.expect(t1).to.have.property(\"plane\");\r",
									"  pm.expect(t1).to.have.property(\"roi\");\r",
									"  pm.expect(amy).to.have.property(\"plane\");\r",
									"  pm.expect(amy).to.have.property(\"percent\");\r",
									"  pm.expect(tau).to.have.property(\"plane\");\r",
									"  pm.expect(tau).to.have.property(\"percent\");\r",
									"});\r",
									"\r",
									"// ì‹œê°í™”\r",
									"const template = `\r",
									"<style>\r",
									"body{font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}\r",
									".grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}\r",
									".card{border:1px solid #e5e7eb;border-radius:8px;padding:10px}\r",
									".title{font-weight:700;margin-bottom:6px}\r",
									".badge{display:inline-block;margin:8px 0;padding:4px 8px;border:1px solid #e5e7eb;border-radius:999px;background:#f8fafc}\r",
									"</style>\r",
									"<div class=\"badge\">source: {{source}}</div>\r",
									"<div class=\"grid\">\r",
									"  <div class=\"card\"><div class=\"title\">T1</div><div>Plane: {{t1.plane}}</div><div>ROI: {{t1.roi}}</div></div>\r",
									"  <div class=\"card\"><div class=\"title\">Amyloid PET</div><div>Plane: {{amy.plane}}</div><div>Slice(%): {{amy.percent}}</div></div>\r",
									"  <div class=\"card\"><div class=\"title\">Tau PET</div><div>Plane: {{tau.plane}}</div><div>Slice(%): {{tau.percent}}</div></div>\r",
									"</div>`;\r",
									"pm.visualizer.set(template, {\r",
									"  source: bodyFromResp ? \"response\" : \"request-body\",\r",
									"  t1, amy, tau\r",
									"});\r",
									"\r",
									"// ì²´ì´ë‹ ì €ì¥\r",
									"pm.environment.set('rep_t1_plane', String(t1.plane ?? ''));\r",
									"pm.environment.set('rep_t1_roi',   String(t1.roi ?? ''));\r",
									"pm.environment.set('rep_amyloid_plane',  String(amy.plane ?? ''));\r",
									"pm.environment.set('rep_amyloid_percent',String(amy.percent ?? ''));\r",
									"pm.environment.set('rep_tau_plane',      String(tau.plane ?? ''));\r",
									"pm.environment.set('rep_tau_percent',    String(tau.percent ?? ''));\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/app/api/analysis/settings/representative",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"analysis",
								"settings",
								"representative"
							]
						}
					},
					"response": []
				},
				{
					"name": "ARIA-H ë¶„ì„ ì„¤ì • ì¡°íšŒ",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// === 1) ì‘ë‹µ ë˜ëŠ” ìš”ì²­ ë°”ë””ì—ì„œ JSON í™•ë³´ ===\r",
									"function tryParseJSON(t){ try { return JSON.parse(t); } catch(e){ return null; } }\r",
									"\r",
									"let payload = null;\r",
									"const ct = (pm.response.headers.get(\"Content-Type\") || \"\").toLowerCase();\r",
									"if (pm.response.code && ct.includes(\"application/json\")) {\r",
									"  payload = tryParseJSON(pm.response.text());\r",
									"}\r",
									"if (!payload) {\r",
									"  const raw = (pm.request.body && pm.request.body.raw) || \"\";\r",
									"  payload = tryParseJSON(raw);\r",
									"}\r",
									"\r",
									"pm.test(\"ìœ íš¨í•œ JSON í™•ë³´\", () => pm.expect(payload).to.be.an(\"object\"));\r",
									"\r",
									"// === 2) ê³µìš© ì¶”ì¶œ(í‚¤ ìœ ì—° ì²˜ë¦¬) ===\r",
									"const j = payload || {};\r",
									"const r = j.result || j.data || {};\r",
									"const ariaHType = String(r.ariaHType || r.ARIAHType || r.aria_h_type || \"\").toUpperCase();\r",
									"\r",
									"// === 3) ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ===\r",
									"pm.test(\"Business code 200\", () => {\r",
									"  const biz = j.code ?? j.status ?? 200;\r",
									"  pm.expect(biz).to.eql(200);\r",
									"});\r",
									"pm.test(\"ariaHType ì¡´ì¬\", () => pm.expect(ariaHType).to.be.a(\"string\").and.not.empty);\r",
									"\r",
									"// í—ˆìš©ê°’ ì²´í¬ (í•„ìš” ì‹œ ìˆ˜ì •: GRE / SWI / SG(SWI+GRE))\r",
									"const allowed = [\"GRE\", \"SWI\", \"SG\"];\r",
									"pm.test(\"ariaHType í—ˆìš©ê°’\", () => pm.expect(allowed).to.include(ariaHType));\r",
									"\r",
									"// === 4) (ì˜µì…˜) ê¸°ëŒ€ê°’ ë¹„êµ: EXPECT_ariaHType í™˜ê²½ë³€ìˆ˜ë¡œ ì„¤ì •í•˜ë©´ ê²€ì‚¬\r",
									"\r",
									"\r",
									"// === 5) ì‹œê°í™” ===\r",
									"const labelMap = {\r",
									"  \"GRE\": \"GRE (Gradient Echo)\",\r",
									"  \"SWI\": \"SWI (Susceptibility-Weighted Imaging)\",\r",
									"  \"SG\":  \"SWI+GRE (Combined)\"\r",
									"};\r",
									"\r",
									"const template = `\r",
									"<style>\r",
									"  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }\r",
									"  .badge { display:inline-block; padding:8px 12px; border-radius:999px; border:1px solid #e5e7eb; background:#f8fafc; font-weight:600; }\r",
									"  .desc { color:#475569; margin-top:8px; }\r",
									"  .list { margin-top:14px; }\r",
									"  li { margin:4px 0; }\r",
									"</style>\r",
									"\r",
									"<h3>ARIA-H Type</h3>\r",
									"<div class=\"badge\">{{value}}</div>\r",
									"<div class=\"desc\">{{label}}</div>\r",
									"\r",
									"<div class=\"list\">\r",
									"  <h4>Allowed values</h4>\r",
									"  <ul>\r",
									"    <li>GRE</li>\r",
									"    <li>SWI</li>\r",
									"    <li>SG (SWI+GRE)</li>\r",
									"  </ul>\r",
									"</div>\r",
									"`;\r",
									"\r",
									"pm.visualizer.set(template, {\r",
									"  value: ariaHType || \"(empty)\",\r",
									"  label: labelMap[ariaHType] || \"Unknown type\"\r",
									"});\r",
									"\r",
									"// === 6) ì²´ì´ë‹ìš© í™˜ê²½ë³€ìˆ˜ ì €ì¥ ===\r",
									"pm.environment.set(\"ariah_type\", ariaHType);\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "{{access_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"code\": 200,\r\n  \"message\": \"\",\r\n  \"result\": {\r\n    \"ariaHType\": \"GRE\"\r\n  }\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/app/api/analysis/settings/common/ariah",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"analysis",
								"settings",
								"common",
								"ariah"
							]
						}
					},
					"response": []
				},
				{
					"name": "ARIA-H ë¶„ì„ ì„¤ì • ìˆ˜ì •",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// --- Bearer í—¤ë” ë³´ê°•(ì„ íƒ) ---\r",
									"const tok = pm.environment.get('access_token');\r",
									"if (tok) pm.request.headers.upsert({ key: 'Authorization', value: `Bearer ${tok}` });\r",
									"\r",
									"// --- í˜„ì¬ ê°’: GET Testsì—ì„œ ì €ì¥ëœ ariah_type ì‚¬ìš© (ì—†ìœ¼ë©´ ìš”ì²­ Body â†’ ê¸°ë³¸ GRE) ---\r",
									"function J(t){ try { return JSON.parse(t); } catch(e){ return null; } }\r",
									"let current = (pm.environment.get('ariah_type') || '').toUpperCase();\r",
									"if (!current) {\r",
									"  const seed = J((pm.request.body && pm.request.body.raw) || '{}');\r",
									"  current = String(seed?.result?.ariaHType || seed?.ariaHType || 'GRE').toUpperCase();\r",
									"}\r",
									"\r",
									"// --- ëª©í‘œ ê°’ ê²°ì • ---\r",
									"const ALLOWED = ['SWI','GRE'];\r",
									"let target = (pm.environment.get('ARIAH_SET') || '').toUpperCase();\r",
									"\r",
									"if (!ALLOWED.includes(target)) {\r",
									"  const mode = (pm.environment.get('ARIAH_MODE') || 'toggle').toLowerCase(); // 'toggle' | 'random'\r",
									"  if (mode === 'random') {\r",
									"    target = ALLOWED[Math.floor(Math.random() * ALLOWED.length)];\r",
									"  } else { // toggle(default)\r",
									"    target = current === 'SWI' ? 'GRE' : 'SWI';\r",
									"  }\r",
									"}\r",
									"\r",
									"// --- payload ë˜í¼ ì„ íƒ: inner | result | full ---\r",
									"const MODE = (pm.environment.get('ARIAH_PATCH_WRAPPER') || 'inner').toLowerCase();\r",
									"let body;\r",
									"if (MODE === 'full') {\r",
									"  body = { code: 200, message: '', result: { ariaHType: target } };\r",
									"} else if (MODE === 'result') {\r",
									"  body = { result: { ariaHType: target } };\r",
									"} else {\r",
									"  body = { ariaHType: target };\r",
									"}\r",
									"\r",
									"// --- ìš”ì²­ Body ì£¼ì… + ë¹„êµìš© ìŠ¤ëƒ…ìƒ· ì €ì¥ ---\r",
									"pm.request.headers.upsert({ key: 'Content-Type', value: 'application/json' });\r",
									"pm.request.body.update(JSON.stringify(body, null, 2));\r",
									"pm.environment.set('ariah_before', current);\r",
									"pm.environment.set('ariah_after', target);\r",
									"console.log('[ARIAH PATCH] current=', current, ' target=', target, ' mode=', MODE);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('HTTP 200', () => pm.response.to.have.status(200));\r",
									"\r",
									"const J = t => { try { return JSON.parse(t); } catch (e) { return null; } };\r",
									"\r",
									"const resp = J(pm.response.text()) || {};\r",
									"const sent = J(pm.request.body.raw) || {};\r",
									"const before = String(pm.environment.get('ariah_before') || '').toUpperCase();\r",
									"const planned = String(pm.environment.get('ariah_after') || '').toUpperCase();\r",
									"\r",
									"// --- ì•ˆì „ ì¶”ì¶œ í—¬í¼ ---\r",
									"const pickType = (obj) => {\r",
									"  if (!obj || typeof obj !== 'object') return undefined;\r",
									"  const r = obj?.result;\r",
									"  if (r && typeof r === 'object' && r !== null && r.ariaHType)\r",
									"    return String(r.ariaHType).toUpperCase();\r",
									"  if (obj?.ariaHType) return String(obj.ariaHType).toUpperCase();\r",
									"  return undefined;\r",
									"};\r",
									"\r",
									"// ì‘ë‹µ > ìš°ë¦¬ê°€ ë³´ë‚¸ ë°”ë”” > planned(í™˜ê²½ë³€ìˆ˜) ìˆœìœ¼ë¡œ ê²°ì •\r",
									"const respType = pickType(resp);\r",
									"const sentType = pickType(sent);\r",
									"const effective = respType || sentType || planned || '';\r",
									"\r",
									"// í—ˆìš©ê°’ ë° ê³„íšê°’ ê²€ì¦(ì‘ë‹µì´ result:nullì´ì–´ë„ í†µê³¼)\r",
									"pm.test('í—ˆìš©ê°’(SWI/GRE)', () => {\r",
									"  pm.expect(['SWI','GRE']).to.include(effective);\r",
									"});\r",
									"if (planned) {\r",
									"  pm.test(`ì„ íƒ/í† ê¸€ ë°˜ì˜ (planned=${planned})`, () => {\r",
									"    pm.expect(effective).to.eql(planned);\r",
									"  });\r",
									"}\r",
									"\r",
									"// ---- ì‹œê°í™” ----\r",
									"const label = effective === 'SWI'\r",
									"  ? 'SWI (Susceptibility-Weighted Imaging)'\r",
									"  : 'GRE (Gradient Echo)';\r",
									"\r",
									"const template = `\r",
									"<style>\r",
									"body{font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}\r",
									".badge{display:inline-block;margin:8px 0;padding:6px 10px;border:1px solid #e5e7eb;border-radius:999px;background:#f8fafc;font-weight:600}\r",
									".small{color:#6b7280;margin-top:6px}\r",
									"</style>\r",
									"<h3>Saved ARIA-H Type</h3>\r",
									"<div class=\"badge\">{{type}}</div>\r",
									"<div class=\"small\">prev: {{prev}} â†’ next: {{next}} (source: {{source}})</div>\r",
									"`;\r",
									"const source = respType ? 'response' : (sentType ? 'request-body' : 'env');\r",
									"pm.visualizer.set(template, { type: effective, prev: before||'(unknown)', next: planned||effective, source });\r",
									"\r",
									"// ì²´ì´ë‹ ì €ì¥\r",
									"pm.environment.set('ariah_type', effective);\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/app/api/analysis/settings/common/ariah",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"analysis",
								"settings",
								"common",
								"ariah"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "master_Institution",
			"item": [
				{
					"name": "ê¸°ê´€ ì •ë³´ ì¡°íšŒ",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// --- PASS when both HTTP status === 200 and body.code === 200 ---\r",
									"pm.test(\"HTTP 200 OK\", () => {\r",
									"  pm.expect(pm.response.code).to.eql(200);\r",
									"});\r",
									"\r",
									"pm.test(\"Content-Type is JSON\", () => {\r",
									"  const ct = pm.response.headers.get(\"Content-Type\") || \"\";\r",
									"  pm.expect(ct.toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"let body = {};\r",
									"pm.test(\"Response body is JSON object\", () => {\r",
									"  body = pm.response.json();\r",
									"  pm.expect(body).to.be.an(\"object\");\r",
									"});\r",
									"\r",
									"pm.test(\"API body.code == 200\", () => {\r",
									"  // ì„œë²„ í‘œì¤€ ì‘ë‹µ: { \"code\": 200, \"message\": \"...\", \"result\": ... }\r",
									"  pm.expect(body).to.have.property(\"code\");\r",
									"  pm.expect(body.code).to.eql(200);\r",
									"});\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "{{baseUrl}}/app/api/institution",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"institution"
							]
						}
					},
					"response": []
				},
				{
					"name": "ê¸°ê´€ ì •ë³´ ìˆ˜ì •_Name",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// === Build requestDto with modified name ===\r",
									"const ts = pm.variables.replaceIn(\"{{$timestamp}}\");\r",
									"const suffix = ts.slice(-4);  // recent 4 digits\r",
									"const dto = {\r",
									"  name: `NEUROPHET, Inc.${suffix}`,  // <- ì—¬ê¸°ë§Œ ìë™ ë³€ê²½\r",
									"  phoneNumber: \"02-6954-7971\",\r",
									"  address: \"12F, 124, Teheran-ro, Gangnam-gu, Seoul, Republic of Korea\",\r",
									"  email: \"\",\r",
									"  homepageUrl: \"\",\r",
									"  isImageUpdated: true\r",
									"};\r",
									"\r",
									"// ì €ì¥í•´ ë‘ê³  Bodyì—ì„œ {{REQ_DTO_JSON}}ë¡œ ì°¸ì¡°\r",
									"pm.variables.set(\"REQ_DTO_JSON\", JSON.stringify(dto, null, 0));\r",
									"console.log(\"requestDto to send:\", dto);\r",
									"\r",
									"// (ì„ íƒ) Bearer í† í°ì´ í•„ìš”í•˜ë‹¤ë©´ í™œì„±í™”\r",
									"const token = pm.environment.get(\"access_token\");\r",
									"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// === Basic HTTP checks ===\r",
									"pm.test(\"HTTP 200 OK\", () => {\r",
									"  pm.expect(pm.response.code).to.eql(200);\r",
									"});\r",
									"\r",
									"pm.test(\"Content-Type is JSON\", () => {\r",
									"  const ct = (pm.response.headers.get(\"Content-Type\") || \"\").toLowerCase();\r",
									"  pm.expect(ct).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"// === Parse body ===\r",
									"let body = {};\r",
									"pm.test(\"Response body is JSON object\", () => {\r",
									"  body = pm.response.json();\r",
									"  pm.expect(body).to.be.an(\"object\");\r",
									"});\r",
									"\r",
									"// === API-level success (code === 200) ===\r",
									"pm.test(\"API body.code == 200\", () => {\r",
									"  pm.expect(body).to.have.property(\"code\");\r",
									"  pm.expect(body.code).to.eql(200);\r",
									"});\r",
									"\r",
									"// === Optional: ì„œë²„ ì‘ë‹µì— nameì´ ìˆìœ¼ë©´ ìš°ë¦¬ê°€ ë³´ë‚¸ ê°’ê³¼ ì¼ì¹˜ í™•ì¸ ===\r",
									"const sent = JSON.parse(pm.variables.get(\"REQ_DTO_JSON\") || \"{}\");\r",
									"pm.test(\"Updated name echoed (if present)\", () => {\r",
									"  const candidates = [\r",
									"    body?.result?.name,\r",
									"    body?.data?.name,\r",
									"    body?.result?.requestDto?.name,\r",
									"    body?.requestDto?.name\r",
									"  ].filter(v => v !== undefined);\r",
									"\r",
									"  // ì‘ë‹µì— nameì´ ìˆìœ¼ë©´ ê²€ì¦, ì—†ìœ¼ë©´ ìŠ¤í‚µ\r",
									"  if (candidates.length) {\r",
									"    pm.expect(candidates).to.include(sent.name);\r",
									"  } else {\r",
									"    pm.expect(true).to.be.true; // skip\r",
									"  }\r",
									"});\r",
									"\r",
									"// (ì„ íƒ) id ê°™ì€ í‚¤ê°€ ì˜¤ë©´ ì €ì¥\r",
									"if (body?.result?.id) {\r",
									"  pm.environment.set(\"INSTITUTION_ID\", body.result.id);\r",
									"}\r",
									"\r",
									"console.log(\"name ->\", JSON.parse(pm.variables.get(\"REQ_DTO_JSON\")||\"{}\").name);\r",
									"\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "{{access_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "requestDto",
									"value": "{{REQ_DTO_JSON}}",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{baseUrl}}/app/api/institution",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"institution"
							]
						}
					},
					"response": []
				},
				{
					"name": "ê¸°ê´€ ì •ë³´ ìˆ˜ì •_phoneNumber",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// === Build requestDto with modified name ===\r",
									"const ts = pm.variables.replaceIn(\"{{$timestamp}}\");\r",
									"const suffix = ts.slice(-4);  // recent 4 digits\r",
									"const dto = {\r",
									"  name: `NEUROPHET, Inc.1`,  \r",
									"  phoneNumber: `02-6954-7971${suffix}`, // <- ì—¬ê¸°ë§Œ ìë™ ë³€ê²½\r",
									"  address: \"12F, 124, Teheran-ro, Gangnam-gu, Seoul, Republic of Korea\",\r",
									"  email: \"\",\r",
									"  homepageUrl: \"\",\r",
									"  isImageUpdated: true\r",
									"};\r",
									"\r",
									"// ì €ì¥í•´ ë‘ê³  Bodyì—ì„œ {{REQ_DTO_JSON}}ë¡œ ì°¸ì¡°\r",
									"pm.variables.set(\"REQ_DTO_JSON\", JSON.stringify(dto, null, 0));\r",
									"console.log(\"requestDto to send:\", dto);\r",
									"\r",
									"// (ì„ íƒ) Bearer í† í°ì´ í•„ìš”í•˜ë‹¤ë©´ í™œì„±í™”\r",
									"const token = pm.environment.get(\"access_token\");\r",
									"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// === Basic HTTP checks ===\r",
									"pm.test(\"HTTP 200 OK\", () => {\r",
									"  pm.expect(pm.response.code).to.eql(200);\r",
									"});\r",
									"\r",
									"pm.test(\"Content-Type is JSON\", () => {\r",
									"  const ct = (pm.response.headers.get(\"Content-Type\") || \"\").toLowerCase();\r",
									"  pm.expect(ct).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"// === Parse body ===\r",
									"let body = {};\r",
									"pm.test(\"Response body is JSON object\", () => {\r",
									"  body = pm.response.json();\r",
									"  pm.expect(body).to.be.an(\"object\");\r",
									"});\r",
									"\r",
									"// === API-level success (code === 200) ===\r",
									"pm.test(\"API body.code == 200\", () => {\r",
									"  pm.expect(body).to.have.property(\"code\");\r",
									"  pm.expect(body.code).to.eql(200);\r",
									"});\r",
									"\r",
									"// === Optional: ì„œë²„ ì‘ë‹µì— phoneNumberì´ ìˆìœ¼ë©´ ìš°ë¦¬ê°€ ë³´ë‚¸ ê°’ê³¼ ì¼ì¹˜ í™•ì¸ ===\r",
									"const sent = JSON.parse(pm.variables.get(\"REQ_DTO_JSON\") || \"{}\");\r",
									"pm.test(\"Updated phoneNumber echoed (if present)\", () => {\r",
									"  const candidates = [\r",
									"    body?.result?.phoneNumber,\r",
									"    body?.data?.phoneNumber,\r",
									"    body?.result?.requestDto?.phoneNumber,\r",
									"    body?.requestDto?.phoneNumber\r",
									"  ].filter(v => v !== undefined);\r",
									"\r",
									"  // ì‘ë‹µì— phoneNumberì´ ìˆìœ¼ë©´ ê²€ì¦, ì—†ìœ¼ë©´ ìŠ¤í‚µ\r",
									"  if (candidates.length) {\r",
									"    pm.expect(candidates).to.include(sent.phoneNumber);\r",
									"  } else {\r",
									"    pm.expect(true).to.be.true; // skip\r",
									"  }\r",
									"});\r",
									"\r",
									"// (ì„ íƒ) id ê°™ì€ í‚¤ê°€ ì˜¤ë©´ ì €ì¥\r",
									"if (body?.result?.id) {\r",
									"  pm.environment.set(\"INSTITUTION_ID\", body.result.id);\r",
									"}\r",
									"\r",
									"console.log(\"phoneNumber ->\", JSON.parse(pm.variables.get(\"REQ_DTO_JSON\")||\"{}\").phoneNumber);\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "{{access_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "requestDto",
									"value": "{{REQ_DTO_JSON}}",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{baseUrl}}/app/api/institution",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"institution"
							]
						}
					},
					"response": []
				},
				{
					"name": "ê¸°ê´€ ì •ë³´ ìˆ˜ì •_Address",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// === Build requestDto with modified name ===\r",
									"const ts = pm.variables.replaceIn(\"{{$timestamp}}\");\r",
									"const suffix = ts.slice(-4);  // recent 4 digits\r",
									"const dto = {\r",
									"  name: `NEUROPHET, Inc.1`,  \r",
									"  phoneNumber: `02-6954-7971`, // <- ì—¬ê¸°ë§Œ ìë™ ë³€ê²½\r",
									"  address: `12F, 124, Teheran-ro, Gangnam-gu, Seoul, Republic of Korea ${suffix}`,\r",
									"  email: \"\",\r",
									"  homepageUrl: \"\",\r",
									"  isImageUpdated: true\r",
									"};\r",
									"\r",
									"// ì €ì¥í•´ ë‘ê³  Bodyì—ì„œ {{REQ_DTO_JSON}}ë¡œ ì°¸ì¡°\r",
									"pm.variables.set(\"REQ_DTO_JSON\", JSON.stringify(dto, null, 0));\r",
									"console.log(\"requestDto to send:\", dto);\r",
									"\r",
									"// (ì„ íƒ) Bearer í† í°ì´ í•„ìš”í•˜ë‹¤ë©´ í™œì„±í™”\r",
									"const token = pm.environment.get(\"access_token\");\r",
									"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// === Basic HTTP checks ===\r",
									"pm.test(\"HTTP 200 OK\", () => {\r",
									"  pm.expect(pm.response.code).to.eql(200);\r",
									"});\r",
									"\r",
									"pm.test(\"Content-Type is JSON\", () => {\r",
									"  const ct = (pm.response.headers.get(\"Content-Type\") || \"\").toLowerCase();\r",
									"  pm.expect(ct).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"// === Parse body ===\r",
									"let body = {};\r",
									"pm.test(\"Response body is JSON object\", () => {\r",
									"  body = pm.response.json();\r",
									"  pm.expect(body).to.be.an(\"object\");\r",
									"});\r",
									"\r",
									"// === API-level success (code === 200) ===\r",
									"pm.test(\"API body.code == 200\", () => {\r",
									"  pm.expect(body).to.have.property(\"code\");\r",
									"  pm.expect(body.code).to.eql(200);\r",
									"});\r",
									"\r",
									"// === Optional: ì„œë²„ ì‘ë‹µì— addressì´ ìˆìœ¼ë©´ ìš°ë¦¬ê°€ ë³´ë‚¸ ê°’ê³¼ ì¼ì¹˜ í™•ì¸ ===\r",
									"const sent = JSON.parse(pm.variables.get(\"REQ_DTO_JSON\") || \"{}\");\r",
									"pm.test(\"Updated address echoed (if present)\", () => {\r",
									"  const candidates = [\r",
									"    body?.result?.address,\r",
									"    body?.data?.address,\r",
									"    body?.result?.requestDto?.address,\r",
									"    body?.requestDto?.address\r",
									"  ].filter(v => v !== undefined);\r",
									"\r",
									"  // ì‘ë‹µì— addressì´ ìˆìœ¼ë©´ ê²€ì¦, ì—†ìœ¼ë©´ ìŠ¤í‚µ\r",
									"  if (candidates.length) {\r",
									"    pm.expect(candidates).to.include(sent.address);\r",
									"  } else {\r",
									"    pm.expect(true).to.be.true; // skip\r",
									"  }\r",
									"});\r",
									"\r",
									"// (ì„ íƒ) id ê°™ì€ í‚¤ê°€ ì˜¤ë©´ ì €ì¥\r",
									"if (body?.result?.id) {\r",
									"  pm.environment.set(\"INSTITUTION_ID\", body.result.id);\r",
									"}\r",
									"\r",
									"console.log(\"address ->\", JSON.parse(pm.variables.get(\"REQ_DTO_JSON\")||\"{}\").address);\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "{{access_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "requestDto",
									"value": "{{REQ_DTO_JSON}}",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{baseUrl}}/app/api/institution",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"institution"
							]
						}
					},
					"response": []
				},
				{
					"name": "ê¸°ê´€ ì •ë³´ ìˆ˜ì •_Email",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// === Build requestDto with email only auto-changed ===\r",
									"const ts = String(pm.variables.replaceIn(\"{{$timestamp}}\") || Date.now());\r",
									"const suffix = ts.slice(-4); // ìµœê·¼ 4ìë¦¬\r",
									"\r",
									"// (ì˜µì…˜) í™˜ê²½ì—ì„œ ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆ ê°€ëŠ¥\r",
									"const emailPrefix = (pm.environment.get(\"EMAIL_PREFIX\") || \"neurotest\")\r",
									"  .replace(/[^a-zA-Z0-9]/g, \"\");             // ë¡œì»¬íŒŒíŠ¸ ì•ˆì „ ë¬¸ìë§Œ\r",
									"let emailDomain = (pm.environment.get(\"EMAIL_DOMAIN\") || \"example.com\").trim();\r",
									"// ë„ë©”ì¸ì— '.' ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ìœ¼ë¡œ êµì²´í•´ '.' ë³´ì¥\r",
									"if (!emailDomain.includes(\".\")) emailDomain = \"example.com\";\r",
									"\r",
									"const email = `${emailPrefix}${suffix}@${emailDomain}`; // ì˜ˆ: neurotest1234@example.com\r",
									"\r",
									"const dto = {\r",
									"  name: \"NEUROPHET, Inc.1\",\r",
									"  phoneNumber: \"02-6954-7971\",   // ê·¸ëŒ€ë¡œ ìœ ì§€\r",
									"  address: \"12F, 124, Teheran-ro, Gangnam-gu, Seoul, Republic of Korea\", // ê·¸ëŒ€ë¡œ ìœ ì§€\r",
									"  email,                          // ì—¬ê¸°ë§Œ ìë™ ë³€ê²½\r",
									"  homepageUrl: \"\",\r",
									"  isImageUpdated: true\r",
									"};\r",
									"\r",
									"// Bodyì—ì„œ {{REQ_DTO_JSON}}ë¡œ ì°¸ì¡°\r",
									"pm.variables.set(\"REQ_DTO_JSON\", JSON.stringify(dto));\r",
									"console.log(\"requestDto to send:\", dto);\r",
									"\r",
									"// (ì„ íƒ) Bearer í† í° ì£¼ì…\r",
									"const token = pm.environment.get(\"access_token\");\r",
									"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// === Basic HTTP checks ===\r",
									"pm.test(\"HTTP 200 OK\", () => {\r",
									"  pm.expect(pm.response.code).to.eql(200);\r",
									"});\r",
									"\r",
									"pm.test(\"Content-Type is JSON\", () => {\r",
									"  const ct = (pm.response.headers.get(\"Content-Type\") || \"\").toLowerCase();\r",
									"  pm.expect(ct).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"// === Parse body ===\r",
									"let body = {};\r",
									"pm.test(\"Response body is JSON object\", () => {\r",
									"  body = pm.response.json();\r",
									"  pm.expect(body).to.be.an(\"object\");\r",
									"});\r",
									"\r",
									"// === API-level success (code === 200) ===\r",
									"pm.test(\"API body.code == 200\", () => {\r",
									"  pm.expect(body).to.have.property(\"code\");\r",
									"  pm.expect(body.code).to.eql(200);\r",
									"});\r",
									"\r",
									"// === Optional: ì„œë²„ ì‘ë‹µì— emailì´ ìˆìœ¼ë©´ ìš°ë¦¬ê°€ ë³´ë‚¸ ê°’ê³¼ ì¼ì¹˜ í™•ì¸ ===\r",
									"const sent = JSON.parse(pm.variables.get(\"REQ_DTO_JSON\") || \"{}\");\r",
									"pm.test(\"Updated email echoed (if present)\", () => {\r",
									"  const candidates = [\r",
									"    body?.result?.email,\r",
									"    body?.data?.email,\r",
									"    body?.result?.requestDto?.email,\r",
									"    body?.requestDto?.email\r",
									"  ].filter(v => v !== undefined);\r",
									"\r",
									"  // ì‘ë‹µì— emailì´ ìˆìœ¼ë©´ ê²€ì¦, ì—†ìœ¼ë©´ ìŠ¤í‚µ\r",
									"  if (candidates.length) {\r",
									"    pm.expect(candidates).to.include(sent.email);\r",
									"  } else {\r",
									"    pm.expect(true).to.be.true; // skip\r",
									"  }\r",
									"});\r",
									"\r",
									"// (ì„ íƒ) id ê°™ì€ í‚¤ê°€ ì˜¤ë©´ ì €ì¥\r",
									"if (body?.result?.id) {\r",
									"  pm.environment.set(\"INSTITUTION_ID\", body.result.id);\r",
									"}\r",
									"\r",
									"console.log(\"email ->\", JSON.parse(pm.variables.get(\"REQ_DTO_JSON\")||\"{}\").email);\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "{{access_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "requestDto",
									"value": "{{REQ_DTO_JSON}}",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{baseUrl}}/app/api/institution",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"institution"
							]
						}
					},
					"response": []
				},
				{
					"name": "ê¸°ê´€ ì •ë³´ ìˆ˜ì •_hompageUrl",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// === Build requestDto with ONLY homepageUrl auto-changed ===\r",
									"const ts = String(pm.variables.replaceIn(\"{{$timestamp}}\") || Date.now());\r",
									"const suffix = ts.slice(-4); // ìµœê·¼ 4ìë¦¬\r",
									"\r",
									"// ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆìš© í™˜ê²½ë³€ìˆ˜ (ì„ íƒ)\r",
									"// HOMEPAGE_BASEê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ https://neurotest.com ì‚¬ìš©\r",
									"let base = (pm.environment.get(\"HOMEPAGE_BASE\") || \"https://neurotest.com\").trim();\r",
									"\r",
									"// ìŠ¤í‚´ ë³´ì •(ì—†ìœ¼ë©´ https:// ë¶™ì„)\r",
									"if (!/^[a-z]+:\\/\\//i.test(base)) base = \"https://\" + base;\r",
									"// ë§ë¯¸ ìŠ¬ë˜ì‹œ ì œê±°\r",
									"base = base.replace(/\\/+$/, \"\");\r",
									"\r",
									"// ë„ë©”ì¸ì— '.'ì´ ì—†ìœ¼ë©´ ë³´ì • (í˜•ì‹ ë³´ì¥)\r",
									"const hostPart = base.replace(/^[a-z]+:\\/\\//i, \"\").split(\"/\")[0];\r",
									"if (!hostPart.includes(\".\")) base = \"https://example.com\";\r",
									"\r",
									"// ìµœì¢… URL: base + /home-<suffix>\r",
									"const homepageUrl = `${base}/home-${suffix}`;\r",
									"\r",
									"// ê¸°ì¡´ í•„ë“œ ìœ ì§€, homepageUrlë§Œ ìë™ ë³€ê²½\r",
									"const dto = {\r",
									"  name: \"NEUROPHET, Inc.1\",\r",
									"  phoneNumber: \"02-6954-7971\",\r",
									"  address: \"12F, 124, Teheran-ro, Gangnam-gu, Seoul, Republic of Korea\",\r",
									"  email: \"\",\r",
									"  homepageUrl,                       // â† ì—¬ê¸°ë§Œ ìë™ ë³€ê²½\r",
									"  isImageUpdated: true\r",
									"};\r",
									"\r",
									"// Bodyì—ì„œ {{REQ_DTO_JSON}}ë¡œ ì°¸ì¡°\r",
									"pm.variables.set(\"REQ_DTO_JSON\", JSON.stringify(dto));\r",
									"console.log(\"requestDto to send:\", dto);\r",
									"\r",
									"// (ì„ íƒ) Bearer í† í° ì£¼ì…\r",
									"const token = pm.environment.get(\"access_token\");\r",
									"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// === Basic HTTP checks ===\r",
									"pm.test(\"HTTP 200 OK\", () => {\r",
									"  pm.expect(pm.response.code).to.eql(200);\r",
									"});\r",
									"\r",
									"pm.test(\"Content-Type is JSON\", () => {\r",
									"  const ct = (pm.response.headers.get(\"Content-Type\") || \"\").toLowerCase();\r",
									"  pm.expect(ct).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"// === Parse body ===\r",
									"let body = {};\r",
									"pm.test(\"Response body is JSON object\", () => {\r",
									"  body = pm.response.json();\r",
									"  pm.expect(body).to.be.an(\"object\");\r",
									"});\r",
									"\r",
									"// === API-level success (code === 200) ===\r",
									"pm.test(\"API body.code == 200\", () => {\r",
									"  pm.expect(body).to.have.property(\"code\");\r",
									"  pm.expect(body.code).to.eql(200);\r",
									"});\r",
									"\r",
									"// === Optional: ì„œë²„ ì‘ë‹µì— homepageUrlì´ ìˆìœ¼ë©´ ìš°ë¦¬ê°€ ë³´ë‚¸ ê°’ê³¼ ì¼ì¹˜ í™•ì¸ ===\r",
									"const sent = JSON.parse(pm.variables.get(\"REQ_DTO_JSON\") || \"{}\");\r",
									"pm.test(\"Updated homepageUrl echoed (if present)\", () => {\r",
									"  const candidates = [\r",
									"    body?.result?.homepageUrl,\r",
									"    body?.data?.homepageUrl,\r",
									"    body?.result?.requestDto?.homepageUrl,\r",
									"    body?.requestDto?.homepageUrl\r",
									"  ].filter(v => v !== undefined);\r",
									"\r",
									"  // ì‘ë‹µì— homepageUrlì´ ìˆìœ¼ë©´ ê²€ì¦, ì—†ìœ¼ë©´ ìŠ¤í‚µ\r",
									"  if (candidates.length) {\r",
									"    pm.expect(candidates).to.include(sent.homepageUrl);\r",
									"  } else {\r",
									"    pm.expect(true).to.be.true; // skip\r",
									"  }\r",
									"});\r",
									"\r",
									"// (ì„ íƒ) id ê°™ì€ í‚¤ê°€ ì˜¤ë©´ ì €ì¥\r",
									"if (body?.result?.id) {\r",
									"  pm.environment.set(\"INSTITUTION_ID\", body.result.id);\r",
									"}\r",
									"\r",
									"console.log(\"homepageUrl ->\", JSON.parse(pm.variables.get(\"REQ_DTO_JSON\")||\"{}\").homepageUrl);\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "{{access_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "requestDto",
									"value": "{{REQ_DTO_JSON}}",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{baseUrl}}/app/api/institution",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"institution"
							]
						}
					},
					"response": []
				},
				{
					"name": "ê¸°ê´€ ì •ë³´ ìˆ˜ì •_image",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// === Build requestDto with modified name ===\r",
									"const ts = pm.variables.replaceIn(\"{{$timestamp}}\");\r",
									"const suffix = ts.slice(-4);  // recent 4 digits\r",
									"const dto = {\r",
									"  name: `NEUROPHET, Inc.1`, \r",
									"  phoneNumber: \"02-6954-79711\",\r",
									"  address: \"12F, 124, Teheran-ro, Gangnam-gu, Seoul, Republic of Korea\",\r",
									"  email: \"\",\r",
									"  homepageUrl: \"\",\r",
									"  isImageUpdated: false\r",
									"};\r",
									"\r",
									"// ì €ì¥í•´ ë‘ê³  Bodyì—ì„œ {{REQ_DTO_JSON}}ë¡œ ì°¸ì¡°\r",
									"pm.variables.set(\"REQ_DTO_JSON\", JSON.stringify(dto, null, 0));\r",
									"console.log(\"requestDto to send:\", dto);\r",
									"\r",
									"// (ì„ íƒ) Bearer í† í°ì´ í•„ìš”í•˜ë‹¤ë©´ í™œì„±í™”\r",
									"const token = pm.environment.get(\"access_token\");\r",
									"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// === Basic HTTP checks ===\r",
									"pm.test(\"HTTP 200 OK\", () => {\r",
									"  pm.expect(pm.response.code).to.eql(200);\r",
									"});\r",
									"\r",
									"pm.test(\"Content-Type is JSON\", () => {\r",
									"  const ct = (pm.response.headers.get(\"Content-Type\") || \"\").toLowerCase();\r",
									"  pm.expect(ct).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"// === Parse body ===\r",
									"let body = {};\r",
									"pm.test(\"Response body is JSON object\", () => {\r",
									"  body = pm.response.json();\r",
									"  pm.expect(body).to.be.an(\"object\");\r",
									"});\r",
									"\r",
									"// === API-level success (code === 200) ===\r",
									"pm.test(\"API body.code == 200\", () => {\r",
									"  pm.expect(body).to.have.property(\"code\");\r",
									"  pm.expect(body.code).to.eql(200);\r",
									"});\r",
									"\r",
									"// === Optional: ì„œë²„ ì‘ë‹µì— imageì´ ìˆìœ¼ë©´ ìš°ë¦¬ê°€ ë³´ë‚¸ ê°’ê³¼ ì¼ì¹˜ í™•ì¸ ===\r",
									"const sent = JSON.parse(pm.variables.get(\"REQ_DTO_JSON\") || \"{}\");\r",
									"pm.test(\"Updated image echoed (if present)\", () => {\r",
									"  const candidates = [\r",
									"    body?.result?.image,\r",
									"    body?.data?.image,\r",
									"    body?.result?.requestDto?.image,\r",
									"    body?.requestDto?.image\r",
									"  ].filter(v => v !== undefined);\r",
									"\r",
									"  // ì‘ë‹µì— imageì´ ìˆìœ¼ë©´ ê²€ì¦, ì—†ìœ¼ë©´ ìŠ¤í‚µ\r",
									"  if (candidates.length) {\r",
									"    pm.expect(candidates).to.include(sent.image);\r",
									"  } else {\r",
									"    pm.expect(true).to.be.true; // skip\r",
									"  }\r",
									"});\r",
									"\r",
									"// (ì„ íƒ) id ê°™ì€ í‚¤ê°€ ì˜¤ë©´ ì €ì¥\r",
									"if (body?.result?.id) {\r",
									"  pm.environment.set(\"INSTITUTION_ID\", body.result.id);\r",
									"}\r",
									"\r",
									"console.log(\"image ->\", JSON.parse(pm.variables.get(\"REQ_DTO_JSON\")||\"{}\").image);\r",
									"\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "{{access_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "requestDto",
									"value": "{{REQ_DTO_JSON}}",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{baseUrl}}/app/api/institution",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"institution"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "master_Advanced",
			"item": [
				{
					"name": "ARIA-H Analysis",
					"item": [
						{
							"name": "ARIA-E Analysis ì¡°íšŒ",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// --- PASS when both HTTP status === 200 and body.code === 200 ---\r",
											"pm.test(\"HTTP 200 OK\", () => {\r",
											"  pm.expect(pm.response.code).to.eql(200);\r",
											"});\r",
											"\r",
											"pm.test(\"Content-Type is JSON\", () => {\r",
											"  const ct = pm.response.headers.get(\"Content-Type\") || \"\";\r",
											"  pm.expect(ct.toLowerCase()).to.include(\"application/json\");\r",
											"});\r",
											"\r",
											"let body = {};\r",
											"pm.test(\"Response body is JSON object\", () => {\r",
											"  body = pm.response.json();\r",
											"  pm.expect(body).to.be.an(\"object\");\r",
											"});\r",
											"\r",
											"pm.test(\"API body.code == 200\", () => {\r",
											"  // ì„œë²„ í‘œì¤€ ì‘ë‹µ: { \"code\": 200, \"message\": \"...\", \"result\": ... }\r",
											"  pm.expect(body).to.have.property(\"code\");\r",
											"  pm.expect(body.code).to.eql(200);\r",
											"});\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											"\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": ""
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/advanced/ariae",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"advanced",
										"ariae"
									]
								}
							},
							"response": []
						},
						{
							"name": "ARIA-E Analysis Baseline_Enable",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === PATCH /app/api/advanced/ariae : Pre-request ===\r",
											"\r",
											"\r",
											"// 2) í˜ì´ë¡œë“œ(ê¸°ë³¸ê°’: ariaECutoffValue=1, ariaEBaselineReportView=true)\r",
											"//    í•„ìš”ì‹œ í™˜ê²½ë³€ìˆ˜ë¡œ ë®ì–´ì“°ê¸° ê°€ëŠ¥: ARIAE_E_CUTOFF, ARIAE_BASELINE_VIEW\r",
											"const cutoff = Number(pm.environment.get(\"ARIAE_E_CUTOFF\") ?? 1);\r",
											"const baselineView = String(pm.environment.get(\"ARIAE_BASELINE_VIEW\") ?? \"true\").toLowerCase() === \"true\";\r",
											"\r",
											"const payload = {\r",
											"  ariaECutoffValue: cutoff,\r",
											"  ariaEBaselineReportView: baselineView, // â† trueê°€ ë˜ë„ë¡ ê¸°ë³¸ ì„¸íŒ…\r",
											"};\r",
											"\r",
											"// 3) ìš”ì²­ ë°”ë”” ì£¼ì…\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(payload));\r",
											"\r",
											"// 4) ë¡œê¹… ë° í…ŒìŠ¤íŠ¸ìš© ì €ì¥\r",
											"pm.variables.set(\"REQ_PAYLOAD_JSON\", JSON.stringify(payload));\r",
											"console.log(\"[ARIAE][pre] payload=\", payload);\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === PATCH /app/api/advanced/ariae : Tests ===\r",
											"\r",
											"// 0) ìš”ì²­ì´ PATCHì¸ì§€(ì•ˆì „ í™•ì¸)\r",
											"pm.test(\"HTTP method is PATCH\", () => pm.expect(pm.request.method).to.eql(\"PATCH\"));\r",
											"\r",
											"// 1) ìš”ì²­ ë°”ë”” í™•ì¸: ariaEBaselineReportView === true\r",
											"let reqBody = {};\r",
											"try { reqBody = JSON.parse(pm.request.body.raw); } catch(e) { reqBody = {}; }\r",
											"\r",
											"pm.test(\"Request: ariaEBaselineReportView is true\", () => {\r",
											"  pm.expect(reqBody.ariaEBaselineReportView, \"ìš”ì²­ë°”ë””ì— ariaEBaselineReportView=true ì—¬ì•¼ í•©ë‹ˆë‹¤.\").to.eql(true);\r",
											"});\r",
											"\r",
											"// 2) ì‘ë‹µ ìƒíƒœ 200\r",
											"pm.test(\"HTTP 200\", () => pm.response.to.have.status(200));\r",
											"\r",
											"// 3) (ì„ íƒ) ì„œë¹„ìŠ¤ code í•„ë“œê°€ ìˆë‹¤ë©´ 200\r",
											"let j = null;\r",
											"try { j = pm.response.json(); } catch(e) { j = null; }\r",
											"\r",
											"if (j && typeof j.code !== \"undefined\") {\r",
											"  pm.test(\"Business code == 200\", () => pm.expect(j.code).to.eql(200));\r",
											"}\r",
											"\r",
											"// 4) (ì„ íƒ) ì„œë²„ê°€ ë³€ê²½ê°’ì„ íšŒì‹ í•œë‹¤ë©´ ê°’ ê²€ì¦\r",
											"if (j?.result && typeof j.result === \"object\") {\r",
											"  if (\"ariaEBaselineReportView\" in j.result) {\r",
											"    pm.test(\"Server echo: ariaEBaselineReportView == true\", () =>\r",
											"      pm.expect(Boolean(j.result.ariaEBaselineReportView)).to.eql(true)\r",
											"    );\r",
											"  }\r",
											"  if (\"ariaECutoffValue\" in j.result) {\r",
											"    pm.test(\"Server echo: ariaECutoffValue == requested\", () =>\r",
											"      pm.expect(Number(j.result.ariaECutoffValue)).to.eql(Number(reqBody.ariaECutoffValue))\r",
											"    );\r",
											"  }\r",
											"}\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "PATCH",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": ""
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/advanced/ariae",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"advanced",
										"ariae"
									]
								}
							},
							"response": []
						},
						{
							"name": "ARIA-E Analysis Baseline_Disable",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === PATCH /app/api/advanced/ariae : Pre-request (false ì¼€ì´ìŠ¤) ===\r",
											"\r",
											"\r",
											"// 2) í˜ì´ë¡œë“œ êµ¬ì„±\r",
											"//    ê¸°ë³¸ê°’: ariaECutoffValue=1, ariaEBaselineReportView=false\r",
											"//    (ì˜µì…˜) í™˜ê²½ë³€ìˆ˜ë¡œ ì¡°ì • ê°€ëŠ¥: ARIAE_E_CUTOFF, ARIAE_BASELINE_VIEW\r",
											"const cutoff = Number(pm.environment.get(\"ARIAE_E_CUTOFF\") ?? 1);\r",
											"// false ì¼€ì´ìŠ¤ë¥¼ ê°•ì œí•˜ë ¤ë©´ ì•„ë˜ í•œ ì¤„ì„ true/false íŒŒì‹± ëŒ€ì‹  í•˜ë“œì½”ë”©ìœ¼ë¡œ ë‘ì…”ë„ ë©ë‹ˆë‹¤.\r",
											"// const baselineView = false;\r",
											"const baselineView = String(pm.environment.get(\"ARIAE_BASELINE_VIEW\") ?? \"false\").toLowerCase() === \"true\";\r",
											"\r",
											"const payload = {\r",
											"  ariaECutoffValue: cutoff,\r",
											"  ariaEBaselineReportView: baselineView, // â† falseê°€ ë˜ë„ë¡ ê¸°ë³¸ ì„¸íŒ…\r",
											"};\r",
											"\r",
											"// 3) ë°”ë”” ì£¼ì…\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(payload));\r",
											"\r",
											"// 4) ë¡œê¹…/ê³µìœ \r",
											"pm.variables.set(\"REQ_PAYLOAD_JSON\", JSON.stringify(payload));\r",
											"console.log(\"[ARIAE][pre:false] payload=\", payload);\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === PATCH /app/api/advanced/ariae : Tests (false ì¼€ì´ìŠ¤) ===\r",
											"\r",
											"// 0) ë©”ì„œë“œ í™•ì¸\r",
											"pm.test(\"HTTP method is PATCH\", () => pm.expect(pm.request.method).to.eql(\"PATCH\"));\r",
											"\r",
											"// 1) ìš”ì²­ ë°”ë”” í™•ì¸: ariaEBaselineReportView === false\r",
											"let reqBody = {};\r",
											"try { reqBody = JSON.parse(pm.request.body.raw); } catch(e) { reqBody = {}; }\r",
											"\r",
											"pm.test(\"Request: ariaEBaselineReportView is false\", () => {\r",
											"  pm.expect(reqBody).to.have.property(\"ariaEBaselineReportView\");\r",
											"  pm.expect(reqBody.ariaEBaselineReportView, \"ìš”ì²­ë°”ë””ì— ariaEBaselineReportView=false ì—¬ì•¼ í•©ë‹ˆë‹¤.\").to.eql(false);\r",
											"});\r",
											"\r",
											"// 2) ì‘ë‹µ ìƒíƒœ 200\r",
											"pm.test(\"HTTP 200\", () => pm.response.to.have.status(200));\r",
											"\r",
											"// 3) (ì„ íƒ) ì„œë¹„ìŠ¤ codeê°€ ìˆë‹¤ë©´ 200\r",
											"let j = null;\r",
											"try { j = pm.response.json(); } catch(e) { j = null; }\r",
											"\r",
											"if (j && typeof j.code !== \"undefined\") {\r",
											"  pm.test(\"Business code == 200\", () => pm.expect(j.code).to.eql(200));\r",
											"}\r",
											"\r",
											"// 4) (ì„ íƒ) ì„œë²„ê°€ ë³€ê²½ê°’ì„ íšŒì‹ í•œë‹¤ë©´ ê°’ ê²€ì¦\r",
											"if (j?.result && typeof j.result === \"object\") {\r",
											"  if (\"ariaEBaselineReportView\" in j.result) {\r",
											"    pm.test(\"Server echo: ariaEBaselineReportView == false\", () =>\r",
											"      pm.expect(Boolean(j.result.ariaEBaselineReportView)).to.eql(false)\r",
											"    );\r",
											"  }\r",
											"  if (\"ariaECutoffValue\" in j.result && \"ariaECutoffValue\" in reqBody) {\r",
											"    pm.test(\"Server echo: ariaECutoffValue == requested\", () =>\r",
											"      pm.expect(Number(j.result.ariaECutoffValue)).to.eql(Number(reqBody.ariaECutoffValue))\r",
											"    );\r",
											"  }\r",
											"}\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "PATCH",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": ""
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/advanced/ariae",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"advanced",
										"ariae"
									]
								}
							},
							"response": []
						}
					]
				},
				{
					"name": "Lesion Size Threshold for Site Counting",
					"item": [
						{
							"name": "Lesion Size ìˆ˜ì •",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === PATCH /app/api/advanced/ariae : Pre-request (ëœë¤ 1~10) ===\r",
											"\r",
											"// 1) í—¤ë”/í† í°\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
											"\r",
											"// 2) ëœë¤ ì •ìˆ˜(ê¸°ë³¸ 1~10) ìƒì„±\r",
											"const MIN = Number(pm.environment.get(\"ARIAE_MIN\") ?? 1);\r",
											"const MAX = Number(pm.environment.get(\"ARIAE_MAX\") ?? 10);\r",
											"// (ì˜µì…˜) íŠ¹ì • ê°’ ê°•ì œí•˜ë ¤ë©´ í™˜ê²½ë³€ìˆ˜ ARIAE_FORCE_VALUE ì„¤ì •\r",
											"const forceVal = pm.environment.get(\"ARIAE_FORCE_VALUE\");\r",
											"const randomInt = forceVal !== undefined && forceVal !== null\r",
											"  ? Number(forceVal)\r",
											"  : Math.floor(Math.random() * (MAX - MIN + 1)) + MIN;\r",
											"\r",
											"// 3) í˜ì´ë¡œë“œ êµ¬ì„± (baselineì€ true ê³ ì •)\r",
											"const payload = {\r",
											"  ariaECutoffValue: randomInt,\r",
											"  ariaEBaselineReportView: true\r",
											"};\r",
											"\r",
											"// 4) ìš”ì²­ ë°”ë”” ì£¼ì… + ë¡œê¹…\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(payload));\r",
											"pm.variables.set(\"REQ_PAYLOAD_JSON\", JSON.stringify(payload));\r",
											"pm.environment.set(\"ARIAE_LAST_RANDOM\", String(randomInt));\r",
											"console.log(\"[ARIAE][pre] cutoff(random 1~10) =\", randomInt);\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === PATCH /app/api/advanced/ariae : Tests (ëœë¤ 1~10) ===\r",
											"\r",
											"// 0) ë©”ì„œë“œ í™•ì¸\r",
											"pm.test(\"HTTP method is PATCH\", () => pm.expect(pm.request.method).to.eql(\"PATCH\"));\r",
											"\r",
											"// 1) ìš”ì²­ ë°”ë”” í™•ì¸ (baseline true, cutoff 1~10 ì •ìˆ˜)\r",
											"let reqBody = {};\r",
											"try { reqBody = JSON.parse(pm.request.body.raw); } catch(e) { reqBody = {}; }\r",
											"\r",
											"pm.test(\"Request: ariaEBaselineReportView is true\", () => {\r",
											"  pm.expect(reqBody.ariaEBaselineReportView, \"ariaEBaselineReportView=true ì—¬ì•¼ í•©ë‹ˆë‹¤.\").to.eql(true);\r",
											"});\r",
											"\r",
											"const MIN = Number(pm.environment.get(\"ARIAE_MIN\") ?? 1);\r",
											"const MAX = Number(pm.environment.get(\"ARIAE_MAX\") ?? 10);\r",
											"\r",
											"pm.test(`Request: ariaECutoffValue is integer in [${MIN}, ${MAX}]`, () => {\r",
											"  pm.expect(reqBody).to.have.property(\"ariaECutoffValue\");\r",
											"  pm.expect(Number.isInteger(Number(reqBody.ariaECutoffValue))).to.eql(true);\r",
											"  pm.expect(Number(reqBody.ariaECutoffValue)).to.be.at.least(MIN);\r",
											"  pm.expect(Number(reqBody.ariaECutoffValue)).to.be.at.most(MAX);\r",
											"});\r",
											"\r",
											"// 2) ì‘ë‹µ ìƒíƒœ 200\r",
											"pm.test(\"HTTP 200\", () => pm.response.to.have.status(200));\r",
											"\r",
											"// 3) (ì„ íƒ) ì„œë¹„ìŠ¤ codeê°€ ìˆìœ¼ë©´ 200\r",
											"let j = null;\r",
											"try { j = pm.response.json(); } catch(e) { j = null; }\r",
											"\r",
											"if (j && typeof j.code !== \"undefined\") {\r",
											"  pm.test(\"Business code == 200\", () => pm.expect(j.code).to.eql(200));\r",
											"}\r",
											"\r",
											"// 4) (ì„ íƒ) ì„œë²„ê°€ ê°’ íšŒì‹ í•˜ë©´ echo í™•ì¸\r",
											"if (j?.result && typeof j.result === \"object\") {\r",
											"  if (\"ariaEBaselineReportView\" in j.result) {\r",
											"    pm.test(\"Server echo: ariaEBaselineReportView == true\", () =>\r",
											"      pm.expect(Boolean(j.result.ariaEBaselineReportView)).to.eql(true)\r",
											"    );\r",
											"  }\r",
											"  if (\"ariaECutoffValue\" in j.result) {\r",
											"    pm.test(\"Server echo: ariaECutoffValue matches request\", () =>\r",
											"      pm.expect(Number(j.result.ariaECutoffValue)).to.eql(Number(reqBody.ariaECutoffValue))\r",
											"    );\r",
											"  }\r",
											"}\r",
											"\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "PATCH",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": ""
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/advanced/ariae",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"advanced",
										"ariae"
									]
								}
							},
							"response": []
						}
					]
				}
			]
		},
		{
			"name": "master_Connectivity",
			"item": [
				{
					"name": "DICOM Receiver",
					"item": [
						{
							"name": "DICOM Receiver_start",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === POST /app/api/dicom/listeners/start : Pre-request ===\r",
											"\r",
											"// 2) í˜ì´ë¡œë“œ (ê¸°ë³¸: AQUAAD, env SERVICE_NAMEë¡œ ë®ì–´ì“°ê¸° ê°€ëŠ¥)\r",
											"const serviceName = String(pm.environment.get(\"SERVICE_NAME\") ?? \"AQUAAD\");\r",
											"const payload = { serviceName };\r",
											"\r",
											"// 3) ë°”ë”” ì£¼ì… + ë¡œê¹…\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(payload));\r",
											"pm.variables.set(\"REQ_PAYLOAD_JSON\", JSON.stringify(payload));\r",
											"console.log(\"[DICOM START][pre] payload=\", payload);\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === POST /app/api/dicom/listeners/start : Tests ===\r",
											"\r",
											"// 0) ë©”ì„œë“œ í™•ì¸\r",
											"pm.test(\"HTTP method is POST\", () => pm.expect(pm.request.method).to.eql(\"POST\"));\r",
											"\r",
											"// 1) ìš”ì²­ ë°”ë”” í™•ì¸ (serviceName ì¡´ì¬ ë° ê¸°ëŒ€ê°’)\r",
											"let reqBody = {};\r",
											"try { reqBody = JSON.parse(pm.request.body.raw); } catch(e) { reqBody = {}; }\r",
											"\r",
											"pm.test(\"Request has serviceName\", () => {\r",
											"  pm.expect(reqBody).to.have.property(\"serviceName\");\r",
											"});\r",
											"\r",
											"pm.test(\"Request: serviceName matches expected\", () => {\r",
											"  const expected = String(pm.environment.get(\"SERVICE_NAME\") ?? \"AQUAAD\");\r",
											"  pm.expect(String(reqBody.serviceName)).to.eql(expected);\r",
											"});\r",
											"\r",
											"// 2) ì‘ë‹µ ìƒíƒœ 200\r",
											"pm.test(\"HTTP 200\", () => pm.response.to.have.status(200));\r",
											"\r",
											"// 3) (ì„ íƒ) ì„œë¹„ìŠ¤ code í•„ë“œê°€ ìˆë‹¤ë©´ 200\r",
											"let j = null;\r",
											"try { j = pm.response.json(); } catch(e) { j = null; }\r",
											"\r",
											"if (j && typeof j.code !== \"undefined\") {\r",
											"  pm.test(\"Business code == 200\", () => pm.expect(j.code).to.eql(200));\r",
											"}\r",
											"\r",
											"// 4) (ì„ íƒ) ì„œë²„ê°€ íšŒì‹ ê°’ì„ ì¤€ë‹¤ë©´ ê°„ë‹¨ ê²€ì¦\r",
											"if (j?.result && typeof j.result === \"object\") {\r",
											"  if (\"serviceName\" in j.result) {\r",
											"    pm.test(\"Server echo: serviceName matches\", () =>\r",
											"      pm.expect(String(j.result.serviceName)).to.eql(String(reqBody.serviceName))\r",
											"    );\r",
											"  }\r",
											"  if (\"started\" in j.result) {\r",
											"    pm.test(\"Server 'started' == true\", () =>\r",
											"      pm.expect(Boolean(j.result.started)).to.eql(true)\r",
											"    );\r",
											"  }\r",
											"}\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											"\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "formdata",
									"formdata": []
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/dicom/listeners/start",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"dicom",
										"listeners",
										"start"
									]
								}
							},
							"response": []
						},
						{
							"name": "DICOM Receiver_stop",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// start ìš”ì²­ ë°”ë””ë¥¼ ìë™ ì„¸íŒ…í•˜ê³  ì‹¶ìœ¼ë©´ ì‚¬ìš©\r",
											"const serviceName = String(pm.environment.get(\"SERVICE_NAME\") ?? \"AQUAAD\");\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify({ serviceName }));\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === After START send: log start.result -> delay -> call STOP and log stop.result ===\r",
											"\r",
											"// 1) START ì‘ë‹µ ë¡œê¹…/ê°„ë‹¨ ê²€ì¦\r",
											"pm.test(\"HTTP 200 (start)\", () => pm.response.to.have.status(200));\r",
											"\r",
											"let startJson = null;\r",
											"try { startJson = pm.response.json(); } catch (e) { startJson = null; }\r",
											"\r",
											"if (startJson && typeof startJson.code !== \"undefined\") {\r",
											"  pm.test(\"Business code == 200 (start)\", () => pm.expect(startJson.code).to.eql(200));\r",
											"}\r",
											"\r",
											"const startResult = (startJson && startJson.result !== undefined) ? startJson.result : \"(no result)\";\r",
											"console.log(\"[DICOM][start] result =\", startResult);\r",
											"\r",
											"// 2) STOP ìš”ì²­ ì¤€ë¹„\r",
											"const baseUrl = String(pm.environment.get(\"baseUrl\") || pm.variables.get(\"baseUrl\") || \"\").replace(/\\/+$/, \"\");\r",
											"const stopUrl  = `${baseUrl}/app/api/dicom/listeners/stop`;\r",
											"const auth     = pm.request.headers.get(\"Authorization\") || \"\";\r",
											"const headers  = [\r",
											"  { key: \"Content-Type\", value: \"application/json\" },\r",
											"  ...(auth ? [{ key: \"Authorization\", value: auth }] : [])\r",
											"];\r",
											"\r",
											"// serviceNameì€ ìš”ì²­ ë°”ë””ì—ì„œ ìš°ì„  ê°€ì ¸ì˜¤ê³  ì—†ìœ¼ë©´ env ì‚¬ìš©\r",
											"let serviceName = \"AQUAAD\";\r",
											"try {\r",
											"  const reqBody = pm.request?.body?.raw ? JSON.parse(pm.request.body.raw) : {};\r",
											"  serviceName = String(reqBody?.serviceName ?? pm.environment.get(\"SERVICE_NAME\") ?? \"AQUAAD\");\r",
											"} catch (e) {\r",
											"  serviceName = String(pm.environment.get(\"SERVICE_NAME\") ?? \"AQUAAD\");\r",
											"}\r",
											"\r",
											"const delayMs = Number(pm.environment.get(\"START_STOP_DELAY_MS\") ?? 300);\r",
											"\r",
											"// 3) ë”œë ˆì´ ë’¤ STOP í˜¸ì¶œ â†’ result ì½˜ì†” ì¶œë ¥\r",
											"setTimeout(() => {\r",
											"  pm.sendRequest({\r",
											"    url: stopUrl,\r",
											"    method: \"POST\",\r",
											"    header: headers,\r",
											"    body: { mode: \"raw\", raw: JSON.stringify({ serviceName }) }\r",
											"  }, (err, res) => {\r",
											"    if (err) {\r",
											"      console.error(\"[DICOM][stop] request error:\", err);\r",
											"      pm.test(\"STOP request error\", () => { throw new Error(String(err)); });\r",
											"      return;\r",
											"    }\r",
											"\r",
											"    let stopJson = null;\r",
											"    try { stopJson = res.json(); } catch (e) { stopJson = null; }\r",
											"\r",
											"    const stopResult = (stopJson && stopJson.result !== undefined) ? stopJson.result : \"(no result)\";\r",
											"    console.log(\"[DICOM][stop] result  =\", stopResult);\r",
											"\r",
											"    // ê°„ë‹¨ ê²€ì¦ (ì›í•˜ë©´ ì œê±° ê°€ëŠ¥)\r",
											"    pm.test(\"HTTP 200 (stop)\", () => pm.expect(res.code).to.eql(200));\r",
											"    if (stopJson && typeof stopJson.code !== \"undefined\") {\r",
											"      pm.test(\"Business code == 200 (stop)\", () => pm.expect(stopJson.code).to.eql(200));\r",
											"    }\r",
											"  });\r",
											"}, delayMs);\r",
											"\r",
											"\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "formdata",
									"formdata": []
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/dicom/listeners/start",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"dicom",
										"listeners",
										"start"
									]
								}
							},
							"response": []
						},
						{
							"name": "DICOM Receiver_ setting ip ìˆ˜ì •",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === PUT /app/api/dicom/listeners : hostName(ìˆ«ì+.) ëœë¤ ìƒì„± & ë°”ë”” ì£¼ì… ===\r",
											"pm.request.method = \"PUT\";\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"\r",
											"// í† í°(ìˆìœ¼ë©´)\r",
											"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
											"\r",
											"// ---- ì„¤ì • ----\r",
											"const MAX_HOST_LEN = Number(pm.environment.get(\"HOSTNAME_MAXLEN\") || 63);\r",
											"\r",
											"// ---- ìœ í‹¸ ----\r",
											"function rint(min, max){ return Math.floor(Math.random()*(max-min+1))+min; }\r",
											"function makeDigitLabel(len){\r",
											"  let s = \"\";\r",
											"  for (let i=0;i<len;i++) s += String(rint(0,9));\r",
											"  return s;\r",
											"}\r",
											"function makeNumericHostname(maxLen){\r",
											"  // 1~3ê°œ ë ˆì´ë¸”, ê° ë ˆì´ë¸”ì€ ìˆ«ìë§Œ. '.'ë¡œ ê²°í•©. ì‹œì‘/ëì€ ìˆ«ì, '..' ê¸ˆì§€.\r",
											"  const labelCount = rint(1,3);\r",
											"  let remaining = maxLen - (labelCount - 1); // ì (.) ìˆ˜ ê³ ë ¤\r",
											"  const labels = [];\r",
											"  for (let i=0;i<labelCount;i++){\r",
											"    const minForRest = (labelCount - i - 1)*1;         // ë’¤ ë ˆì´ë¸” ìµœì†Œ 1ê¸€ì í™•ë³´\r",
											"    const maxForThis = Math.max(1, remaining - minForRest);\r",
											"    const L = rint(1, Math.min(20, maxForThis));       // ë¼ë²¨ ê¸¸ì´ 1~20\r",
											"    labels.push(makeDigitLabel(L));\r",
											"    remaining -= L;\r",
											"  }\r",
											"  let host = labels.join(\".\");\r",
											"  if (host.length > maxLen) {\r",
											"    host = host.slice(0, maxLen);\r",
											"    if (host.endsWith(\".\")) host = host.slice(0, -1) + \"0\"; // ëì´ '.'ì´ë©´ ë³´ì •\r",
											"  }\r",
											"  return host;\r",
											"}\r",
											"\r",
											"const hostName = makeNumericHostname(MAX_HOST_LEN);\r",
											"\r",
											"// ---- ìš”ì²­ ë°”ë””(ë¬¸ì œì—ì„œ ì¤€ í¬ë§· ê¸°ë°˜, hostNameë§Œ ëœë¤) ----\r",
											"let body = {\r",
											"  id: 1,\r",
											"  serviceName: \"AQUAAD\",\r",
											"  hostName: hostName,\r",
											"  servicePort: 103,\r",
											"  aeTitle: \"AQUAAD\",\r",
											"  automaticStart: true,\r",
											"  transactionTimeout: 60,\r",
											"  useTls: false,\r",
											"  useMutual: false\r",
											"};\r",
											"\r",
											"// (ì˜µì…˜) BASE_BODY_JSONìœ¼ë¡œ ì¼ë¶€ ë®ì–´ì“°ê¸°\r",
											"try {\r",
											"  const extra = pm.environment.get(\"BASE_BODY_JSON\");\r",
											"  if (extra) body = Object.assign(body, JSON.parse(extra));\r",
											"} catch(e){}\r",
											"\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(body));\r",
											"\r",
											"// ë¡œê·¸ & ì €ì¥\r",
											"console.log(\"[PUT SEND]\", pm.request.url.toString(), \"payload=\", body);\r",
											"pm.environment.set(\"LAST_NUM_HOSTNAME\", hostName);\r",
											"pm.environment.set(\"HOSTNAME_MAXLEN_EFFECTIVE\", String(MAX_HOST_LEN));\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === Tests: HTTP/Biz 200 + hostName(ìˆ«ì/.) ìœ íš¨ì„± ê²€ì¦ ===\r",
											"(function () {\r",
											"  // 1) HTTP 200\r",
											"  pm.test(\"HTTP 200\", function(){ pm.response.to.have.status(200); });\r",
											"\r",
											"  // 2) (ìˆìœ¼ë©´) ë¹„ì¦ˆë‹ˆìŠ¤ ì½”ë“œ 200\r",
											"  let j=null; try { j = pm.response.json(); } catch(e){}\r",
											"  if (j && typeof j.code !== \"undefined\") {\r",
											"    pm.test(\"Business code == 200\", function(){ pm.expect(j.code).to.eql(200); });\r",
											"  }\r",
											"\r",
											"  // 3) hostName ê·œì¹™ ê²€ì¦\r",
											"  const host = pm.environment.get(\"LAST_NUM_HOSTNAME\") || \"\";\r",
											"  const maxLen = parseInt(pm.environment.get(\"HOSTNAME_MAXLEN_EFFECTIVE\") || \"63\", 10);\r",
											"  console.log(\"[VERIFY] hostName =\", host, \"len=\", host.length);\r",
											"\r",
											"  pm.test(\"hostName length <= \" + maxLen, function(){\r",
											"    pm.expect(host.length).to.be.at.most(maxLen);\r",
											"  });\r",
											"  pm.test(\"Allowed chars only [0-9.]\", function(){\r",
											"    pm.expect(/^[0-9.]+$/.test(host)).to.eql(true);\r",
											"  });\r",
											"  pm.test(\"Starts & ends with digit\", function(){\r",
											"    pm.expect(/^[0-9](?:.*[0-9])?$/.test(host)).to.eql(true);\r",
											"  });\r",
											"  pm.test(\"No consecutive dots ('..')\", function(){\r",
											"    pm.expect(host.indexOf(\"..\") === -1).to.eql(true);\r",
											"  });\r",
											"\r",
											"  // (ì˜µì…˜) ì‘ë‹µì´ hostNameì„ ì—ì½”í•˜ë©´ ë™ì¼ì„± í™•ì¸\r",
											"  function pick(o, path){\r",
											"    try { return path.split(\".\").reduce((x,k)=> (x && typeof x===\"object\") ? x[k] : undefined, o); }\r",
											"    catch(e){ return undefined; }\r",
											"  }\r",
											"  const echoed = (j && (j.hostName ?? j?.result?.hostName ?? j?.data?.hostName));\r",
											"  if (typeof echoed !== \"undefined\") {\r",
											"    pm.test(\"Response hostName equals sent\", function(){\r",
											"      pm.expect(String(echoed)).to.eql(String(host));\r",
											"    });\r",
											"  } else {\r",
											"    console.log(\"[echo-skip] hostName not present in response\");\r",
											"  }\r",
											"})();\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "PUT",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "formdata",
									"formdata": []
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/dicom/listeners",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"dicom",
										"listeners"
									]
								}
							},
							"response": []
						},
						{
							"name": "DICOM Receiver_setting hostname ìˆ˜ì •",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === PUT /app/api/dicom/listeners : hostName(ì†Œë¬¸ì/ìˆ«ì/-/.) ëœë¤ ìƒì„± & ë°”ë”” ì£¼ì… ===\r",
											"pm.request.method = \"PUT\";\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"\r",
											"// í† í°(ìˆìœ¼ë©´)\r",
											"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
											"\r",
											"// ---- ì„¤ì • ----\r",
											"const MAX_HOST_LEN = Number(pm.environment.get(\"HOSTNAME_MAXLEN\") || 63);\r",
											"\r",
											"// ---- ìœ í‹¸ ----\r",
											"function rint(min, max){ return Math.floor(Math.random()*(max-min+1))+min; }\r",
											"function pick(s){ return s.charAt(Math.floor(Math.random()*s.length)); }\r",
											"\r",
											"const ALNUM = \"abcdefghijklmnopqrstuvwxyz0123456789\"; // ì‹œì‘/ë í—ˆìš©(ì†Œë¬¸ì+ìˆ«ì)\r",
											"const MID   = ALNUM + \"-\";                              // ë¼ë²¨ ë‚´ë¶€(í•˜ì´í”ˆ í—ˆìš©)\r",
											"\r",
											"// ë¼ë²¨ 1ê°œ ìƒì„±: [a-z0-9] ( [a-z0-9-]* ) [a-z0-9]\r",
											"function makeLabel(len){\r",
											"  if (len <= 1) return pick(ALNUM);\r",
											"  let s = pick(ALNUM);\r",
											"  for (let i=1;i<len-1;i++) s += pick(MID);\r",
											"  s += pick(ALNUM);\r",
											"  return s;\r",
											"}\r",
											"\r",
											"// hostName: 1~3ê°œ ë¼ë²¨ì„ '.'ë¡œ ì—°ê²°, ì „ì²´ ê¸¸ì´ â‰¤ 63, '..' ê¸ˆì§€, ì‹œì‘/ë ì˜ìˆ«ì\r",
											"function makeHostname(maxLen){\r",
											"  const labelCount = rint(1,3);\r",
											"  let remaining = maxLen - (labelCount - 1); // ì (.) ê°œìˆ˜ ê³ ë ¤\r",
											"  const labels = [];\r",
											"  for (let i=0;i<labelCount;i++){\r",
											"    const minForRest = (labelCount - i - 1) * 1;           // ë’¤ ë¼ë²¨ ìµœì†Œ 1ì\r",
											"    const maxForThis = Math.max(1, remaining - minForRest);\r",
											"    const L = rint(1, Math.min(20, maxForThis));           // ë¼ë²¨ ê¸¸ì´ 1~20\r",
											"    labels.push(makeLabel(L));\r",
											"    remaining -= L;\r",
											"  }\r",
											"  let host = labels.join(\".\");\r",
											"  if (host.length > maxLen) {\r",
											"    host = host.slice(0, maxLen);\r",
											"    // ìë¥´ë‹¤ '.'ë¡œ ëë‚˜ë©´ ìˆ«ìë¡œ ë³´ì •\r",
											"    if (host.endsWith(\".\")) host = host.slice(0, -1) + \"0\";\r",
											"    // ìë¥´ë‹¤ '-'ë¡œ ëë‚˜ë©´ ì•ŒíŒŒë²³ìœ¼ë¡œ ë³´ì •\r",
											"    if (host.endsWith(\"-\")) host = host.slice(0, -1) + \"a\";\r",
											"  }\r",
											"  return host;\r",
											"}\r",
											"\r",
											"const hostName = makeHostname(MAX_HOST_LEN);\r",
											"\r",
											"// ---- ìš”ì²­ ë°”ë””(ë¬¸ì œì—ì„œ ì¤€ í¬ë§·) ----\r",
											"let body = {\r",
											"  id: 1,\r",
											"  serviceName: \"AQUAAD\",\r",
											"  hostName: hostName,          // â† ëœë¤ ìƒì„±\r",
											"  servicePort: 103,\r",
											"  aeTitle: \"AQUAAD\",\r",
											"  automaticStart: true,\r",
											"  transactionTimeout: 60,\r",
											"  useTls: false,\r",
											"  useMutual: false\r",
											"};\r",
											"\r",
											"// (ì˜µì…˜) BASE_BODY_JSONìœ¼ë¡œ ì¼ë¶€ ë®ì–´ì“°ê¸°\r",
											"try {\r",
											"  const extra = pm.environment.get(\"BASE_BODY_JSON\");\r",
											"  if (extra) body = Object.assign(body, JSON.parse(extra));\r",
											"} catch(e){}\r",
											"\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(body));\r",
											"\r",
											"// ë¡œê·¸ & ì €ì¥\r",
											"console.log(\"[PUT SEND]\", pm.request.url.toString(), \"payload=\", body);\r",
											"pm.environment.set(\"LAST_HOSTNAME\", hostName);\r",
											"pm.environment.set(\"HOSTNAME_MAXLEN_EFFECTIVE\", String(MAX_HOST_LEN));\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === Tests: HTTP/Biz 200 + hostName(ì†Œë¬¸ì/ìˆ«ì/-/.) ê·œì¹™ ê²€ì¦ ===\r",
											"(function () {\r",
											"  // 1) HTTP 200\r",
											"  pm.test(\"HTTP 200\", function(){ pm.response.to.have.status(200); });\r",
											"\r",
											"  // 2) (ìˆìœ¼ë©´) ë¹„ì¦ˆë‹ˆìŠ¤ ì½”ë“œ 200\r",
											"  let j=null; try { j = pm.response.json(); } catch(e){}\r",
											"  if (j && typeof j.code !== \"undefined\") {\r",
											"    pm.test(\"Business code == 200\", function(){ pm.expect(j.code).to.eql(200); });\r",
											"  }\r",
											"\r",
											"  // 3) hostName ê·œì¹™ ê²€ì¦\r",
											"  const host = pm.environment.get(\"LAST_HOSTNAME\") || \"\";\r",
											"  const maxLen = parseInt(pm.environment.get(\"HOSTNAME_MAXLEN_EFFECTIVE\") || \"63\", 10);\r",
											"  console.log(\"[VERIFY] hostName =\", host, \"len=\", host.length);\r",
											"\r",
											"  pm.test(\"hostName length â‰¤ \" + maxLen, function(){\r",
											"    pm.expect(host.length).to.be.at.most(maxLen);\r",
											"  });\r",
											"  pm.test(\"Allowed chars only [a-z0-9.-]\", function(){\r",
											"    pm.expect(/^[a-z0-9.-]+$/.test(host)).to.eql(true);\r",
											"  });\r",
											"  pm.test(\"Starts & ends with alphanumeric\", function(){\r",
											"    pm.expect(/^[a-z0-9](?:.*[a-z0-9])?$/.test(host)).to.eql(true);\r",
											"  });\r",
											"  pm.test(\"No consecutive dots ('..')\", function(){\r",
											"    pm.expect(host.indexOf(\"..\") === -1).to.eql(true);\r",
											"  });\r",
											"  // ê° ë¼ë²¨ì€ í•˜ì´í”ˆìœ¼ë¡œ ì‹œì‘/ë ë¶ˆê°€\r",
											"  pm.test(\"Each label matches ^[a-z0-9]([a-z0-9-]*[a-z0-9])?$\", function(){\r",
											"    const ok = host.split(\".\").every(lbl => /^[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/.test(lbl));\r",
											"    pm.expect(ok, \"invalid label in: \" + host).to.eql(true);\r",
											"  });\r",
											"\r",
											"  // (ì˜µì…˜) ì‘ë‹µì´ hostNameì„ ì—ì½”í•˜ë©´ ì¼ì¹˜ í™•ì¸\r",
											"  const echoed = (j && (j.hostName ?? j?.result?.hostName ?? j?.data?.hostName));\r",
											"  if (typeof echoed !== \"undefined\") {\r",
											"    pm.test(\"Response hostName equals sent\", function(){\r",
											"      pm.expect(String(echoed)).to.eql(String(host));\r",
											"    });\r",
											"  } else {\r",
											"    console.log(\"[echo-skip] hostName not present in response\");\r",
											"  }\r",
											"})();\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "PUT",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "formdata",
									"formdata": []
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/dicom/listeners",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"dicom",
										"listeners"
									]
								}
							},
							"response": []
						},
						{
							"name": "DICOM Receiver_setting port ìˆ˜ì •",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === Pre-request: servicePort(0~65535) ëœë¤ ìƒì„± â†’ ë°”ë”” êµ¬ì„± & ì½˜ì†” ë¡œê·¸ ===\r",
											"pm.request.method = \"PUT\";\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"\r",
											"var token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: \"Bearer \" + token });\r",
											"\r",
											"// ë²”ìœ„(í™˜ê²½ë³€ìˆ˜ë¡œ ì¡°ì • ê°€ëŠ¥; ê¸°ë³¸ 0~65535)\r",
											"function toInt(x){ var n=parseInt(x,10); return isNaN(n)?null:n; }\r",
											"var MIN_PORT = toInt(pm.environment.get(\"MIN_SERVICE_PORT\"));\r",
											"var MAX_PORT = toInt(pm.environment.get(\"MAX_SERVICE_PORT\"));\r",
											"if (MIN_PORT === null) MIN_PORT = 0;\r",
											"if (MAX_PORT === null) MAX_PORT = 65535;\r",
											"\r",
											"// ê°•ì œ í¬íŠ¸(ì˜µì…˜): ê²½ê³„ê°’ í…ŒìŠ¤íŠ¸ ë“±\r",
											"var FORCE_PORT = toInt(pm.environment.get(\"FORCE_SERVICE_PORT\"));\r",
											"\r",
											"function randInt(min, max){ return Math.floor(Math.random()*(max-min+1)) + min; }\r",
											"\r",
											"// ìµœì¢… ì‚¬ìš©í•  í¬íŠ¸\r",
											"var port = (FORCE_PORT !== null) ? FORCE_PORT : randInt(MIN_PORT, MAX_PORT);\r",
											"// ë²”ìœ„ í´ë¨í”„(ì•ˆì „)\r",
											"if (port < MIN_PORT) port = MIN_PORT;\r",
											"if (port > MAX_PORT) port = MAX_PORT;\r",
											"\r",
											"// ìš”ì²­ ë°”ë”” êµ¬ì„± (ë¬¸ì œì—ì„œ ì¤€ ê¸°ë³¸ ê°’ + ëœë¤ í¬íŠ¸)\r",
											"var body = {\r",
											"  id: 1,\r",
											"  serviceName: \"AQUAAD\",\r",
											"  hostName: \"localhost\",\r",
											"  servicePort: port,            // â˜… ëœë¤(ë˜ëŠ” ê°•ì œ)\r",
											"  aeTitle: \"AQUAAD\",\r",
											"  automaticStart: true,\r",
											"  transactionTimeout: 60,\r",
											"  useTls: false,\r",
											"  useMutual: false\r",
											"};\r",
											"\r",
											"// ê¸°ì¡´ ìš”ì²­ íƒ­ì— ë­”ê°€ ì¨ë†¨ë‹¤ë©´ ë³‘í•©í•˜ë ¤ë©´ ì•„ë˜ ì£¼ì„ í•´ì œ\r",
											"// try { var cur = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {}; body = Object.assign(cur, body); } catch(e){}\r",
											"\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(body));\r",
											"\r",
											"// ì½˜ì†” ë¡œê·¸(ì‹¤ì œë¡œ ë³´ë‚¸ í˜ì´ë¡œë“œ & í¬íŠ¸)\r",
											"try {\r",
											"  var reqUrl = pm.request.url ? pm.request.url.toString() : \"(unknown url)\";\r",
											"  console.log(\"[PUT SEND] \" + reqUrl + \" payload =\", body);\r",
											"  console.log(\"[PUT SEND] servicePort =\", port);\r",
											"} catch(e) {\r",
											"  console.log(\"[PUT SEND] payload =\", body);\r",
											"}\r",
											"\r",
											"// í…ŒìŠ¤íŠ¸ì—ì„œ ì¬ê²€ì¦ì„ ìœ„í•´ ì €ì¥\r",
											"pm.environment.set(\"LAST_RANDOM_SERVICE_PORT\", String(port));\r",
											"pm.environment.set(\"LAST_SERVICE_PORT_RANGE\", JSON.stringify({min:MIN_PORT, max:MAX_PORT}));\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === Tests: HTTP 200 / (ìˆìœ¼ë©´) ë¹„ì¦ˆë‹ˆìŠ¤ì½”ë“œ 200 í™•ì¸ + ë³´ë‚¸ í¬íŠ¸ ë²”ìœ„ ì¬ê²€ì¦ ===\r",
											"(function(){\r",
											"  // HTTP 200\r",
											"  pm.test(\"HTTP 200\", function(){ pm.response.to.have.status(200); });\r",
											"\r",
											"  // (ì˜µì…˜) ë¹„ì¦ˆë‹ˆìŠ¤ ì½”ë“œ 200\r",
											"  try {\r",
											"    var j = pm.response.json();\r",
											"    if (j && typeof j.code !== \"undefined\") {\r",
											"      pm.test(\"Business code == 200\", function(){ pm.expect(j.code).to.eql(200); });\r",
											"    }\r",
											"  } catch(e){}\r",
											"\r",
											"  // ë³´ë‚¸ í¬íŠ¸ ì¬ê²€ì¦\r",
											"  var portStr = pm.environment.get(\"LAST_RANDOM_SERVICE_PORT\") || \"\";\r",
											"  var rangeStr = pm.environment.get(\"LAST_SERVICE_PORT_RANGE\") || \"{}\";\r",
											"  var port = parseInt(portStr, 10);\r",
											"  var range = {}; try { range = JSON.parse(rangeStr); } catch(e){}\r",
											"  var min = typeof range.min === \"number\" ? range.min : 0;\r",
											"  var max = typeof range.max === \"number\" ? range.max : 65535;\r",
											"\r",
											"  console.log(\"[VERIFY] servicePort sent =\", port, \"range=[\"+min+\",\"+max+\"]\");\r",
											"\r",
											"  pm.test(\"servicePort is integer\", function(){ pm.expect(isNaN(port)).to.eql(false); });\r",
											"  pm.test(\"servicePort in [min, max]\", function(){ pm.expect(port >= min && port <= max).to.eql(true); });\r",
											"})();\r",
											"\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "PUT",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "formdata",
									"formdata": []
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/dicom/listeners",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"dicom",
										"listeners"
									]
								}
							},
							"response": []
						},
						{
							"name": "DICOM Receiver_setting aEtitle ìˆ˜ì •",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === Pre-request: aeTitle(ìµœëŒ€ 16ì) ëœë¤ ìƒì„± â†’ ë°”ë”” êµ¬ì„± & ì½˜ì†” ë¡œê·¸ ===\r",
											"pm.request.method = \"PUT\";\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"\r",
											"var token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: \"Bearer \" + token });\r",
											"\r",
											"// ----- ì„¤ì • (í™˜ê²½ë³€ìˆ˜ë¡œ ì¡°ì • ê°€ëŠ¥) -----\r",
											"function toInt(x){ var n=parseInt(x,10); return isNaN(n)?null:n; }\r",
											"var MAX_LEN   = toInt(pm.environment.get(\"AET_MAXLEN\"));   if (MAX_LEN === null) MAX_LEN = 16; // ê¸°ë³¸ 16\r",
											"var MIN_LEN   = toInt(pm.environment.get(\"AET_MINLEN\"));   if (MIN_LEN === null) MIN_LEN = 2;  // ê¸°ë³¸ 1\r",
											"var FORCE_VAL = pm.environment.get(\"FORCE_AETITLE\") || \"\"; // ê³ ì •ê°’(ê²½ê³„ í…ŒìŠ¤íŠ¸ìš©). ë¹„ì›Œë‘ë©´ ëœë¤\r",
											"// ë¬¸ìì§‘í•©(ê¸°ë³¸: ëŒ€ë¬¸ì+ìˆ«ì). í•„ìš”í•˜ë©´ AET_CHARSET í™˜ê²½ë³€ìˆ˜ë¡œ êµì²´ ê°€ëŠ¥.\r",
											"var CHARSET   = pm.environment.get(\"AET_CHARSET\") || \"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\";\r",
											"\r",
											"function randInt(min, max){ return Math.floor(Math.random()*(max-min+1)) + min; }\r",
											"function pick(chars){ return chars.charAt(Math.floor(Math.random()*chars.length)); }\r",
											"\r",
											"function makeRandomAETitle(minLen, maxLen, charset){\r",
											"  var len = randInt(minLen, maxLen);\r",
											"  var s = \"\";\r",
											"  for (var i=0;i<len;i++) s += pick(charset);\r",
											"  return s;\r",
											"}\r",
											"\r",
											"var aeTitle = FORCE_VAL ? String(FORCE_VAL) : makeRandomAETitle(MIN_LEN, MAX_LEN, CHARSET);\r",
											"// ê¸¸ì´ ì´ˆê³¼ ë°©ì§€(í˜¹ì‹œ FORCE_VALì´ ë„ˆë¬´ ê¸¸ë©´ ìë¦„)\r",
											"if (aeTitle.length > MAX_LEN) aeTitle = aeTitle.slice(0, MAX_LEN);\r",
											"\r",
											"// ----- ìš”ì²­ ë°”ë”” êµ¬ì„± (ë¬¸ì œì—ì„œ ì¤€ ê¸°ë³¸ ê°’ + ëœë¤ aeTitle) -----\r",
											"var body = {\r",
											"  id: 1,\r",
											"  serviceName: \"AQUAAD\",\r",
											"  hostName: \"localhost\",\r",
											"  servicePort: 103,\r",
											"  aeTitle: aeTitle,               // â˜… ëœë¤(ë˜ëŠ” FORCE_AETITLE)\r",
											"  automaticStart: true,\r",
											"  transactionTimeout: 60,\r",
											"  useTls: false,\r",
											"  useMutual: false\r",
											"};\r",
											"\r",
											"// í•„ìš”ì‹œ, ê¸°ì¡´ ìš”ì²­ íƒ­ì— ì ì–´ë‘” ê°’ê³¼ ë³‘í•©í•˜ë ¤ë©´ ì•„ë˜ ì£¼ì„ì„ í•´ì œí•˜ì„¸ìš”.\r",
											"// try { var cur = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {}; body = Object.assign(cur, body); } catch(e){}\r",
											"\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(body));\r",
											"\r",
											"// ì½˜ì†” ë¡œê·¸(ì‹¤ì œë¡œ ë³´ë‚¸ í˜ì´ë¡œë“œ & aeTitle ê¸¸ì´)\r",
											"try {\r",
											"  var reqUrl = pm.request.url ? pm.request.url.toString() : \"(unknown url)\";\r",
											"  console.log(\"[PUT SEND] \" + reqUrl + \" payload =\", body);\r",
											"  console.log(\"[PUT SEND] aeTitle =\", aeTitle, \"len=\", aeTitle.length);\r",
											"} catch(e) {\r",
											"  console.log(\"[PUT SEND] payload =\", body);\r",
											"}\r",
											"\r",
											"// Testsì—ì„œ ê²€ì¦ìš© ì €ì¥\r",
											"pm.environment.set(\"LAST_RANDOM_AETITLE\", aeTitle);\r",
											"pm.environment.set(\"AET_LIMITS\", JSON.stringify({ min: MIN_LEN, max: MAX_LEN }));\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === Tests: HTTP 200 / (ìˆìœ¼ë©´) ë¹„ì¦ˆë‹ˆìŠ¤ì½”ë“œ 200 í™•ì¸ + ë³´ë‚¸ aeTitle ê¸¸ì´ ì¬ê²€ì¦ ===\r",
											"(function(){\r",
											"  // HTTP 200\r",
											"  pm.test(\"HTTP 200\", function(){ pm.response.to.have.status(200); });\r",
											"\r",
											"  // (ì˜µì…˜) ë¹„ì¦ˆë‹ˆìŠ¤ ì½”ë“œ 200\r",
											"  try {\r",
											"    var j = pm.response.json();\r",
											"    if (j && typeof j.code !== \"undefined\") {\r",
											"      pm.test(\"Business code == 200\", function(){ pm.expect(j.code).to.eql(200); });\r",
											"    }\r",
											"  } catch(e){}\r",
											"\r",
											"  // ë³´ë‚¸ aeTitle ì¬ê²€ì¦\r",
											"  var ae  = pm.environment.get(\"LAST_RANDOM_AETITLE\") || \"\";\r",
											"  var lim = {}; try { lim = JSON.parse(pm.environment.get(\"AET_LIMITS\") || \"{}\"); } catch(e){}\r",
											"  var min = typeof lim.min === \"number\" ? lim.min : 1;\r",
											"  var max = typeof lim.max === \"number\" ? lim.max : 16;\r",
											"\r",
											"  console.log(\"[VERIFY] aeTitle sent =\", ae, \"len=\", ae.length, \"limits=[\"+min+\",\"+max+\"]\");\r",
											"\r",
											"  pm.test(\"aeTitle length >= min\", function(){ pm.expect(ae.length >= min).to.eql(true); });\r",
											"  pm.test(\"aeTitle length <= max\", function(){ pm.expect(ae.length <= max).to.eql(true); });\r",
											"\r",
											"  // (ì˜µì…˜) ë¬¸ìì§‘í•© í™•ì¸ì„ ì›í•˜ë©´ ì£¼ì„ í•´ì œ: ê¸°ë³¸ ëŒ€ë¬¸ì+ìˆ«ì\r",
											"  // pm.test(\"aeTitle charset [A-Z0-9]\", function(){ pm.expect(/^[A-Z0-9]+$/.test(ae)).to.eql(true); });\r",
											"})();\r",
											"\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "PUT",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "formdata",
									"formdata": []
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/dicom/listeners",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"dicom",
										"listeners"
									]
								}
							},
							"response": []
						},
						{
							"name": "DICOM Receiver_setting Timeout ìˆ˜ì •",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === Pre-request: transactionTimeout(30~600) ëœë¤ ìƒì„± â†’ ë°”ë”” êµ¬ì„± & ì½˜ì†” ë¡œê·¸ ===\r",
											"pm.request.method = \"PUT\";\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"\r",
											"var token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: \"Bearer \" + token });\r",
											"\r",
											"function toInt(x){ var n=parseInt(x,10); return isNaN(n)?null:n; }\r",
											"function randInt(min, max){ return Math.floor(Math.random()*(max-min+1)) + min; }\r",
											"\r",
											"// ë²”ìœ„ (ê¸°ë³¸ 30~600) â€” í•„ìš”í•˜ë©´ envë¡œ ì¡°ì •\r",
											"var MIN_T = toInt(pm.environment.get(\"MIN_TX_TIMEOUT\")); if (MIN_T === null) MIN_T = 30;\r",
											"var MAX_T = toInt(pm.environment.get(\"MAX_TX_TIMEOUT\")); if (MAX_T === null) MAX_T = 600;\r",
											"// ê°•ì œê°’(ê²½ê³„ í…ŒìŠ¤íŠ¸ìš©)\r",
											"var FORCE_T = toInt(pm.environment.get(\"FORCE_TX_TIMEOUT\"));\r",
											"\r",
											"// ìµœì¢… timeout ì„ íƒ\r",
											"var tx = (FORCE_T !== null) ? FORCE_T : randInt(MIN_T, MAX_T);\r",
											"// ì•ˆì „ í´ë¨í”„\r",
											"if (tx < MIN_T) tx = MIN_T;\r",
											"if (tx > MAX_T) tx = MAX_T;\r",
											"\r",
											"// ìš”ì²­ ë°”ë”” êµ¬ì„± (ë¬¸ì œì—ì„œ ì¤€ ê¸°ë³¸ ê°’ + ëœë¤ transactionTimeout)\r",
											"var body = {\r",
											"  id: 1,\r",
											"  serviceName: \"AQUAAD\",\r",
											"  hostName: \"localhost\",\r",
											"  servicePort: 103,\r",
											"  aeTitle: \"AQUAAD\",\r",
											"  automaticStart: true,\r",
											"  transactionTimeout: tx,   // â˜… ëœë¤/ê°•ì œ\r",
											"  useTls: false,\r",
											"  useMutual: false\r",
											"};\r",
											"\r",
											"// (ì˜µì…˜) ê¸°ì¡´ ìš”ì²­ íƒ­ì´ë‚˜ BASE_BODY_JSONê³¼ ë³‘í•©í•˜ê³  ì‹¶ìœ¼ë©´ ì£¼ì„ í•´ì œ\r",
											"// try { var cur = pm.request.body && pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {}; body = Object.assign(cur, body); } catch(e){}\r",
											"// try { var extra = pm.environment.get(\"BASE_BODY_JSON\"); if (extra) body = Object.assign(body, JSON.parse(extra)); } catch(e){}\r",
											"\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(body));\r",
											"\r",
											"// ì½˜ì†” ë¡œê·¸(ì‹¤ì œ ì „ì†¡ payload/timeout)\r",
											"try {\r",
											"  var reqUrl = pm.request.url ? pm.request.url.toString() : \"(unknown url)\";\r",
											"  console.log(\"[PUT SEND] \" + reqUrl + \" payload =\", body);\r",
											"  console.log(\"[PUT SEND] transactionTimeout =\", tx);\r",
											"} catch(e) {\r",
											"  console.log(\"[PUT SEND] payload =\", body);\r",
											"}\r",
											"\r",
											"// Testsì—ì„œ ì¬ê²€ì¦ì„ ìœ„í•œ ë³´ê´€\r",
											"pm.environment.set(\"LAST_RANDOM_TX_TIMEOUT\", String(tx));\r",
											"pm.environment.set(\"LAST_TX_TIMEOUT_RANGE\", JSON.stringify({min:MIN_T, max:MAX_T}));\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === Tests: HTTP 200 / (ìˆìœ¼ë©´) ë¹„ì¦ˆë‹ˆìŠ¤ì½”ë“œ 200 í™•ì¸ + ë³´ë‚¸ transactionTimeout ë²”ìœ„ ì¬ê²€ì¦ ===\r",
											"(function(){\r",
											"  // HTTP 200\r",
											"  pm.test(\"HTTP 200\", function(){ pm.response.to.have.status(200); });\r",
											"\r",
											"  // (ì˜µì…˜) ë¹„ì¦ˆë‹ˆìŠ¤ ì½”ë“œ 200\r",
											"  try {\r",
											"    var j = pm.response.json();\r",
											"    if (j && typeof j.code !== \"undefined\") {\r",
											"      pm.test(\"Business code == 200\", function(){ pm.expect(j.code).to.eql(200); });\r",
											"    }\r",
											"  } catch(e){}\r",
											"\r",
											"  // ë³´ë‚¸ timeout ì¬ê²€ì¦\r",
											"  var txStr = pm.environment.get(\"LAST_RANDOM_TX_TIMEOUT\") || \"\";\r",
											"  var rangeStr = pm.environment.get(\"LAST_TX_TIMEOUT_RANGE\") || \"{}\";\r",
											"  var tx = parseInt(txStr, 10);\r",
											"  var range = {}; try { range = JSON.parse(rangeStr); } catch(e){}\r",
											"  var min = (typeof range.min === \"number\") ? range.min : 30;\r",
											"  var max = (typeof range.max === \"number\") ? range.max : 600;\r",
											"\r",
											"  console.log(\"[VERIFY] transactionTimeout sent =\", tx, \"range=[\"+min+\",\"+max+\"]\");\r",
											"\r",
											"  pm.test(\"transactionTimeout is integer\", function(){ pm.expect(isNaN(tx)).to.eql(false); });\r",
											"  pm.test(\"transactionTimeout in [min, max]\", function(){ pm.expect(tx >= min && tx <= max).to.eql(true); });\r",
											"})();\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "PUT",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "formdata",
									"formdata": []
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/dicom/listeners",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"dicom",
										"listeners"
									]
								}
							},
							"response": []
						},
						{
							"name": "DICOM Receiver_setting autoStart on",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === Pre-request: automaticStart=trueë¡œ ê³ ì •í•˜ì—¬ ë³´ëƒ„ + ì‹¤ì œ payload ë¡œê·¸ ===\r",
											"pm.request.method = \"PUT\";\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"\r",
											"// í† í° (ìˆìœ¼ë©´ í—¤ë” ì£¼ì…)\r",
											"var token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: \"Bearer \" + token });\r",
											"\r",
											"// ê¸°ë³¸ ë°”ë””(ë¬¸ì œì—ì„œ ì œê³µ) â€” í•„ìš” ì‹œ í™˜ê²½ JSON(BASE_BODY_JSON)ê³¼ ë³‘í•© ê°€ëŠ¥\r",
											"function readJson(str){ try { return JSON.parse(str); } catch(e){ return {}; } }\r",
											"var baseEnv = readJson(pm.environment.get(\"BASE_BODY_JSON\") || \"{}\");\r",
											"\r",
											"// ê¸°ë³¸ê°’ êµ¬ì„±\r",
											"var body = {\r",
											"  id: 1,\r",
											"  serviceName: \"AQUAAD\",\r",
											"  hostName: \"localhost\",\r",
											"  servicePort: 103,\r",
											"  aeTitle: \"AQUAAD\",\r",
											"  automaticStart: true,   // â˜… ìš”êµ¬ì‚¬í•­: í•­ìƒ trueë¡œ ì°ì–´ì„œ ì „ì†¡\r",
											"  transactionTimeout: 60,\r",
											"  useTls: false,\r",
											"  useMutual: false\r",
											"};\r",
											"\r",
											"// ê¸°ì¡´ ìš”ì²­ íƒ­(raw)ì— ë­”ê°€ ì¨ë†¨ìœ¼ë©´ ë°˜ì˜í•˜ê³  ì‹¶ë‹¤ë©´ ì£¼ì„ í•´ì œ\r",
											"// var cur = readJson(pm.request?.body?.raw || \"{}\");\r",
											"// body = Object.assign({}, body, cur);\r",
											"\r",
											"// í™˜ê²½ JSON ë³‘í•©(í•„ìš”í•œ í•„ë“œë§Œ ë®ê¸°)\r",
											"body = Object.assign({}, body, baseEnv);\r",
											"\r",
											"// automaticStartëŠ” ìµœì¢…ì ìœ¼ë¡œ ë¬´ì¡°ê±´ trueë¡œ ê°•ì œ\r",
											"body.automaticStart = true;\r",
											"\r",
											"// ìš”ì²­ ë°”ë”” ì ìš©\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(body));\r",
											"\r",
											"// ì½˜ì†” ë¡œê·¸(ì‹¤ì œë¡œ ë³´ë‚¸ ê°’ í™•ì¸)\r",
											"try {\r",
											"  var reqUrl = pm.request.url ? pm.request.url.toString() : \"(unknown url)\";\r",
											"  console.log(\"[PUT SEND] \" + reqUrl + \" payload =\", body);\r",
											"} catch(e) {\r",
											"  console.log(\"[PUT SEND] payload =\", body);\r",
											"}\r",
											"\r",
											"// Testsì—ì„œ ì°¸ì¡°í•  ìˆ˜ ìˆê²Œ ì €ì¥(ì„ íƒ)\r",
											"pm.environment.set(\"LAST_PUT_BODY\", JSON.stringify(body));\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === Tests: HTTP 200 / (ìˆìœ¼ë©´) ë¹„ì¦ˆë‹ˆìŠ¤ì½”ë“œ 200 / ì‘ë‹µì— ìë™ ì‹œì‘ ê°’ ìˆìœ¼ë©´ true í™•ì¸ ===\r",
											"(function(){\r",
											"  // HTTP 200\r",
											"  pm.test(\"HTTP 200\", function(){ pm.response.to.have.status(200); });\r",
											"\r",
											"  // (ì˜µì…˜) ë¹„ì¦ˆë‹ˆìŠ¤ ì½”ë“œ 200\r",
											"  var j = null; try { j = pm.response.json(); } catch(e){}\r",
											"  if (j && typeof j.code !== \"undefined\") {\r",
											"    pm.test(\"Business code == 200\", function(){ pm.expect(j.code).to.eql(200); });\r",
											"  }\r",
											"\r",
											"  // ì‘ë‹µì— automaticStartê°€ í¬í•¨ë¼ ìˆë‹¤ë©´ trueì¸ì§€ í™•ì¸(ì‘ë‹µ ìŠ¤í‚¤ë§ˆê°€ ë‹¤ë¥´ë©´ í†µê³¼)\r",
											"  var respAuto = null;\r",
											"  if (j) {\r",
											"    if (typeof j.automaticStart !== \"undefined\") respAuto = j.automaticStart;\r",
											"    else if (j.result && typeof j.result.automaticStart !== \"undefined\") respAuto = j.result.automaticStart;\r",
											"  }\r",
											"  if (respAuto !== null) {\r",
											"    var respAutoBool = (respAuto === true) ||\r",
											"                       (respAuto === 1) ||\r",
											"                       (String(respAuto).toLowerCase() === \"true\") ||\r",
											"                       (String(respAuto) === \"1\");\r",
											"    pm.test(\"Response automaticStart == true (if present)\", function(){ pm.expect(respAutoBool).to.eql(true); });\r",
											"    console.log(\"[VERIFY] response automaticStart =\", respAuto);\r",
											"  }\r",
											"})();\r",
											"\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "PUT",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "formdata",
									"formdata": []
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/dicom/listeners",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"dicom",
										"listeners"
									]
								}
							},
							"response": []
						},
						{
							"name": "DICOM Receiver_setting autoStart off",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === Pre-request: automaticStart=falseë¡œ ê³ ì •í•˜ì—¬ ë³´ëƒ„ + ì‹¤ì œ payload ë¡œê·¸ ===\r",
											"pm.request.method = \"PUT\";\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"\r",
											"// í† í° (ìˆìœ¼ë©´ í—¤ë” ì£¼ì…)\r",
											"var token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: \"Bearer \" + token });\r",
											"\r",
											"// ê¸°ë³¸ ë°”ë””(ë¬¸ì œì—ì„œ ì œê³µ) â€” í•„ìš” ì‹œ í™˜ê²½ JSON(BASE_BODY_JSON)ê³¼ ë³‘í•© ê°€ëŠ¥\r",
											"function readJson(str){ try { return JSON.parse(str); } catch(e){ return {}; } }\r",
											"var baseEnv = readJson(pm.environment.get(\"BASE_BODY_JSON\") || \"{}\");\r",
											"\r",
											"// ê¸°ë³¸ê°’ êµ¬ì„±\r",
											"var body = {\r",
											"  id: 1,\r",
											"  serviceName: \"AQUAAD\",\r",
											"  hostName: \"localhost\",\r",
											"  servicePort: 103,\r",
											"  aeTitle: \"AQUAAD\",\r",
											"  automaticStart: false,   // â˜… ìš”êµ¬ì‚¬í•­: í•­ìƒ falseë¡œ ì°ì–´ì„œ ì „ì†¡\r",
											"  transactionTimeout: 60,\r",
											"  useTls: false,\r",
											"  useMutual: false\r",
											"};\r",
											"\r",
											"// ê¸°ì¡´ ìš”ì²­ íƒ­(raw)ì— ë­”ê°€ ì¨ë†¨ìœ¼ë©´ ë°˜ì˜í•˜ê³  ì‹¶ë‹¤ë©´ ì£¼ì„ í•´ì œ\r",
											"// var cur = readJson(pm.request?.body?.raw || \"{}\");\r",
											"// body = Object.assign({}, body, cur);\r",
											"\r",
											"// í™˜ê²½ JSON ë³‘í•©(í•„ìš”í•œ í•„ë“œë§Œ ë®ê¸°)\r",
											"body = Object.assign({}, body, baseEnv);\r",
											"\r",
											"// automaticStartëŠ” ìµœì¢…ì ìœ¼ë¡œ ë¬´ì¡°ê±´ falseë¡œ ê°•ì œ\r",
											"body.automaticStart = false;\r",
											"\r",
											"// ìš”ì²­ ë°”ë”” ì ìš©\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(body));\r",
											"\r",
											"// ì½˜ì†” ë¡œê·¸(ì‹¤ì œë¡œ ë³´ë‚¸ ê°’ í™•ì¸)\r",
											"try {\r",
											"  var reqUrl = pm.request.url ? pm.request.url.toString() : \"(unknown url)\";\r",
											"  console.log(\"[PUT SEND] \" + reqUrl + \" payload =\", body);\r",
											"} catch(e) {\r",
											"  console.log(\"[PUT SEND] payload =\", body);\r",
											"}\r",
											"\r",
											"// Testsì—ì„œ ì°¸ì¡°í•  ìˆ˜ ìˆê²Œ ì €ì¥(ì„ íƒ)\r",
											"pm.environment.set(\"LAST_PUT_BODY\", JSON.stringify(body));\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === Tests: HTTP 200 / (ìˆìœ¼ë©´) ë¹„ì¦ˆë‹ˆìŠ¤ì½”ë“œ 200 / ì‘ë‹µì— ìë™ ì‹œì‘ ê°’ ìˆìœ¼ë©´ false í™•ì¸ ===\r",
											"(function(){\r",
											"  // HTTP 200\r",
											"  pm.test(\"HTTP 200\", function(){ pm.response.to.have.status(200); });\r",
											"\r",
											"  // (ì˜µì…˜) ë¹„ì¦ˆë‹ˆìŠ¤ ì½”ë“œ 200\r",
											"  var j = null; try { j = pm.response.json(); } catch(e){}\r",
											"  if (j && typeof j.code !== \"undefined\") {\r",
											"    pm.test(\"Business code == 200\", function(){ pm.expect(j.code).to.eql(200); });\r",
											"  }\r",
											"\r",
											"  // ì‘ë‹µì— automaticStartê°€ í¬í•¨ë¼ ìˆë‹¤ë©´ falseì¸ì§€ í™•ì¸(ì‘ë‹µ ìŠ¤í‚¤ë§ˆê°€ ë‹¤ë¥´ë©´ í†µê³¼)\r",
											"  var respAuto = null;\r",
											"  if (j) {\r",
											"    if (typeof j.automaticStart !== \"undefined\") respAuto = j.automaticStart;\r",
											"    else if (j.result && typeof j.result.automaticStart !== \"undefined\") respAuto = j.result.automaticStart;\r",
											"  }\r",
											"  if (respAuto !== null) {\r",
											"    var respAutoBool = (respAuto === false) ||\r",
											"                       (respAuto === 1) ||\r",
											"                       (String(respAuto).toLowerCase() === \"false\") ||\r",
											"                       (String(respAuto) === \"1\");\r",
											"    pm.test(\"Response automaticStart == false (if present)\", function(){ pm.expect(respAutoBool).to.eql(false); });\r",
											"    console.log(\"[VERIFY] response automaticStart =\", respAuto);\r",
											"  }\r",
											"})();\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "PUT",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "formdata",
									"formdata": []
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/dicom/listeners",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"dicom",
										"listeners"
									]
								}
							},
							"response": []
						}
					]
				},
				{
					"name": "Result Archiving Server",
					"item": [
						{
							"name": "Result Archiving Server_Add server",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === Pre-request: ëœë¤ hostName(<=63, [A-Za-z0-9.-]) + ëœë¤ aeTitle(<=16) ìƒì„± â†’ ë°”ë”” êµ¬ì„± & ë¡œê·¸ ===\r",
											"pm.request.method = \"POST\";\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"\r",
											"// í† í°(ìˆìœ¼ë©´)\r",
											"var token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: \"Bearer \" + token });\r",
											"\r",
											"// ---------- ì˜µì…˜(í™˜ê²½ë³€ìˆ˜) ----------\r",
											"// hostName\r",
											"var MAX_HOST_LEN  = Number(pm.environment.get(\"HOSTNAME_MAXLEN\") || 63);\r",
											"var LABELS_FORCE  = Number(pm.environment.get(\"HOSTNAME_LABEL_COUNT\") || 0); // 0: 1~2 ëœë¤, 1: ë‹¨ì¼, 2: ë‘ ë ˆì´ë¸”\r",
											"var FORCE_HOST    = pm.environment.get(\"FORCE_HOSTNAME\") || \"\";             // ê³ ì • hostName(í…ŒìŠ¤íŠ¸ìš©)\r",
											"// aeTitle\r",
											"function toInt(x){ var n=parseInt(x,10); return isNaN(n)?null:n; }\r",
											"var AET_MAXLEN    = toInt(pm.environment.get(\"AET_MAXLEN\")); if (AET_MAXLEN === null) AET_MAXLEN = 16;\r",
											"var AET_MINLEN    = toInt(pm.environment.get(\"AET_MINLEN\")); if (AET_MINLEN === null) AET_MINLEN = 2;\r",
											"var FORCE_AET     = pm.environment.get(\"FORCE_AETITLE\") || \"\";\r",
											"// ê¸°ë³¸ ë¬¸ìì§‘í•©(ì•ˆì „í•˜ê²Œ ëŒ€ë¬¸ì+ìˆ«ì). í•„ìš”ì‹œ AET_CHARSETìœ¼ë¡œ êµì²´ ê°€ëŠ¥\r",
											"var AET_CHARSET   = pm.environment.get(\"AET_CHARSET\") || \"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\";\r",
											"\r",
											"// ---------- ìœ í‹¸ ----------\r",
											"function pick(s){ return s.charAt(Math.floor(Math.random()*s.length)); }\r",
											"function randInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }\r",
											"\r",
											"// (1) hostName ìƒì„±: ì‹œì‘/ë ì˜ìˆ«ì, ì¤‘ê°„ ì˜ìˆ«ì/í•˜ì´í”ˆ, '.'ë¡œ ë ˆì´ë¸” ê²°í•©, ì „ì²´ â‰¤ MAX_HOST_LEN\r",
											"var ALNUM = \"abcdefghijklmnopqrstuvwxyz0123456789\";\r",
											"var MID   = ALNUM + \"-\";\r",
											"\r",
											"function makeLabel(len){\r",
											"  if (len <= 1) return pick(ALNUM);\r",
											"  var s = pick(ALNUM);\r",
											"  for (var i=1;i<len-1;i++) s += pick(MID);\r",
											"  s += pick(ALNUM);\r",
											"  return s;\r",
											"}\r",
											"function makeHostname(maxLen){\r",
											"  if (FORCE_HOST) {\r",
											"    var h = String(FORCE_HOST).slice(0, maxLen);\r",
											"    if (!/[A-Za-z0-9]$/.test(h)) h = h.replace(/[^a-z0-9]$/, \"a\");\r",
											"    return h;\r",
											"  }\r",
											"  var labelCount = LABELS_FORCE ? LABELS_FORCE : randInt(1,2);\r",
											"  var remaining = maxLen - (labelCount - 1);\r",
											"  var labels = [];\r",
											"  for (var i=0;i<labelCount;i++){\r",
											"    var minForRest = (labelCount - i - 1) * 1;\r",
											"    var maxForThis = Math.max(1, remaining - minForRest);\r",
											"    var len = randInt(1, Math.min(20, maxForThis));\r",
											"    var lbl = makeLabel(len);\r",
											"    labels.push(lbl);\r",
											"    remaining -= len;\r",
											"  }\r",
											"  var host = labels.join(\".\");\r",
											"  if (host.length > maxLen) host = host.slice(0, maxLen).replace(/[^a-z0-9]$/, \"a\");\r",
											"  return host;\r",
											"}\r",
											"var randomHost = makeHostname(MAX_HOST_LEN);\r",
											"\r",
											"// (2) aeTitle ìƒì„±: ê¸¸ì´ AET_MINLEN~AET_MAXLEN, ê¸°ë³¸ ëŒ€ë¬¸ì+ìˆ«ì\r",
											"function makeAETitle(minLen, maxLen, charset){\r",
											"  var len = randInt(minLen, maxLen);\r",
											"  var out = \"\";\r",
											"  for (var i=0;i<len;i++) out += pick(charset);\r",
											"  return out;\r",
											"}\r",
											"var aeTitle = FORCE_AET ? String(FORCE_AET) : makeAETitle(AET_MINLEN, AET_MAXLEN, AET_CHARSET);\r",
											"if (aeTitle.length > AET_MAXLEN) aeTitle = aeTitle.slice(0, AET_MAXLEN);\r",
											"\r",
											"// ---------- ìš”ì²­ ë°”ë”” ----------\r",
											"var body = {\r",
											"  hostName: randomHost,\r",
											"  servicePort: 11,\r",
											"  aeTitle: aeTitle,                 // â˜… ëœë¤(ì¤‘ë³µ íšŒí”¼)\r",
											"  useTls: false,\r",
											"  useMutual: false,\r",
											"  serverStatus: true,\r",
											"  transferToPacs: {\r",
											"    report: true,\r",
											"    analysisResultImage: false\r",
											"  }\r",
											"};\r",
											"\r",
											"// (ì˜µì…˜) BASE_BODY_JSONìœ¼ë¡œ ì¶”ê°€ í•„ë“œ ë®ì–´ì“°ê¸°\r",
											"try {\r",
											"  var extra = pm.environment.get(\"BASE_BODY_JSON\");\r",
											"  if (extra) body = Object.assign(body, JSON.parse(extra));\r",
											"} catch(e){}\r",
											"\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(body));\r",
											"\r",
											"// ---------- ë¡œê·¸ & ì €ì¥ ----------\r",
											"try {\r",
											"  var reqUrl = pm.request.url ? pm.request.url.toString() : \"(unknown url)\";\r",
											"  console.log(\"[POST SEND] \" + reqUrl + \" payload =\", body);\r",
											"  console.log(\"[POST SEND] hostName =\", randomHost, \"len=\", randomHost.length);\r",
											"  console.log(\"[POST SEND] aeTitle  =\", aeTitle,    \"len=\", aeTitle.length);\r",
											"} catch(e){}\r",
											"\r",
											"pm.environment.set(\"LAST_RANDOM_HOSTNAME\", randomHost);\r",
											"pm.environment.set(\"HOSTNAME_MAXLEN_EFFECTIVE\", String(MAX_HOST_LEN));\r",
											"pm.environment.set(\"LAST_RANDOM_AETITLE\", aeTitle);\r",
											"pm.environment.set(\"AET_LIMITS\", JSON.stringify({ min: AET_MINLEN, max: AET_MAXLEN }));\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === Tests: HTTP 200 / (ìˆìœ¼ë©´) ë¹„ì¦ˆë‹ˆìŠ¤ì½”ë“œ 200 í™•ì¸ + ë³´ë‚¸ hostName ê·œì¹™/ local=true ì¬ê²€ì¦ ===\r",
											"(function(){\r",
											"  // 1) HTTP 200\r",
											"  pm.test(\"HTTP 200\", function(){ pm.response.to.have.status(200); });\r",
											"\r",
											"  // 2) (ì˜µì…˜) ë¹„ì¦ˆë‹ˆìŠ¤ ì½”ë“œ 200\r",
											"  var j=null; try { j = pm.response.json(); } catch(e){}\r",
											"  if (j && typeof j.code !== \"undefined\") {\r",
											"    pm.test(\"Business code == 200\", function(){ pm.expect(j.code).to.eql(200); });\r",
											"  }\r",
											"\r",
											"  // 3) hostName ê·œì¹™ ì¬ê²€ì¦\r",
											"  var host = pm.environment.get(\"LAST_RANDOM_HOSTNAME\") || \"\";\r",
											"  var maxLen = parseInt(pm.environment.get(\"HOSTNAME_MAXLEN_EFFECTIVE\") || \"63\", 10);\r",
											"  console.log(\"[VERIFY] hostName sent =\", host, \"len=\", host.length);\r",
											"\r",
											"  pm.test(\"hostName length <= \"+maxLen, function(){ pm.expect(host.length).to.be.at.most(maxLen); });\r",
											"  pm.test(\"hostName allowed chars [a-z0-9.-]\", function(){\r",
											"    pm.expect(/^[a-z0-9.-]+$/.test(host)).to.eql(true);\r",
											"  });\r",
											"  pm.test(\"hostName starts & ends with alphanumeric\", function(){\r",
											"    pm.expect(/^[a-z0-9].*[a-z0-9]$/.test(host) || /^[a-z0-9]$/.test(host)).to.eql(true);\r",
											"  });\r",
											"\r",
											"  // 4) local=true í™•ì¸(ì‘ë‹µì— ìˆìœ¼ë©´ ì²´í¬)\r",
											"  if (j) {\r",
											"    var respLocal = null;\r",
											"    if (typeof j.local !== \"undefined\") respLocal = j.local;\r",
											"    else if (j.result && typeof j.result.local !== \"undefined\") respLocal = j.result.local;\r",
											"\r",
											"    if (respLocal !== null) {\r",
											"      var respLocalBool = (respLocal === true) ||\r",
											"                          (respLocal === 1) ||\r",
											"                          (String(respLocal).toLowerCase() === \"true\") ||\r",
											"                          (String(respLocal) === \"1\");\r",
											"      pm.test(\"Response local == true (if present)\", function(){ pm.expect(respLocalBool).to.eql(true); });\r",
											"      console.log(\"[VERIFY] response local =\", respLocal);\r",
											"    }\r",
											"  }\r",
											"})();\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "formdata",
									"formdata": []
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/dicom/servers",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"dicom",
										"servers"
									]
								}
							},
							"response": []
						},
						{
							"name": "Result Archiving Server_ëª©ë¡ ì¡°íšŒ",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === Save first id from result.reportServers to env {{id}} and {{aeTitle}} ===\r",
											"(function () {\r",
											"  // ê¸°ë³¸ ì‘ë‹µ ì²´í¬\r",
											"  pm.test(\"HTTP 200\", function () { pm.response.to.have.status(200); });\r",
											"\r",
											"  var body = null; try { body = pm.response.json(); } catch (e) {}\r",
											"  pm.test(\"Body is JSON\", function(){ pm.expect(body).to.be.an(\"object\"); });\r",
											"\r",
											"  // reportServers ë°°ì—´ êº¼ë‚´ê¸°\r",
											"  var list = [];\r",
											"  if (body && body.result && Array.isArray(body.result.reportServers)) {\r",
											"    list = body.result.reportServers;\r",
											"  }\r",
											"\r",
											"  pm.test(\"reportServers has at least 1 item\", function () {\r",
											"    pm.expect(list.length).to.be.greaterThan(0);\r",
											"  });\r",
											"\r",
											"  // ì²« ë²ˆì§¸ ì•„ì´í…œ\r",
											"  var first = list[0] || null;\r",
											"\r",
											"  // id ì¶”ì¶œ (id ì—†ìœ¼ë©´ serverIdë„ ì‹œë„)\r",
											"  var firstId = (first && (first.id != null ? first.id : first.serverId)) || null;\r",
											"  pm.test(\"First item has id\", function () {\r",
											"    pm.expect(firstId, \"Cannot find id in first reportServers item\").to.not.be.null;\r",
											"  });\r",
											"\r",
											"  if (firstId != null) {\r",
											"    var idStr = String(firstId);\r",
											"    // í™˜ê²½/ì»¬ë ‰ì…˜/ê¸€ë¡œë²Œ ëª¨ë‘ ì €ì¥\r",
											"    try { pm.environment.set(\"id\", idStr); } catch(e){}\r",
											"    try { pm.collectionVariables.set(\"id\", idStr); } catch(e){}\r",
											"    try { pm.globals.set(\"id\", idStr); } catch(e){}\r",
											"  }\r",
											"\r",
											"  // === aeTitle ì¶”ì¶œ & ì €ì¥ ===\r",
											"  var firstAeTitle = (first && first.aeTitle != null) ? String(first.aeTitle) : null;\r",
											"\r",
											"  pm.test(\"First item has aeTitle\", function () {\r",
											"    pm.expect(firstAeTitle, \"Cannot find aeTitle in first reportServers item\").to.not.be.null;\r",
											"  });\r",
											"\r",
											"  if (firstAeTitle != null) {\r",
											"    try { pm.environment.set(\"aeTitle\", firstAeTitle); } catch(e){}\r",
											"    try { pm.collectionVariables.set(\"aeTitle\", firstAeTitle); } catch(e){}\r",
											"    try { pm.globals.set(\"aeTitle\", firstAeTitle); } catch(e){}\r",
											"  }\r",
											"\r",
											"  console.log(\"[REPORT SERVER SAVED]\",\r",
											"    \"id=\", firstId,\r",
											"    \"hostName=\", first && first.hostName,\r",
											"    \"aeTitle=\", firstAeTitle\r",
											"  );\r",
											"})();\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "formdata",
									"formdata": []
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/dicom/servers",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"dicom",
										"servers"
									]
								}
							},
							"response": []
						},
						{
							"name": "Result Archiving Server_Add ì¤‘ë³µ aeTtile",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === Pre-request: ëœë¤ hostName(<=63, [A-Za-z0-9.-]) + aeTitle(ENV ìš°ì„ , ì—†ìœ¼ë©´ ëœë¤) â†’ ë°”ë”” êµ¬ì„± & ë¡œê·¸ ===\r",
											"pm.request.method = \"POST\";\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"\r",
											"// í† í°(ìˆìœ¼ë©´)\r",
											"var token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: \"Bearer \" + token });\r",
											"\r",
											"// ---------- ì˜µì…˜(í™˜ê²½ë³€ìˆ˜) ----------\r",
											"// hostName\r",
											"var MAX_HOST_LEN  = Number(pm.environment.get(\"HOSTNAME_MAXLEN\") || 63);\r",
											"var LABELS_FORCE  = Number(pm.environment.get(\"HOSTNAME_LABEL_COUNT\") || 0); // 0: 1~2 ëœë¤, 1: ë‹¨ì¼, 2: ë‘ ë ˆì´ë¸”\r",
											"var FORCE_HOST    = pm.environment.get(\"FORCE_HOSTNAME\") || \"\";             // ê³ ì • hostName(í…ŒìŠ¤íŠ¸ìš©)\r",
											"// aeTitle\r",
											"function toInt(x){ var n=parseInt(x,10); return isNaN(n)?null:n; }\r",
											"var AET_MAXLEN    = toInt(pm.environment.get(\"AET_MAXLEN\")); if (AET_MAXLEN === null) AET_MAXLEN = 16;\r",
											"var AET_MINLEN    = toInt(pm.environment.get(\"AET_MINLEN\")); if (AET_MINLEN === null) AET_MINLEN = 2;\r",
											"var FORCE_AET     = pm.environment.get(\"FORCE_AETITLE\") || \"\";\r",
											"// ê¸°ë³¸ ë¬¸ìì§‘í•©(ì•ˆì „í•˜ê²Œ ëŒ€ë¬¸ì+ìˆ«ì). í•„ìš”ì‹œ AET_CHARSETìœ¼ë¡œ êµì²´ ê°€ëŠ¥\r",
											"var AET_CHARSET   = pm.environment.get(\"AET_CHARSET\") || \"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\";\r",
											"\r",
											"// ---------- ìœ í‹¸ ----------\r",
											"function pick(s){ return s.charAt(Math.floor(Math.random()*s.length)); }\r",
											"function randInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }\r",
											"\r",
											"// (1) hostName ìƒì„±: ì‹œì‘/ë ì˜ìˆ«ì, ì¤‘ê°„ ì˜ìˆ«ì/í•˜ì´í”ˆ, '.'ë¡œ ë ˆì´ë¸” ê²°í•©, ì „ì²´ â‰¤ MAX_HOST_LEN\r",
											"var ALNUM = \"abcdefghijklmnopqrstuvwxyz0123456789\";\r",
											"var MID   = ALNUM + \"-\";\r",
											"\r",
											"function makeLabel(len){\r",
											"  if (len <= 1) return pick(ALNUM);\r",
											"  var s = pick(ALNUM);\r",
											"  for (var i=1;i<len-1;i++) s += pick(MID);\r",
											"  s += pick(ALNUM);\r",
											"  return s;\r",
											"}\r",
											"function makeHostname(maxLen){\r",
											"  if (FORCE_HOST) {\r",
											"    var h = String(FORCE_HOST).slice(0, maxLen);\r",
											"    if (!/[A-Za-z0-9]$/.test(h)) h = h.replace(/[^a-z0-9]$/, \"a\");\r",
											"    return h;\r",
											"  }\r",
											"  var labelCount = LABELS_FORCE ? LABELS_FORCE : randInt(1,2);\r",
											"  var remaining = maxLen - (labelCount - 1);\r",
											"  var labels = [];\r",
											"  for (var i=0;i<labelCount;i++){\r",
											"    var minForRest = (labelCount - i - 1) * 1;\r",
											"    var maxForThis = Math.max(1, remaining - minForRest);\r",
											"    var len = randInt(1, Math.min(20, maxForThis));\r",
											"    var lbl = makeLabel(len);\r",
											"    labels.push(lbl);\r",
											"    remaining -= len;\r",
											"  }\r",
											"  var host = labels.join(\".\");\r",
											"  if (host.length > maxLen) host = host.slice(0, maxLen).replace(/[^a-z0-9]$/, \"a\");\r",
											"  return host;\r",
											"}\r",
											"var randomHost = makeHostname(MAX_HOST_LEN);\r",
											"\r",
											"// (2) aeTitle ìƒì„±: ENV ìš°ì„  â†’ FORCE_AET â†’ ëœë¤\r",
											"function makeAETitle(minLen, maxLen, charset){\r",
											"  var len = randInt(minLen, maxLen);\r",
											"  var out = \"\";\r",
											"  for (var i=0;i<len;i++) out += pick(charset);\r",
											"  return out;\r",
											"}\r",
											"// ENVì—ì„œ ìš°ì„  ê°€ì ¸ì˜¤ê¸° (env -> collection -> global)\r",
											"var AE_ENV =\r",
											"  pm.environment.get(\"aeTitle\") ||\r",
											"  pm.collectionVariables.get(\"aeTitle\") ||\r",
											"  pm.globals.get(\"aeTitle\") || \"\";\r",
											"\r",
											"// ìµœì¢… ì‚¬ìš©ê°’ ê³„ì‚°\r",
											"var aeTitle = AE_ENV ? String(AE_ENV)\r",
											"           : (FORCE_AET ? String(FORCE_AET) : makeAETitle(AET_MINLEN, AET_MAXLEN, AET_CHARSET));\r",
											"if (aeTitle.length > AET_MAXLEN) aeTitle = aeTitle.slice(0, AET_MAXLEN);\r",
											"\r",
											"// ---------- ìš”ì²­ ë°”ë”” ----------\r",
											"var body = {\r",
											"  hostName: randomHost,\r",
											"  servicePort: 11,\r",
											"  aeTitle: aeTitle,                 // â˜… ENV ìš°ì„ (ì—†ìœ¼ë©´ ëœë¤)\r",
											"  useTls: false,\r",
											"  useMutual: false,\r",
											"  serverStatus: true,\r",
											"  transferToPacs: {\r",
											"    report: true,\r",
											"    analysisResultImage: false\r",
											"  }\r",
											"};\r",
											"\r",
											"// (ì˜µì…˜) BASE_BODY_JSONìœ¼ë¡œ ì¶”ê°€ í•„ë“œ ë®ì–´ì“°ê¸°\r",
											"try {\r",
											"  var extra = pm.environment.get(\"BASE_BODY_JSON\");\r",
											"  if (extra) body = Object.assign(body, JSON.parse(extra));\r",
											"} catch(e){}\r",
											"\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(body));\r",
											"\r",
											"// ---------- ë¡œê·¸ & ì €ì¥ ----------\r",
											"try {\r",
											"  var reqUrl = pm.request.url ? pm.request.url.toString() : \"(unknown url)\";\r",
											"  console.log(\"[POST SEND] \" + reqUrl + \" payload =\", body);\r",
											"  console.log(\"[POST SEND] hostName =\", randomHost, \"len=\", randomHost.length);\r",
											"  console.log(\"[POST SEND] aeTitle  =\", aeTitle,    \"len=\", aeTitle.length, \" (source:\", (AE_ENV ? \"ENV\" : (FORCE_AET ? \"FORCE\" : \"RANDOM\")), \")\");\r",
											"} catch(e){}\r",
											"\r",
											"pm.environment.set(\"LAST_RANDOM_HOSTNAME\", randomHost);\r",
											"pm.environment.set(\"HOSTNAME_MAXLEN_EFFECTIVE\", String(MAX_HOST_LEN));\r",
											"pm.environment.set(\"LAST_RANDOM_AETITLE\", aeTitle);\r",
											"pm.environment.set(\"AET_LIMITS\", JSON.stringify({ min: AET_MINLEN, max: AET_MAXLEN }));\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === Tests: PASS ê¸°ì¤€ = (HTTP 2xx) OR (HTTP 500 && code==9007) ===\r",
											"(function(){\r",
											"  // ì‘ë‹µ íŒŒì‹±\r",
											"  var j = null; try { j = pm.response.json(); } catch(e){}\r",
											"  var http = pm.response.code;\r",
											"  var svcCode = (j && typeof j.code !== \"undefined\") ? Number(j.code) : null;\r",
											"  var svcMsg  = (j && typeof j.message !== \"undefined\") ? String(j.message) : \"\";\r",
											"\r",
											"  // PASS ì¡°ê±´\r",
											"  var is2xx = http >= 200 && http < 300;\r",
											"  var isExpected9007 = (http === 500 && svcCode === 9007);\r",
											"  var PASS = is2xx || isExpected9007;\r",
											"\r",
											"  // í•µì‹¬ PASS í…ŒìŠ¤íŠ¸\r",
											"  pm.test(\"POST /app/api/dicom/servers: PASS ì¡°ê±´ ì¶©ì¡±\", function () {\r",
											"    pm.expect(PASS, `status=${http}, code=${svcCode}, msg=\"${svcMsg}\"`).to.be.true;\r",
											"  });\r",
											"\r",
											"  // ë³´ì¡° í…ŒìŠ¤íŠ¸(ê°€ë…ì„±)\r",
											"  if (isExpected9007) {\r",
											"    pm.test(\"ì˜ˆìƒëœ ì˜ˆì™¸ ìˆ˜ìš©: 500 + code=9007\", function(){ pm.expect(true).to.be.true; });\r",
											"  } else if (is2xx) {\r",
											"    // ë¹„ì¦ˆë‹ˆìŠ¤ ì½”ë“œ 200ì€ 2xxì¼ ë•Œë§Œ ì²´í¬(9007 ê²½ë¡œì—ì„œ ì‹¤íŒ¨í•˜ì§€ ì•Šê²Œ)\r",
											"    if (j && typeof j.code !== \"undefined\") {\r",
											"      pm.test(\"Business code == 200 (if present on 2xx)\", function(){ pm.expect(j.code).to.eql(200); });\r",
											"    }\r",
											"  } else {\r",
											"    pm.test(\"ë¹„í—ˆìš© ìƒíƒœ(ì°¸ê³ ìš©)\", function(){\r",
											"      pm.expect.fail(`Unexpected response. status=${http}, code=${svcCode}, message=\"${svcMsg}\"`);\r",
											"    });\r",
											"  }\r",
											"\r",
											"  // hostName ê·œì¹™ ì¬ê²€ì¦(ê¸°ì¡´ ìœ ì§€)\r",
											"  var host = pm.environment.get(\"LAST_RANDOM_HOSTNAME\") || \"\";\r",
											"  var maxLen = parseInt(pm.environment.get(\"HOSTNAME_MAXLEN_EFFECTIVE\") || \"63\", 10);\r",
											"  console.log(\"[VERIFY] hostName sent =\", host, \"len=\", host.length);\r",
											"\r",
											"  pm.test(\"hostName length <= \" + maxLen, function(){ pm.expect(host.length).to.be.at.most(maxLen); });\r",
											"  pm.test(\"hostName allowed chars [a-z0-9.-]\", function(){\r",
											"    pm.expect(/^[a-z0-9.-]+$/.test(host)).to.eql(true);\r",
											"  });\r",
											"  pm.test(\"hostName starts & ends with alphanumeric\", function(){\r",
											"    pm.expect(/^[a-z0-9].*[a-z0-9]$/.test(host) || /^[a-z0-9]$/.test(host)).to.eql(true);\r",
											"  });\r",
											"\r",
											"  // (ì˜µì…˜) ì‘ë‹µ local=true í™•ì¸(ìˆìœ¼ë©´)\r",
											"  if (j) {\r",
											"    var respLocal = null;\r",
											"    if (typeof j.local !== \"undefined\") respLocal = j.local;\r",
											"    else if (j.result && typeof j.result.local !== \"undefined\") respLocal = j.result.local;\r",
											"\r",
											"    if (respLocal !== null) {\r",
											"      var respLocalBool = (respLocal === true) ||\r",
											"                          (respLocal === 1) ||\r",
											"                          (String(respLocal).toLowerCase() === \"true\") ||\r",
											"                          (String(respLocal) === \"1\");\r",
											"      pm.test(\"Response local == true (if present)\", function(){ pm.expect(respLocalBool).to.eql(true); });\r",
											"      console.log(\"[VERIFY] response local =\", respLocal);\r",
											"    }\r",
											"  }\r",
											"})();\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰): PASS ê¸°ì¤€ì„ (2xx) OR (500+7011)ë¡œ ë°˜ì˜ ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // ì´ˆê¸°í™” (í•œë²ˆë§Œ)\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„°(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"\r",
											"    // PASS ê¸°ì¤€ ì¬ì •ì˜: (2xx) OR (500 && code==7011)\r",
											"    let j = null; try { j = pm.response.json(); } catch(e){}\r",
											"    const http = pm.response.code;\r",
											"    const svcCode = (j && typeof j.code !== \"undefined\") ? Number(j.code) : null;\r",
											"    const ok = (http >= 200 && http < 300) || (http === 500 && svcCode === 9007);\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "formdata",
									"formdata": []
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/dicom/servers",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"dicom",
										"servers"
									]
								}
							},
							"response": []
						},
						{
							"name": "Result Archiving Server_setting ip ìˆ˜ì •",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === PUT /app/api/dicom/servers/{{id}} : hostName(ìˆ«ì+.) ëœë¤ ìƒì„± & ë°”ë”” êµ¬ì„± ===\r",
											"pm.request.method = \"PUT\";\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"\r",
											"// í† í°(ìˆìœ¼ë©´)\r",
											"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
											"\r",
											"// --- ì„¤ì • ---\r",
											"const MAX_HOST_LEN = Number(pm.environment.get(\"HOSTNAME_MAXLEN\") || 63); // ìµœëŒ€ 63\r",
											"const DEFAULT_PORT = 115;\r",
											"const DEFAULT_AE   = \"XM4VL6R2\";\r",
											"\r",
											"// --- ìœ í‹¸ ---\r",
											"function rint(min, max){ return Math.floor(Math.random()*(max-min+1))+min; }\r",
											"function makeDigitLabel(len){\r",
											"  let s = \"\";\r",
											"  for (let i=0;i<len;i++) s += String(rint(0,9));\r",
											"  return s;\r",
											"}\r",
											"function makeNumericHostname(maxLen){\r",
											"  // 1~3ê°œ ë ˆì´ë¸”, ê° ë ˆì´ë¸”ì€ ìˆ«ìë§Œ ('.'ìœ¼ë¡œ ê²°í•©). ì‹œì‘/ëì´ ìˆ«ì ë³´ì¥, '..' ê¸ˆì§€\r",
											"  const labelCount = rint(1,3);\r",
											"  let remaining = maxLen - (labelCount - 1); // ì (.) ê°œìˆ˜ ê³ ë ¤\r",
											"  const labels = [];\r",
											"  for (let i=0;i<labelCount;i++){\r",
											"    const minForRest = (labelCount - i - 1) * 1; // ë’¤ ë ˆì´ë¸” ìµœì†Œ 1ìë¦¬ í™•ë³´\r",
											"    const maxForThis = Math.max(1, remaining - minForRest);\r",
											"    const len = rint(1, Math.min(10, maxForThis));  // ë ˆì´ë¸” ê¸¸ì´ 1~10\r",
											"    labels.push(makeDigitLabel(len));\r",
											"    remaining -= len;\r",
											"  }\r",
											"  let host = labels.join(\".\");\r",
											"  // í˜¹ì‹œ ì´ˆê³¼ ì‹œ ì˜ë¼ë‚´ê¸°(ë§ˆì§€ë§‰ì´ '.'ì´ ë˜ì§€ ì•Šë„ë¡ ì²˜ë¦¬)\r",
											"  if (host.length > maxLen) {\r",
											"    host = host.slice(0, maxLen);\r",
											"    if (host.endsWith(\".\")) host = host.slice(0, -1) + \"0\";\r",
											"  }\r",
											"  return host;\r",
											"}\r",
											"\r",
											"// --- ê²½ë¡œ id ì¶”ì¶œ(ì‹¤ì œ URLì—ì„œ íŒŒì‹±) ---\r",
											"function getPathId(){\r",
											"  try {\r",
											"    const url = pm.request.url.toString();\r",
											"    const m = /\\/servers\\/([^\\/\\?#]+)(?:[\\/\\?#]|$)/i.exec(url);\r",
											"    return m ? m[1] : (pm.variables.get(\"id\") || pm.environment.get(\"id\") || pm.collectionVariables.get(\"id\"));\r",
											"  } catch (e) { return pm.environment.get(\"id\"); }\r",
											"}\r",
											"const pathId = String(getPathId() || \"\");\r",
											"\r",
											"// --- ë°”ë”” ë§Œë“¤ê¸° ---\r",
											"const hostName = makeNumericHostname(MAX_HOST_LEN);\r",
											"const body = {\r",
											"  hostName,\r",
											"  servicePort: DEFAULT_PORT,\r",
											"  aeTitle: DEFAULT_AE,\r",
											"  useTls: false,\r",
											"  useMutual: false,\r",
											"  serverStatus: true,\r",
											"  transferToPacs: { report: true, analysisResultImage: false },\r",
											"  id: pathId ? Number(pathId) : undefined // ê²½ë¡œ idì™€ ë™ê¸°í™”\r",
											"};\r",
											"\r",
											"// (ì˜µì…˜) BASE_BODY_JSON ë³‘í•©\r",
											"try {\r",
											"  const extra = pm.environment.get(\"BASE_BODY_JSON\");\r",
											"  if (extra) Object.assign(body, JSON.parse(extra));\r",
											"} catch(e){}\r",
											"\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(body));\r",
											"\r",
											"// ë¡œê·¸ & ì €ì¥\r",
											"console.log(\"[PUT SEND] url=\", pm.request.url.toString(), \"payload=\", body);\r",
											"pm.environment.set(\"LAST_NUM_HOSTNAME\", hostName);\r",
											"pm.environment.set(\"HOSTNAME_MAXLEN_EFFECTIVE\", String(MAX_HOST_LEN));\r",
											"pm.environment.set(\"PUT_BODY_ID\", String(body.id || \"\"));\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === Tests: HTTP/Biz 200 í™•ì¸ + hostName(ìˆ«ì/.) ê·œì¹™ ê²€ì¦ + ê²½ë¡œ/ë°”ë”” id ì¼ì¹˜ ===\r",
											"(function () {\r",
											"  // 1) HTTP 200\r",
											"  pm.test(\"HTTP 200\", function(){ pm.response.to.have.status(200); });\r",
											"\r",
											"  // 2) (ìˆìœ¼ë©´) ë¹„ì¦ˆë‹ˆìŠ¤ ì½”ë“œ 200\r",
											"  let j = null; try { j = pm.response.json(); } catch(e){}\r",
											"  if (j && typeof j.code !== \"undefined\") {\r",
											"    pm.test(\"Business code == 200\", function(){ pm.expect(j.code).to.eql(200); });\r",
											"  }\r",
											"\r",
											"  // 3) hostName ê·œì¹™ ê²€ì¦ (ìˆ«ìì™€ ì (.)ë§Œ, ê¸¸ì´<=63, ì‹œì‘/ë ìˆ«ì, '..' ê¸ˆì§€)\r",
											"  const host = pm.environment.get(\"LAST_NUM_HOSTNAME\") || \"\";\r",
											"  const maxLen = parseInt(pm.environment.get(\"HOSTNAME_MAXLEN_EFFECTIVE\") || \"63\", 10);\r",
											"\r",
											"  console.log(\"[VERIFY] hostName =\", host, \"len=\", host.length);\r",
											"\r",
											"  pm.test(\"hostName length <= \" + maxLen, function(){\r",
											"    pm.expect(host.length).to.be.at.most(maxLen);\r",
											"  });\r",
											"  pm.test(\"hostName allowed chars [0-9.]\", function(){\r",
											"    pm.expect(/^[0-9.]+$/.test(host)).to.eql(true);\r",
											"  });\r",
											"  pm.test(\"hostName starts & ends with digit\", function(){\r",
											"    pm.expect(/^[0-9](?:.*[0-9])?$/.test(host)).to.eql(true);\r",
											"  });\r",
											"  pm.test(\"hostName has no consecutive dots\", function(){\r",
											"    pm.expect(host.indexOf(\"..\") === -1).to.eql(true);\r",
											"  });\r",
											"\r",
											"  // 4) ê²½ë¡œ idì™€ ë°”ë”” id ì¼ì¹˜ ê²€ì¦\r",
											"  function getPathId(){\r",
											"    try {\r",
											"      const m = /\\/servers\\/([^\\/\\?#]+)(?:[\\/\\?#]|$)/i.exec(pm.request.url.toString());\r",
											"      return m ? m[1] : null;\r",
											"    } catch(e){ return null; }\r",
											"  }\r",
											"  const pathId = getPathId();\r",
											"  const bodyId = pm.environment.get(\"PUT_BODY_ID\") || null;\r",
											"  if (pathId && bodyId) {\r",
											"    pm.test(\"Path id == Body id\", function(){\r",
											"      pm.expect(String(bodyId)).to.eql(String(pathId));\r",
											"    });\r",
											"  }\r",
											"})();\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "PUT",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "formdata",
									"formdata": []
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/dicom/servers/{{id}}",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"dicom",
										"servers",
										"{{id}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "Result Archiving Server_setting hostname ìˆ˜ì •",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === PUT /app/api/dicom/servers/{{id}} : hostName(ì†Œë¬¸ì/ìˆ«ì/-/.) ëœë¤ ìƒì„± & ë°”ë”” ì£¼ì… ===\r",
											"pm.request.method = \"PUT\";\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"\r",
											"// í† í°(ìˆìœ¼ë©´)\r",
											"var token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: \"Bearer \" + token });\r",
											"\r",
											"// ---- ì„¤ì • ----\r",
											"var MAX_HOST_LEN = Number(pm.environment.get(\"HOSTNAME_MAXLEN\") || 63); // ì „ì²´ ìµœëŒ€ ê¸¸ì´ 63\r",
											"var DEFAULT_PORT = 115;\r",
											"var DEFAULT_AE   = \"XM4VL6R2\";\r",
											"\r",
											"// ---- ìœ í‹¸ ----\r",
											"function rint(min, max){ return Math.floor(Math.random()*(max-min+1))+min; }\r",
											"function pick(s){ return s.charAt(Math.floor(Math.random()*s.length)); }\r",
											"\r",
											"var ALNUM = \"abcdefghijklmnopqrstuvwxyz0123456789\";     // ì‹œì‘/ë í—ˆìš©\r",
											"var MID   = ALNUM + \"-\";                                 // ë¼ë²¨ ë‚´ë¶€ í—ˆìš©(í•˜ì´í”ˆ í¬í•¨)\r",
											"function makeLabel(len){\r",
											"  if (len <= 1) return pick(ALNUM);\r",
											"  var s = pick(ALNUM);\r",
											"  for (var i=1;i<len-1;i++) s += pick(MID);\r",
											"  s += pick(ALNUM);\r",
											"  return s;\r",
											"}\r",
											"\r",
											"// hostName ë§Œë“¤ê¸°: 1~3ê°œ ë¼ë²¨ì„ '.'ë¡œ ì—°ê²°, ì´ ê¸¸ì´ â‰¤ MAX_HOST_LEN\r",
											"function makeHostname(maxLen){\r",
											"  var labelCount = rint(1,3);\r",
											"  var remaining = maxLen - (labelCount - 1); // ì (.) ê°œìˆ˜ ê³ ë ¤\r",
											"  var labels = [];\r",
											"  for (var i=0;i<labelCount;i++){\r",
											"    var minForRest = (labelCount - i - 1) * 1;                 // ë’¤ ë¼ë²¨ ìµœì†Œ 1ì ë³´ì¥\r",
											"    var maxForThis = Math.max(1, remaining - minForRest);\r",
											"    var L = rint(1, Math.min(20, maxForThis));                 // ë¼ë²¨ ê¸¸ì´ 1~20\r",
											"    labels.push(makeLabel(L));\r",
											"    remaining -= L;\r",
											"  }\r",
											"  var host = labels.join(\".\");\r",
											"  // ì´ˆê³¼ ì‹œ ì•ˆì „í•˜ê²Œ ìë¥´ê¸°(ë§ˆì§€ë§‰ì´ '.'ì´ë©´ ìˆ«ì ë³´ì •)\r",
											"  if (host.length > maxLen) {\r",
											"    host = host.slice(0, maxLen);\r",
											"    if (host.endsWith(\".\")) host = host.slice(0, -1) + \"0\";\r",
											"    // í˜¹ì‹œ ë§ˆì§€ë§‰ì´ í•˜ì´í”ˆì´ë©´ ì•ŒíŒŒë²³ìœ¼ë¡œ ë³´ì •\r",
											"    if (host.endsWith(\"-\")) host = host.slice(0, -1) + \"a\";\r",
											"  }\r",
											"  return host;\r",
											"}\r",
											"\r",
											"// ê²½ë¡œì˜ id ì¶”ì¶œ(ì—†ìœ¼ë©´ env/collection/globalsì—ì„œ)\r",
											"function getPathId(){\r",
											"  try {\r",
											"    var m = /\\/servers\\/([^\\/\\?#]+)(?:[\\/\\?#]|$)/i.exec(pm.request.url.toString());\r",
											"    if (m) return m[1];\r",
											"  } catch(e){}\r",
											"  return pm.variables.get(\"id\") || pm.environment.get(\"id\") || pm.collectionVariables.get(\"id\") || pm.globals.get(\"id\");\r",
											"}\r",
											"\r",
											"var pathId   = String(getPathId() || \"\");\r",
											"var hostName = makeHostname(MAX_HOST_LEN);\r",
											"\r",
											"// ìš”ì²­ ë°”ë”” êµ¬ì„±\r",
											"var body = {\r",
											"  hostName: hostName,\r",
											"  servicePort: DEFAULT_PORT,\r",
											"  aeTitle: DEFAULT_AE,\r",
											"  useTls: false,\r",
											"  useMutual: false,\r",
											"  serverStatus: true,\r",
											"  transferToPacs: { report: true, analysisResultImage: false },\r",
											"  id: pathId ? Number(pathId) : undefined\r",
											"};\r",
											"\r",
											"// (ì˜µì…˜) BASE_BODY_JSON ë³‘í•©\r",
											"try {\r",
											"  var extra = pm.environment.get(\"BASE_BODY_JSON\");\r",
											"  if (extra) Object.assign(body, JSON.parse(extra));\r",
											"} catch(e){}\r",
											"\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(body));\r",
											"\r",
											"// ë¡œê·¸ & ì €ì¥\r",
											"console.log(\"[PUT SEND]\", pm.request.url.toString(), \"payload=\", body);\r",
											"pm.environment.set(\"LAST_HOSTNAME\", hostName);\r",
											"pm.environment.set(\"HOSTNAME_MAXLEN_EFFECTIVE\", String(MAX_HOST_LEN));\r",
											"pm.environment.set(\"PUT_BODY_ID\", String(body.id || \"\"));\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === Tests: HTTP/Biz 200 + hostName ê·œì¹™ ê²€ì¦(ì†Œë¬¸ì/ìˆ«ì/-/.), ë¼ë²¨ ê·œì¹™, ê¸¸ì´, id ì¼ì¹˜ ===\r",
											"(function(){\r",
											"  // 1) HTTP 200\r",
											"  pm.test(\"HTTP 200\", function(){ pm.response.to.have.status(200); });\r",
											"\r",
											"  // 2) (ìˆìœ¼ë©´) ë¹„ì¦ˆë‹ˆìŠ¤ ì½”ë“œ 200\r",
											"  var j=null; try { j=pm.response.json(); } catch(e){}\r",
											"  if (j && typeof j.code !== \"undefined\") {\r",
											"    pm.test(\"Business code == 200\", function(){ pm.expect(j.code).to.eql(200); });\r",
											"  }\r",
											"\r",
											"  // 3) hostName ê·œì¹™ ê²€ì¦\r",
											"  var host = pm.environment.get(\"LAST_HOSTNAME\") || \"\";\r",
											"  var maxLen = parseInt(pm.environment.get(\"HOSTNAME_MAXLEN_EFFECTIVE\") || \"63\", 10);\r",
											"  console.log(\"[VERIFY] hostName=\", host, \"len=\", host.length);\r",
											"\r",
											"  pm.test(\"hostName length <= \" + maxLen, function(){\r",
											"    pm.expect(host.length).to.be.at.most(maxLen);\r",
											"  });\r",
											"  pm.test(\"Allowed chars only [a-z0-9.-]\", function(){\r",
											"    pm.expect(/^[a-z0-9.-]+$/.test(host)).to.eql(true);\r",
											"  });\r",
											"  pm.test(\"No consecutive dots ('..')\", function(){\r",
											"    pm.expect(host.indexOf(\"..\") === -1).to.eql(true);\r",
											"  });\r",
											"  pm.test(\"Starts & ends with alphanumeric\", function(){\r",
											"    pm.expect(/^[a-z0-9](?:.*[a-z0-9])?$/.test(host)).to.eql(true);\r",
											"  });\r",
											"\r",
											"  // ë¼ë²¨ë³„ ê·œì¹™(ê° ë¼ë²¨ì€ í•˜ì´í”ˆìœ¼ë¡œ ì‹œì‘/ë ë¶ˆê°€, ë‚´ë¶€ëŠ” [a-z0-9-]*)\r",
											"  pm.test(\"Each label matches RFC-like rule\", function(){\r",
											"    var labels = host.split(\".\");\r",
											"    var ok = labels.every(function(lbl){\r",
											"      return /^[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/.test(lbl);\r",
											"    });\r",
											"    pm.expect(ok, \"invalid label in: \" + labels.join(\"|\")).to.eql(true);\r",
											"  });\r",
											"\r",
											"  // 4) ê²½ë¡œ idì™€ ë°”ë”” id ì¼ì¹˜\r",
											"  function getPathId(){\r",
											"    try {\r",
											"      var m = /\\/servers\\/([^\\/\\?#]+)(?:[\\/\\?#]|$)/i.exec(pm.request.url.toString());\r",
											"      return m ? m[1] : null;\r",
											"    } catch(e){ return null; }\r",
											"  }\r",
											"  var pathId = getPathId();\r",
											"  var bodyId = pm.environment.get(\"PUT_BODY_ID\") || null;\r",
											"  if (pathId && bodyId) {\r",
											"    pm.test(\"Path id == Body id\", function(){\r",
											"      pm.expect(String(bodyId)).to.eql(String(pathId));\r",
											"    });\r",
											"  }\r",
											"})();\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "PUT",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "formdata",
									"formdata": []
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/dicom/servers/{{id}}",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"dicom",
										"servers",
										"{{id}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "Result Archiving Server_setting port ìˆ˜ì •",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === PUT /app/api/dicom/servers/{{id}} : servicePort(0~65535) ëœë¤ ìƒì„± & ë°”ë”” ì£¼ì… ===\r",
											"pm.request.method = \"PUT\";\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"\r",
											"// í† í°(ìˆìœ¼ë©´)\r",
											"var token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: \"Bearer \" + token });\r",
											"\r",
											"// ---- ìœ í‹¸/ì„¤ì • ----\r",
											"function rint(min, max){ return Math.floor(Math.random()*(max-min+1))+min; }\r",
											"function toInt(x){ var n=parseInt(x,10); return isNaN(n)?null:n; }\r",
											"\r",
											"var MIN_PORT = 0, MAX_PORT = 65535;\r",
											"var forced   = toInt(pm.environment.get(\"FORCE_SERVICE_PORT\"));\r",
											"var port     = (forced!=null ? Math.max(MIN_PORT, Math.min(MAX_PORT, forced)) : rint(MIN_PORT, MAX_PORT));\r",
											"\r",
											"// URL ê²½ë¡œì—ì„œ id ì¶”ì¶œ (ì—†ìœ¼ë©´ env/collection/globalì˜ id ì‚¬ìš©)\r",
											"function getPathId(){\r",
											"  try {\r",
											"    var m = /\\/servers\\/([^\\/\\?#]+)(?:[\\/\\?#]|$)/i.exec(pm.request.url.toString());\r",
											"    if (m) return m[1];\r",
											"  } catch(e){}\r",
											"  return pm.variables.get(\"id\") || pm.environment.get(\"id\") || pm.collectionVariables.get(\"id\") || pm.globals.get(\"id\");\r",
											"}\r",
											"var pathId = getPathId();\r",
											"\r",
											"// ë°”ë”” êµ¬ì„± (ì˜ˆì‹œ ì–‘ì‹ ê¸°ë°˜)\r",
											"var body = {\r",
											"  hostName: \"lioluili\",\r",
											"  servicePort: port,\r",
											"  aeTitle: \"XM4VL6R2\",\r",
											"  useTls: false,\r",
											"  useMutual: false,\r",
											"  serverStatus: true,\r",
											"  transferToPacs: { report: true, analysisResultImage: false },\r",
											"  id: pathId ? Number(pathId) : undefined\r",
											"};\r",
											"\r",
											"// (ì˜µì…˜) BASE_BODY_JSON ë³‘í•©\r",
											"try {\r",
											"  var extra = pm.environment.get(\"BASE_BODY_JSON\");\r",
											"  if (extra) Object.assign(body, JSON.parse(extra));\r",
											"} catch(e){}\r",
											"\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(body));\r",
											"\r",
											"// ë¡œê·¸ & ì €ì¥\r",
											"console.log(\"[PUT SEND] url=\", pm.request.url.toString(), \"payload=\", body);\r",
											"pm.environment.set(\"LAST_SERVICE_PORT\", String(port));\r",
											"pm.environment.set(\"PORT_LIMITS\", JSON.stringify({ min: MIN_PORT, max: MAX_PORT }));\r",
											"pm.environment.set(\"PUT_BODY_ID\", String(body.id || \"\"));\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === Tests: HTTP/Biz 200 + servicePort(0~65535) ìœ íš¨ì„± + ê²½ë¡œ/ë°”ë”” id ì¼ì¹˜ ===\r",
											"(function () {\r",
											"  // 1) HTTP 200\r",
											"  pm.test(\"HTTP 200\", function(){ pm.response.to.have.status(200); });\r",
											"\r",
											"  // 2) (ìˆìœ¼ë©´) ë¹„ì¦ˆë‹ˆìŠ¤ ì½”ë“œ 200\r",
											"  var j=null; try { j = pm.response.json(); } catch(e){}\r",
											"  if (j && typeof j.code !== \"undefined\") {\r",
											"    pm.test(\"Business code == 200\", function(){ pm.expect(j.code).to.eql(200); });\r",
											"  }\r",
											"\r",
											"  // 3) servicePort ìœ íš¨ì„± (0~65535, ì •ìˆ˜)\r",
											"  var portStr = pm.environment.get(\"LAST_SERVICE_PORT\") || \"\";\r",
											"  var portNum = parseInt(portStr, 10);\r",
											"  console.log(\"[VERIFY] servicePort(sent) =\", portNum);\r",
											"\r",
											"  pm.test(\"servicePort is integer\", function(){\r",
											"    pm.expect(Number.isInteger(portNum)).to.eql(true);\r",
											"  });\r",
											"  pm.test(\"servicePort in [0, 65535]\", function(){\r",
											"    pm.expect(portNum).to.be.at.least(0);\r",
											"    pm.expect(portNum).to.be.at.most(65535);\r",
											"  });\r",
											"\r",
											"  // 3-1) ì‘ë‹µì— servicePortê°€ ìˆìœ¼ë©´ ë™ì¼í•œì§€ í™•ì¸(ì—†ìœ¼ë©´ ì´ í…ŒìŠ¤íŠ¸ëŠ” ìŠ¤í‚µ)\r",
											"  function getRespPort(resp){\r",
											"    if (!resp) return null;\r",
											"    if (typeof resp.servicePort !== \"undefined\") return resp.servicePort;\r",
											"    if (resp.result && typeof resp.result.servicePort !== \"undefined\") return resp.result.servicePort;\r",
											"    if (resp.data   && typeof resp.data.servicePort   !== \"undefined\") return resp.data.servicePort;\r",
											"    // ë°°ì—´/ë¦¬ìŠ¤íŠ¸ í˜•íƒœëŠ” APIë§ˆë‹¤ ë‹¬ë¼ì„œ ìƒëµ (í•„ìš”ì‹œ ì¶”ê°€)\r",
											"    return null;\r",
											"  }\r",
											"  var echoed = getRespPort(j);\r",
											"  if (echoed !== null) {\r",
											"    var echoedNum = parseInt(echoed, 10);\r",
											"    pm.test(\"Response servicePort equals sent\", function(){\r",
											"      pm.expect(echoedNum).to.eql(portNum);\r",
											"    });\r",
											"  }\r",
											"\r",
											"  // 4) ê²½ë¡œ idì™€ ë°”ë”” id ì¼ì¹˜\r",
											"  function getPathId(){\r",
											"    try {\r",
											"      var m = /\\/servers\\/([^\\/\\?#]+)(?:[\\/\\?#]|$)/i.exec(pm.request.url.toString());\r",
											"      return m ? m[1] : null;\r",
											"    } catch(e){ return null; }\r",
											"  }\r",
											"  var pathId = getPathId();\r",
											"  var bodyId = pm.environment.get(\"PUT_BODY_ID\") || null;\r",
											"  if (pathId && bodyId) {\r",
											"    pm.test(\"Path id == Body id\", function(){\r",
											"      pm.expect(String(bodyId)).to.eql(String(pathId));\r",
											"    });\r",
											"  }\r",
											"})();\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "PUT",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "formdata",
									"formdata": []
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/dicom/servers/{{id}}",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"dicom",
										"servers",
										"{{id}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "Result Archiving Server_setting aeTitle ìˆ˜ì •",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === PUT /app/api/dicom/servers/{{id}} : aeTitle(ì•ŒíŒŒ+ìˆ«ì, ê¸¸ì´ 0~16) ìƒì„± & ë°”ë”” ì£¼ì… ===\r",
											"pm.request.method = \"PUT\";\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"\r",
											"// í† í°(ìˆìœ¼ë©´)\r",
											"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
											"\r",
											"// ----- ì„¤ì • -----\r",
											"function toInt(x){ const n=parseInt(x,10); return isNaN(n)?null:n; }\r",
											"const AET_MIN = (toInt(pm.environment.get(\"AET_MINLEN\")) ?? 1);   // ê¸°ë³¸ 1 (ë¹ˆê°’ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ 0ìœ¼ë¡œ ì„¤ì •)\r",
											"const AET_MAX = (toInt(pm.environment.get(\"AET_MAXLEN\")) ?? 16);  // ê¸°ë³¸ 16\r",
											"const FORCE_AE = pm.environment.get(\"FORCE_AETITLE\") || \"\";       // ê°•ì œê°’(ìˆìœ¼ë©´ ì´ ê°’ ì‚¬ìš©)\r",
											"\r",
											"// ê¸°ë³¸ ë¬¸ìì§‘í•©(ëŒ€ë¬¸ì+ìˆ«ì). í•„ìš”í•˜ë©´ AET_CHARSETìœ¼ë¡œ êµì²´ ê°€ëŠ¥(ì˜ˆ: \"abcdefghijklmnopqrstuvwxyz0123456789\")\r",
											"const AET_CHARSET = pm.environment.get(\"AET_CHARSET\") || \"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\";\r",
											"\r",
											"// ----- ìœ í‹¸ -----\r",
											"function rint(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }\r",
											"function pick(s){ return s.charAt(Math.floor(Math.random()*s.length)); }\r",
											"function hasDigit(s){ return /\\d/.test(s); }\r",
											"function hasAlpha(s){ return /[A-Za-z]/.test(s); }\r",
											"\r",
											"// ê²½ë¡œì˜ {id} ì¶”ì¶œ(ì—†ìœ¼ë©´ env/collection/globalì—ì„œ)\r",
											"function getPathId(){\r",
											"  try {\r",
											"    const m = /\\/servers\\/([^\\/\\?#]+)(?:[\\/\\?#]|$)/i.exec(pm.request.url.toString());\r",
											"    if (m) return m[1];\r",
											"  } catch(e){}\r",
											"  return pm.variables.get(\"id\") || pm.environment.get(\"id\") || pm.collectionVariables.get(\"id\") || pm.globals.get(\"id\");\r",
											"}\r",
											"const pathId = getPathId();\r",
											"\r",
											"// aeTitle ìƒì„±(ì•ŒíŒŒ+ìˆ«ì, ìˆ«ì ìµœì†Œ 1ì í¬í•¨)\r",
											"function makeAeTitle(minLen, maxLen, charset){\r",
											"  const len = rint(Math.max(0,minLen), maxLen);\r",
											"  if (len === 0) return \"\"; // ë¹ˆ ë¬¸ìì—´ í—ˆìš© ì¼€ì´ìŠ¤\r",
											"  let s = \"\";\r",
											"  // ë¨¼ì € ìˆ«ì 1ê°œëŠ” ë³´ì¥\r",
											"  s += pick(\"0123456789\");\r",
											"  for (let i = 1; i < len; i++) s += pick(charset);\r",
											"  // ì…”í”Œ\r",
											"  s = s.split('').sort(()=>Math.random()-0.5).join('');\r",
											"  return s;\r",
											"}\r",
											"\r",
											"let aeTitle = FORCE_AE ? String(FORCE_AE).slice(0, AET_MAX) : makeAeTitle(AET_MIN, AET_MAX, AET_CHARSET);\r",
											"\r",
											"// ìš”ì²­ ë°”ë””(ë¬¸ì œì—ì„œ ì¤€ í¬ë§·)\r",
											"const body = {\r",
											"  hostName: \"lioluili\",\r",
											"  servicePort: 115,\r",
											"  aeTitle: aeTitle,\r",
											"  useTls: false,\r",
											"  useMutual: false,\r",
											"  serverStatus: true,\r",
											"  transferToPacs: { report: false, analysisResultImage: true },\r",
											"  id: pathId ? Number(pathId) : undefined\r",
											"};\r",
											"\r",
											"// (ì˜µì…˜) BASE_BODY_JSONìœ¼ë¡œ ë®ì–´ì“°ê¸°\r",
											"try {\r",
											"  const extra = pm.environment.get(\"BASE_BODY_JSON\");\r",
											"  if (extra) Object.assign(body, JSON.parse(extra));\r",
											"} catch(e){}\r",
											"\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(body));\r",
											"\r",
											"// ë¡œê·¸ & ê²€ì¦ìš© ì €ì¥\r",
											"console.log(\"[PUT SEND]\", pm.request.url.toString(), \"payload=\", body);\r",
											"pm.environment.set(\"LAST_AETITLE\", aeTitle);\r",
											"pm.environment.set(\"AET_LIMITS\", JSON.stringify({ min: AET_MIN, max: AET_MAX }));\r",
											"pm.environment.set(\"AET_CHARSET_EFFECTIVE\", AET_CHARSET);\r",
											"pm.environment.set(\"PUT_BODY_ID\", String(body.id || \"\"));\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === Tests: HTTP/Biz 200 + aeTitle(ì•ŒíŒŒ+ìˆ«ì, ìˆ«ì í¬í•¨, ê¸¸ì´ ì œí•œ) + ê²½ë¡œ/ë°”ë”” id ì¼ì¹˜ ===\r",
											"(function () {\r",
											"  // 1) HTTP 200\r",
											"  pm.test(\"HTTP 200\", function(){ pm.response.to.have.status(200); });\r",
											"\r",
											"  // 2) (ìˆìœ¼ë©´) ë¹„ì¦ˆë‹ˆìŠ¤ ì½”ë“œ 200\r",
											"  let j=null; try { j = pm.response.json(); } catch(e){}\r",
											"  if (j && typeof j.code !== \"undefined\") {\r",
											"    pm.test(\"Business code == 200\", function(){ pm.expect(j.code).to.eql(200); });\r",
											"  }\r",
											"\r",
											"  // 3) aeTitle ìœ íš¨ì„±\r",
											"  const ae  = pm.environment.get(\"LAST_AETITLE\") || \"\";\r",
											"  let lim = {}; try { lim = JSON.parse(pm.environment.get(\"AET_LIMITS\") || \"{}\"); } catch(e){}\r",
											"  const min = typeof lim.min === \"number\" ? lim.min : 2;\r",
											"  const max = typeof lim.max === \"number\" ? lim.max : 16;\r",
											"  const charset = pm.environment.get(\"AET_CHARSET_EFFECTIVE\") || \"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\";\r",
											"\r",
											"  console.log(\"[VERIFY] aeTitle(sent) =\", ae, \"len=\", ae.length, \"limits=[\"+min+\",\"+max+\"]\", \"charset=\", charset);\r",
											"\r",
											"  pm.test(\"aeTitle length in [\"+min+\",\"+max+\"]\", function(){\r",
											"    pm.expect(ae.length).to.be.at.least(min);\r",
											"    pm.expect(ae.length).to.be.at.most(max);\r",
											"  });\r",
											"\r",
											"  // í—ˆìš© ë¬¸ì ì§‘í•© ê²€ì¦ (ê¸°ë³¸: ëŒ€ë¬¸ì+ìˆ«ì). charsetì„ ë°”ê¿¨ë‹¤ë©´ í•´ë‹¹ ì§‘í•©ìœ¼ë¡œ ë™ì  ê²€ì‚¬.\r",
											"  pm.test(\"aeTitle allowed chars only\", function(){\r",
											"    const re = new RegExp(\"^[\" + charset.replace(/[-\\\\^$*+?.()|[\\]{}]/g, '\\\\$&') + \"]*$\");\r",
											"    pm.expect(re.test(ae)).to.eql(true);\r",
											"  });\r",
											"\r",
											"  // ìˆ«ì ë°˜ë“œì‹œ 1ê°œ ì´ìƒ í¬í•¨\r",
											"  pm.test(\"aeTitle contains at least one digit\", function(){\r",
											"    pm.expect(/\\d/.test(ae)).to.eql(true);\r",
											"  });\r",
											"\r",
											"  // (ì˜µì…˜) ëŒ€ë¬¸ì/ì†Œë¬¸ì í˜¼ìš©ì„ í—ˆìš©í•˜ë ¤ë©´ charsetì„ í™˜ê²½ë³€ìˆ˜ë¡œ ë‚´ë ¤ì„œ ë°”ê¿” ì“°ë©´ ë¨\r",
											"  // ì˜ˆ: AET_CHARSET=\"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\"\r",
											"\r",
											"  // (ì˜µì…˜) ì‘ë‹µì— aeTitleì´ ìˆìœ¼ë©´ ì—ì½” ê²€ì¦\r",
											"  function getRespAe(resp){\r",
											"    if (!resp) return null;\r",
											"    if (typeof resp.aeTitle !== \"undefined\") return resp.aeTitle;\r",
											"    if (resp.result && typeof resp.result.aeTitle !== \"undefined\") return resp.result.aeTitle;\r",
											"    if (resp.data   && typeof resp.data.aeTitle   !== \"undefined\") return resp.data.aeTitle;\r",
											"    return null;\r",
											"  }\r",
											"  const echoed = getRespAe(j);\r",
											"  if (echoed !== null) {\r",
											"    pm.test(\"Response aeTitle equals sent\", function(){\r",
											"      pm.expect(String(echoed)).to.eql(String(ae));\r",
											"    });\r",
											"  }\r",
											"\r",
											"  // 4) ê²½ë¡œ id == ë°”ë”” id\r",
											"  function getPathId(){\r",
											"    try {\r",
											"      const m = /\\/servers\\/([^\\/\\?#]+)(?:[\\/\\?#]|$)/i.exec(pm.request.url.toString());\r",
											"      return m ? m[1] : null;\r",
											"    } catch(e){ return null; }\r",
											"  }\r",
											"  const pathId = getPathId();\r",
											"  const bodyId = pm.environment.get(\"PUT_BODY_ID\") || null;\r",
											"  if (pathId && bodyId) {\r",
											"    pm.test(\"Path id == Body id\", function(){\r",
											"      pm.expect(String(bodyId)).to.eql(String(pathId));\r",
											"    });\r",
											"  }\r",
											"})();\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "PUT",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "formdata",
									"formdata": []
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/dicom/servers/{{id}}",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"dicom",
										"servers",
										"{{id}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "Result Archiving Server_ setting report false -> true",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === PUT /app/api/dicom/servers/{{id}} : í˜„ì¬ ê°’ ìœ ì§€ + transferToPacs.reportë§Œ trueë¡œ ë³€ê²½ ===\r",
											"pm.request.method = \"PUT\";\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"\r",
											"// í† í°(ìˆìœ¼ë©´)\r",
											"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
											"\r",
											"// ----- ìœ í‹¸ & í™˜ê²½ -----\r",
											"function originFrom(u){ const m=String(u||\"\").match(/^(https?:\\/\\/[^\\/]+)/i); return m?m[1]:u; }\r",
											"const baseUrl = String(pm.environment.get(\"baseUrl\") || pm.variables.get(\"baseUrl\") || \"\").replace(/\\/+$/,\"\");\r",
											"const origin  = pm.environment.get(\"ORIGIN\") || originFrom(baseUrl);\r",
											"const referer = pm.environment.get(\"REFERER_URL\") || (origin + \"/administration/connectivity\");\r",
											"const csrfHeaderName = pm.environment.get(\"CSRF_HEADER_NAME\");\r",
											"const csrfToken      = pm.environment.get(\"CSRF_TOKEN\");\r",
											"const headersArr = [\r",
											"  { key:\"Accept\", value:\"application/json\" },\r",
											"  { key:\"X-Requested-With\", value:\"XMLHttpRequest\" },\r",
											"  { key:\"Content-Type\", value:\"application/json\" },\r",
											"  token ? { key:\"Authorization\", value:\"Bearer \" + token } : null,\r",
											"  { key:\"Origin\",  value: origin },\r",
											"  { key:\"Referer\", value: referer }\r",
											"].filter(Boolean);\r",
											"if (csrfHeaderName && csrfToken) headersArr.push({ key: csrfHeaderName, value: csrfToken });\r",
											"\r",
											"// ê²½ë¡œ {id} ì¶”ì¶œ\r",
											"function getPathId(){\r",
											"  try {\r",
											"    const m = /\\/servers\\/([^\\/\\?#]+)(?:[\\/\\?#]|$)/i.exec(pm.request.url.toString());\r",
											"    if (m) return m[1];\r",
											"  } catch(e){}\r",
											"  return pm.variables.get(\"id\") || pm.environment.get(\"id\") ||\r",
											"         pm.collectionVariables.get(\"id\") || pm.globals.get(\"id\");\r",
											"}\r",
											"const targetId = String(getPathId() || \"\");\r",
											"\r",
											"// ê¸°ì¡´ ìš”ì²­ ë°”ë””(ìˆë‹¤ë©´) ì½ì–´ì„œ fallbackë¡œ ì‚¬ìš©\r",
											"let fallbackBody = {};\r",
											"try { fallbackBody = pm.request?.body?.raw ? JSON.parse(pm.request.body.raw) : {}; } catch(e){ fallbackBody = {}; }\r",
											"\r",
											"// ëª©ë¡ ì¡°íšŒí•´ì„œ í•´ë‹¹ idì˜ í˜„ì¬ ê°’ì„ ê°€ì ¸ì˜¨ë‹¤\r",
											"const listUrl = baseUrl + \"/app/api/dicom/servers\";\r",
											"pm.sendRequest({ url:listUrl, method:\"GET\", header: headersArr }, function(err, res){\r",
											"  let row = null;\r",
											"  if (!err && res && res.code === 200) {\r",
											"    let j=null; try { j = res.json(); } catch(e){}\r",
											"    const arrays = [];\r",
											"    if (j && j.result) {\r",
											"      if (Array.isArray(j.result.reportServers)) arrays.push(j.result.reportServers);\r",
											"      if (Array.isArray(j.result.servers))       arrays.push(j.result.servers);\r",
											"      if (Array.isArray(j.result.items))         arrays.push(j.result.items);\r",
											"      if (Array.isArray(j.result.content))       arrays.push(j.result.content);\r",
											"      if (Array.isArray(j.result.list))          arrays.push(j.result.list);\r",
											"    }\r",
											"    if (Array.isArray(j?.items)) arrays.push(j.items);\r",
											"    if (Array.isArray(j?.data))  arrays.push(j.data);\r",
											"    if (Array.isArray(j))        arrays.push(j);\r",
											"\r",
											"    // id ë§¤ì¹­\r",
											"    outer:\r",
											"    for (let a=0;a<arrays.length;a++){\r",
											"      const arr = arrays[a];\r",
											"      for (let i=0;i<arr.length;i++){\r",
											"        const r = arr[i] || {};\r",
											"        const rid = String(r.id != null ? r.id : r.serverId);\r",
											"        if (rid && targetId && rid === targetId) { row = r; break outer; }\r",
											"      }\r",
											"    }\r",
											"  }\r",
											"\r",
											"  // PUT ë°”ë”” êµ¬ì„±: rowê°€ ìˆìœ¼ë©´ ê·¸ëŒ€ë¡œ ë³µì‚¬, ì—†ìœ¼ë©´ fallbackBody/ë¬¸ì œì—ì„œ ì¤€ ê¸°ë³¸ê°’ ì‚¬ìš©\r",
											"  const current = row || {};\r",
											"  const body = {\r",
											"    hostName: (current.hostName != null ? current.hostName : (fallbackBody.hostName ?? \"lioluili\")),\r",
											"    servicePort: (current.servicePort != null ? current.servicePort : (fallbackBody.servicePort ?? 115)),\r",
											"    aeTitle: (current.aeTitle != null ? current.aeTitle : (fallbackBody.aeTitle ?? \"XM4VL6R2\")),\r",
											"    useTls: (current.useTls != null ? current.useTls : (fallbackBody.useTls ?? false)),\r",
											"    useMutual: (current.useMutual != null ? current.useMutual : (fallbackBody.useMutual ?? false)),\r",
											"    serverStatus: (current.status != null ? current.status : (fallbackBody.serverStatus ?? true)),\r",
											"    transferToPacs: {\r",
											"      // â˜… ì—¬ê¸°ì„œ reportë§Œ trueë¡œ ê°•ì œ ë³€ê²½\r",
											"      report: true,\r",
											"      // ë‚˜ë¨¸ì§€ëŠ” í˜„ ìƒíƒœ ìœ ì§€(ì—†ìœ¼ë©´ fallback â†’ ê¸°ë³¸ê°’ true)\r",
											"      analysisResultImage: (current.transferToPacs?.analysisResultImage ??\r",
											"                            fallbackBody.transferToPacs?.analysisResultImage ?? true)\r",
											"    },\r",
											"    id: Number(targetId || fallbackBody.id)\r",
											"  };\r",
											"\r",
											"  // ë¡œê·¸ & ì €ì¥(ì´ì „ report ê°’ ê¸°ì–µ)\r",
											"  const prevReport = (current.transferToPacs?.report ?? fallbackBody.transferToPacs?.report ?? null);\r",
											"  pm.environment.set(\"PREV_REPORT\", String(prevReport));\r",
											"  pm.environment.set(\"PUT_BODY_ID\", String(body.id || \"\"));\r",
											"  pm.environment.set(\"PUT_BODY_JSON\", JSON.stringify(body));\r",
											"\r",
											"  console.log(\"[PRE][GET list] id=\", targetId, \"found=\", !!row);\r",
											"  console.log(\"[PRE] prev.report=\", prevReport, \" -> send.report=true\");\r",
											"  console.log(\"[PUT SEND BODY] =\", body);\r",
											"\r",
											"  // ì‹¤ì œ ìš”ì²­ ë³¸ë¬¸ ì£¼ì…\r",
											"  pm.request.body.mode = \"raw\";\r",
											"  pm.request.body.update(JSON.stringify(body));\r",
											"});\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === Tests: HTTP/Biz 200 + report(true) ë°˜ì˜ í™•ì¸(ì‘ë‹µì´ ì—ì½”í•˜ë©´) + id ì¼ì¹˜ + (ì„ íƒ) ì´ì „â†’í˜„ì¬ ë¡œê·¸ ===\r",
											"(function(){\r",
											"  // 1) HTTP 200\r",
											"  pm.test(\"HTTP 200\", function(){ pm.response.to.have.status(200); });\r",
											"\r",
											"  // 2) (ìˆìœ¼ë©´) ë¹„ì¦ˆë‹ˆìŠ¤ ì½”ë“œ 200\r",
											"  let j=null; try { j = pm.response.json(); } catch(e){}\r",
											"  if (j && typeof j.code !== \"undefined\") {\r",
											"    pm.test(\"Business code == 200\", function(){ pm.expect(j.code).to.eql(200); });\r",
											"  }\r",
											"\r",
											"  // 3) ì‘ë‹µì—ì„œ transferToPacs.reportë¥¼ ì°¾ì•„ true í™•ì¸ (ì‘ë‹µì´ ê·¸ í•„ë“œë¥¼ ì•ˆ ì£¼ë©´ ìŠ¤í‚µ)\r",
											"  function getReportVal(obj){\r",
											"    if (!obj || typeof obj !== \"object\") return null;\r",
											"    if (obj.transferToPacs && typeof obj.transferToPacs.report !== \"undefined\") return obj.transferToPacs.report;\r",
											"    if (obj.result && obj.result.transferToPacs && typeof obj.result.transferToPacs.report !== \"undefined\") return obj.result.transferToPacs.report;\r",
											"    if (obj.data   && obj.data.transferToPacs   && typeof obj.data.transferToPacs.report   !== \"undefined\") return obj.data.transferToPacs.report;\r",
											"    return null;\r",
											"  }\r",
											"  function toBoolish(v){\r",
											"    if (v === true || v === false) return v;\r",
											"    if (typeof v === \"number\") return v !== 0;\r",
											"    const s = String(v).toLowerCase();\r",
											"    if (s === \"true\" || s === \"1\") return true;\r",
											"    if (s === \"false\" || s === \"0\") return false;\r",
											"    return null;\r",
											"  }\r",
											"\r",
											"  const rep = getReportVal(j);\r",
											"  if (rep !== null) {\r",
											"    pm.test(\"transferToPacs.report == true (echoed)\", function(){\r",
											"      pm.expect(toBoolish(rep)).to.eql(true);\r",
											"    });\r",
											"    console.log(\"[VERIFY] response.transferToPacs.report =\", rep);\r",
											"  } else {\r",
											"    console.log(\"[INFO] Response doesn't echo transferToPacs.report â€” skipping echo check\");\r",
											"  }\r",
											"\r",
											"  // 4) ê²½ë¡œ id == ë°”ë”” id\r",
											"  function getPathId(){\r",
											"    try {\r",
											"      const m = /\\/servers\\/([^\\/\\?#]+)(?:[\\/\\?#]|$)/i.exec(pm.request.url.toString());\r",
											"      return m ? m[1] : null;\r",
											"    } catch(e){ return null; }\r",
											"  }\r",
											"  const pathId = getPathId();\r",
											"  const bodyId = pm.environment.get(\"PUT_BODY_ID\") || null;\r",
											"  if (pathId && bodyId) {\r",
											"    pm.test(\"Path id == Body id\", function(){\r",
											"      pm.expect(String(bodyId)).to.eql(String(pathId));\r",
											"    });\r",
											"  }\r",
											"\r",
											"  // 5) ì •ë³´ ë¡œê·¸: ì´ì „â†’í˜„ì¬(report)\r",
											"  const prev = pm.environment.get(\"PREV_REPORT\");\r",
											"  console.log(\"[REPORT] prev =\", prev, \" -> sent = true\");\r",
											"})();\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "PUT",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "formdata",
									"formdata": []
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/dicom/servers/{{id}}",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"dicom",
										"servers",
										"{{id}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "Result Archiving Server_setting analysis true -> false",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === PUT /app/api/dicom/servers/{{id}} : í˜„ì¬ ê°’ ìœ ì§€ + transferToPacs.analysisResultImageë§Œ falseë¡œ ë³€ê²½ ===\r",
											"pm.request.method = \"PUT\";\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"\r",
											"// í† í°(ìˆìœ¼ë©´)\r",
											"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
											"\r",
											"// ----- ìœ í‹¸ & í™˜ê²½ -----\r",
											"function originFrom(u){ const m=String(u||\"\").match(/^(https?:\\/\\/[^\\/]+)/i); return m?m[1]:u; }\r",
											"const baseUrl = String(pm.environment.get(\"baseUrl\") || pm.variables.get(\"baseUrl\") || \"\").replace(/\\/+$/,\"\");\r",
											"const origin  = pm.environment.get(\"ORIGIN\") || originFrom(baseUrl);\r",
											"const referer = pm.environment.get(\"REFERER_URL\") || (origin + \"/administration/connectivity\");\r",
											"const csrfHeaderName = pm.environment.get(\"CSRF_HEADER_NAME\");\r",
											"const csrfToken      = pm.environment.get(\"CSRF_TOKEN\");\r",
											"\r",
											"const headersArr = [\r",
											"  { key:\"Accept\", value:\"application/json\" },\r",
											"  { key:\"X-Requested-With\", value:\"XMLHttpRequest\" },\r",
											"  { key:\"Content-Type\", value:\"application/json\" },\r",
											"  token ? { key:\"Authorization\", value:`Bearer ${token}` } : null,\r",
											"  { key:\"Origin\", value: origin },\r",
											"  { key:\"Referer\", value: referer }\r",
											"].filter(Boolean);\r",
											"if (csrfHeaderName && csrfToken) headersArr.push({ key: csrfHeaderName, value: csrfToken });\r",
											"\r",
											"// ê²½ë¡œ {id}\r",
											"function getPathId(){\r",
											"  try {\r",
											"    const m = /\\/servers\\/([^\\/\\?#]+)(?:[\\/\\?#]|$)/i.exec(pm.request.url.toString());\r",
											"    if (m) return m[1];\r",
											"  } catch(e){}\r",
											"  return pm.variables.get(\"id\") || pm.environment.get(\"id\") ||\r",
											"         pm.collectionVariables.get(\"id\") || pm.globals.get(\"id\");\r",
											"}\r",
											"const targetId = String(getPathId() || \"\");\r",
											"\r",
											"// ê¸°ì¡´ ìš”ì²­ ë°”ë””ë¥¼ fallbackìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥\r",
											"let fallbackBody = {};\r",
											"try { fallbackBody = pm.request?.body?.raw ? JSON.parse(pm.request.body.raw) : {}; } catch(e){}\r",
											"\r",
											"// ëª©ë¡ì—ì„œ í˜„ì¬ ê°’ ì¡°íšŒ\r",
											"const listUrl = baseUrl + \"/app/api/dicom/servers\";\r",
											"pm.sendRequest({ url:listUrl, method:\"GET\", header: headersArr }, function(err, res){\r",
											"  let row = null;\r",
											"  if (!err && res && res.code === 200) {\r",
											"    let j=null; try { j = res.json(); } catch(e){}\r",
											"    const arrays = [];\r",
											"    if (j && j.result) {\r",
											"      if (Array.isArray(j.result.reportServers)) arrays.push(j.result.reportServers);\r",
											"      if (Array.isArray(j.result.servers))       arrays.push(j.result.servers);\r",
											"      if (Array.isArray(j.result.items))         arrays.push(j.result.items);\r",
											"      if (Array.isArray(j.result.content))       arrays.push(j.result.content);\r",
											"      if (Array.isArray(j.result.list))          arrays.push(j.result.list);\r",
											"    }\r",
											"    if (Array.isArray(j?.items)) arrays.push(j.items);\r",
											"    if (Array.isArray(j?.data))  arrays.push(j.data);\r",
											"    if (Array.isArray(j))        arrays.push(j);\r",
											"\r",
											"    // id ë§¤ì¹­\r",
											"    outer:\r",
											"    for (let a=0;a<arrays.length;a++){\r",
											"      const arr = arrays[a] || [];\r",
											"      for (let i=0;i<arr.length;i++){\r",
											"        const r = arr[i] || {};\r",
											"        const rid = String(r.id != null ? r.id : r.serverId);\r",
											"        if (rid && targetId && rid === targetId) { row = r; break outer; }\r",
											"      }\r",
											"    }\r",
											"  }\r",
											"\r",
											"  // PUT ë°”ë””: í˜„ ìƒíƒœ ë³µì‚¬ + analysisResultImageë§Œ falseë¡œ ë³€ê²½\r",
											"  const current = row || {};\r",
											"  const prevARI = current.transferToPacs?.analysisResultImage ?? fallbackBody.transferToPacs?.analysisResultImage ?? null;\r",
											"\r",
											"  const body = {\r",
											"    hostName:  (current.hostName  != null ? current.hostName  : (fallbackBody.hostName  ?? \"lioluili\")),\r",
											"    servicePort: (current.servicePort != null ? current.servicePort : (fallbackBody.servicePort ?? 115)),\r",
											"    aeTitle:   (current.aeTitle   != null ? current.aeTitle   : (fallbackBody.aeTitle   ?? \"XM4VL6R2\")),\r",
											"    useTls:    (current.useTls    != null ? current.useTls    : (fallbackBody.useTls    ?? false)),\r",
											"    useMutual: (current.useMutual != null ? current.useMutual : (fallbackBody.useMutual ?? false)),\r",
											"    // ì¼ë¶€ APIëŠ” status ëŒ€ì‹  serverStatus í‚¤ë¥¼ ì”€\r",
											"    serverStatus: (current.status != null ? current.status : (fallbackBody.serverStatus ?? true)),\r",
											"    transferToPacs: {\r",
											"      // reportëŠ” í˜„ ìƒíƒœ ìœ ì§€\r",
											"      report: (current.transferToPacs?.report ??\r",
											"               fallbackBody.transferToPacs?.report ?? true),\r",
											"      // â˜… analysisResultImageëŠ” falseë¡œ ê°•ì œ (true â†’ false ë³€ê²½)\r",
											"      analysisResultImage: false\r",
											"    },\r",
											"    id: Number(targetId || fallbackBody.id)\r",
											"  };\r",
											"\r",
											"  // ë¡œê·¸ & ì €ì¥\r",
											"  pm.environment.set(\"PREV_ARI\", String(prevARI));\r",
											"  pm.environment.set(\"PUT_BODY_ID\", String(body.id || \"\"));\r",
											"  pm.environment.set(\"PUT_BODY_JSON\", JSON.stringify(body));\r",
											"\r",
											"  console.log(\"[PRE][GET list] id=\", targetId, \"found=\", !!row);\r",
											"  console.log(\"[PRE] prev.analysisResultImage=\", prevARI, \" -> send.analysisResultImage=false\");\r",
											"  console.log(\"[PUT SEND BODY] =\", body);\r",
											"\r",
											"  // ì‹¤ì œ ìš”ì²­ ë³¸ë¬¸ ì£¼ì…\r",
											"  pm.request.body.mode = \"raw\";\r",
											"  pm.request.body.update(JSON.stringify(body));\r",
											"});\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === Tests: HTTP/Biz 200 + analysisResultImage(false) ë°˜ì˜ í™•ì¸(ì—ì½” ì‹œ) + id ì¼ì¹˜ + ì´ì „â†’í˜„ì¬ ë¡œê·¸ ===\r",
											"(function(){\r",
											"  // 1) HTTP 200\r",
											"  pm.test(\"HTTP 200\", function(){ pm.response.to.have.status(200); });\r",
											"\r",
											"  // 2) (ìˆìœ¼ë©´) ë¹„ì¦ˆë‹ˆìŠ¤ ì½”ë“œ 200\r",
											"  let j=null; try { j = pm.response.json(); } catch(e){}\r",
											"  if (j && typeof j.code !== \"undefined\") {\r",
											"    pm.test(\"Business code == 200\", function(){ pm.expect(j.code).to.eql(200); });\r",
											"  }\r",
											"\r",
											"  // 3) ì‘ë‹µì—ì„œ transferToPacs.analysisResultImageë¥¼ ì°¾ì•„ false í™•ì¸ (ì‘ë‹µì´ ê·¸ í•„ë“œë¥¼ ì•ˆ ì£¼ë©´ ìŠ¤í‚µ)\r",
											"  function getAriVal(obj){\r",
											"    if (!obj || typeof obj !== \"object\") return null;\r",
											"    if (obj.transferToPacs && typeof obj.transferToPacs.analysisResultImage !== \"undefined\")\r",
											"      return obj.transferToPacs.analysisResultImage;\r",
											"    if (obj.result && obj.result.transferToPacs && typeof obj.result.transferToPacs.analysisResultImage !== \"undefined\")\r",
											"      return obj.result.transferToPacs.analysisResultImage;\r",
											"    if (obj.data   && obj.data.transferToPacs   && typeof obj.data.transferToPacs.analysisResultImage   !== \"undefined\")\r",
											"      return obj.data.transferToPacs.analysisResultImage;\r",
											"    return null;\r",
											"  }\r",
											"  function toBoolish(v){\r",
											"    if (v === true || v === false) return v;\r",
											"    if (typeof v === \"number\") return v !== 0;\r",
											"    const s = String(v).toLowerCase();\r",
											"    if (s === \"true\" || s === \"1\") return true;\r",
											"    if (s === \"false\" || s === \"0\") return false;\r",
											"    return null;\r",
											"  }\r",
											"\r",
											"  const ari = getAriVal(j);\r",
											"  if (ari !== null) {\r",
											"    pm.test(\"transferToPacs.analysisResultImage == false (echoed)\", function(){\r",
											"      pm.expect(toBoolish(ari)).to.eql(false);\r",
											"    });\r",
											"    console.log(\"[VERIFY] response.transferToPacs.analysisResultImage =\", ari);\r",
											"  } else {\r",
											"    console.log(\"[INFO] Response doesn't echo transferToPacs.analysisResultImage â€” skipping echo check\");\r",
											"  }\r",
											"\r",
											"  // 4) ê²½ë¡œ id == ë°”ë”” id\r",
											"  function getPathId(){\r",
											"    try {\r",
											"      const m = /\\/servers\\/([^\\/\\?#]+)(?:[\\/\\?#]|$)/i.exec(pm.request.url.toString());\r",
											"      return m ? m[1] : null;\r",
											"    } catch(e){ return null; }\r",
											"  }\r",
											"  const pathId = getPathId();\r",
											"  const bodyId = pm.environment.get(\"PUT_BODY_ID\") || null;\r",
											"  if (pathId && bodyId) {\r",
											"    pm.test(\"Path id == Body id\", function(){\r",
											"      pm.expect(String(bodyId)).to.eql(String(pathId));\r",
											"    });\r",
											"  }\r",
											"\r",
											"  // 5) ì •ë³´ ë¡œê·¸: ì´ì „ â†’ í˜„ì¬(ë³´ëƒ„) ìƒíƒœ\r",
											"  const prev = pm.environment.get(\"PREV_ARI\");\r",
											"  console.log(\"[ARI] prev =\", prev, \" -> sent = false\");\r",
											"})();\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "PUT",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "formdata",
									"formdata": []
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/dicom/servers/{{id}}",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"dicom",
										"servers",
										"{{id}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "Result Archiving Server_setting status",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === PUT /app/api/dicom/servers/{{id}} : í˜„ì¬ ê°’ ìœ ì§€ + serverStatusë§Œ falseë¡œ ë³€ê²½ ===\r",
											"pm.request.method = \"PUT\";\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"\r",
											"// í† í°(ìˆìœ¼ë©´)\r",
											"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
											"\r",
											"// ----- ìœ í‹¸ & í™˜ê²½ -----\r",
											"function originFrom(u){ const m=String(u||\"\").match(/^(https?:\\/\\/[^\\/]+)/i); return m?m[1]:u; }\r",
											"const baseUrl = String(pm.environment.get(\"baseUrl\") || pm.variables.get(\"baseUrl\") || \"\").replace(/\\/+$/,\"\");\r",
											"const origin  = pm.environment.get(\"ORIGIN\") || originFrom(baseUrl);\r",
											"const referer = pm.environment.get(\"REFERER_URL\") || (origin + \"/administration/connectivity\");\r",
											"const csrfHeaderName = pm.environment.get(\"CSRF_HEADER_NAME\");\r",
											"const csrfToken      = pm.environment.get(\"CSRF_TOKEN\");\r",
											"\r",
											"const headersArr = [\r",
											"  { key:\"Accept\", value:\"application/json\" },\r",
											"  { key:\"X-Requested-With\", value:\"XMLHttpRequest\" },\r",
											"  { key:\"Content-Type\", value:\"application/json\" },\r",
											"  token ? { key:\"Authorization\", value:`Bearer ${token}` } : null,\r",
											"  { key:\"Origin\", value: origin },\r",
											"  { key:\"Referer\", value: referer }\r",
											"].filter(Boolean);\r",
											"if (csrfHeaderName && csrfToken) headersArr.push({ key: csrfHeaderName, value: csrfToken });\r",
											"\r",
											"// ê²½ë¡œ {id}\r",
											"function getPathId(){\r",
											"  try {\r",
											"    const m = /\\/servers\\/([^\\/\\?#]+)(?:[\\/\\?#]|$)/i.exec(pm.request.url.toString());\r",
											"    if (m) return m[1];\r",
											"  } catch(e){}\r",
											"  return pm.variables.get(\"id\") || pm.environment.get(\"id\") ||\r",
											"         pm.collectionVariables.get(\"id\") || pm.globals.get(\"id\");\r",
											"}\r",
											"const targetId = String(getPathId() || \"\");\r",
											"\r",
											"// ê¸°ì¡´ ìš”ì²­ ë°”ë””ë¥¼ fallbackìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥\r",
											"let fallbackBody = {};\r",
											"try { fallbackBody = pm.request?.body?.raw ? JSON.parse(pm.request.body.raw) : {}; } catch(e){}\r",
											"\r",
											"// ëª©ë¡ì—ì„œ í˜„ì¬ ê°’ ì¡°íšŒ\r",
											"const listUrl = baseUrl + \"/app/api/dicom/servers\";\r",
											"pm.sendRequest({ url:listUrl, method:\"GET\", header: headersArr }, function(err, res){\r",
											"  let row = null;\r",
											"  if (!err && res && res.code === 200) {\r",
											"    let j=null; try { j = res.json(); } catch(e){}\r",
											"    const arrays = [];\r",
											"    if (j && j.result) {\r",
											"      if (Array.isArray(j.result.reportServers)) arrays.push(j.result.reportServers);\r",
											"      if (Array.isArray(j.result.servers))       arrays.push(j.result.servers);\r",
											"      if (Array.isArray(j.result.items))         arrays.push(j.result.items);\r",
											"      if (Array.isArray(j.result.content))       arrays.push(j.result.content);\r",
											"      if (Array.isArray(j.result.list))          arrays.push(j.result.list);\r",
											"    }\r",
											"    if (Array.isArray(j?.items)) arrays.push(j.items);\r",
											"    if (Array.isArray(j?.data))  arrays.push(j.data);\r",
											"    if (Array.isArray(j))        arrays.push(j);\r",
											"\r",
											"    // id ë§¤ì¹­\r",
											"    outer:\r",
											"    for (let a=0;a<arrays.length;a++){\r",
											"      const arr = arrays[a] || [];\r",
											"      for (let i=0;i<arr.length;i++){\r",
											"        const r = arr[i] || {};\r",
											"        const rid = String(r.id != null ? r.id : r.serverId);\r",
											"        if (rid && targetId && rid === targetId) { row = r; break outer; }\r",
											"      }\r",
											"    }\r",
											"  }\r",
											"\r",
											"  // PUT ë°”ë””: í˜„ ìƒíƒœ ë³µì‚¬ + serverStatusë§Œ falseë¡œ ë³€ê²½\r",
											"  const current = row || {};\r",
											"  const prevStatus = (current.status != null ? current.status\r",
											"                    : (typeof fallbackBody.serverStatus !== \"undefined\" ? fallbackBody.serverStatus : null));\r",
											"\r",
											"  const body = {\r",
											"    hostName:  (current.hostName  != null ? current.hostName  : (fallbackBody.hostName  ?? \"lioluili\")),\r",
											"    servicePort: (current.servicePort != null ? current.servicePort : (fallbackBody.servicePort ?? 115)),\r",
											"    aeTitle:   (current.aeTitle   != null ? current.aeTitle   : (fallbackBody.aeTitle   ?? \"XM4VL6R2\")),\r",
											"    useTls:    (current.useTls    != null ? current.useTls    : (fallbackBody.useTls    ?? false)),\r",
											"    useMutual: (current.useMutual != null ? current.useMutual : (fallbackBody.useMutual ?? false)),\r",
											"    // â˜… serverStatusëŠ” falseë¡œ ê°•ì œ (í˜„ì¬ê°’ trueâ†’false ì „í™˜ ëª©ì )\r",
											"    serverStatus: false,\r",
											"    transferToPacs: {\r",
											"      // ë‚˜ë¨¸ì§€ëŠ” í˜„ ìƒíƒœ ìœ ì§€(ì—†ìœ¼ë©´ fallback â†’ ê¸°ë³¸ê°’)\r",
											"      report: (current.transferToPacs?.report ??\r",
											"               fallbackBody.transferToPacs?.report ?? true),\r",
											"      analysisResultImage: (current.transferToPacs?.analysisResultImage ??\r",
											"                            fallbackBody.transferToPacs?.analysisResultImage ?? false)\r",
											"    },\r",
											"    id: Number(targetId || fallbackBody.id)\r",
											"  };\r",
											"\r",
											"  // ë¡œê·¸ & ì €ì¥\r",
											"  pm.environment.set(\"PREV_SERVER_STATUS\", String(prevStatus));\r",
											"  pm.environment.set(\"PUT_BODY_ID\", String(body.id || \"\"));\r",
											"  pm.environment.set(\"PUT_BODY_JSON\", JSON.stringify(body));\r",
											"\r",
											"  console.log(\"[PRE][GET list] id=\", targetId, \"found=\", !!row);\r",
											"  console.log(\"[PRE] prev.serverStatus/status=\", prevStatus, \" -> send.serverStatus=false\");\r",
											"  console.log(\"[PUT SEND BODY] =\", body);\r",
											"\r",
											"  // ì‹¤ì œ ìš”ì²­ ë³¸ë¬¸ ì£¼ì…\r",
											"  pm.request.body.mode = \"raw\";\r",
											"  pm.request.body.update(JSON.stringify(body));\r",
											"});\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === Tests: HTTP/Biz 200 + serverStatus(false) ë°˜ì˜ í™•ì¸(ì—ì½” ì‹œ) + id ì¼ì¹˜ + ì´ì „â†’í˜„ì¬ ë¡œê·¸ ===\r",
											"(function(){\r",
											"  // 1) HTTP 200\r",
											"  pm.test(\"HTTP 200\", function(){ pm.response.to.have.status(200); });\r",
											"\r",
											"  // 2) (ìˆìœ¼ë©´) ë¹„ì¦ˆë‹ˆìŠ¤ ì½”ë“œ 200\r",
											"  let j=null; try { j = pm.response.json(); } catch(e){}\r",
											"  if (j && typeof j.code !== \"undefined\") {\r",
											"    pm.test(\"Business code == 200\", function(){ pm.expect(j.code).to.eql(200); });\r",
											"  }\r",
											"\r",
											"  // 3) ì‘ë‹µì—ì„œ serverStatus/statusë¥¼ ì°¾ì•„ false í™•ì¸ (ì‘ë‹µì´ ê·¸ í•„ë“œë¥¼ ì•ˆ ì£¼ë©´ ìŠ¤í‚µ)\r",
											"  function getStatusVal(obj){\r",
											"    if (!obj || typeof obj !== \"object\") return null;\r",
											"    if (typeof obj.serverStatus !== \"undefined\") return obj.serverStatus;\r",
											"    if (typeof obj.status       !== \"undefined\") return obj.status;\r",
											"    if (obj.result && (typeof obj.result.serverStatus !== \"undefined\" || typeof obj.result.status !== \"undefined\"))\r",
											"      return (typeof obj.result.serverStatus !== \"undefined\") ? obj.result.serverStatus : obj.result.status;\r",
											"    if (obj.data && (typeof obj.data.serverStatus !== \"undefined\" || typeof obj.data.status !== \"undefined\"))\r",
											"      return (typeof obj.data.serverStatus !== \"undefined\") ? obj.data.serverStatus : obj.data.status;\r",
											"    return null;\r",
											"  }\r",
											"  function toBoolish(v){\r",
											"    if (v === true || v === false) return v;\r",
											"    if (typeof v === \"number\") return v !== 0;\r",
											"    const s = String(v).toLowerCase();\r",
											"    if (s === \"true\" || s === \"1\") return true;\r",
											"    if (s === \"false\" || s === \"0\") return false;\r",
											"    return null;\r",
											"  }\r",
											"\r",
											"  const sv = getStatusVal(j);\r",
											"  if (sv !== null) {\r",
											"    pm.test(\"serverStatus == false (echoed)\", function(){\r",
											"      pm.expect(toBoolish(sv)).to.eql(false);\r",
											"    });\r",
											"    console.log(\"[VERIFY] response.serverStatus/status =\", sv);\r",
											"  } else {\r",
											"    console.log(\"[INFO] Response doesn't echo serverStatus/status â€” skipping echo check\");\r",
											"  }\r",
											"\r",
											"  // 4) ê²½ë¡œ id == ë°”ë”” id\r",
											"  function getPathId(){\r",
											"    try {\r",
											"      const m = /\\/servers\\/([^\\/\\?#]+)(?:[\\/\\?#]|$)/i.exec(pm.request.url.toString());\r",
											"      return m ? m[1] : null;\r",
											"    } catch(e){ return null; }\r",
											"  }\r",
											"  const pathId = getPathId();\r",
											"  const bodyId = pm.environment.get(\"PUT_BODY_ID\") || null;\r",
											"  if (pathId && bodyId) {\r",
											"    pm.test(\"Path id == Body id\", function(){\r",
											"      pm.expect(String(bodyId)).to.eql(String(pathId));\r",
											"    });\r",
											"  }\r",
											"\r",
											"  // 5) ì •ë³´ ë¡œê·¸: ì´ì „ â†’ í˜„ì¬(ë³´ëƒ„) ìƒíƒœ\r",
											"  const prev = pm.environment.get(\"PREV_SERVER_STATUS\");\r",
											"  console.log(\"[SERVER_STATUS] prev =\", prev, \" -> sent = false\");\r",
											"})();\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "PUT",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "formdata",
									"formdata": []
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/dicom/servers/{{id}}",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"dicom",
										"servers",
										"{{id}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "Result Archiving Server_setting ping failed",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === POST /app/api/dicom/servers/echo : env {{id}} ì£¼ì…í•´ì„œ ë³¸ë¬¸ êµ¬ì„± ===\r",
											"pm.request.method = \"POST\";\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"\r",
											"// í† í°(ìˆìœ¼ë©´)\r",
											"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
											"\r",
											"// id ê°€ì ¸ì˜¤ê¸° (env > collection > globals > request var)\r",
											"function getIdVar() {\r",
											"  return pm.environment.get(\"id\")\r",
											"      || pm.collectionVariables.get(\"id\")\r",
											"      || pm.globals.get(\"id\")\r",
											"      || pm.variables.get(\"id\")\r",
											"      || \"\";\r",
											"}\r",
											"const idStr = String(getIdVar() || \"\").trim();\r",
											"pm.environment.set(\"ECHO_ID_SENT\", idStr);   // Testsì—ì„œ í™•ì¸ìš©\r",
											"\r",
											"// ê¸°ì¡´ RAW ë°”ë””ê°€ ìˆìœ¼ë©´ ì½ê³ , ì—†ìœ¼ë©´ ê¸°ë³¸ í…œí”Œë¦¿ ì‚¬ìš©\r",
											"let body = {\r",
											"  hostName: \"lioluili\",\r",
											"  servicePort: 115,\r",
											"  aeTitle: \"J77H3FN3GK7XJ\",\r",
											"  useTls: false,\r",
											"  keystore: {\r",
											"    keystoreType: \"PKCS12\",\r",
											"    keystoreName: \"\",\r",
											"    keystorePassword: \"\",\r",
											"    keyPassword: \"\",\r",
											"    keystoreUploadKey: \"\"\r",
											"  },\r",
											"  truststore: {\r",
											"    keystoreType: \"PKCS12\",\r",
											"    keystoreName: \"\",\r",
											"    keystorePassword: \"\",\r",
											"    keystoreUploadKey: \"\"\r",
											"  },\r",
											"  useMutual: false,\r",
											"  serverStatus: true,\r",
											"  transferToPacs: { report: true, analysisResultImage: false },\r",
											"  id: idStr ? Number(idStr) : undefined\r",
											"};\r",
											"\r",
											"try {\r",
											"  const raw = pm.request?.body?.raw;\r",
											"  if (raw) {\r",
											"    const parsed = JSON.parse(raw);\r",
											"    // ê¸°ì¡´ ê°’ ìœ ì§€í•˜ë©´ì„œ idë§Œ êµì²´\r",
											"    body = Object.assign({}, parsed, { id: idStr ? Number(idStr) : parsed.id });\r",
											"  }\r",
											"} catch (e) {\r",
											"  // íŒŒì‹± ì‹¤íŒ¨ì‹œ ìœ„ í…œí”Œë¦¿ ì‚¬ìš©\r",
											"}\r",
											"\r",
											"// (ì˜µì…˜) BASE_BODY_JSON í™˜ê²½ë³€ìˆ˜ë¡œ ì¶”ê°€/ë®ì–´ì“°ê¸° ê°€ëŠ¥\r",
											"try {\r",
											"  const extra = pm.environment.get(\"BASE_BODY_JSON\");\r",
											"  if (extra) Object.assign(body, JSON.parse(extra));\r",
											"} catch (e) {}\r",
											"\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(body));\r",
											"\r",
											"// ë¡œê·¸\r",
											"console.log(\"[ECHO SEND] url=\", pm.request.url.toString(), \"payload=\", body);\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === Tests: ê¸°ëŒ€ê°’ â†’ HTTP 200 / biz 200 / result === false (ì‹¤íŒ¨ ì—ì½”) ===\r",
											"(function () {\r",
											"  // 0) idê°€ ë“¤ì–´ê°”ëŠ”ì§€ ì²´í¬\r",
											"  const idSent = pm.environment.get(\"ECHO_ID_SENT\") || \"\";\r",
											"  pm.test(\"env id is provided\", function () {\r",
											"    pm.expect(idSent, \"í™˜ê²½ë³€ìˆ˜ idê°€ ë¹„ì–´ìˆìŒ\").to.not.be.empty;\r",
											"  });\r",
											"\r",
											"  // 1) HTTP 200\r",
											"  pm.test(\"HTTP 200\", function(){ pm.response.to.have.status(200); });\r",
											"\r",
											"  // 2) JSON íŒŒì‹±\r",
											"  let j=null; try { j = pm.response.json(); } catch(e){}\r",
											"  pm.test(\"Body is JSON\", function(){ pm.expect(j).to.be.an(\"object\"); });\r",
											"\r",
											"  // 3) ë¹„ì¦ˆë‹ˆìŠ¤ ì½”ë“œ 200\r",
											"  if (j && typeof j.code !== \"undefined\") {\r",
											"    pm.test(\"Business code == 200\", function(){ pm.expect(j.code).to.eql(200); });\r",
											"  } else {\r",
											"    pm.test(\"Body has 'code' field\", function(){ pm.expect(false, \"ì‘ë‹µì— code í•„ë“œê°€ ì—†ìŒ\").to.eql(true); });\r",
											"  }\r",
											"\r",
											"  // 4) ì‹¤íŒ¨ ì—ì½” ê¸°ëŒ€: result === false\r",
											"  pm.test(\"Echo result === false (expected fail case)\", function(){\r",
											"    pm.expect(j && Object.prototype.hasOwnProperty.call(j, \"result\")).to.eql(true);\r",
											"    pm.expect(j.result).to.eql(false);\r",
											"  });\r",
											"\r",
											"  // ë””ë²„ê·¸ ë¡œê·¸\r",
											"  console.log(\"[ECHO RESP]\", j);\r",
											"})();\r",
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "formdata",
									"formdata": []
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/dicom/servers/echo",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"dicom",
										"servers",
										"echo"
									]
								}
							},
							"response": []
						},
						{
							"name": "Result Archiving Server_ëª©ë¡ ì‚­ì œ",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"  const TAG = '[AGG]';\r",
											"\r",
											"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"  if (!pm.collectionVariables.get('__agg_init')) {\r",
											"    pm.collectionVariables.set('__agg_init', '1');\r",
											"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"    pm.collectionVariables.set('__log', '[]');\r",
											"    pm.collectionVariables.set('__req_total', 0);\r",
											"    pm.collectionVariables.set('__req_pass', 0);\r",
											"    pm.collectionVariables.set('__req_fail', 0);\r",
											"    console.log(TAG, 'init (fallback)');\r",
											"  }\r",
											"\r",
											"  try {\r",
											"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"    if (isSummary) return;\r",
											"\r",
											"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"    const before = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'before counters =', before);\r",
											"\r",
											"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"    const row = {\r",
											"      name: pm.info.requestName,\r",
											"      method: pm.request.method,\r",
											"      url: pm.request.url.toString(),\r",
											"      status: pm.response.code,\r",
											"      time_ms: pm.response.responseTime,\r",
											"      ok\r",
											"    };\r",
											"\r",
											"    // ë¡œê·¸ ì ì¬\r",
											"    let rows = [];\r",
											"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"    rows.push(row);\r",
											"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
											"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
											"\r",
											"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"    const after = {\r",
											"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
											"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
											"    };\r",
											"    console.log(TAG, 'after counters =', after);\r",
											"  } catch (err) {\r",
											"    console.error('[AGG ERROR]', err);\r",
											"    pm.test('Aggregation script error').fail(String(err));\r",
											"  }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "DELETE",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "formdata",
									"formdata": []
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/dicom/servers/{{id}}",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"dicom",
										"servers",
										"{{id}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "Result Archiving Server_setting ping success",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// === POST /app/api/dicom/servers/echo : env {{id}} ì£¼ì… + ê³ ì • ë°”ë”” ì „ì†¡ ===\r",
											"pm.request.method = \"POST\";\r",
											"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
											"\r",
											"// í† í°(ìˆìœ¼ë©´)\r",
											"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
											"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
											"\r",
											"// env/collection/globalsì—ì„œ id ê°€ì ¸ì˜¤ê¸°\r",
											"function getIdVar() {\r",
											"  return pm.environment.get(\"id\")\r",
											"      || pm.collectionVariables.get(\"id\")\r",
											"      || pm.globals.get(\"id\")\r",
											"      || pm.variables.get(\"id\")\r",
											"      || \"\";\r",
											"}\r",
											"const idStr = String(getIdVar() || \"\").trim();\r",
											"pm.environment.set(\"ECHO_ID_SENT\", idStr); // Testsì—ì„œ í™•ì¸ìš©\r",
											"\r",
											"// ì •í™•í•œ ìš”ì²­ ë°”ë””\r",
											"let body = {\r",
											"  hostName: \"localhost\",\r",
											"  servicePort: 4242,\r",
											"  aeTitle: \"ORTHANC\",\r",
											"  useTls: false,\r",
											"  keystore: {\r",
											"    keystoreType: \"PKCS12\",\r",
											"    keystoreName: \"\",\r",
											"    keystorePassword: \"\",\r",
											"    keyPassword: \"\",\r",
											"    keystoreUploadKey: \"\"\r",
											"  },\r",
											"  truststore: {\r",
											"    keystoreType: \"PKCS12\",\r",
											"    keystoreName: \"\",\r",
											"    keystorePassword: \"\",\r",
											"    keystoreUploadKey: \"\"\r",
											"  },\r",
											"  useMutual: false,\r",
											"  serverStatus: true,\r",
											"  transferToPacs: {\r",
											"    report: true,\r",
											"    analysisResultImage: true\r",
											"  },\r",
											"  id: idStr ? Number(idStr) : undefined\r",
											"};\r",
											"\r",
											"// (ì˜µì…˜) BASE_BODY_JSONìœ¼ë¡œ ì¼ë¶€ ë®ì–´ì“°ê¸° ê°€ëŠ¥\r",
											"try {\r",
											"  const extra = pm.environment.get(\"BASE_BODY_JSON\");\r",
											"  if (extra) body = Object.assign(body, JSON.parse(extra));\r",
											"} catch(e){}\r",
											"\r",
											"pm.request.body.mode = \"raw\";\r",
											"pm.request.body.update(JSON.stringify(body));\r",
											"\r",
											"console.log(\"[ECHO SEND]\", pm.request.url.toString(), \"payload=\", body);\r",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"// === Tests: HTTP 200 / biz 200 / result === true (ì„±ê³µ ì—ì½”) ===\r",
											"(function () {\r",
											"    // 0) id ì£¼ì… í™•ì¸\r",
											"    const idSent = pm.environment.get(\"ECHO_ID_SENT\") || \"\";\r",
											"    pm.test(\"env id is provided\", function () {\r",
											"        pm.expect(idSent, \"í™˜ê²½ë³€ìˆ˜ idê°€ ë¹„ì–´ìˆìŒ\").to.not.be.empty;\r",
											"    });\r",
											"\r",
											"    // 1) HTTP 200\r",
											"    pm.test(\"HTTP 200\", function () { pm.response.to.have.status(200); });\r",
											"\r",
											"    // 2) JSON íŒŒì‹±\r",
											"    let j = null; try { j = pm.response.json(); } catch (e) { }\r",
											"    pm.test(\"Body is JSON\", function () { pm.expect(j).to.be.an(\"object\"); });\r",
											"\r",
											"    // 3) ë¹„ì¦ˆë‹ˆìŠ¤ ì½”ë“œ 200\r",
											"    pm.test(\"Business code == 200\", function () {\r",
											"        pm.expect(j && typeof j.code !== \"undefined\", \"ì‘ë‹µì— code í•„ë“œ ì—†ìŒ\").to.eql(true);\r",
											"        pm.expect(j.code).to.eql(200);\r",
											"    });\r",
											"\r",
											"    // 4) ì„±ê³µ ì—ì½” ê¸°ëŒ€: result === true\r",
											"    pm.test(\"Echo result === true\", function () {\r",
											"        pm.expect(j && Object.prototype.hasOwnProperty.call(j, \"result\")).to.eql(true);\r",
											"        pm.expect(j.result).to.eql(true);\r",
											"    });\r",
											"\r",
											"    console.log(\"[ECHO RESP]\", j);\r",
											"})();\r",
											"\r",
											"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
											"(function () {\r",
											"    const TAG = '[AGG]';\r",
											"\r",
											"    // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
											"    if (!pm.collectionVariables.get('__agg_init')) {\r",
											"        pm.collectionVariables.set('__agg_init', '1');\r",
											"        pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
											"        pm.collectionVariables.set('__log', '[]');\r",
											"        pm.collectionVariables.set('__req_total', 0);\r",
											"        pm.collectionVariables.set('__req_pass', 0);\r",
											"        pm.collectionVariables.set('__req_fail', 0);\r",
											"        console.log(TAG, 'init (fallback)');\r",
											"    }\r",
											"\r",
											"    try {\r",
											"        // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
											"        const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
											"        console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
											"        if (isSummary) return;\r",
											"\r",
											"        // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
											"        const before = {\r",
											"            total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"            pass: Number(pm.collectionVariables.get('__req_pass') || 0),\r",
											"            fail: Number(pm.collectionVariables.get('__req_fail') || 0),\r",
											"        };\r",
											"        console.log(TAG, 'before counters =', before);\r",
											"\r",
											"        // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
											"        const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
											"\r",
											"        const row = {\r",
											"            name: pm.info.requestName,\r",
											"            method: pm.request.method,\r",
											"            url: pm.request.url.toString(),\r",
											"            status: pm.response.code,\r",
											"            time_ms: pm.response.responseTime,\r",
											"            ok\r",
											"        };\r",
											"\r",
											"        // ë¡œê·¸ ì ì¬\r",
											"        let rows = [];\r",
											"        try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
											"        catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
											"        rows.push(row);\r",
											"        pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
											"\r",
											"        // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
											"        pm.collectionVariables.set('__req_total', before.total + 1);\r",
											"        pm.collectionVariables.set('__req_pass', before.pass + (ok ? 1 : 0));\r",
											"        pm.collectionVariables.set('__req_fail', before.fail + (ok ? 0 : 1));\r",
											"\r",
											"        // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
											"        const after = {\r",
											"            total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
											"            pass: Number(pm.collectionVariables.get('__req_pass') || 0),\r",
											"            fail: Number(pm.collectionVariables.get('__req_fail') || 0),\r",
											"        };\r",
											"        console.log(TAG, 'after counters =', after);\r",
											"    } catch (err) {\r",
											"        console.error('[AGG ERROR]', err);\r",
											"        pm.test('Aggregation script error').fail(String(err));\r",
											"    }\r",
											"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "{{access_token}}",
										"type": "text"
									}
								],
								"body": {
									"mode": "formdata",
									"formdata": []
								},
								"url": {
									"raw": "{{baseUrl}}/app/api/dicom/servers/echo",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"app",
										"api",
										"dicom",
										"servers",
										"echo"
									]
								}
							},
							"response": []
						}
					]
				}
			]
		},
		{
			"name": "master_System",
			"item": [
				{
					"name": "ì‹œìŠ¤í…œ ì„¤ì • ì¡°íšŒ",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// --- PASS when both HTTP status === 200 and body.code === 200 ---\r",
									"pm.test(\"HTTP 200 OK\", () => {\r",
									"  pm.expect(pm.response.code).to.eql(200);\r",
									"});\r",
									"\r",
									"pm.test(\"Content-Type is JSON\", () => {\r",
									"  const ct = pm.response.headers.get(\"Content-Type\") || \"\";\r",
									"  pm.expect(ct.toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"let body = {};\r",
									"pm.test(\"Response body is JSON object\", () => {\r",
									"  body = pm.response.json();\r",
									"  pm.expect(body).to.be.an(\"object\");\r",
									"});\r",
									"\r",
									"pm.test(\"API body.code == 200\", () => {\r",
									"  // ì„œë²„ í‘œì¤€ ì‘ë‹µ: { \"code\": 200, \"message\": \"...\", \"result\": ... }\r",
									"  pm.expect(body).to.have.property(\"code\");\r",
									"  pm.expect(body.code).to.eql(200);\r",
									"});\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"\r",
									"// RUO ON/OFF í† ê¸€ì„ ìœ„í•´ ì¶”ê°€í•¨\r",
									"  let json = pm.response.json();\r",
									"\r",
									"if (json.result) {\r",
									"  pm.collectionVariables.set(\"SYS_CONFIG\", JSON.stringify(json.result));\r",
									"  console.log(\"[SYS_CONFIG Saved]\", json.result);\r",
									"}\r",
									"\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "{{baseUrl}}/app/api/system",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"system"
							]
						}
					},
					"response": []
				},
				{
					"name": "ë²„ì „ ì •ë³´ í™•ì¸",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "{{access_token}}",
								"type": "text"
							},
							{
								"key": "",
								"value": "",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/app/api/system/information",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"system",
								"information"
							]
						}
					},
					"response": []
				},
				{
					"name": "ì‹œìŠ¤í…œ í™˜ê²½ ì •ë³´ ì¡°íšŒ",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// 1) HTTP/í—¤ë” ê¸°ë³¸ ê²€ì‚¬\r",
									"pm.test(\"Status is 200\", () => pm.response.to.have.status(200));\r",
									"pm.test(\"Content-Type is JSON\", () => {\r",
									"  const ct = (pm.response.headers.get(\"Content-Type\") || \"\").toLowerCase();\r",
									"  pm.expect(ct).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"// 2) JSON íŒŒì‹±\r",
									"let j = {};\r",
									"try { j = pm.response.json(); } catch (e) { j = {}; }\r",
									"\r",
									"// 3) ë¹„ì¦ˆë‹ˆìŠ¤ ì½”ë“œ(ìˆìœ¼ë©´) í™•ì¸\r",
									"const bizCode = j?.code ?? j?.status ?? 200;\r",
									"pm.test(\"Business code 200\", () => pm.expect(bizCode).to.eql(200));\r",
									"\r",
									"// 4) í•„ë“œ êº¼ë‚´ê¸° (í‚¤ ë³€ë™ ìœ ì—°)\r",
									"const r = j?.result ?? j?.data ?? {};\r",
									"const timezone = r?.timezone ?? r?.timeZone ?? r?.tz ?? null;\r",
									"const research = (r?.isActiveResearchMode ?? r?.researchMode ?? r?.isResearch);\r",
									"\r",
									"// 5) í˜•ì‹/ê°’ ê²€ì¦ (ê°€ë²¼ìš´ íƒ€ì…ì²´í¬ë§Œ)\r",
									"pm.test(\"timezone is string\", () => pm.expect(timezone).to.be.a(\"string\"));\r",
									"pm.test(\"research flag is boolean\", () => pm.expect(typeof research).to.eql(\"boolean\"));\r",
									"\r",
									"// 6) ì½˜ì†” ë¡œê·¸ + ì²´ì´ë‹ ì €ì¥\r",
									"console.log(\"[ENV] timezone:\", timezone, \"| researchMode:\", research);\r",
									"pm.environment.set(\"env_timezone\", String(timezone ?? \"\"));\r",
									"pm.environment.set(\"env_research\", String(research));\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/app/api/system/environment",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"system",
								"environment"
							]
						}
					},
					"response": []
				},
				{
					"name": "ì‹œìŠ¤í…œ ì„¤ì • ìˆ˜ì •_ê²½ê³„ê°’(ìµœì†Œê°’)",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// === /app/api/system PATCH ìš”ì²­ìš© Pre-request ===\r",
									"const payload = {\r",
									"  timezone: \"UTC\",\r",
									"  sessionTimeoutMinute: 30,\r",
									"  analysisTimeoutMinute: 25,\r",
									"  isActiveResearchMode: true,\r",
									"  passwordChangePeriod: 1,\r",
									"  passwordChangeDelayPeriod: 1\r",
									"};\r",
									"\r",
									"// í—¤ë” ì„¸íŒ…\r",
									"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
									"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
									"if (token) {\r",
									"  pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
									"} else {\r",
									"  console.warn(\"âš ï¸ access_token/ACCESS_TOKEN í™˜ê²½ë³€ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤. 401ì´ ë‚  ìˆ˜ ìˆì–´ìš”.\");\r",
									"}\r",
									"\r",
									"// PATCH ë³¸ë¬¸ ì£¼ì…\r",
									"pm.request.body.mode = \"raw\";\r",
									"pm.request.body.update(JSON.stringify(payload));\r",
									"\r",
									"// ì´í›„ Testsì—ì„œ ë¹„êµí•  ìˆ˜ ìˆë„ë¡ ê¸°ëŒ€ê°’ ì €ì¥\r",
									"pm.variables.set(\"EXPECTED_SYSTEM_BODY\", JSON.stringify(payload));\r",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// === ê³µí†µ ì‘ë‹µ ê²€ì¦ ===\r",
									"pm.test(\"HTTP 200\", () => pm.response.to.have.status(200));\r",
									"\r",
									"// JSON íŒŒì‹±\r",
									"let j = {};\r",
									"pm.test(\"ì‘ë‹µì´ JSONì´ì–´ì•¼ í•¨\", () => {\r",
									"  j = pm.response.json();\r",
									"  pm.expect(j).to.be.an(\"object\");\r",
									"});\r",
									"\r",
									"// (ì„ íƒ) ë¹„ì¦ˆë‹ˆìŠ¤ ì½”ë“œê°€ ìˆìœ¼ë©´ 200ì´ì–´ì•¼ í•¨ (ì—†ìœ¼ë©´ í†µê³¼)\r",
									"pm.test(\"Business code == 200 (ìˆë‹¤ë©´)\", () => pm.expect(j?.code ?? 200).to.eql(200));\r",
									"\r",
									"// === ê²°ê³¼ ê°’ í™•ì¸ (ì„œë²„ê°€ resultì— ë°˜ì˜ ê°’ì„ ëŒë ¤ì¤„ ë•Œë§Œ ê²€ì¦) ===\r",
									"const expected = JSON.parse(pm.variables.get(\"EXPECTED_SYSTEM_BODY\") || \"{}\");\r",
									"const r = j?.result;\r",
									"\r",
									"if (r && typeof r === \"object\") {\r",
									"  Object.keys(expected).forEach(k => {\r",
									"    if (Object.prototype.hasOwnProperty.call(r, k)) {\r",
									"      pm.test(`result.${k} ì ìš©ë¨`, () => pm.expect(r[k]).to.eql(expected[k]));\r",
									"    }\r",
									"  });\r",
									"\r",
									"  // ë‹¤ìŒ ìš”ì²­ì—ì„œ ì“°ê³  ì‹¶ë‹¤ë©´ í™˜ê²½ë³€ìˆ˜ë¡œ ì €ì¥\r",
									"  Object.keys(expected).forEach(k => {\r",
									"    if (Object.prototype.hasOwnProperty.call(r, k)) {\r",
									"      pm.environment.set(`system_${k}`, r[k]);\r",
									"    }\r",
									"  });\r",
									"} else {\r",
									"  console.log(\"â„¹ï¸ ì‘ë‹µì— resultê°€ ì—†ê±°ë‚˜ ê°ì²´ê°€ ì•„ë‹™ë‹ˆë‹¤. ì„œë²„ ìŠ¤í™ìƒ ì •ìƒì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\");\r",
									"}\r",
									"\r",
									"// === ìš”ì²­ í—¤ë”/ì„¤ì • í™•ì¸ ===\r",
									"pm.test(\"Authorization í—¤ë” í¬í•¨\", () => {\r",
									"  const auth = pm.request.headers.get(\"Authorization\");\r",
									"  pm.expect(auth, \"Authorization header missing; set access_token or ACCESS_TOKEN\").to.be.a(\"string\").and.match(/^Bearer\\s.+/);\r",
									"});\r",
									"pm.test(\"Content-Type: application/json\", () => {\r",
									"  pm.expect(pm.request.headers.get(\"Content-Type\")).to.eql(\"application/json\");\r",
									"});\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "{{baseUrl}}/app/api/system",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"system"
							]
						}
					},
					"response": []
				},
				{
					"name": "ì‹œìŠ¤í…œ ì„¤ì • ìˆ˜ì •_ê²½ê³„ê°’(ìµœëŒ€ê°’)",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// === /app/api/system PATCH ìš”ì²­ìš© Pre-request ===\r",
									"const payload = {\r",
									"  timezone: \"Asia/Seoul\",\r",
									"  sessionTimeoutMinute: 500,\r",
									"  analysisTimeoutMinute: 60,\r",
									"  isActiveResearchMode: true,\r",
									"  passwordChangePeriod: 365,\r",
									"  passwordChangeDelayPeriod: 365\r",
									"};\r",
									"\r",
									"// í—¤ë” ì„¸íŒ…\r",
									"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
									"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
									"if (token) {\r",
									"  pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
									"} else {\r",
									"  console.warn(\"âš ï¸ access_token/ACCESS_TOKEN í™˜ê²½ë³€ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤. 401ì´ ë‚  ìˆ˜ ìˆì–´ìš”.\");\r",
									"}\r",
									"\r",
									"// PATCH ë³¸ë¬¸ ì£¼ì…\r",
									"pm.request.body.mode = \"raw\";\r",
									"pm.request.body.update(JSON.stringify(payload));\r",
									"\r",
									"// ì´í›„ Testsì—ì„œ ë¹„êµí•  ìˆ˜ ìˆë„ë¡ ê¸°ëŒ€ê°’ ì €ì¥\r",
									"pm.variables.set(\"EXPECTED_SYSTEM_BODY\", JSON.stringify(payload));\r",
									"\r",
									"\r",
									"\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// === ê³µí†µ ì‘ë‹µ ê²€ì¦ ===\r",
									"pm.test(\"HTTP 200\", () => pm.response.to.have.status(200));\r",
									"\r",
									"// JSON íŒŒì‹±\r",
									"let j = {};\r",
									"pm.test(\"ì‘ë‹µì´ JSONì´ì–´ì•¼ í•¨\", () => {\r",
									"  j = pm.response.json();\r",
									"  pm.expect(j).to.be.an(\"object\");\r",
									"});\r",
									"\r",
									"// (ì„ íƒ) ë¹„ì¦ˆë‹ˆìŠ¤ ì½”ë“œê°€ ìˆìœ¼ë©´ 200ì´ì–´ì•¼ í•¨ (ì—†ìœ¼ë©´ í†µê³¼)\r",
									"pm.test(\"Business code == 200 (ìˆë‹¤ë©´)\", () => pm.expect(j?.code ?? 200).to.eql(200));\r",
									"\r",
									"// === ê²°ê³¼ ê°’ í™•ì¸ (ì„œë²„ê°€ resultì— ë°˜ì˜ ê°’ì„ ëŒë ¤ì¤„ ë•Œë§Œ ê²€ì¦) ===\r",
									"const expected = JSON.parse(pm.variables.get(\"EXPECTED_SYSTEM_BODY\") || \"{}\");\r",
									"const r = j?.result;\r",
									"\r",
									"if (r && typeof r === \"object\") {\r",
									"  Object.keys(expected).forEach(k => {\r",
									"    if (Object.prototype.hasOwnProperty.call(r, k)) {\r",
									"      pm.test(`result.${k} ì ìš©ë¨`, () => pm.expect(r[k]).to.eql(expected[k]));\r",
									"    }\r",
									"  });\r",
									"\r",
									"  // ë‹¤ìŒ ìš”ì²­ì—ì„œ ì“°ê³  ì‹¶ë‹¤ë©´ í™˜ê²½ë³€ìˆ˜ë¡œ ì €ì¥\r",
									"  Object.keys(expected).forEach(k => {\r",
									"    if (Object.prototype.hasOwnProperty.call(r, k)) {\r",
									"      pm.environment.set(`system_${k}`, r[k]);\r",
									"    }\r",
									"  });\r",
									"} else {\r",
									"  console.log(\"â„¹ï¸ ì‘ë‹µì— resultê°€ ì—†ê±°ë‚˜ ê°ì²´ê°€ ì•„ë‹™ë‹ˆë‹¤. ì„œë²„ ìŠ¤í™ìƒ ì •ìƒì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\");\r",
									"}\r",
									"\r",
									"// === ìš”ì²­ í—¤ë”/ì„¤ì • í™•ì¸ ===\r",
									"pm.test(\"Authorization í—¤ë” í¬í•¨\", () => {\r",
									"  const auth = pm.request.headers.get(\"Authorization\");\r",
									"  pm.expect(auth, \"Authorization header missing; set access_token or ACCESS_TOKEN\").to.be.a(\"string\").and.match(/^Bearer\\s.+/);\r",
									"});\r",
									"pm.test(\"Content-Type: application/json\", () => {\r",
									"  pm.expect(pm.request.headers.get(\"Content-Type\")).to.eql(\"application/json\");\r",
									"});\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "{{baseUrl}}/app/api/system",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"system"
							]
						}
					},
					"response": []
				},
				{
					"name": "RUO ON/OFF",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"let saved = pm.collectionVariables.get(\"SYS_CONFIG\");\r",
									"let cfg = JSON.parse(saved);\r",
									"\r",
									"// ì„œë²„ê°€ í—ˆìš©í•˜ëŠ” í•„ë“œë§Œ ì¶”ì¶œ\r",
									"let body = {\r",
									"  timezone: cfg.timezone,\r",
									"  sessionTimeoutMinute: cfg.sessionTimeoutMinute,\r",
									"  analysisTimeoutMinute: cfg.analysisTimeoutMinute,\r",
									"  passwordChangePeriod: cfg.passwordChangePeriod,\r",
									"  passwordChangeDelayPeriod: cfg.passwordChangeDelayPeriod,\r",
									"  isActiveResearchMode: !cfg.isActiveResearchMode\r",
									"};\r",
									"\r",
									"console.log(\"[PATCH BODY FINAL]\", body);\r",
									"\r",
									"pm.request.body.mode = \"raw\";\r",
									"pm.request.body.update(JSON.stringify(body, null, 2));\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// === RUO toggle state ===\r",
									"// ì»¬ë ‰ì…˜ ë³€ìˆ˜ì—ì„œ ì´ì „ ìƒíƒœ ì½ê¸°\r",
									"let curr = pm.collectionVariables.get(\"RUO_LAST\") || \"off\";\r",
									"\r",
									"// ë‹¤ìŒ ìƒíƒœ ê³„ì‚°\r",
									"let next = curr === \"off\" ? \"on\" : \"off\";\r",
									"\r",
									"// ë‹¤ìŒ ìƒíƒœ ì €ì¥\r",
									"pm.collectionVariables.set(\"RUO_LAST\", next);\r",
									"\r",
									"// --- body êµ¬ì„± ---\r",
									"const body = {\r",
									"  timezone: \"Asia/Seoul\",\r",
									"  sessionTimeoutMinute: 500,\r",
									"  analysisTimeoutMinute: 60,\r",
									"  isActiveResearchMode: next === \"on\",\r",
									"  passwordChangePeriod: 365,\r",
									"  passwordChangeDelayPeriod: 365\r",
									"};\r",
									"\r",
									"// ìš”ì²­ bodyë¥¼ JSONìœ¼ë¡œ ê°•ì œ ì„¤ì •\r",
									"pm.request.body.mode = \"raw\";\r",
									"pm.request.body.update(JSON.stringify(body, null, 2));\r",
									"\r",
									"// ë¡œê·¸ ì¶œë ¥\r",
									"console.log(`[RUO Toggle] prev = ${curr}, next = ${next}`);\r",
									"console.log(\"[PATCH /app/api/system] body =>\", body);\r",
									"\r",
									"let res = {};\r",
									"try { res = pm.response.json(); } catch (e) {}\r",
									"\r",
									"pm.test(\"HTTP 200 OK\", () => {\r",
									"  pm.expect(pm.response.code).to.eql(200);\r",
									"});\r",
									"\r",
									"pm.test(\"API body.code == 200\", () => {\r",
									"  pm.expect(res).to.have.property(\"code\");\r",
									"  pm.expect(res.code).to.eql(200);\r",
									"});\r",
									"\r",
									"console.log(\"[PATCH result]\", res);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "{{baseUrl}}/app/api/system",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"system"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "master_report",
			"item": [
				{
					"name": "ë³´ê³ ì„œ ì„¤ì • ì¡°íšŒ",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"const token = pm.environment.get(\"access_token\"); //í™˜ê²½ë³€ìˆ˜ì—ì„œ access_token ì½ê¸°\r",
									"\r",
									"// í† í°ì´ ìˆìœ¼ë©´ Authorization í—¤ë” ì„¤ì •, í—¤ë” ê°’: Bearer token\r",
									"if (token) pm.request.headers.upsert({key:\"Authorization\", value:`Bearer ${token}`});\r",
									"pm.request.headers.upsert({key:\"Accept\", value:\"application/json\"});\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"HTTP 200\", () => pm.response.to.have.status(200)); // HTTP ìƒíƒœ ì½”ë“œ 200 í™•ì¸\r",
									"\r",
									"const j = pm.response.json();\r",
									"const cats = j?.result?.reportSettingCatalogs || {};\r",
									"const langs = cats.languages || [];\r",
									"const cur = j?.result?.reportSetting?.languageCode;\r",
									"\r",
									"pm.test(\"languages ë°°ì—´ ì¡´ì¬\", () => pm.expect(langs).to.be.an(\"array\").that.is.not.empty);\r",
									"pm.test(\"languageCode ì¡´ì¬\", () => pm.expect(cur).to.be.a(\"string\").and.not.empty);\r",
									"\r",
									"// í˜„ì¬ ì–¸ì–´ê°€ ì¹´íƒˆë¡œê·¸ì— ìˆëŠ”ì§€ ê²€ì¦\r",
									"const codes = langs.map(l => l.code);\r",
									"pm.test(\"í˜„ì¬ ì–¸ì–´ê°€ ì¹´íƒˆë¡œê·¸ì— í¬í•¨\", () => pm.expect(codes).to.include(cur));\r",
									"\r",
									"// âœ… English(EN) ê°•ì œ ì²´í¬: Englishê°€ ì•„ë‹ˆë©´ ì‹¤íŒ¨\r",
									"pm.test(\"Report language must be English (en)\", () => {\r",
									"  pm.expect(String(cur).toLowerCase(), \"Report language is not English\").to.eql(\"en\");\r",
									"});\r",
									"\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/app/api/report/settings",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"report",
								"settings"
							]
						}
					},
					"response": []
				},
				{
					"name": "ë³´ê³ ì„œ í…œí”Œë¦¿ ëª©ë¡ ì¡°íšŒ",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// ê³µí†µ í—¤ë”(ì¸ì¦)\r",
									"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
									"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
									"if (token) pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
									"\r",
									"// (ì„ íƒ) ì œì™¸í•  UIDë“¤ ì½¤ë§ˆë¡œ ë„£ìœ¼ë©´ ê±´ë„ˆëœë‹ˆë‹¤. ì˜ˆ: \"AD-RE-SCRLEQ-PD-R,AD-RE-MNT-PD-R\"\r",
									"pm.environment.set(\"EXCLUDE_UIDS\", pm.environment.get(\"EXCLUDE_UIDS\") || \"\");\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"const BODY_KEY_NAME = \"templateUid\";  // í•„ìš” ì‹œ \"uid\" ë¡œ ë³€ê²½\r",
									"\r",
									"const baseUrl = pm.variables.replaceIn(\"{{baseUrl}}\");\r",
									"const auth = pm.request.headers.get(\"Authorization\") || \"\";\r",
									"const excludeSet = new Set(\r",
									"  (pm.environment.get(\"EXCLUDE_UIDS\") || \"\")\r",
									"    .split(\",\")\r",
									"    .map(s => s.trim())\r",
									"    .filter(Boolean)\r",
									");\r",
									"\r",
									"// í—¬í¼: í˜„ì¬ í…œí”Œë¦¿ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°\r",
									"function getTemplates(cb) {\r",
									"  pm.sendRequest({\r",
									"    url: `${baseUrl}/app/api/report/templates`,\r",
									"    method: \"GET\",\r",
									"    header: [{ key: \"Authorization\", value: auth }]\r",
									"  }, (err, res) => {\r",
									"    pm.test(\"GET templates 200\", () => pm.expect(res.code).to.eql(200));\r",
									"    if (err) return cb(err);\r",
									"    let j={}; try{ j=res.json(); }catch(e){}\r",
									"    cb(null, (j?.result?.templates) || []);\r",
									"  });\r",
									"}\r",
									"\r",
									"// í—¬í¼: ì„¤ì • POST\r",
									"function setTransfer(uid, val, cb) {\r",
									"  const body = {}; body[BODY_KEY_NAME] = uid; body.transfer = Boolean(val);\r",
									"  pm.sendRequest({\r",
									"    url: `${baseUrl}/app/api/report/templates/configure`,\r",
									"    method: \"POST\",\r",
									"    header: [\r",
									"      { key: \"Authorization\", value: auth },\r",
									"      { key: \"Content-Type\", value: \"application/json\" },\r",
									"    ],\r",
									"    body: { mode: \"raw\", raw: JSON.stringify(body) }\r",
									"  }, (err, res) => {\r",
									"    if (err) return cb(err);\r",
									"    let j={}; try{ j=res.json(); }catch(e){}\r",
									"    const svc = j?.code ?? res.code;\r",
									"    pm.test(`POST ${uid} - HTTP 200`,   () => pm.expect(res.code).to.eql(200));\r",
									"    pm.test(`POST ${uid} - code 200`,   () => pm.expect(svc).to.eql(200));\r",
									"    cb(null);\r",
									"  });\r",
									"}\r",
									"\r",
									"// 1) í˜„ì¬ ìƒíƒœ ë¡œë“œ\r",
									"getTemplates((err, list) => {\r",
									"  pm.test(\"GET templates error-free\", () => pm.expect(err).to.eql(null));\r",
									"  if (err) return;\r",
									"\r",
									"  // ë°˜ì „ ëŒ€ìƒ: transferê°€ booleanì´ê³ , ì œì™¸ì§‘í•©ì— ì—†ëŠ” UIDë§Œ\r",
									"  const plan = [];\r",
									"  const before = {};\r",
									"  for (const t of list) {\r",
									"    before[t.uid] = t.transfer;         // true/false/null\r",
									"    if (excludeSet.has(t.uid)) continue;\r",
									"    if (typeof t.transfer === \"boolean\") {\r",
									"      plan.push({ uid: t.uid, want: !t.transfer });\r",
									"    }\r",
									"  }\r",
									"\r",
									"  // 2) ìˆœì°¨ POST\r",
									"  function next(i) {\r",
									"    if (i >= plan.length) return verify();\r",
									"    const { uid, want } = plan[i];\r",
									"    setTransfer(uid, want, () => next(i+1));\r",
									"  }\r",
									"\r",
									"  // 3) ì¬-GETìœ¼ë¡œ ìµœì¢… ê²€ì¦(ëª¨ë‘ ë°˜ì „ë˜ì—ˆëŠ”ì§€)\r",
									"  function verify() {\r",
									"    getTemplates((e2, finalList) => {\r",
									"      pm.test(\"Final GET error-free\", () => pm.expect(e2).to.eql(null));\r",
									"      if (e2) return;\r",
									"\r",
									"      const after = Object.fromEntries(finalList.map(t => [t.uid, t.transfer]));\r",
									"      for (const { uid } of plan) {\r",
									"        pm.test(`Verify that ${uid}.transfer flipped`, () => {\r",
									"          pm.expect(after[uid]).to.eql(!before[uid]);\r",
									"        });\r",
									"      }\r",
									"      // ì°¸ê³ : ì œì™¸ëœ UIDë‚˜ transfer===nullì´ë˜ UIDëŠ” ê²€ì¦ì—ì„œ ìë™ ì œì™¸ë¨\r",
									"    });\r",
									"  }\r",
									"\r",
									"  next(0);\r",
									"});\r",
									"\r",
									"// ë“œë¼ì´ë²„ ìš”ì²­ ìì²´ë„ 200(ë©”ì¸ ìš”ì²­ì€ 1íšŒë§Œ ì‹¤í–‰)\r",
									"pm.test(\"Driver request 200\", () => pm.response.to.have.status(200));\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/app/api/report/templates",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"report",
								"templates"
							]
						}
					},
					"response": []
				},
				{
					"name": "ë³´ê³ ì„œ í…œí”Œë¦¿ ë³„ ì„¤ì • ìˆ˜ì •",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// ì§‘ê³„\r",
									"const ok = [];\r",
									"const fail = [];\r",
									"const details = []; // {uid, status, code}\r",
									"\r",
									"// ì„ íƒ ëª©ë¡/ì „ì†¡ê°’ ë³µêµ¬\r",
									"const selected = JSON.parse(pm.variables.get(\"selected_uids_json\") || \"[]\");\r",
									"const transfer = pm.variables.get(\"transfer_value\") === \"true\";\r",
									"\r",
									"// ë©”ì¸ ì‘ë‹µ ë°˜ì˜\r",
									"const firstUid = selected[0];\r",
									"if (pm.response.code === 200) {\r",
									"  ok.push(firstUid);\r",
									"  details.push({ uid: firstUid, status: \"OK\", code: pm.response.code });\r",
									"} else {\r",
									"  fail.push(firstUid);\r",
									"  details.push({ uid: firstUid, status: \"FAIL\", code: pm.response.code });\r",
									"}\r",
									"\r",
									"// === ì¸ì¦/ê³µí†µ í—¤ë” ë³µì‚¬ (ì¶”ê°€ ìš”ì²­ìš©) ===\r",
									"const baseHeaders = {};\r",
									"pm.request.headers.each(h => {\r",
									"  if (!h || !h.key) return;\r",
									"  if ([\"Content-Length\", \"Host\"].includes(h.key)) return;\r",
									"  baseHeaders[h.key] = h.value;\r",
									"});\r",
									"baseHeaders[\"Content-Type\"] = \"application/json\";\r",
									"if (!baseHeaders[\"Authorization\"]) {\r",
									"  const envAuth = pm.environment.get(\"AUTHORIZATION\"); // ì˜ˆ: \"Bearer xxxxx\"\r",
									"  if (envAuth) baseHeaders[\"Authorization\"] = envAuth;\r",
									"}\r",
									"const csrf = pm.environment.get(\"X_CSRF_TOKEN\");\r",
									"if (csrf) baseHeaders[\"X-CSRF-Token\"] = csrf;\r",
									"\r",
									"// === ë‚¨ì€ UID ìˆœì°¨ ì „ì†¡ ===\r",
									"const remaining = selected.slice(1);\r",
									"\r",
									"function sendNext(i) {\r",
									"  if (i >= remaining.length) return finalizeSummary();\r",
									"\r",
									"  const uid = remaining[i];\r",
									"  pm.sendRequest({\r",
									"    url: pm.request.url.toString(),\r",
									"    method: \"POST\",\r",
									"    header: baseHeaders,\r",
									"    body: { mode: \"raw\", raw: JSON.stringify({ templateUid: uid, transfer }) },\r",
									"  }, (err, res) => {\r",
									"    if (err || !res) {\r",
									"      fail.push(uid);\r",
									"      details.push({ uid, status: \"FAIL\", code: err ? \"ERR\" : \"NORES\" });\r",
									"    } else if (res.code === 200) {\r",
									"      ok.push(uid);\r",
									"      details.push({ uid, status: \"OK\", code: res.code });\r",
									"    } else {\r",
									"      fail.push(uid);\r",
									"      details.push({ uid, status: \"FAIL\", code: res.code });\r",
									"    }\r",
									"    sendNext(i + 1);\r",
									"  });\r",
									"}\r",
									"\r",
									"function finalizeSummary() {\r",
									"  // âœ… ìš”ì•½\r",
									"  pm.test(`Transfer to PACS ê²°ê³¼: OK=${ok.length} / FAIL=${fail.length}`, () => pm.expect(true).to.be.true);\r",
									"  if (fail.length) console.warn(\"Failed UIDs:\", fail.join(\",\"));\r",
									"\r",
									"  // ê° UID í•œ ì¤„ì”© í‘œì‹œ\r",
									"  details.forEach(d => {\r",
									"    pm.test(`ë³€ê²½: ${d.uid} â†’ transfer=${transfer} (${d.status}/${d.code})`, () => pm.expect(true).to.be.true);\r",
									"  });\r",
									"\r",
									"  // Visualize í‘œ\r",
									"  const template = `\r",
									"  <style>\r",
									"    body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; }\r",
									"    h3 { margin: 0 0 8px; }\r",
									"    .meta { margin-bottom: 12px; font-size: 12px; opacity: 0.8; }\r",
									"    table { border-collapse: collapse; width: 100%; }\r",
									"    th, td { border: 1px solid #ddd; padding: 6px 8px; font-size: 12px; }\r",
									"    th { background: #f6f6f6; text-align: left; }\r",
									"    .ok { color: #0a7c2f; font-weight: 600; }\r",
									"    .fail { color: #b00020; font-weight: 600; }\r",
									"  </style>\r",
									"  <h3>Transfer to PACS ë³€ê²½ ë‚´ì—­</h3>\r",
									"  <div class=\"meta\">\r",
									"    transfer â‡’ <b>{{transfer}}</b> |\r",
									"    ì´ {{total}}ê±´ (OK {{ok}} / FAIL {{fail}}) |\r",
									"    ì‹¤í–‰ì‹œê°: {{ts}}\r",
									"  </div>\r",
									"  <table>\r",
									"    <thead>\r",
									"      <tr>\r",
									"        <th>#</th>\r",
									"        <th>Template UID</th>\r",
									"        <th>transfer</th>\r",
									"        <th>Status</th>\r",
									"        <th>HTTP Code</th>\r",
									"      </tr>\r",
									"    </thead>\r",
									"    <tbody>\r",
									"      {{#each rows}}\r",
									"      <tr>\r",
									"        <td>{{@index}}</td>\r",
									"        <td>{{uid}}</td>\r",
									"        <td>{{../transfer}}</td>\r",
									"        <td class=\"{{lower status}}\">{{status}}</td>\r",
									"        <td>{{code}}</td>\r",
									"      </tr>\r",
									"      {{/each}}\r",
									"    </tbody>\r",
									"  </table>\r",
									"  `;\r",
									"  pm.visualizer.set(template, {\r",
									"    transfer: String(transfer),\r",
									"    total: details.length,\r",
									"    ok: ok.length,\r",
									"    fail: fail.length,\r",
									"    ts: new Date().toLocaleString(),\r",
									"    rows: details,\r",
									"    lower: s => String(s).toLowerCase()\r",
									"  });\r",
									"\r",
									"  // ê¸°ë³¸ ê²€ì¦\r",
									"  pm.test(\"ì‘ë‹µ 200 OK (ë©”ì¸ ìš”ì²­)\", function () {\r",
									"    pm.response.to.have.status(200);\r",
									"  });\r",
									"\r",
									"  // ---- ì—¬ê¸°: SKIP_LOGOUTê°€ trueì¼ ë•Œë§Œ ëŸ° ì¢…ë£Œ, ì•„ë‹ˆë©´ ë‹¤ìŒ(ë¡œê·¸ì•„ì›ƒ) ê³„ì† ì‹¤í–‰ ----\r",
									"  const skipLogout = pm.environment.get(\"SKIP_LOGOUT\") === \"true\";\r",
									"  if (skipLogout) {\r",
									"    console.log(\"[configure] SKIP_LOGOUT=true â†’ ì—¬ê¸°ì„œ ëŸ° ì¢…ë£Œ\");\r",
									"    postman.setNextRequest(null);\r",
									"  } else {\r",
									"    console.log(\"[configure] SKIP_LOGOUT=false â†’ ë‹¤ìŒ ìš”ì²­ ê³„ì† ì‹¤í–‰(ë¡œê·¸ì•„ì›ƒ í¬í•¨)\");\r",
									"    // setNextRequest í˜¸ì¶œ ì•ˆ í•˜ë©´ Runnerê°€ ë‹¤ìŒ ìš”ì²­ìœ¼ë¡œ ì§„í–‰\r",
									"    // í•„ìš” ì‹œ ì •í™•íˆ ë‹¤ìŒì„ 'ë¡œê·¸ì•„ì›ƒ'ìœ¼ë¡œ ê°•ì œí•˜ë ¤ë©´ ì•„ë˜ í•œ ì¤„ ì‚¬ìš©:\r",
									"    // postman.setNextRequest(\"ë¡œê·¸ì•„ì›ƒ\"); // ìš”ì²­ ì´ë¦„ ì •í™•íˆ ì¼ì¹˜\r",
									"  }\r",
									"}\r",
									"\r",
									"if (!remaining.length) {\r",
									"  finalizeSummary();\r",
									"} else {\r",
									"  sendNext(0);\r",
									"}\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// 1) í…œí”Œë¦¿ ëª©ë¡: í™˜ê²½ë³€ìˆ˜ TARGET_UIDS (CSV)\r",
									"const envCsv = pm.environment.get(\"TARGET_UIDS\");\r",
									"let templates = envCsv\r",
									"  ? envCsv.split(\",\").map(s => s.trim()).filter(Boolean)\r",
									"  : [\r",
									"      \"AD-RE-VOL-PD-R\",\r",
									"      \"AD-RE-FHI-PD-R\",\r",
									"      \"AD-RE-AE-PD-R\",\r",
									"      \"AD-RE-AHSWI-PD-R\",\r",
									"      \"AD-RE-AHGRE-PD-R\",\r",
									"      \"AD-RE-AHSG-PD-R\",\r",
									"      \"AD-RE-APET-PD-R\",\r",
									"      \"AD-RE-TPET-PD-R\",\r",
									"    ];\r",
									"\r",
									"if (!templates.length) {\r",
									"  throw new Error(\"TARGET_UIDSê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.\");\r",
									"}\r",
									"\r",
									"// 2) 4ê°œ ëœë¤(ì¤‘ë³µ ì—†ì´) ì„ íƒ\r",
									"function pickN(arr, n) {\r",
									"  const a = [...arr];\r",
									"  for (let i = a.length - 1; i > 0; i--) {\r",
									"    const j = Math.floor(Math.random() * (i + 1));\r",
									"    [a[i], a[j]] = [a[j], a[i]];\r",
									"  }\r",
									"  return a.slice(0, Math.min(n, a.length));\r",
									"}\r",
									"const selected = pickN(templates, 4);\r",
									"\r",
									"// 3) TRANSFER ë²ˆê°ˆì•„ í† ê¸€\r",
									"const last = pm.environment.get(\"LAST_TRANSFER\") === \"true\";\r",
									"const transfer = !last;\r",
									"pm.environment.set(\"LAST_TRANSFER\", String(transfer));\r",
									"\r",
									"// 4) ë©”ì¸ ìš”ì²­ì€ ì²« ë²ˆì§¸ UIDë¡œ ì „ì†¡, ë‚˜ë¨¸ì§€ëŠ” Testsì—ì„œ ì¶”ê°€ ì „ì†¡\r",
									"const [first, ...rest] = selected;\r",
									"\r",
									"// 5) ë°”ë””/í—¤ë” ì„¤ì •\r",
									"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
									"pm.request.body.update(JSON.stringify({ templateUid: first, transfer }));\r",
									"\r",
									"// 6) Testsì—ì„œ ì“°ë„ë¡ ì €ì¥\r",
									"pm.variables.set(\"selected_uids_json\", JSON.stringify(selected));\r",
									"pm.variables.set(\"transfer_value\", String(transfer));\r",
									"pm.variables.set(\"picked_templateUid\", first);\r",
									"pm.variables.set(\"picked_transfer\", transfer);\r",
									"\r",
									"console.log(\"[configure] first:\", first, \"transfer:\", transfer, \"others:\", rest);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/app/api/report/templates/configure",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"report",
								"templates",
								"configure"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "master_PACS",
			"item": [
				{
					"name": "PACS ì „ì†¡ ì„¤ì • ì¡°íšŒ",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// --- PASS when both HTTP status === 200 and body.code === 200 ---\r",
									"pm.test(\"HTTP 200 OK\", () => {\r",
									"  pm.expect(pm.response.code).to.eql(200);\r",
									"});\r",
									"\r",
									"pm.test(\"Content-Type is JSON\", () => {\r",
									"  const ct = pm.response.headers.get(\"Content-Type\") || \"\";\r",
									"  pm.expect(ct.toLowerCase()).to.include(\"application/json\");\r",
									"});\r",
									"\r",
									"let body = {};\r",
									"pm.test(\"Response body is JSON object\", () => {\r",
									"  body = pm.response.json();\r",
									"  pm.expect(body).to.be.an(\"object\");\r",
									"});\r",
									"\r",
									"pm.test(\"API body.code == 200\", () => {\r",
									"  // ì„œë²„ í‘œì¤€ ì‘ë‹µ: { \"code\": 200, \"message\": \"...\", \"result\": ... }\r",
									"  pm.expect(body).to.have.property(\"code\");\r",
									"  pm.expect(body.code).to.eql(200);\r",
									"});\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "{{baseUrl}}/app/api/pacs/settings",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"pacs",
								"settings"
							]
						}
					},
					"response": []
				},
				{
					"name": "PACS ì „ì†¡ ì„¤ì • ìˆ˜ì •",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// ==== PACS Settings ëœë¤ Payload ìƒì„± & ì£¼ì… ====\r",
									"\r",
									"// ëª¨ë“œ ì„¤ì •: random | all_true | all_false\r",
									"const mode = String(pm.environment.get(\"pacs_mode\") || \"random\").toLowerCase();\r",
									"const includeSwiTType = String(pm.environment.get(\"include_swiTType\") || \"false\").toLowerCase() === \"true\";\r",
									"\r",
									"// ëœë¤ ë¶ˆë¦¬ì–¸\r",
									"function randBool() {\r",
									"  if (mode === \"all_true\")  return true;\r",
									"  if (mode === \"all_false\") return false;\r",
									"  return Math.random() < 0.5;\r",
									"}\r",
									"// 3ë°©í–¥/1ë°©í–¥ ìƒì„±ê¸°\r",
									"function makeTriDir() { return { axial: randBool(), coronal: randBool(), sagittal: randBool() }; }\r",
									"function makeAxialOnly() { return { axial: randBool() }; }\r",
									"\r",
									"// ==== ì—¬ê¸° ì¶”ê°€: ì˜µì…˜ ëœë¤ ì„ íƒ ====\r",
									"function pick(arr) { return arr[Math.floor(Math.random() * arr.length)]; }\r",
									"const reportThemeOptions = [\"DARK\", \"LIGHT\"];\r",
									"const sendPacsFileTypeOptions = [\"JPEG\", \"PDF\"];\r",
									"\r",
									"const selectedReportTheme   = pick(reportThemeOptions);\r",
									"const selectedSendFileType  = pick(sendPacsFileTypeOptions);\r",
									"\r",
									"// ---- Payload êµ¬ì„± ----\r",
									"const payload = {\r",
									"  t1Type:      makeTriDir(),\r",
									"  flairType:   makeTriDir(),\r",
									"  amyloidType: makeTriDir(),\r",
									"  tauType:     makeTriDir(),\r",
									"\r",
									"  ariaEType:   makeAxialOnly(),\r",
									"  swiType:     makeAxialOnly(),\r",
									"  greType:     makeAxialOnly(),\r",
									"\r",
									"\r",
									"  // ëœë¤ ì„ íƒ ì ìš©\r",
									"  reportTheme: selectedReportTheme,\r",
									"  sendPacsFileType: selectedSendFileType\r",
									"};\r",
									"if (includeSwiTType) payload.swiTType = makeAxialOnly();\r",
									"\r",
									"// ---- í—¤ë”/ë°”ë”” ì„¸íŒ… ----\r",
									"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
									"const token = pm.environment.get(\"access_token\") || pm.environment.get(\"ACCESS_TOKEN\");\r",
									"if (token) {\r",
									"  pm.request.headers.upsert({ key: \"Authorization\", value: `Bearer ${token}` });\r",
									"} else {\r",
									"  console.warn(\"âš ï¸ access_token/ACCESS_TOKEN í™˜ê²½ë³€ìˆ˜ê°€ ì—†ì–´ 401ì´ ë‚  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\");\r",
									"}\r",
									"pm.request.body.mode = \"raw\";\r",
									"pm.request.body.update(JSON.stringify(payload));\r",
									"\r",
									"// ---- í‰íƒ„í™”(ë¶ˆë¦¬ì–¸ë§Œ) & ë¡œê·¸ ----\r",
									"function flattenBools(p) {\r",
									"  const out = {};\r",
									"  const tri = [\"t1Type\",\"flairType\",\"amyloidType\",\"tauType\"];\r",
									"  tri.forEach(n => {\r",
									"    const o = p[n] || {};\r",
									"    [\"axial\",\"coronal\",\"sagittal\"].forEach(d => {\r",
									"      if (o.hasOwnProperty(d)) out[`${n}.${d}`] = Boolean(o[d]);\r",
									"    });\r",
									"  });\r",
									"  [\"ariaEType\",\"swiType\",\"greType\",\"swiTType\"].forEach(n => {\r",
									"    const o = p[n];\r",
									"    if (o && o.hasOwnProperty(\"axial\")) out[`${n}.axial`] = Boolean(o.axial);\r",
									"  });\r",
									"  return out;\r",
									"}\r",
									"const flat = flattenBools(payload);\r",
									"\r",
									"// ì½˜ì†” ë¡œê·¸\r",
									"console.log(\"[PACS PAYLOAD]\", payload);\r",
									"console.log(\"[PACS BOOLS - SENT]\");\r",
									"Object.keys(flat).sort().forEach(k => console.log(`${k}: ${flat[k]}`));\r",
									"console.log(`[reportTheme]: ${payload.reportTheme}`);\r",
									"console.log(`[sendPacsFileType]: ${payload.sendPacsFileType}`);\r",
									"\r",
									"// ---- Testsì—ì„œ ì‚¬ìš©í•  ê°’ ì €ì¥ ----\r",
									"pm.variables.set(\"EXPECTED_PACS_SETTINGS\", JSON.stringify(payload));\r",
									"pm.variables.set(\"PACS_FLAT\", JSON.stringify(flat));\r",
									"pm.variables.set(\"REPORT_THEME_SELECTED\", selectedReportTheme);\r",
									"pm.variables.set(\"SEND_FILETYPE_SELECTED\", selectedSendFileType);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// ==== ê¸°ë³¸ ì‘ë‹µ ê²€ì‚¬ ====\r",
									"pm.test(\"HTTP 200\", () => pm.response.to.have.status(200));\r",
									"\r",
									"// JSON íŒŒì‹±\r",
									"let j = {};\r",
									"pm.test(\"ì‘ë‹µì´ JSONì´ì–´ì•¼ í•¨\", () => { j = pm.response.json(); pm.expect(j).to.be.an(\"object\"); });\r",
									"\r",
									"// ë¹„ì¦ˆë‹ˆìŠ¤ ì½”ë“œ(ìˆë‹¤ë©´ 200)\r",
									"pm.test(\"Business code == 200 (ìˆë‹¤ë©´)\", () => pm.expect(j?.code ?? 200).to.eql(200));\r",
									"\r",
									"// ==== ë³´ë‚¸ ëœë¤ ë¶ˆë¦¬ì–¸ ê°’ (Test ì´ë¦„ìœ¼ë¡œ í‘œê¸°) ====\r",
									"const flatSent = JSON.parse(pm.variables.get(\"PACS_FLAT\") || \"{}\");\r",
									"Object.keys(flatSent).sort().forEach(k => {\r",
									"  const v = flatSent[k];\r",
									"  pm.test(`[SENT] ${k} = ${v}`, () => pm.expect(typeof v).to.eql(\"boolean\"));\r",
									"});\r",
									"console.log(\"[PACS BOOLS - SENT FLAT]\", flatSent);\r",
									"\r",
									"// ==== ë³´ë‚¸ ëœë¤ ì˜µì…˜(ë¬¸ìì—´) ê²€ì¦ ====\r",
									"const themeSent = pm.variables.get(\"REPORT_THEME_SELECTED\");\r",
									"const fileSent  = pm.variables.get(\"SEND_FILETYPE_SELECTED\");\r",
									"\r",
									"pm.test(`[SENT] reportTheme = ${themeSent}`, () => pm.expect([\"DARK\",\"LIGHT\"]).to.include(themeSent));\r",
									"pm.test(`[SENT] sendPacsFileType = ${fileSent}`, () => pm.expect([\"JPEG\",\"PDF\"]).to.include(fileSent));\r",
									"\r",
									"// ==== ì„œë²„ echoê°€ ìˆë‹¤ë©´ ë¹„êµ ====\r",
									"function flattenBools(p) {\r",
									"  if (!p || typeof p !== \"object\") return {};\r",
									"  const out = {};\r",
									"  const tri = [\"t1Type\",\"flairType\",\"amyloidType\",\"tauType\"];\r",
									"  tri.forEach(n => {\r",
									"    const o = p[n] || {};\r",
									"    [\"axial\",\"coronal\",\"sagittal\"].forEach(d => {\r",
									"      if (o && o.hasOwnProperty(d)) out[`${n}.${d}`] = Boolean(o[d]);\r",
									"    });\r",
									"  });\r",
									"  [\"ariaEType\",\"swiType\",\"greType\",\"swiTType\"].forEach(n => {\r",
									"    const o = p[n];\r",
									"    if (o && o.hasOwnProperty(\"axial\")) out[`${n}.axial`] = Boolean(o.axial);\r",
									"  });\r",
									"  return out;\r",
									"}\r",
									"\r",
									"const r = j?.result;\r",
									"const flatEcho = flattenBools(r);\r",
									"console.log(\"[PACS BOOLS - ECHO FLAT]\", flatEcho);\r",
									"\r",
									"// echo íƒ€ì… í™•ì¸(ë¶ˆë¦¬ì–¸)\r",
									"Object.keys(flatEcho).sort().forEach(k => {\r",
									"  pm.test(`[ECHO] ${k} = ${flatEcho[k]}`, () => pm.expect(typeof flatEcho[k]).to.eql(\"boolean\"));\r",
									"});\r",
									"\r",
									"// sent â†” echo ì¼ì¹˜ ì—¬ë¶€(ë¶ˆë¦¬ì–¸)\r",
									"Object.keys(flatSent).sort().forEach(k => {\r",
									"  if (Object.prototype.hasOwnProperty.call(flatEcho, k)) {\r",
									"    pm.test(`[MATCH] ${k}`, () => pm.expect(flatEcho[k]).to.eql(flatSent[k]));\r",
									"  } else {\r",
									"    pm.test(`[NO ECHO] ${k}`, () => pm.expect(true).to.eql(true)); // echo ì•ˆ ì£¼ë©´ íŒ¨ìŠ¤\r",
									"  }\r",
									"});\r",
									"\r",
									"// ë¬¸ìì—´ ì˜µì…˜ echo ë¹„êµ (ìˆì„ ë•Œë§Œ)\r",
									"if (r && typeof r === \"object\") {\r",
									"  if (Object.prototype.hasOwnProperty.call(r, \"reportTheme\")) {\r",
									"    pm.test(\"reportTheme echo matches\", () => pm.expect(String(r.reportTheme)).to.eql(String(themeSent)));\r",
									"  }\r",
									"  if (Object.prototype.hasOwnProperty.call(r, \"sendPacsFileType\")) {\r",
									"    pm.test(\"sendPacsFileType echo matches\", () => pm.expect(String(r.sendPacsFileType)).to.eql(String(fileSent)));\r",
									"  }\r",
									"}\r",
									"\r",
									"// ==== ìš”ì²­ í—¤ë” í™•ì¸ ====\r",
									"pm.test(\"Authorization í—¤ë” í¬í•¨\", () => {\r",
									"  const auth = pm.request.headers.get(\"Authorization\");\r",
									"  pm.expect(auth, \"Authorization header missing; set access_token or ACCESS_TOKEN\").to.be.a(\"string\").and.match(/^Bearer\\s.+/);\r",
									"});\r",
									"pm.test(\"Content-Type: application/json\", () => {\r",
									"  pm.expect(pm.request.headers.get(\"Content-Type\")).to.eql(\"application/json\");\r",
									"});\r",
									"\r",
									"\r",
									"// === ì§‘ê³„ IIFE (í•­ìƒ ì‹¤í–‰) ===\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  // (ì„ íƒ) ë°©ì–´ì  ì´ˆê¸°í™”: ì»¬ë ‰ì…˜ Pre-requestì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥\r",
									"  if (!pm.collectionVariables.get('__agg_init')) {\r",
									"    pm.collectionVariables.set('__agg_init', '1');\r",
									"    pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"    pm.collectionVariables.set('__log', '[]');\r",
									"    pm.collectionVariables.set('__req_total', 0);\r",
									"    pm.collectionVariables.set('__req_pass', 0);\r",
									"    pm.collectionVariables.set('__req_fail', 0);\r",
									"    console.log(TAG, 'init (fallback)');\r",
									"  }\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); }\r",
									"    catch (e) { console.error(TAG, 'parse __log error:', e); rows = []; }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"})(); // ğŸ”´ ì—¬ê¸°! IIFE ë‹«ê¸°\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "{{baseUrl}}/app/api/pacs/settings",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"app",
								"api",
								"pacs",
								"settings"
							]
						}
					},
					"response": []
				},
				{
					"name": "ë¡œê·¸ì•„ì›ƒ",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {\r",
									"    pm.test(\"ë¡œê·¸ì•„ì›ƒ ì„±ê³µ\", function () {\r",
									"        pm.expect(pm.response.code).to.eql(200);\r",
									"    });\r",
									"\r",
									"    console.log(\"âœ… ë¡œê·¸ì•„ì›ƒ ì„±ê³µ, í† í° ë§Œë£Œ ì²˜ë¦¬ ì‹œì‘\");\r",
									"\r",
									"    // ğŸ”‘ í™˜ê²½ë³€ìˆ˜ì—ì„œ í† í° ì‚­ì œ\r",
									"    pm.environment.unset(\"access_token\");\r",
									"    console.log(\"ğŸ—‘ï¸ accessToken ì‚­ì œ ì™„ë£Œ\");\r",
									"\r",
									"\r",
									"} else {\r",
									"    pm.test(\"ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨\", function () {\r",
									"        pm.expect(pm.response.code).to.eql(200);\r",
									"    });\r",
									"    console.log(\"âŒ ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨ - ì‘ë‹µì½”ë“œ:\", pm.response.code);\r",
									"}\r",
									"(function () {\r",
									"  const TAG = '[AGG]';\r",
									"\r",
									"  try {\r",
									"    // ìš”ì•½ ì „ì†¡ ìš”ì²­ì€ ì§‘ê³„ ì œì™¸\r",
									"    const isSummary = pm.info.requestName === '__Send Summary to Teams';\r",
									"    console.log(TAG, 'request =', pm.info.requestName, 'isSummary =', isSummary);\r",
									"    if (isSummary) return;\r",
									"\r",
									"    // í˜„ì¬ ì¹´ìš´í„° ìƒíƒœ(ì—…ë°ì´íŠ¸ ì „)\r",
									"    const before = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"    };\r",
									"    console.log(TAG, 'before counters =', before);\r",
									"\r",
									"    // ê°„ë‹¨ PASS ê¸°ì¤€: HTTP 2xx\r",
									"    const ok = pm.response.code >= 200 && pm.response.code < 300;\r",
									"\r",
									"    const row = {\r",
									"      name: pm.info.requestName,\r",
									"      method: pm.request.method,\r",
									"      url: pm.request.url.toString(),\r",
									"      status: pm.response.code,\r",
									"      time_ms: pm.response.responseTime,\r",
									"      ok\r",
									"    };\r",
									"\r",
									"    // ë¡œê·¸ ì ì¬\r",
									"    let rows = [];\r",
									"    try {\r",
									"      rows = JSON.parse(pm.collectionVariables.get('__log') || '[]');\r",
									"    } catch (e) {\r",
									"      console.error(TAG, 'parse __log error:', e);\r",
									"      rows = [];\r",
									"    }\r",
									"    rows.push(row);\r",
									"    pm.collectionVariables.set('__log', JSON.stringify(rows));\r",
									"\r",
									"    // ì¹´ìš´í„° ì—…ë°ì´íŠ¸(ì¦ë¶„ ë°©ì‹)\r",
									"    pm.collectionVariables.set('__req_total', before.total + 1);\r",
									"    pm.collectionVariables.set('__req_pass',  before.pass  + (ok ? 1 : 0));\r",
									"    pm.collectionVariables.set('__req_fail',  before.fail  + (ok ? 0 : 1));\r",
									"\r",
									"    // ì—…ë°ì´íŠ¸ í›„ ìƒíƒœ\r",
									"    const after = {\r",
									"      total: Number(pm.collectionVariables.get('__req_total') || 0),\r",
									"      pass:  Number(pm.collectionVariables.get('__req_pass')  || 0),\r",
									"      fail:  Number(pm.collectionVariables.get('__req_fail')  || 0),\r",
									"      last:  row\r",
									"    };\r",
									"    console.log(TAG, 'after counters =', after);\r",
									"  } catch (err) {\r",
									"    console.error('[AGG ERROR]', err);\r",
									"    pm.test('Aggregation script error').fail(String(err));\r",
									"  }\r",
									"  \r",
									"})();\r",
									"// í† í° ì‚­ì œ í™•ì¸ìš©\r",
									"console.log(\"ğŸ“Œ ë¡œê·¸ì•„ì›ƒ ìš”ì²­ í—¤ë”:\", pm.request.headers.toObject());\r",
									"console.log(\"ğŸ“Œ accessToken:\", pm.environment.get(\"access_token\"));\r",
									"console.log(\"ğŸ“Œ ë¡œê·¸ì•„ì›ƒ ì‘ë‹µ Body:\", pm.response.text());\r",
									"\r",
									"\r",
									"// === [AGG DEBUG] ëª¨ë“  ìš”ì²­ ë’¤ì— ì‹¤í–‰ë˜ì–´ ë¡œê·¸/ì¹´ìš´íŠ¸ ëˆ„ì  ===\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "DELETE",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "{{access_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://127.0.0.1/identity/api/access/logout",
							"protocol": "http",
							"host": [
								"127",
								"0",
								"0",
								"1"
							],
							"path": [
								"identity",
								"api",
								"access",
								"logout"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Teams webhook",
			"item": [
				{
					"name": "íŒ€ì¦ˆ ì›¹í›… ì „ì†¡",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// === í•œë²ˆë§Œ ì´ˆê¸°í™” ===\r",
									" {\r",
									"  pm.collectionVariables.set('__agg_init', '1');\r",
									"  pm.collectionVariables.set('__run_started', new Date().toISOString());\r",
									"  pm.collectionVariables.set('__log', '[]');\r",
									"  pm.collectionVariables.set('__req_total', 0);\r",
									"  pm.collectionVariables.set('__req_pass', 0);\r",
									"  pm.collectionVariables.set('__req_fail', 0);\r",
									"}"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"\r",
									"// === Teams MessageCard ìƒì„± & ë°”ë”” ì£¼ì… (ìš”ì•½ ì „ì†¡ ìš”ì²­ì˜ Pre-request) ===\r",
									"const total = Number(pm.collectionVariables.get('__req_total') || 0);\r",
									"const pass  = Number(pm.collectionVariables.get('__req_pass')  || 0);\r",
									"const fail  = Number(pm.collectionVariables.get('__req_fail')  || 0);\r",
									"let rows = [];\r",
									"try { rows = JSON.parse(pm.collectionVariables.get('__log') || '[]'); } catch (e) { rows = []; }\r",
									"\r",
									"console.log('[SUMMARY] counts =', { total, pass, fail });\r",
									"console.log('[SUMMARY] rows.length =', rows.length);\r",
									"\r",
									"// ìµœê·¼ 300ê±´ë§Œ í…ìŠ¤íŠ¸ ì„¹ì…˜ìœ¼ë¡œ\r",
									"const recent = rows.slice(-300).map(r =>\r",
									"  `- ${r.ok ? 'âœ…' : 'âŒ'} **${r.name}** \\`${r.status}\\` ${r.time_ms}ms`\r",
									").join('\\n');\r",
									"\r",
									"const card = {\r",
									"  \"@type\": \"MessageCard\",\r",
									"  \"@context\": \"https://schema.org/extensions\",\r",
									"  \"summary\": \"Postman Collection Run Summary\",\r",
									"  \"themeColor\": fail > 0 ? \"FF0000\" : \"00C853\",\r",
									"  \"title\": `AD 3.0.1 API Test ê²°ê³¼: ${pass}/${total} PASS (fail: ${fail})`,\r",
									"  \"sections\": [\r",
									"    {\r",
									"      \"facts\": [\r",
									"        { \"name\": \"Started\", \"value\": String(pm.collectionVariables.get('__run_started') || \"\") },\r",
									"        { \"name\": \"Total\",   \"value\": String(total) },\r",
									"        { \"name\": \"Pass\",    \"value\": String(pass) },\r",
									"        { \"name\": \"Fail\",    \"value\": String(fail) }\r",
									"      ],\r",
									"      \r",
									"      \"markdown\": true\r",
									"    },\r",
									"    ...(recent ? [{\r",
									"      \"title\": \"í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤\",\r",
									"      \"text\": recent,\r",
									"      \"markdown\": true\r",
									"    }] : [])\r",
									"  ]\r",
									"};\r",
									"\r",
									"pm.request.headers.upsert({ key: \"Content-Type\", value: \"application/json\" });\r",
									"pm.request.body.mode = \"raw\";\r",
									"pm.request.body.update(JSON.stringify(card));"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{WEBHOOK_URL}}",
							"host": [
								"{{WEBHOOK_URL}}"
							]
						}
					},
					"response": []
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"packages": {},
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"packages": {},
				"exec": [
					"console.log('ì»¬ë ‰ì…˜ Post-Response ë™ì‘ í™•ì¸ ');\r",
					"\r",
					"// === AGG: update after each request ===\r",
					"(function () {\r",
					"  const NAME_SUMMARY = '__Send Summary to Teams';\r",
					"  if (pm.info.requestName === NAME_SUMMARY) { console.log('[AGG] skip summary request'); return; }\r",
					"\r",
					"  // í˜„ì¬ ìƒíƒœ ë¡œë“œ(ê¹¨ì¡Œìœ¼ë©´ ë°©ì–´ì  ì¬ìƒì„±)\r",
					"  let st = {};\r",
					"  try { st = JSON.parse(pm.collectionVariables.get('AGG_STATE') || '{}'); } catch (e) { st = {}; }\r",
					"  if (!st || !st.rows) st = { runId: Date.now().toString(), started: new Date().toISOString(), total: 0, pass: 0, fail: 0, rows: [] };\r",
					"\r",
					"  // PASS ê¸°ì¤€: HTTP 2xx (+ì„ íƒ) assertion ì‹¤íŒ¨ í”Œë˜ê·¸ ë°˜ì˜\r",
					"  const hasAssertFail = pm.variables.get('ASSERT_FAIL') === '1';\r",
					"  const ok = (pm.response.code >= 200 && pm.response.code < 300) && !hasAssertFail;\r",
					"\r",
					"  const row = {\r",
					"    name: pm.info.requestName,\r",
					"    method: pm.request.method,\r",
					"    url: pm.request.url.toString(),\r",
					"    status: pm.response.code,\r",
					"    time_ms: pm.response.responseTime,\r",
					"    ok\r",
					"  };\r",
					"\r",
					"  st.rows.push(row);\r",
					"  st.total += 1;\r",
					"  if (ok) st.pass += 1; else st.fail += 1;\r",
					"\r",
					"  pm.collectionVariables.set('AGG_STATE', JSON.stringify(st));\r",
					"  console.log('[AGG:update]', { total: st.total, pass: st.pass, fail: st.fail, last: row.name });\r",
					"})();\r",
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "WEBHOOK_URL",
			"value": ""
		},
		{
			"key": "__run_started",
			"value": ""
		},
		{
			"key": "__req_total",
			"value": ""
		},
		{
			"key": "__req_pass",
			"value": ""
		},
		{
			"key": "__req_fail",
			"value": ""
		},
		{
			"key": "__log",
			"value": ""
		},
		{
			"key": "__env_name",
			"value": ""
		},
		{
			"key": "__agg_init",
			"value": ""
		},
		{
			"key": "AGG_STATE",
			"value": ""
		},
		{
			"key": "__upload_file_ok",
			"value": ""
		},
		{
			"key": "__commit_expect",
			"value": ""
		},
		{
			"key": "__upload_file_result",
			"value": ""
		},
		{
			"key": "RUN_CASES_JSON",
			"value": ""
		},
		{
			"key": "SORT_TOTAL_CASES",
			"value": ""
		},
		{
			"key": "SORT_CURRENT_CASE",
			"value": ""
		},
		{
			"key": "SORT_AGG",
			"value": ""
		},
		{
			"key": "SORT_LOOPS",
			"value": ""
		},
		{
			"key": "SORT_SUMMARY",
			"value": ""
		},
		{
			"key": "id",
			"value": ""
		},
		{
			"key": "PATIENT_ID",
			"value": "",
			"type": "default"
		},
		{
			"key": "LOCK_LAST_HTTP",
			"value": ""
		},
		{
			"key": "LOCK_LAST_SVC",
			"value": ""
		},
		{
			"key": "LOCK_LAST_TRY",
			"value": ""
		},
		{
			"key": "LOCK_LAST_MAX",
			"value": ""
		},
		{
			"key": "LOCK_OK",
			"value": ""
		},
		{
			"key": "LOCK_LOCKED",
			"value": ""
		},
		{
			"key": "aeTitle",
			"value": ""
		},
		{
			"key": "RUO_LAST",
			"value": ""
		},
		{
			"key": "SYS_CONFIG",
			"value": ""
		}
	]
}